<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::storage::masstree::MasstreePartitioner Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::storage::masstree::MasstreePartitioner Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__STORAGE.html">Storage Manager</a> &raquo; <a class="el" href="group__MASSTREE.html">Masstree Storage</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classfoedus_1_1storage_1_1Partitioner.html" title="Partitioning and sorting logic for one storage. ">Partitioner</a> for a masstree storage.  
 <a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classfoedus_1_1storage_1_1Partitioner.html" title="Partitioning and sorting logic for one storage. ">Partitioner</a> for a masstree storage. </p>
<p>The partitioner for masstree simply designs <em>n</em> pairs of a <em>low-key</em> and <em>node</em>.</p>
<dl class="section user"><dt>Low-key</dt><dd>Low-key marks the inclusive beginning of the partition with arbitrary length. For example, <ul>
<li>(low-key: zero-length string, node=0) </li>
<li>(low-key: "e", node=1) </li>
<li>(low-key: "k", node=2) </li>
<li>(low-key: "r", node=1) </li>
<li>(low-key: "w", node=2)</li>
</ul>
This means there are 5 partitions placed in 3 nodes. "abc" would be in node 0, "z" would be in node 2, etc. We so far don't do KeySlice optimization used in the transactional-processing side. We might do that later, but let's see if log gleaner is fast enough without fancy optimization.</dd></dl>
<dl class="section user"><dt>Design policy</dt><dd>Not suprisingly, the partition design logic is more complex than array and sequential. But, we still want to make partitioner/composer as simple as possible. The compromise is as follows.</dd></dl>
<dl class="section user"><dt>One slice as partition key</dt><dd>For efficiency and simplicity we always use one KeySlice (8-bytes) as low-key. We initially explored arbitrary length partitiong keys, but it causes too much overhead and complexity. By using one KeySlice, all comparison is just an integer comparison and fixed-sized.</dd></dl>
<dl class="section user"><dt>Enumerating partitions</dt><dd>With this simplification, partition design just checks the root page of first layer. If it's a border page, everything to node 0. If it's an intermediate page, we use separators in it as partitions. Stupidly simple. For each pointer, we determine the owner node simply based on the last updater of the pointed page, which is a rough statistics in the page header (no correctness guaranteed).</dd></dl>
<dl class="section user"><dt>Expected issues</dt><dd>The scheme above is so simple and easy to implement/maintain. Of course the simplicity has its price. If all keys start with a common 8-bytes, we are screwed. If pointer-distributions are skewed, eg one pointer leads to billion records while other pointers lead to just one record, it will result in one node receiving almost all records. Nevertheless, the branch-page/partition framework above is flexible enough to address the issue later. We just need advanced algorithm to enumerate branch pages and determine owners. Let's keep it simple for now, and work on this later.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This is a private implementation-details of <a class="el" href="group__MASSTREE.html">Masstree Storage</a>, thus file name ends with _impl. Do not include this header from a client program. There is no case client program needs to access this internal class. </dd></dl>

<p>Definition at line <a class="el" href="masstree__partitioner__impl_8hpp_source.html#l00098">98</a> of file <a class="el" href="masstree__partitioner__impl_8hpp_source.html">masstree_partitioner_impl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="masstree__partitioner__impl_8hpp_source.html">masstree_partitioner_impl.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9cbd3bf85a0f48ca30e2e2228361de90"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#a9cbd3bf85a0f48ca30e2e2228361de90">MasstreePartitioner</a> (<a class="el" href="classfoedus_1_1storage_1_1Partitioner.html">Partitioner</a> *parent)</td></tr>
<tr class="memdesc:a9cbd3bf85a0f48ca30e2e2228361de90"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html" title="Partitioner for a masstree storage. ">MasstreePartitioner</a> methods.  <a href="#a9cbd3bf85a0f48ca30e2e2228361de90">More...</a><br /></td></tr>
<tr class="separator:a9cbd3bf85a0f48ca30e2e2228361de90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1aedc45cc5621bd3889f1bf2d47ab79c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#a1aedc45cc5621bd3889f1bf2d47ab79c">design_partition</a> (const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Partitioner_1_1DesignPartitionArguments">Partitioner::DesignPartitionArguments</a> &amp;args)</td></tr>
<tr class="separator:a1aedc45cc5621bd3889f1bf2d47ab79c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7ec6a90c21df726dca9abfa46ea465a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#af7ec6a90c21df726dca9abfa46ea465a">is_partitionable</a> () const </td></tr>
<tr class="separator:af7ec6a90c21df726dca9abfa46ea465a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa88be4c928d4254f51e1e1252680f87e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#aa88be4c928d4254f51e1e1252680f87e">partition_batch</a> (const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Partitioner_1_1PartitionBatchArguments">Partitioner::PartitionBatchArguments</a> &amp;args) const </td></tr>
<tr class="separator:aa88be4c928d4254f51e1e1252680f87e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afac4c5dbd64695fb997e570dec3a5745"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#afac4c5dbd64695fb997e570dec3a5745">sort_batch</a> (const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Partitioner_1_1SortBatchArguments">Partitioner::SortBatchArguments</a> &amp;args) const </td></tr>
<tr class="separator:afac4c5dbd64695fb997e570dec3a5745"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:ac067d5cdc21dfc47c97e864f5204b17b"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#ac067d5cdc21dfc47c97e864f5204b17b">operator&lt;&lt;</a> (std::ostream &amp;o, const <a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html">MasstreePartitioner</a> &amp;v)</td></tr>
<tr class="separator:ac067d5cdc21dfc47c97e864f5204b17b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a9cbd3bf85a0f48ca30e2e2228361de90"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::storage::masstree::MasstreePartitioner::MasstreePartitioner </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1Partitioner.html">Partitioner</a> *&#160;</td>
          <td class="paramname"><em>parent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html" title="Partitioner for a masstree storage. ">MasstreePartitioner</a> methods. </p>

<p>Definition at line <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00053">53</a> of file <a class="el" href="masstree__partitioner__impl_8cpp_source.html">masstree_partitioner_impl.cpp</a>.</p>

<p>References <a class="el" href="partitioner_8cpp_source.html#l00051">foedus::storage::PartitionerMetadata::locate_data()</a>, and <a class="el" href="partitioner_8hpp_source.html#l00237">foedus::storage::PartitionerMetadata::valid_</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  : engine_(parent-&gt;get_engine()),</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    id_(parent-&gt;get_storage_id()),</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    metadata_(<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#aa6e48ddb92bb1c1b572cc3b90e19daf9">PartitionerMetadata::get_metadata</a>(engine_, id_)) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> (metadata_-&gt;<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a63a799f43dfcc06d8c14d471fd0ebfcd">valid_</a>) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    data_ = <span class="keyword">reinterpret_cast&lt;</span>MasstreePartitionerData*<span class="keyword">&gt;</span>(metadata_-&gt;<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a0534520d3f4fb059afdf7b9db375907e">locate_data</a>(engine_));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    data_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1PartitionerMetadata_html_a63a799f43dfcc06d8c14d471fd0ebfcd"><div class="ttname"><a href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a63a799f43dfcc06d8c14d471fd0ebfcd">foedus::storage::PartitionerMetadata::valid_</a></div><div class="ttdeci">bool valid_</div><div class="ttdoc">Whether this partitioner information (metadata+data) has been constructed. </div><div class="ttdef"><b>Definition:</b> <a href="partitioner_8hpp_source.html#l00237">partitioner.hpp:237</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PartitionerMetadata_html_a0534520d3f4fb059afdf7b9db375907e"><div class="ttname"><a href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a0534520d3f4fb059afdf7b9db375907e">foedus::storage::PartitionerMetadata::locate_data</a></div><div class="ttdeci">void * locate_data(Engine *engine)</div><div class="ttdoc">Returns the partitioner data pointed from this metadata. </div><div class="ttdef"><b>Definition:</b> <a href="partitioner_8cpp_source.html#l00051">partitioner.cpp:51</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PartitionerMetadata_html_aa6e48ddb92bb1c1b572cc3b90e19daf9"><div class="ttname"><a href="structfoedus_1_1storage_1_1PartitionerMetadata.html#aa6e48ddb92bb1c1b572cc3b90e19daf9">foedus::storage::PartitionerMetadata::get_metadata</a></div><div class="ttdeci">static PartitionerMetadata * get_metadata(Engine *engine, StorageId id)</div><div class="ttdoc">Returns the shared memory for the given storage ID. </div><div class="ttdef"><b>Definition:</b> <a href="partitioner_8cpp_source.html#l00038">partitioner.cpp:38</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a9cbd3bf85a0f48ca30e2e2228361de90_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a9cbd3bf85a0f48ca30e2e2228361de90_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a9cbd3bf85a0f48ca30e2e2228361de90_cgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a9cbd3bf85a0f48ca30e2e2228361de90_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a0534520d3f4fb059afdf7b9db375907e" title="Returns the partitioner data pointed from this metadata. " alt="" coords="227,119,405,161"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb" title="foedus::soc::SharedMemory\lRepo::get_global_memory\l_anchors" alt="" coords="453,5,639,61"/>
<area shape="rect" id="node4" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="479,86,613,127"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c" title="Returns the shared memories maintained across SOCs. " alt="" coords="456,151,636,193"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e" title="See SOC and IPC. " alt="" coords="479,217,613,258"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a1aedc45cc5621bd3889f1bf2d47ab79c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::storage::masstree::MasstreePartitioner::design_partition </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Partitioner_1_1DesignPartitionArguments">Partitioner::DesignPartitionArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00064">64</a> of file <a class="el" href="masstree__partitioner__impl_8cpp_source.html">masstree_partitioner_impl.cpp</a>.</p>

<p>References <a class="el" href="partitioner_8cpp_source.html#l00061">foedus::storage::PartitionerMetadata::allocate_data()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="aligned__memory_8cpp_source.html#l00182">foedus::memory::AlignedMemory::assure_capacity()</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="storage__id_8hpp_source.html#l00095">foedus::storage::extract_numa_node_from_snapshot_pointer()</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00168">foedus::memory::AlignedMemory::get_block()</a>, <a class="el" href="attachable_8hpp_source.html#l00097">foedus::Attachable&lt; CONTROL_BLOCK &gt;::get_control_block()</a>, <a class="el" href="engine__memory_8hpp_source.html#l00090">foedus::memory::EngineMemory::get_global_volatile_page_resolver()</a>, <a class="el" href="engine_8cpp_source.html#l00050">foedus::Engine::get_memory_manager()</a>, <a class="el" href="engine_8cpp_source.html#l00074">foedus::Engine::get_soc_count()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00084">foedus::storage::masstree::MasstreePage::is_border()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l01067">foedus::storage::masstree::MasstreeIntermediatePointerIterator::is_valid()</a>, <a class="el" href="masstree__id_8hpp_source.html#l00132">foedus::storage::masstree::kInfimumSlice</a>, <a class="el" href="storage__id_8hpp_source.html#l00045">foedus::storage::kPageSize</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="partitioner_8cpp_source.html#l00051">foedus::storage::PartitionerMetadata::locate_data()</a>, <a class="el" href="partitioner_8hpp_source.html#l00232">foedus::storage::PartitionerMetadata::mutex_</a>, <a class="el" href="snapshot__file__set_8cpp_source.html#l00095">foedus::cache::SnapshotFileSet::read_page()</a>, <a class="el" href="page__resolver_8hpp_source.html#l00120">foedus::memory::GlobalVolatilePageResolver::resolve_offset()</a>, <a class="el" href="masstree__storage__pimpl_8hpp_source.html#l00072">foedus::storage::masstree::MasstreeStorageControlBlock::root_page_pointer_</a>, <a class="el" href="partitioner_8hpp_source.html#l00104">foedus::storage::Partitioner::DesignPartitionArguments::snapshot_files_</a>, <a class="el" href="storage__id_8hpp_source.html#l00307">foedus::storage::DualPagePointer::snapshot_pointer_</a>, <a class="el" href="partitioner_8hpp_source.html#l00237">foedus::storage::PartitionerMetadata::valid_</a>, <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>, <a class="el" href="partitioner_8hpp_source.html#l00103">foedus::storage::Partitioner::DesignPartitionArguments::work_memory_</a>, and <a class="el" href="error__stack_8hpp_source.html#l00533">WRAP_ERROR_CODE</a>.</p>

<p>Referenced by <a class="el" href="partitioner_8cpp_source.html#l00106">foedus::storage::Partitioner::design_partition()</a>.</p>
<div class="fragment"><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                                   {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  MasstreeStorage storage(engine_, id_);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  MasstreeStorageControlBlock* control_block = storage.get_control_block();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keyword">const</span> memory::GlobalVolatilePageResolver&amp; resolver</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    = engine_-&gt;<a class="code" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">get_memory_manager</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0">get_global_volatile_page_resolver</a>();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// Read current volatile version and previous snapshot version of the root page</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(args.work_memory_-&gt;assure_capacity(<a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a> * 2));</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  Page* buffers = <span class="keyword">reinterpret_cast&lt;</span>Page*<span class="keyword">&gt;</span>(args.work_memory_-&gt;get_block());</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  MasstreeIntermediatePage* vol = <span class="keyword">reinterpret_cast&lt;</span>MasstreeIntermediatePage*<span class="keyword">&gt;</span>(buffers);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  MasstreeIntermediatePage* snp = <span class="keyword">reinterpret_cast&lt;</span>MasstreeIntermediatePage*<span class="keyword">&gt;</span>(buffers + 1);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> snapshot_page_id = control_block-&gt;root_page_pointer_.snapshot_pointer_;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  MasstreeIntermediatePage* root_volatile = <span class="keyword">reinterpret_cast&lt;</span>MasstreeIntermediatePage*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    resolver.resolve_offset(control_block-&gt;root_page_pointer_.volatile_pointer_));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(read_page_safe(root_volatile, vol));</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">if</span> (snapshot_page_id != 0) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(args.snapshot_files_-&gt;read_page(snapshot_page_id, snp));</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  soc::SharedMutexScope scope(&amp;metadata_-&gt;<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a1b5e5a68b2cde0cd42300642f3b538a3">mutex_</a>);  <span class="comment">// protect this metadata</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (metadata_-&gt;<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a63a799f43dfcc06d8c14d471fd0ebfcd">valid_</a>) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// someone has already initialized this??</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    LOG(FATAL) &lt;&lt; <span class="stringliteral">&quot;Masstree-&quot;</span> &lt;&lt; id_ &lt;&lt; <span class="stringliteral">&quot; partition already designed??:&quot;</span> &lt;&lt; *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(metadata_-&gt;<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a3b5c729829a30ca3848d8254d616459a">allocate_data</a>(engine_, &amp;scope, <span class="keyword">sizeof</span>(MasstreePartitionerData)));</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  data_ = <span class="keyword">reinterpret_cast&lt;</span>MasstreePartitionerData*<span class="keyword">&gt;</span>(metadata_-&gt;<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a0534520d3f4fb059afdf7b9db375907e">locate_data</a>(engine_));</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!vol-&gt;is_border());</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> (engine_-&gt;<a class="code" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">get_soc_count</a>() == 1U) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// no partitioning needed</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    data_-&gt;partition_count_ = 1;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    data_-&gt;low_keys_[0] = <a class="code" href="namespacefoedus_1_1storage_1_1masstree.html#a9cffc20f29ad72d4edbeedece861c48f">kInfimumSlice</a>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    data_-&gt;partitions_[0] = 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// simply the separators in root page is the partition keys.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// if we already have a snapshot page, we use the same partition keys, though</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// assigned nodes might be changed</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    data_-&gt;partition_count_ = 0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (snapshot_page_id == 0) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(design_partition_first(vol));</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="comment">// So far same assignment as previous snapshot.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="comment">// TODO(Hideaki) check current volatile pages to change the assignments.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="keywordflow">for</span> (MasstreeIntermediatePointerIterator it(snp); it.is_valid(); it.next()) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        data_-&gt;low_keys_[data_-&gt;partition_count_] = it.get_low_key();</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> pointer = it.get_pointer().snapshot_pointer_;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        uint16_t assignment = <a class="code" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">extract_numa_node_from_snapshot_pointer</a>(pointer);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        data_-&gt;partitions_[data_-&gt;partition_count_] = assignment;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        ++data_-&gt;partition_count_;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  metadata_-&gt;<a class="code" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a63a799f43dfcc06d8c14d471fd0ebfcd">valid_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Masstree-&quot;</span> &lt;&lt; id_ &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot; partitions:&quot;</span> &lt;&lt; *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1PartitionerMetadata_html_a63a799f43dfcc06d8c14d471fd0ebfcd"><div class="ttname"><a href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a63a799f43dfcc06d8c14d471fd0ebfcd">foedus::storage::PartitionerMetadata::valid_</a></div><div class="ttdeci">bool valid_</div><div class="ttdoc">Whether this partitioner information (metadata+data) has been constructed. </div><div class="ttdef"><b>Definition:</b> <a href="partitioner_8hpp_source.html#l00237">partitioner.hpp:237</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1masstree_html_a9cffc20f29ad72d4edbeedece861c48f"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1masstree.html#a9cffc20f29ad72d4edbeedece861c48f">foedus::storage::masstree::kInfimumSlice</a></div><div class="ttdeci">const KeySlice kInfimumSlice</div><div class="ttdef"><b>Definition:</b> <a href="masstree__id_8hpp_source.html#l00132">masstree_id.hpp:132</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1EngineMemory_html_a62b2d4de6a72644e9e31d35a7f9beae0"><div class="ttname"><a href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0">foedus::memory::EngineMemory::get_global_volatile_page_resolver</a></div><div class="ttdeci">const GlobalVolatilePageResolver &amp; get_global_volatile_page_resolver() const </div><div class="ttdoc">Returns the page resolver to convert volatile page ID to page pointer. </div><div class="ttdef"><b>Definition:</b> <a href="engine__memory_8hpp_source.html#l00090">engine_memory.hpp:90</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_af0ac9dbae9481b295a8492c6d9f6c1d5"><div class="ttname"><a href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">foedus::Engine::get_soc_count</a></div><div class="ttdeci">soc::SocId get_soc_count() const </div><div class="ttdoc">Shorthand for get_options().thread_.group_count_. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00074">engine.cpp:74</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga629d4b8103bfb83ef9c11b842a4fd398"><div class="ttname"><a href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">foedus::storage::SnapshotPagePointer</a></div><div class="ttdeci">uint64_t SnapshotPagePointer</div><div class="ttdoc">Page ID of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00079">storage_id.hpp:79</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PartitionerMetadata_html_a3b5c729829a30ca3848d8254d616459a"><div class="ttname"><a href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a3b5c729829a30ca3848d8254d616459a">foedus::storage::PartitionerMetadata::allocate_data</a></div><div class="ttdeci">ErrorCode allocate_data(Engine *engine, soc::SharedMutexScope *locked, uint32_t data_size)</div><div class="ttdoc">Allocates a patitioner data in shared memory of the given size. </div><div class="ttdef"><b>Definition:</b> <a href="partitioner_8cpp_source.html#l00061">partitioner.cpp:61</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PartitionerMetadata_html_a1b5e5a68b2cde0cd42300642f3b538a3"><div class="ttname"><a href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a1b5e5a68b2cde0cd42300642f3b538a3">foedus::storage::PartitionerMetadata::mutex_</a></div><div class="ttdeci">soc::SharedMutex mutex_</div><div class="ttdoc">Serialize concurrent initialization of this partitioner. </div><div class="ttdef"><b>Definition:</b> <a href="partitioner_8hpp_source.html#l00232">partitioner.hpp:232</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a8f6e96ac10eb804602349a54292d26a1"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">foedus::storage::extract_numa_node_from_snapshot_pointer</a></div><div class="ttdeci">uint8_t extract_numa_node_from_snapshot_pointer(SnapshotPagePointer pointer)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00095">storage_id.hpp:95</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PartitionerMetadata_html_a0534520d3f4fb059afdf7b9db375907e"><div class="ttname"><a href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a0534520d3f4fb059afdf7b9db375907e">foedus::storage::PartitionerMetadata::locate_data</a></div><div class="ttdeci">void * locate_data(Engine *engine)</div><div class="ttdoc">Returns the partitioner data pointed from this metadata. </div><div class="ttdef"><b>Definition:</b> <a href="partitioner_8cpp_source.html#l00051">partitioner.cpp:51</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga952ce4f5f860d7b28a70095b450d3f4d"><div class="ttname"><a href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a></div><div class="ttdeci">#define WRAP_ERROR_CODE(x)</div><div class="ttdoc">Same as CHECK_ERROR(x) except it receives only an error code, thus more efficient. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00533">error_stack.hpp:533</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a02ed05009c7baa8d75e04f202a86b2c6"><div class="ttname"><a href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">foedus::Engine::get_memory_manager</a></div><div class="ttdeci">memory::EngineMemory * get_memory_manager() const </div><div class="ttdoc">See Memory Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00050">engine.cpp:50</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga1a3c05fe1d44455fc3e761947c6e21e6"><div class="ttname"><a href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">foedus::storage::kPageSize</a></div><div class="ttdeci">const uint16_t kPageSize</div><div class="ttdoc">A constant defining the page size (in bytes) of both snapshot pages and volatile pages. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00045">storage_id.hpp:45</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_cgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a3b5c729829a30ca3848d8254d616459a" title="Allocates a patitioner data in shared memory of the given size. " alt="" coords="255,181,434,223"/>
<area shape="rect" id="node9" href="classfoedus_1_1memory_1_1AlignedMemory.html#ad79701492d232cb5aec1ad4d8c99eb5d" title="If the current size is smaller than the given size, automatically expands. " alt="" coords="238,344,451,385"/>
<area shape="rect" id="node12" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="773,690,961,746"/>
<area shape="rect" id="node13" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="238,697,451,739"/>
<area shape="rect" id="node14" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="279,763,411,804"/>
<area shape="rect" id="node15" href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0" title="Returns the page resolver to convert volatile page ID to page pointer. " alt="" coords="239,829,450,885"/>
<area shape="rect" id="node16" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6" title="See Memory Manager. " alt="" coords="277,909,412,951"/>
<area shape="rect" id="node17" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="277,975,412,1016"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a1a6f55a5a59bcab9631bbb879da689ec" title="foedus::storage::masstree\l::MasstreePage::is_border" alt="" coords="257,1040,432,1081"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePointerIterator.html#acd0b166a127ed5fbadecd838f8e32be5" title="foedus::storage::masstree\l::MasstreeIntermediatePointerIterator\l::is_valid" alt="" coords="227,1277,463,1333"/>
<area shape="rect" id="node23" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a0534520d3f4fb059afdf7b9db375907e" title="Returns the partitioner data pointed from this metadata. " alt="" coords="528,17,707,59"/>
<area shape="rect" id="node25" href="classfoedus_1_1cache_1_1SnapshotFileSet.html#ad7ea1e9815cd47c3175371d37974526a" title="foedus::cache::SnapshotFile\lSet::read_page" alt="" coords="251,540,438,581"/>
<area shape="rect" id="node37" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f" title="Resolves offset plus NUMA node ID to storage::Page*. " alt="" coords="243,1105,446,1147"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a889951c15caacc4d60b446f6c6c56cde" title="Returns the special index&#45;0 entry that manages data block allocation for partitioners. " alt="" coords="513,213,721,255"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SharedMutexScope.html#a51a27729ac214786ce97d32ae80dd6f7" title="foedus::soc::SharedMutex\lScope::get_mutex" alt="" coords="530,148,705,189"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SharedMutexScope.html#a9576d709cf25478f4fe81a8362ba7636" title="foedus::soc::SharedMutex\lScope::is_locked_by_me" alt="" coords="530,83,705,124"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb" title="foedus::soc::SharedMemory\lRepo::get_global_memory\l_anchors" alt="" coords="775,202,960,258"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c" title="Returns the shared memories maintained across SOCs. " alt="" coords="777,71,957,112"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e" title="See SOC and IPC. " alt="" coords="800,136,935,177"/>
<area shape="rect" id="node10" href="classfoedus_1_1memory_1_1AlignedMemory.html#ad11d2289458b26db2aaef9de984045a0" title="Returns if this object doesn&#39;t hold a valid memory block. " alt="" coords="511,279,724,320"/>
<area shape="rect" id="node11" href="classfoedus_1_1memory_1_1AlignedMemory.html#afd955f5f991e28943c72ecff1167c16b" title="Releases the memory block. " alt="" coords="511,344,724,385"/>
<area shape="rect" id="node19" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956" title="foedus::storage::PageHeader\l::get_page_type" alt="" coords="772,984,963,1025"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec" title="physical key count (those keys might be deleted) in this page. " alt="" coords="514,1284,721,1325"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a1cb83de15afc0a903046937276b0ed31" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::get_minipage" alt="" coords="525,1350,710,1406"/>
<area shape="rect" id="node24" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="800,5,935,47"/>
<area shape="rect" id="node26" href="namespacefoedus_1_1storage.html#a3c3e7a984303d1ef88e001db1591b1be" title="foedus::storage::extract\l_local_page_id_from_snapshot\l_pointer" alt="" coords="517,606,717,662"/>
<area shape="rect" id="node27" href="classfoedus_1_1cache_1_1SnapshotFileSet.html#ae5b153acb9f3115c44a48e10ff2262fb" title="foedus::cache::SnapshotFile\lSet::get_or_open_file" alt="" coords="524,540,711,581"/>
<area shape="rect" id="node29" href="classfoedus_1_1fs_1_1DirectIoFile.html#a5353bbb3b2a815d6c858c8190edeccf4" title="A version that receives a raw pointer that has to be aligned (be careful to use this ver)..." alt="" coords="542,475,693,516"/>
<area shape="rect" id="node36" href="classfoedus_1_1fs_1_1DirectIoFile.html#a35814dfec4dab81d5bb46e453f1993e6" title="Sets the position of the next byte to be written/extracted from/to the stream. " alt="" coords="542,409,693,451"/>
<area shape="rect" id="node28" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="772,610,963,666"/>
<area shape="rect" id="node30" href="namespacefoedus_1_1fs.html#a1a3ea81bf627928d9a5f154986af9c48" title="foedus::fs::is_odirect\l_aligned" alt="" coords="796,348,939,389"/>
<area shape="rect" id="node31" href="classfoedus_1_1fs_1_1DirectIoFile.html#a1d89a9c761a388f13f9b59490b6caa00" title="Whether the file is already and successfully opened. " alt="" coords="792,544,943,585"/>
<area shape="rect" id="node32" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="797,413,937,455"/>
<area shape="rect" id="node33" href="classfoedus_1_1fs_1_1DirectIoFile.html#a1c6bff6aafc955fd4c2a8e11e7f41f40" title="Sequentially read the given amount of contents from the current position. " alt="" coords="792,479,943,520"/>
<area shape="rect" id="node34" href="group__DEBUGGING.html#gac7eac15b41b0fab4e689f62d147ce620" title="Wait until the given CPU cycles elapse. " alt="" coords="800,283,935,324"/>
<area shape="rect" id="node35" href="group__DEBUGGING.html#ga48dd46b3a1382506a34fcb4e6e0941f6" title="Returns the current CPU cycle via x86 RDTSC. " alt="" coords="1011,283,1145,324"/>
<area shape="rect" id="node38" href="namespacefoedus_1_1storage.html#a9220f4aff16817a668990bd85f2f527d" title="foedus::storage::assert\l_valid_volatile_page" alt="" coords="540,1137,695,1179"/>
<area shape="rect" id="node40" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="793,1060,942,1101"/>
<area shape="rect" id="node42" href="namespacefoedus_1_1storage.html#a67e1af2de6e13b000e66609cf60849b6" title="foedus::storage::construct\l_volatile_page_pointer" alt="" coords="531,1072,704,1113"/>
<area shape="rect" id="node43" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a63ab3e809b38145565cef7791f211a35" title="As the name suggests, this version is for new pages, which don&#39;t have sanity checks. " alt="" coords="516,1203,719,1259"/>
<area shape="rect" id="node39" href="namespacefoedus_1_1storage.html#ab7207e6e276af504c0e358a923ee75ec" title="foedus::storage::assert\l_aligned_page" alt="" coords="790,1207,945,1248"/>
<area shape="rect" id="node41" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="787,1137,948,1179"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_icgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_a1aedc45cc5621bd3889f1bf2d47ab79c_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Partitioner.html#a31a7e393bf1f87a9a039c60b291ac9d1" title="Determines partitioning scheme for this storage. " alt="" coords="227,13,405,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af7ec6a90c21df726dca9abfa46ea465a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::storage::masstree::MasstreePartitioner::is_partitionable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00280">280</a> of file <a class="el" href="masstree__partitioner__impl_8cpp_source.html">masstree_partitioner_impl.cpp</a>.</p>

<p>References <a class="el" href="masstree__partitioner__impl_8hpp_source.html#l00146">foedus::storage::masstree::MasstreePartitionerData::partition_count_</a>.</p>

<p>Referenced by <a class="el" href="partitioner_8cpp_source.html#l00094">foedus::storage::Partitioner::is_partitionable()</a>, and <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00284">partition_batch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                                 {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">return</span> data_-&gt;<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData.html#ad4656cee2ce3375678213bedbb21cac0">partition_count_</a> &gt; 1U;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData_html_ad4656cee2ce3375678213bedbb21cac0"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData.html#ad4656cee2ce3375678213bedbb21cac0">foedus::storage::masstree::MasstreePartitionerData::partition_count_</a></div><div class="ttdeci">uint16_t partition_count_</div><div class="ttdef"><b>Definition:</b> <a href="masstree__partitioner__impl_8hpp_source.html#l00146">masstree_partitioner_impl.hpp:146</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_af7ec6a90c21df726dca9abfa46ea465a_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_af7ec6a90c21df726dca9abfa46ea465a_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_af7ec6a90c21df726dca9abfa46ea465a_icgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_af7ec6a90c21df726dca9abfa46ea465a_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Partitioner.html#ac031b933b72d2890fd24b90b1685110a" title="returns if this storage is partitionable. " alt="" coords="227,5,405,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#aa88be4c928d4254f51e1e1252680f87e" title="foedus::storage::masstree\l::MasstreePartitioner::\lpartition_batch" alt="" coords="229,71,403,127"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1Partitioner.html#a8c7b2f626b460815615663be4d22427f" title="Identifies the partition of each log record in a batched fashion. " alt="" coords="453,79,632,120"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa88be4c928d4254f51e1e1252680f87e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::storage::masstree::MasstreePartitioner::partition_batch </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Partitioner_1_1PartitionBatchArguments">Partitioner::PartitionBatchArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00284">284</a> of file <a class="el" href="masstree__partitioner__impl_8cpp_source.html">masstree_partitioner_impl.cpp</a>.</p>

<p>References <a class="el" href="rdtsc__watch_8hpp_source.html#l00052">foedus::debugging::RdtscWatch::elapsed()</a>, <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00527">foedus::storage::masstree::MasstreePartitionerData::find_partition()</a>, <a class="el" href="masstree__log__types_8hpp_source.html#l00104">foedus::storage::masstree::MasstreeCommonLogType::get_key()</a>, <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00280">is_partitionable()</a>, <a class="el" href="masstree__log__types_8hpp_source.html#l00088">foedus::storage::masstree::MasstreeCommonLogType::key_length_</a>, <a class="el" href="partitioner_8hpp_source.html#l00120">foedus::storage::Partitioner::PartitionBatchArguments::log_buffer_</a>, <a class="el" href="partitioner_8hpp_source.html#l00122">foedus::storage::Partitioner::PartitionBatchArguments::log_positions_</a>, <a class="el" href="partitioner_8hpp_source.html#l00124">foedus::storage::Partitioner::PartitionBatchArguments::logs_count_</a>, <a class="el" href="masstree__partitioner__impl_8hpp_source.html#l00146">foedus::storage::masstree::MasstreePartitionerData::partition_count_</a>, <a class="el" href="masstree__partitioner__impl_8hpp_source.html#l00221">foedus::storage::masstree::resolve_log()</a>, <a class="el" href="partitioner_8hpp_source.html#l00126">foedus::storage::Partitioner::PartitionBatchArguments::results_</a>, and <a class="el" href="rdtsc__watch_8hpp_source.html#l00047">foedus::debugging::RdtscWatch::stop()</a>.</p>

<p>Referenced by <a class="el" href="partitioner_8cpp_source.html#l00118">foedus::storage::Partitioner::partition_batch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                                                                              {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  debugging::RdtscWatch stop_watch;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#af7ec6a90c21df726dca9abfa46ea465a">is_partitionable</a>()) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    std::memset(args.results_, 0, <span class="keyword">sizeof</span>(<a class="code" href="group__STORAGE.html#ga0d50cbff79d98d6068fe0b8add81d06a">PartitionId</a>) * args.logs_count_);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; args.logs_count_; ++i) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keyword">const</span> MasstreeCommonLogType* rec = <a class="code" href="namespacefoedus_1_1storage_1_1masstree.html#a7df011f1d7015440e30e6013add5a667">resolve_log</a>(args.log_buffer_, args.log_positions_[i]);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    uint16_t key_length = rec-&gt;key_length_;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* key = rec-&gt;get_key();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    args.results_[i] = data_-&gt;<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData.html#ab637b0800009ad0f2ff8c2716bf1fee8">find_partition</a>(key, key_length);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Masstree-:&quot;</span> &lt;&lt; id_ &lt;&lt; <span class="stringliteral">&quot; took &quot;</span> &lt;&lt; stop_watch.elapsed() &lt;&lt; <span class="stringliteral">&quot;cycles&quot;</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; to partition &quot;</span> &lt;&lt; args.logs_count_ &lt;&lt; <span class="stringliteral">&quot; entries. #partitions=&quot;</span> &lt;&lt; data_-&gt;<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData.html#ad4656cee2ce3375678213bedbb21cac0">partition_count_</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">// if these binary searches are too costly, let&#39;s optimize them.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="ttc" id="group__STORAGE_html_ga0d50cbff79d98d6068fe0b8add81d06a"><div class="ttname"><a href="group__STORAGE.html#ga0d50cbff79d98d6068fe0b8add81d06a">foedus::storage::PartitionId</a></div><div class="ttdeci">thread::ThreadGroupId PartitionId</div><div class="ttdoc">As partition=NUMA node, this is just a synonym of foedus::thread::ThreadGroupId. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00065">storage_id.hpp:65</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData_html_ab637b0800009ad0f2ff8c2716bf1fee8"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData.html#ab637b0800009ad0f2ff8c2716bf1fee8">foedus::storage::masstree::MasstreePartitionerData::find_partition</a></div><div class="ttdeci">uint16_t find_partition(const char *key, uint16_t key_length) const </div><div class="ttdoc">Returns the partition (node ID) that should contain the key. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__partitioner__impl_8cpp_source.html#l00527">masstree_partitioner_impl.cpp:527</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData_html_ad4656cee2ce3375678213bedbb21cac0"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData.html#ad4656cee2ce3375678213bedbb21cac0">foedus::storage::masstree::MasstreePartitionerData::partition_count_</a></div><div class="ttdeci">uint16_t partition_count_</div><div class="ttdef"><b>Definition:</b> <a href="masstree__partitioner__impl_8hpp_source.html#l00146">masstree_partitioner_impl.hpp:146</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1masstree_html_a7df011f1d7015440e30e6013add5a667"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1masstree.html#a7df011f1d7015440e30e6013add5a667">foedus::storage::masstree::resolve_log</a></div><div class="ttdeci">const MasstreeCommonLogType * resolve_log(const snapshot::LogBuffer &amp;log_buffer, snapshot::BufferPosition pos)</div><div class="ttdef"><b>Definition:</b> <a href="masstree__partitioner__impl_8hpp_source.html#l00221">masstree_partitioner_impl.hpp:221</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_html_af7ec6a90c21df726dca9abfa46ea465a"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#af7ec6a90c21df726dca9abfa46ea465a">foedus::storage::masstree::MasstreePartitioner::is_partitionable</a></div><div class="ttdeci">bool is_partitionable() const </div><div class="ttdef"><b>Definition:</b> <a href="masstree__partitioner__impl_8cpp_source.html#l00280">masstree_partitioner_impl.cpp:280</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_cgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1debugging_1_1RdtscWatch.html#afc5d436b00dfd6af4727e4975e84aa75" title="foedus::debugging::\lRdtscWatch::elapsed" alt="" coords="498,188,645,229"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1masstree_1_1MasstreePartitionerData.html#ab637b0800009ad0f2ff8c2716bf1fee8" title="Returns the partition (node ID) that should contain the key. " alt="" coords="232,34,405,90"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeCommonLogType.html#aee0dcbac82c0486cd1d527f408b65c37" title="foedus::storage::masstree\l::MasstreeCommonLogType\l::get_key" alt="" coords="227,165,411,221"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html#af7ec6a90c21df726dca9abfa46ea465a" title="foedus::storage::masstree\l::MasstreePartitioner::\lis_partitionable" alt="" coords="232,245,405,301"/>
<area shape="rect" id="node8" href="namespacefoedus_1_1storage_1_1masstree.html#a7df011f1d7015440e30e6013add5a667" title="foedus::storage::masstree\l::resolve_log" alt="" coords="232,391,405,432"/>
<area shape="rect" id="node12" href="classfoedus_1_1debugging_1_1RdtscWatch.html#a0f5961269d79e636777d722ade37dd2e" title="Take another current time tick. " alt="" coords="251,325,386,367"/>
<area shape="rect" id="node4" href="group__MASSTREE.html#gaca11c6ba81d4c4c7708ca3bcdff3bfa0" title="Returns if the given key is 8&#45;bytes aligned and also zero&#45;padded to 8&#45;bytes for easier slicing (which..." alt="" coords="459,5,684,47"/>
<area shape="rect" id="node5" href="group__MASSTREE.html#ga48710f51199feed3db2e2f374ae73814" title="Convert an aligned big&#45;endian byte array of at least 8&#45;bytes&#45;length to KeySlice. " alt="" coords="485,71,658,127"/>
<area shape="rect" id="node9" href="structfoedus_1_1log_1_1LogHeader.html#a6ebe3b99442f2a58a4adeeb60f9a37e0" title="Convenience method to cast into LogCode. " alt="" coords="494,391,649,432"/>
<area shape="rect" id="node10" href="structfoedus_1_1snapshot_1_1LogBuffer.html#a4c866d7cc1684237eca5fff49215b80e" title="foedus::snapshot::LogBuffer\l::resolve" alt="" coords="480,456,663,497"/>
<area shape="rect" id="node11" href="namespacefoedus_1_1snapshot.html#a499edf9829f41f833e2057346e8bbf3a" title="foedus::snapshot::from\l_buffer_position" alt="" coords="732,456,887,497"/>
<area shape="rect" id="node13" href="group__DEBUGGING.html#ga48dd46b3a1382506a34fcb4e6e0941f6" title="Returns the current CPU cycle via x86 RDTSC. " alt="" coords="504,325,639,367"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_icgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_aa88be4c928d4254f51e1e1252680f87e_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Partitioner.html#a8c7b2f626b460815615663be4d22427f" title="Identifies the partition of each log record in a batched fashion. " alt="" coords="227,13,405,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afac4c5dbd64695fb997e570dec3a5745"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::storage::masstree::MasstreePartitioner::sort_batch </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Partitioner_1_1SortBatchArguments">Partitioner::SortBatchArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00489">489</a> of file <a class="el" href="masstree__partitioner__impl_8cpp_source.html">masstree_partitioner_impl.cpp</a>.</p>

<p>References <a class="el" href="partitioner_8hpp_source.html#l00146">foedus::storage::Partitioner::SortBatchArguments::logs_count_</a>, <a class="el" href="partitioner_8hpp_source.html#l00150">foedus::storage::Partitioner::SortBatchArguments::longest_key_length_</a>, <a class="el" href="partitioner_8hpp_source.html#l00148">foedus::storage::Partitioner::SortBatchArguments::shortest_key_length_</a>, and <a class="el" href="partitioner_8hpp_source.html#l00169">foedus::storage::Partitioner::SortBatchArguments::written_count_</a>.</p>

<p>Referenced by <a class="el" href="partitioner_8cpp_source.html#l00129">foedus::storage::Partitioner::sort_batch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                                                                    {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keywordflow">if</span> (args.logs_count_ == 0) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    *args.written_count_ = 0;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">if</span> (args.longest_key_length_ == <span class="keyword">sizeof</span>(<a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a>)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      &amp;&amp; args.shortest_key_length_ == <span class="keyword">sizeof</span>(<a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a>)) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    sort_batch_8bytes(args);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    sort_batch_general(args);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;}</div>
<div class="ttc" id="group__MASSTREE_html_ga556e8f0d5e02e78f3ddecd8f5b022bf6"><div class="ttname"><a href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">foedus::storage::masstree::KeySlice</a></div><div class="ttdeci">uint64_t KeySlice</div><div class="ttdoc">Each key slice is an 8-byte integer. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__id_8hpp_source.html#l00126">masstree_id.hpp:126</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_afac4c5dbd64695fb997e570dec3a5745_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_afac4c5dbd64695fb997e570dec3a5745_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_afac4c5dbd64695fb997e570dec3a5745_icgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner_afac4c5dbd64695fb997e570dec3a5745_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Partitioner.html#a8c8909d8a44ae9d6a4afee0ded0add4c" title="Called from log reducer to sort log entries by keys. " alt="" coords="227,13,405,54"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a class="anchor" id="ac067d5cdc21dfc47c97e864f5204b17b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html">MasstreePartitioner</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="masstree__partitioner__impl_8cpp_source.html#l00503">503</a> of file <a class="el" href="masstree__partitioner__impl_8cpp_source.html">masstree_partitioner_impl.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                                                                    {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;MasstreePartitioner&gt;&quot;</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">if</span> (v.data_) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    o &lt;&lt; <span class="stringliteral">&quot;&lt;partition_count_&gt;&quot;</span> &lt;&lt; v.data_-&gt;partition_count_ &lt;&lt; <span class="stringliteral">&quot;&lt;/partition_count_&gt;&quot;</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;&lt;partitions&gt;&quot;</span>;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; v.data_-&gt;partition_count_; ++i) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      o &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;  &lt;partition node=\&quot;&quot;</span> &lt;&lt; v.data_-&gt;partitions_[i] &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;&quot;</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        &lt;&lt; assorted::Hex(v.data_-&gt;low_keys_[i], 16)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;&lt;/partition&gt;&quot;</span>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    o &lt;&lt; <span class="stringliteral">&quot;&lt;/partitions&gt;&quot;</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    o &lt;&lt; <span class="stringliteral">&quot;Not yet designed&quot;</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;/MasstreePartitioner&gt;&quot;</span>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordflow">return</span> o;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/storage/masstree/<a class="el" href="masstree__partitioner__impl_8hpp_source.html">masstree_partitioner_impl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/storage/masstree/<a class="el" href="masstree__partitioner__impl_8cpp_source.html">masstree_partitioner_impl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage.html">storage</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage_1_1masstree.html">masstree</a></li><li class="navelem"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePartitioner.html">MasstreePartitioner</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
