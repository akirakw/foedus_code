<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::storage::sequential::SequentialComposer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::storage::sequential::SequentialComposer Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__STORAGE.html">Storage Manager</a> &raquo; <a class="el" href="group__SEQUENTIAL.html">Sequential Storage</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classfoedus_1_1storage_1_1Composer.html" title="Represents a logic to compose a new version of data pages for one storage. ">Composer</a> for an sequential storage.  
 <a href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classfoedus_1_1storage_1_1Composer.html" title="Represents a logic to compose a new version of data pages for one storage. ">Composer</a> for an sequential storage. </p>
<p>Like partitioner, this does a quite simple stuff. We don't need to do any merge-sort as there is no order. We just sequentially add them all.</p>
<dl class="section user"><dt>Page allcation in compose()</dt><dd>This composer sequentially writes out data pages until the main buffer in snapshot_writer_ becomes full. Whenever it does, it writes out all the pages and treat the first page as one head page. So, this <a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a3e005713f9a1c12bb2a4771a192b47a5">compose()</a> can output more than one head pages. By doing this, we don't have to worry about any of the intermediate pages and pointer installations. Sooooo simple. The limit is of course 500 pointers (4kb), but surely it will fit. If it doesn't, we must consider allowing variable-sized root info page.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This is a private implementation-details of <a class="el" href="group__SEQUENTIAL.html">Sequential Storage</a>, thus file name ends with _impl. Do not include this header from a client program. There is no case client program needs to access this internal class. </dd></dl>

<p>Definition at line <a class="el" href="sequential__composer__impl_8hpp_source.html#l00060">60</a> of file <a class="el" href="sequential__composer__impl_8hpp_source.html">sequential_composer_impl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="sequential__composer__impl_8hpp_source.html">sequential_composer_impl.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:structfoedus_1_1storage_1_1sequential_1_1SequentialComposer_1_1RootInfoPage"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SEQUENTIAL.html#structfoedus_1_1storage_1_1sequential_1_1SequentialComposer_1_1RootInfoPage">RootInfoPage</a></td></tr>
<tr class="memdesc:structfoedus_1_1storage_1_1sequential_1_1SequentialComposer_1_1RootInfoPage"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output of one <a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a3e005713f9a1c12bb2a4771a192b47a5">compose()</a> call, which are then combined in <a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a91db842a6ef8780d3fe4ba2f0f625da7">construct_root()</a>.  <a href="group__SEQUENTIAL.html#structfoedus_1_1storage_1_1sequential_1_1SequentialComposer_1_1RootInfoPage">More...</a><br /></td></tr>
<tr class="separator:structfoedus_1_1storage_1_1sequential_1_1SequentialComposer_1_1RootInfoPage"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a40d6cbcb9d51dddfbde41743abdc3a29"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a40d6cbcb9d51dddfbde41743abdc3a29">SequentialComposer</a> (<a class="el" href="classfoedus_1_1storage_1_1Composer.html">Composer</a> *parent)</td></tr>
<tr class="separator:a40d6cbcb9d51dddfbde41743abdc3a29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63f8c78241f6fec475322fd836a9429b"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b">to_string</a> () const </td></tr>
<tr class="separator:a63f8c78241f6fec475322fd836a9429b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e005713f9a1c12bb2a4771a192b47a5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a3e005713f9a1c12bb2a4771a192b47a5">compose</a> (const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">Composer::ComposeArguments</a> &amp;args)</td></tr>
<tr class="separator:a3e005713f9a1c12bb2a4771a192b47a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91db842a6ef8780d3fe4ba2f0f625da7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a91db842a6ef8780d3fe4ba2f0f625da7">construct_root</a> (const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments">Composer::ConstructRootArguments</a> &amp;args)</td></tr>
<tr class="separator:a91db842a6ef8780d3fe4ba2f0f625da7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93883e6731ee4a8f2efc4cf7cec2560f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html">Composer::DropResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a93883e6731ee4a8f2efc4cf7cec2560f">drop_volatiles</a> (const <a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html">Composer::DropVolatilesArguments</a> &amp;args)</td></tr>
<tr class="separator:a93883e6731ee4a8f2efc4cf7cec2560f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a40d6cbcb9d51dddfbde41743abdc3a29"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::storage::sequential::SequentialComposer::SequentialComposer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1Composer.html">Composer</a> *&#160;</td>
          <td class="paramname"><em>parent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sequential__composer__impl_8cpp_source.html#l00045">45</a> of file <a class="el" href="sequential__composer__impl_8cpp_source.html">sequential_composer_impl.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  : engine_(parent-&gt;get_engine()), storage_id_(parent-&gt;get_storage_id()) {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a3e005713f9a1c12bb2a4771a192b47a5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::storage::sequential::SequentialComposer::compose </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">Composer::ComposeArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sequential__composer__impl_8cpp_source.html#l00154">154</a> of file <a class="el" href="sequential__composer__impl_8cpp_source.html">sequential_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="sequential__page__impl_8hpp_source.html#l00155">foedus::storage::sequential::SequentialPage::append_record_nosync()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00184">foedus::storage::sequential::SequentialPage::can_insert_record()</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00119">foedus::storage::sequential::StreamStatus::cur_owner_id_</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00118">foedus::storage::sequential::StreamStatus::cur_payload_</a>, <a class="el" href="stop__watch_8hpp_source.html#l00048">foedus::debugging::StopWatch::elapsed_ms()</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00120">foedus::storage::sequential::StreamStatus::ended_</a>, <a class="el" href="storage__id_8hpp_source.html#l00095">foedus::storage::extract_numa_node_from_snapshot_pointer()</a>, <a class="el" href="storage__id_8hpp_source.html#l00098">foedus::storage::extract_snapshot_id_from_snapshot_pointer()</a>, <a class="el" href="sequential__id_8hpp_source.html#l00070">foedus::storage::sequential::HeadPagePointer::from_epoch_</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00107">foedus::storage::sequential::StreamStatus::get_entry()</a>, <a class="el" href="xct__id_8hpp_source.html#l00964">foedus::xct::XctId::get_epoch()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00101">foedus::snapshot::SnapshotWriter::get_numa_node()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00102">foedus::snapshot::SnapshotWriter::get_page_base()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00105">foedus::snapshot::SnapshotWriter::get_page_size()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00116">foedus::snapshot::SnapshotWriter::get_snapshot_id()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00061">foedus::storage::sequential::SequentialPage::header()</a>, <a class="el" href="sequential__composer__impl_8hpp_source.html#l00067">foedus::storage::sequential::SequentialComposer::RootInfoPage::header_</a>, <a class="el" href="common__log__types_8hpp_source.html#l00113">foedus::log::BaseLogType::header_</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00053">foedus::storage::sequential::StreamStatus::init()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00141">foedus::storage::sequential::SequentialPage::initialize_snapshot_page()</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="composer_8hpp_source.html#l00101">foedus::storage::Composer::ComposeArguments::log_streams_</a>, <a class="el" href="composer_8hpp_source.html#l00103">foedus::storage::Composer::ComposeArguments::log_streams_count_</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00074">foedus::storage::sequential::StreamStatus::next()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00130">foedus::storage::sequential::SequentialPage::next_page()</a>, <a class="el" href="epoch_8hpp_source.html#l00127">foedus::Epoch::one_more()</a>, <a class="el" href="sequential__id_8hpp_source.html#l00079">foedus::storage::sequential::HeadPagePointer::page_count_</a>, <a class="el" href="sequential__id_8hpp_source.html#l00068">foedus::storage::sequential::HeadPagePointer::page_id_</a>, <a class="el" href="page_8hpp_source.html#l00191">foedus::storage::PageHeader::page_id_</a>, <a class="el" href="sequential__log__types_8hpp_source.html#l00098">foedus::storage::sequential::SequentialAppendLogType::payload_count_</a>, <a class="el" href="sequential__composer__impl_8hpp_source.html#l00068">foedus::storage::sequential::SequentialComposer::RootInfoPage::pointer_</a>, <a class="el" href="composer_8hpp_source.html#l00116">foedus::storage::Composer::ComposeArguments::root_info_page_</a>, <a class="el" href="storage__id_8hpp_source.html#l00307">foedus::storage::DualPagePointer::snapshot_pointer_</a>, <a class="el" href="composer_8hpp_source.html#l00097">foedus::storage::Composer::ComposeArguments::snapshot_writer_</a>, <a class="el" href="filesystem_8cpp_source.html#l00045">foedus::fs::status()</a>, <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>, <a class="el" href="page_8hpp_source.html#l00196">foedus::storage::PageHeader::storage_id_</a>, <a class="el" href="epoch_8hpp_source.html#l00165">foedus::Epoch::store_max()</a>, <a class="el" href="epoch_8hpp_source.html#l00153">foedus::Epoch::store_min()</a>, <a class="el" href="sequential__id_8hpp_source.html#l00072">foedus::storage::sequential::HeadPagePointer::to_epoch_</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00305">to_string()</a>, <a class="el" href="error__stack_8hpp_source.html#l00533">WRAP_ERROR_CODE</a>, and <a class="el" href="common__log__types_8hpp_source.html#l00075">foedus::log::LogHeader::xct_id_</a>.</p>

<p>Referenced by <a class="el" href="composer_8cpp_source.html#l00061">foedus::storage::Composer::compose()</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                                                           {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  debugging::StopWatch stop_watch;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// Everytime it&#39;s full, we write out all pages. much simpler than other storage types.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// No intermediate pages to track any information.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  snapshot::SnapshotWriter* snapshot_writer = args.snapshot_writer_;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  SequentialPage* base = <span class="keyword">reinterpret_cast&lt;</span>SequentialPage*<span class="keyword">&gt;</span>(snapshot_writer-&gt;get_page_base());</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  SequentialPage* cur_page = compose_new_head(snapshot_writer);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> head_page_id = cur_page-&gt;header().page_id_;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  uint32_t allocated_pages = 1;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  uint64_t total_pages = 0;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">const</span> uint32_t max_pages = snapshot_writer-&gt;get_page_size();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  VLOG(0) &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b">to_string</a>() &lt;&lt; <span class="stringliteral">&quot; composing with &quot;</span> &lt;&lt; args.log_streams_count_ &lt;&lt; <span class="stringliteral">&quot; streams.&quot;</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  Epoch min_epoch;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  Epoch max_epoch;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; args.log_streams_count_; ++i) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    StreamStatus <a class="code" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd">status</a>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(status.init(args.log_streams_[i]));</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">while</span> (!status.ended_) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keyword">const</span> SequentialAppendLogType* entry = status.get_entry();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      Epoch epoch = entry-&gt;header_.xct_id_.get_epoch();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      min_epoch.store_min(epoch);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      max_epoch.store_max(epoch);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="comment">// need to allocate a new page?</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">if</span> (!cur_page-&gt;can_insert_record(entry-&gt;payload_count_)) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// need to flush the buffer?</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span> (allocated_pages &gt;= max_pages) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          <span class="comment">// dump everything and allocate a new head page</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(dump_pages(snapshot_writer, <span class="keyword">false</span>, allocated_pages, &amp;total_pages));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          cur_page = compose_new_head(snapshot_writer);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          allocated_pages = 1;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          <span class="comment">// sequential storage is a bit special. As every page is written-once, we need only</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          <span class="comment">// snapshot pointer. No dual page pointers.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          SequentialPage* next_page = base + allocated_pages;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          ++allocated_pages;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          next_page-&gt;initialize_snapshot_page(storage_id_, cur_page-&gt;header().page_id_ + 1ULL);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          cur_page-&gt;next_page().snapshot_pointer_ = next_page-&gt;header().page_id_;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          cur_page = next_page;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">extract_numa_node_from_snapshot_pointer</a>(cur_page-&gt;header().page_id_)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;              == snapshot_writer-&gt;get_numa_node());</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;          <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c">extract_snapshot_id_from_snapshot_pointer</a>(cur_page-&gt;header().page_id_)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;              == snapshot_writer-&gt;get_snapshot_id());</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_page-&gt;can_insert_record(entry-&gt;payload_count_));</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      cur_page-&gt;append_record_nosync(</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        status.cur_owner_id_,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        entry-&gt;payload_count_,</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        status.cur_payload_);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="comment">// then, read next</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(status.next());</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// dump everything</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(dump_pages(snapshot_writer, <span class="keyword">true</span>, allocated_pages, &amp;total_pages));</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">// this compose() emits just one pointer to the head page.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  RootInfoPage* root_info_page_casted = <span class="keyword">reinterpret_cast&lt;</span>RootInfoPage*<span class="keyword">&gt;</span>(args.root_info_page_);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  root_info_page_casted-&gt;header_.storage_id_ = storage_id_;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  root_info_page_casted-&gt;pointer_.page_id_ = head_page_id;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  root_info_page_casted-&gt;pointer_.from_epoch_ = min_epoch;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  root_info_page_casted-&gt;pointer_.to_epoch_ = max_epoch.one_more();  <span class="comment">// to make it exclusive</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  root_info_page_casted-&gt;pointer_.page_count_ = total_pages;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  LOG(INFO) &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b">to_string</a>() &lt;&lt; <span class="stringliteral">&quot; compose() done in &quot;</span> &lt;&lt; stop_watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms. # pages=&quot;</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    &lt;&lt; total_pages &lt;&lt; <span class="stringliteral">&quot;, head_page=&quot;</span> &lt;&lt; assorted::Hex(head_page_id, 16)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;, min_epoch=&quot;</span> &lt;&lt; min_epoch &lt;&lt; <span class="stringliteral">&quot;, max_epoch=&quot;</span> &lt;&lt; max_epoch;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div>
<div class="ttc" id="group__FILESYSTEM_html_gaaa833e3af93824a2485400b32dab7bcd"><div class="ttname"><a href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd">foedus::fs::status</a></div><div class="ttdeci">FileStatus status(const Path &amp;p)</div><div class="ttdoc">Returns the status of the file. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8cpp_source.html#l00045">filesystem.cpp:45</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga629d4b8103bfb83ef9c11b842a4fd398"><div class="ttname"><a href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">foedus::storage::SnapshotPagePointer</a></div><div class="ttdeci">uint64_t SnapshotPagePointer</div><div class="ttdoc">Page ID of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00079">storage_id.hpp:79</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_html_a63f8c78241f6fec475322fd836a9429b"><div class="ttname"><a href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b">foedus::storage::sequential::SequentialComposer::to_string</a></div><div class="ttdeci">std::string to_string() const </div><div class="ttdef"><b>Definition:</b> <a href="sequential__composer__impl_8cpp_source.html#l00305">sequential_composer_impl.cpp:305</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a82df0b3921d7c863275baf4f9c59959c"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c">foedus::storage::extract_snapshot_id_from_snapshot_pointer</a></div><div class="ttdeci">uint16_t extract_snapshot_id_from_snapshot_pointer(SnapshotPagePointer pointer)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00098">storage_id.hpp:98</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a8f6e96ac10eb804602349a54292d26a1"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">foedus::storage::extract_numa_node_from_snapshot_pointer</a></div><div class="ttdeci">uint8_t extract_numa_node_from_snapshot_pointer(SnapshotPagePointer pointer)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00095">storage_id.hpp:95</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga952ce4f5f860d7b28a70095b450d3f4d"><div class="ttname"><a href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a></div><div class="ttdeci">#define WRAP_ERROR_CODE(x)</div><div class="ttdoc">Same as CHECK_ERROR(x) except it receives only an error code, thus more efficient. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00533">error_stack.hpp:533</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_cgraph" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#aec915d81c404fca9de77c9eed625afa9" title="Appends a record to this page. " alt="" coords="291,239,469,295"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#ac3f12983b3c02d8a6e3cae2867f9d4a2" title="Returns if this page has enough room to insert a record with the given payload length. " alt="" coords="264,86,496,127"/>
<area shape="rect" id="node15" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="297,435,463,477"/>
<area shape="rect" id="node16" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="835,516,1023,572"/>
<area shape="rect" id="node17" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="285,632,475,688"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1sequential_1_1StreamStatus.html#a0d3e3b39cecf0bd37f36cd040d67ad3a" title="foedus::storage::sequential\l::StreamStatus::get_entry" alt="" coords="840,863,1019,905"/>
<area shape="rect" id="node19" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="319,967,441,1009"/>
<area shape="rect" id="node21" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a31e0233463f813ec7a645e970bbe499c" title="foedus::snapshot::Snapshot\lWriter::get_numa_node" alt="" coords="288,1033,472,1074"/>
<area shape="rect" id="node22" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a4f72263ae71f34fad0130151328d6720" title="foedus::snapshot::Snapshot\lWriter::get_page_base" alt="" coords="288,1098,472,1139"/>
<area shape="rect" id="node24" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ab547f0a3936d5cb0c0ee827ea77edd09" title="foedus::snapshot::Snapshot\lWriter::get_page_size" alt="" coords="288,1163,472,1205"/>
<area shape="rect" id="node26" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ad4209f06409d52c010aac8bf98660dbe" title="foedus::snapshot::Snapshot\lWriter::get_snapshot_id" alt="" coords="288,1229,472,1270"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a3d20c83f668324cbd7894c35cbbac629" title="foedus::storage::sequential\l::SequentialPage::header" alt="" coords="291,1294,469,1335"/>
<area shape="rect" id="node28" href="structfoedus_1_1storage_1_1sequential_1_1StreamStatus.html#abc4add6d276ba5433d09fbf27a352ad2" title="foedus::storage::sequential\l::StreamStatus::init" alt="" coords="291,837,469,878"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a24c813069071a3026f40d4a4b3644314" title="foedus::storage::sequential\l::SequentialPage::initialize\l_snapshot_page" alt="" coords="291,552,469,608"/>
<area shape="rect" id="node39" href="structfoedus_1_1storage_1_1sequential_1_1StreamStatus.html#ad8e7bc2200436df2a00cce3f3ae64ba2" title="foedus::storage::sequential\l::StreamStatus::next" alt="" coords="291,902,469,943"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a7ed4fd4e290f1e49a0b187d43b83674e" title="foedus::storage::sequential\l::SequentialPage::next_page" alt="" coords="285,1359,475,1401"/>
<area shape="rect" id="node41" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="295,1425,465,1452"/>
<area shape="rect" id="node42" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="319,1476,441,1503"/>
<area shape="rect" id="node44" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="313,1527,447,1569"/>
<area shape="rect" id="node47" href="classfoedus_1_1Epoch.html#adf886b8b219538b7dac2da820fbec68c" title="Kind of std::max(this, other). " alt="" coords="293,1593,467,1620"/>
<area shape="rect" id="node49" href="classfoedus_1_1Epoch.html#ae113d98c40171e4b80526cd7f7502c03" title="Kind of std::min(this, other). " alt="" coords="295,1644,465,1671"/>
<area shape="rect" id="node50" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b" title="foedus::storage::sequential\l::SequentialComposer::to_string" alt="" coords="276,1695,484,1737"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#adfc56f09f9e4e09466c4f102b9283076" title="Returns how many records in this page placed so far. " alt="" coords="1073,279,1303,321"/>
<area shape="rect" id="node4" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="585,5,745,32"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a5a28eb20d977bb416b92a5f0386a7d80" title="Sets byte length of payload of the specified record in this page. " alt="" coords="544,385,785,426"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a38b891ada2a3ed7381bc0d048570fb18" title="foedus::storage::sequential\l::SequentialPage::assert\l_consistent" alt="" coords="840,377,1019,433"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a2f8f9a8460228df5790ad3181be49e3b" title="foedus::storage::sequential\l::SequentialPage::owner\l_id_from_offset" alt="" coords="575,304,754,360"/>
<area shape="rect" id="node9" href="structfoedus_1_1xct_1_1McsRwLock.html#a522c5b2702bad890293b39e634f2c3c4" title="foedus::xct::McsRwLock\l::reset" alt="" coords="582,107,747,149"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="843,49,1016,90"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1PageVersionStatus.html#a5d7a0b120ba1d28530f04f347e8a889f" title="foedus::storage::PageVersion\lStatus::increment_version\l_counter" alt="" coords="569,173,761,229"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a664f776eddf9d3988a62f5043e57d9e3" title="How many data bytes in this page consumed so far. " alt="" coords="1097,377,1279,433"/>
<area shape="rect" id="node10" href="structfoedus_1_1xct_1_1McsRwLock.html#a252a31f1689940909fe3520162b685f7" title="foedus::xct::McsRwLock\l::set_next_writer" alt="" coords="847,114,1012,155"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1PageVersionStatus.html#a938cd4d9d491c3b6a4eb14afdbfd6b19" title="foedus::storage::PageVersion\lStatus::get_version_counter" alt="" coords="833,181,1025,222"/>
<area shape="rect" id="node20" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="603,1225,726,1266"/>
<area shape="rect" id="node23" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="558,1290,771,1331"/>
<area shape="rect" id="node25" href="classfoedus_1_1memory_1_1AlignedMemory.html#a8db2e188293eaeebdf36cf39920efedd" title="Returns the byte size of the memory block. " alt="" coords="558,1355,771,1397"/>
<area shape="rect" id="node29" href="classfoedus_1_1snapshot_1_1SortedBuffer.html#afb3c42518538c584ac9640c7c1313c3f" title="foedus::snapshot::Sorted\lBuffer::assert_checks" alt="" coords="581,670,748,711"/>
<area shape="rect" id="node30" href="classfoedus_1_1snapshot_1_1SortedBuffer.html#a1ca9a4662628831cb0c4f8719e7cc2eb" title="Returns the buffer memory. " alt="" coords="581,735,748,777"/>
<area shape="rect" id="node31" href="classfoedus_1_1snapshot_1_1SortedBuffer.html#a977e4eef74c89091bd9695fd174bc7ed" title="Returns the size of buffer memory. " alt="" coords="581,801,748,842"/>
<area shape="rect" id="node32" href="classfoedus_1_1snapshot_1_1SortedBuffer.html#a23b9b4a784eabc6bb7eb2e16c64dbac2" title="Current storage block&#39;s beginning in absolute byte position in the file. " alt="" coords="581,867,748,923"/>
<area shape="rect" id="node33" href="classfoedus_1_1snapshot_1_1SortedBuffer.html#aebdd5322ae2e5998f974796dab56454d" title="Returns the absolute byte position of the buffer&#39;s beginning in the entire file. " alt="" coords="581,947,748,989"/>
<area shape="rect" id="node34" href="classfoedus_1_1snapshot_1_1SortedBuffer.html#a7994e9e8b0cfe799f3746d22a29bf236" title="Current storage block&#39;s end in absolute byte position in the file. " alt="" coords="581,1013,748,1069"/>
<area shape="rect" id="node35" href="structfoedus_1_1storage_1_1sequential_1_1StreamStatus.html#ade7d0b1dfef946154fa988ec1ac42453" title="foedus::storage::sequential\l::StreamStatus::read_entry" alt="" coords="575,1159,754,1201"/>
<area shape="rect" id="node36" href="structfoedus_1_1storage_1_1sequential_1_1StreamStatus.html#a628f2a2b7aa3140cf4bcf2f5a17c4040" title="foedus::storage::sequential\l::StreamStatus::wind_stream" alt="" coords="569,1094,760,1135"/>
<area shape="rect" id="node38" href="structfoedus_1_1storage_1_1PageHeader.html#a65c4acd213d2f482eb29c6dee0818915" title="foedus::storage::PageHeader\l::init_snapshot" alt="" coords="569,553,760,594"/>
<area shape="rect" id="node43" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="589,1461,740,1488"/>
<area shape="rect" id="node45" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="584,1513,745,1554"/>
<area shape="rect" id="node46" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="597,1578,732,1619"/>
<area shape="rect" id="node48" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="587,1644,742,1671"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_icgraph" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a3e005713f9a1c12bb2a4771a192b47a5_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Composer.html#a28c752ec784b85418c0bfafab7ee60c0" title="Construct snapshot pages from sorted run files of one storage. " alt="" coords="264,5,443,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a91db842a6ef8780d3fe4ba2f0f625da7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::storage::sequential::SequentialComposer::construct_root </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments">Composer::ConstructRootArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sequential__composer__impl_8cpp_source.html#l00230">230</a> of file <a class="el" href="sequential__composer__impl_8cpp_source.html">sequential_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00135">foedus::snapshot::SnapshotWriter::dump_pages()</a>, <a class="el" href="stop__watch_8hpp_source.html#l00045">foedus::debugging::StopWatch::elapsed_us()</a>, <a class="el" href="storage__id_8hpp_source.html#l00095">foedus::storage::extract_numa_node_from_snapshot_pointer()</a>, <a class="el" href="storage__id_8hpp_source.html#l00098">foedus::storage::extract_snapshot_id_from_snapshot_pointer()</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00168">foedus::memory::AlignedMemory::get_block()</a>, <a class="el" href="attachable_8hpp_source.html#l00097">foedus::Attachable&lt; CONTROL_BLOCK &gt;::get_control_block()</a>, <a class="el" href="storage_8hpp_source.html#l00162">foedus::storage::Storage&lt; CONTROL_BLOCK &gt;::get_metadata()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00271">foedus::storage::sequential::SequentialRootPage::get_next_page()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00115">foedus::snapshot::SnapshotWriter::get_next_page_id()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00101">foedus::snapshot::SnapshotWriter::get_numa_node()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00102">foedus::snapshot::SnapshotWriter::get_page_base()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00262">foedus::storage::sequential::SequentialRootPage::get_pointer_count()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00263">foedus::storage::sequential::SequentialRootPage::get_pointers()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00116">foedus::snapshot::SnapshotWriter::get_snapshot_id()</a>, <a class="el" href="composer_8hpp_source.html#l00134">foedus::storage::Composer::ConstructRootArguments::gleaner_resource_</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00258">foedus::storage::sequential::SequentialRootPage::header()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00275">foedus::storage::sequential::SequentialRootPage::initialize_snapshot_page()</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="sequential__id_8hpp_source.html#l00089">foedus::storage::sequential::kRootPageMaxHeadPointers</a>, <a class="el" href="composer_8hpp_source.html#l00136">foedus::storage::Composer::ConstructRootArguments::new_root_page_pointer_</a>, <a class="el" href="sequential__id_8hpp_source.html#l00068">foedus::storage::sequential::HeadPagePointer::page_id_</a>, <a class="el" href="page_8hpp_source.html#l00191">foedus::storage::PageHeader::page_id_</a>, <a class="el" href="sequential__composer__impl_8hpp_source.html#l00068">foedus::storage::sequential::SequentialComposer::RootInfoPage::pointer_</a>, <a class="el" href="composer_8hpp_source.html#l00128">foedus::storage::Composer::ConstructRootArguments::previous_snapshot_files_</a>, <a class="el" href="snapshot__file__set_8cpp_source.html#l00095">foedus::cache::SnapshotFileSet::read_page()</a>, <a class="el" href="composer_8hpp_source.html#l00130">foedus::storage::Composer::ConstructRootArguments::root_info_pages_</a>, <a class="el" href="composer_8hpp_source.html#l00132">foedus::storage::Composer::ConstructRootArguments::root_info_pages_count_</a>, <a class="el" href="metadata_8hpp_source.html#l00112">foedus::storage::Metadata::root_snapshot_page_id_</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00272">foedus::storage::sequential::SequentialRootPage::set_next_page()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00265">foedus::storage::sequential::SequentialRootPage::set_pointers()</a>, <a class="el" href="composer_8hpp_source.html#l00126">foedus::storage::Composer::ConstructRootArguments::snapshot_writer_</a>, <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>, <a class="el" href="page_8hpp_source.html#l00196">foedus::storage::PageHeader::storage_id_</a>, <a class="el" href="sequential__composer__impl_8cpp_source.html#l00305">to_string()</a>, <a class="el" href="log__gleaner__resource_8hpp_source.html#l00065">foedus::snapshot::LogGleanerResource::work_memory_</a>, and <a class="el" href="error__stack_8hpp_source.html#l00533">WRAP_ERROR_CODE</a>.</p>

<p>Referenced by <a class="el" href="composer_8cpp_source.html#l00072">foedus::storage::Composer::construct_root()</a>.</p>
<div class="fragment"><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                                                                        {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  debugging::StopWatch stop_watch;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  snapshot::SnapshotWriter* snapshot_writer = args.snapshot_writer_;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  std::vector&lt;HeadPagePointer&gt; all_head_pages;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  SequentialStorage storage(engine_, storage_id_);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> previous_root_page_pointer = storage.get_metadata()-&gt;root_snapshot_page_id_;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> page_id = previous_root_page_pointer; page_id != 0;) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// if there already is a root page, read them all.</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// we have to anyway re-write all of them, at least the next pointer.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    SequentialRootPage* root_page = <span class="keyword">reinterpret_cast&lt;</span>SequentialRootPage*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      args.gleaner_resource_-&gt;work_memory_.get_block());</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(args.previous_snapshot_files_-&gt;read_page(page_id, root_page));</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root_page-&gt;header().storage_id_ == storage_id_);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root_page-&gt;header().page_id_ == page_id);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; root_page-&gt;get_pointer_count(); ++i) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      all_head_pages.push_back(root_page-&gt;get_pointers()[i]);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    page_id = root_page-&gt;get_next_page();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="comment">// each root_info_page contains just one pointer to the head page.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; args.root_info_pages_count_; ++i) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keyword">const</span> RootInfoPage* info_page = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>RootInfoPage*<span class="keyword">&gt;</span>(args.root_info_pages_[i]);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(info_page-&gt;pointer_.page_id_ &gt; 0);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    all_head_pages.push_back(info_page-&gt;pointer_);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  VLOG(0) &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b">to_string</a>() &lt;&lt; <span class="stringliteral">&quot; construct_root() total head page pointers=&quot;</span> &lt;&lt; all_head_pages.size();</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">// now simply write out root pages that contain these pointers.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  SequentialRootPage* base = <span class="keyword">reinterpret_cast&lt;</span>SequentialRootPage*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    snapshot_writer-&gt;get_page_base());</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  SequentialRootPage* cur_page = base;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  uint32_t allocated_pages = 1;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> root_of_root_page_id = snapshot_writer-&gt;get_next_page_id();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  cur_page-&gt;initialize_snapshot_page(storage_id_, root_of_root_page_id);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">for</span> (uint32_t written_pointers = 0; written_pointers &lt; all_head_pages.size();) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    uint16_t count_in_this_page = std::min&lt;uint64_t&gt;(</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      all_head_pages.size() - written_pointers,</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <a class="code" href="group__SEQUENTIAL.html#ga720e1cafc9a6f0cc3f9cca92bb6a9295">kRootPageMaxHeadPointers</a>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    cur_page-&gt;set_pointers(&amp;all_head_pages[written_pointers], count_in_this_page);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    written_pointers += count_in_this_page;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (written_pointers &lt; all_head_pages.size()) {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="comment">// we need next page in root page.</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      SequentialRootPage* new_page = cur_page + 1;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      new_page-&gt;initialize_snapshot_page(storage_id_, cur_page-&gt;header().page_id_ + 1);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">extract_numa_node_from_snapshot_pointer</a>(new_page-&gt;header().page_id_)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          == snapshot_writer-&gt;get_numa_node());</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c">extract_snapshot_id_from_snapshot_pointer</a>(new_page-&gt;header().page_id_)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          == snapshot_writer-&gt;get_snapshot_id());</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      cur_page-&gt;set_next_page(new_page-&gt;header().page_id_);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      cur_page = new_page;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      ++allocated_pages;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(written_pointers == all_head_pages.size());</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// write out the new root pages</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(snapshot_writer-&gt;dump_pages(0, allocated_pages));</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(snapshot_writer-&gt;get_next_page_id() == root_of_root_page_id + allocated_pages);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  *args.new_root_page_pointer_ = root_of_root_page_id;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// In sequential, there is only one snapshot pointer to install, the root page.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  storage.get_control_block()-&gt;root_page_pointer_.snapshot_pointer_ = root_of_root_page_id;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  storage.get_control_block()-&gt;meta_.root_snapshot_page_id_ = root_of_root_page_id;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  VLOG(0) &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b">to_string</a>() &lt;&lt; <span class="stringliteral">&quot; construct_root() done in &quot;</span> &lt;&lt; stop_watch.elapsed_us() &lt;&lt; <span class="stringliteral">&quot;us.&quot;</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; total head page pointers=&quot;</span> &lt;&lt; all_head_pages.size()</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;. new root head page=&quot;</span> &lt;&lt; assorted::Hex(*args.new_root_page_pointer_)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;. root_page_count=&quot;</span> &lt;&lt; allocated_pages;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
<div class="ttc" id="group__SEQUENTIAL_html_ga720e1cafc9a6f0cc3f9cca92bb6a9295"><div class="ttname"><a href="group__SEQUENTIAL.html#ga720e1cafc9a6f0cc3f9cca92bb6a9295">foedus::storage::sequential::kRootPageMaxHeadPointers</a></div><div class="ttdeci">const uint16_t kRootPageMaxHeadPointers</div><div class="ttdoc">Maximum number of head pointers in one root page. </div><div class="ttdef"><b>Definition:</b> <a href="sequential__id_8hpp_source.html#l00089">sequential_id.hpp:89</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga629d4b8103bfb83ef9c11b842a4fd398"><div class="ttname"><a href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">foedus::storage::SnapshotPagePointer</a></div><div class="ttdeci">uint64_t SnapshotPagePointer</div><div class="ttdoc">Page ID of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00079">storage_id.hpp:79</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_html_a63f8c78241f6fec475322fd836a9429b"><div class="ttname"><a href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b">foedus::storage::sequential::SequentialComposer::to_string</a></div><div class="ttdeci">std::string to_string() const </div><div class="ttdef"><b>Definition:</b> <a href="sequential__composer__impl_8cpp_source.html#l00305">sequential_composer_impl.cpp:305</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a82df0b3921d7c863275baf4f9c59959c"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c">foedus::storage::extract_snapshot_id_from_snapshot_pointer</a></div><div class="ttdeci">uint16_t extract_snapshot_id_from_snapshot_pointer(SnapshotPagePointer pointer)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00098">storage_id.hpp:98</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a8f6e96ac10eb804602349a54292d26a1"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">foedus::storage::extract_numa_node_from_snapshot_pointer</a></div><div class="ttdeci">uint8_t extract_numa_node_from_snapshot_pointer(SnapshotPagePointer pointer)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00095">storage_id.hpp:95</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga952ce4f5f860d7b28a70095b450d3f4d"><div class="ttname"><a href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a></div><div class="ttdeci">#define WRAP_ERROR_CODE(x)</div><div class="ttdoc">Same as CHECK_ERROR(x) except it receives only an error code, thus more efficient. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00533">error_stack.hpp:533</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_cgraph" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a55ba9fc4a87f71b3991bba1c39948cc9" title="Write out pages that are contiguous in the main page pool. " alt="" coords="307,5,491,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1debugging_1_1StopWatch.html#a7f1f05f4dd494dd57c3ecafb5d9131fb" title="foedus::debugging::\lStopWatch::elapsed_us" alt="" coords="318,71,479,112"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="817,202,1005,258"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="816,282,1007,338"/>
<area shape="rect" id="node6" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="551,596,764,637"/>
<area shape="rect" id="node7" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="333,568,465,609"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1Storage.html#ae3cca5dd58aa9bbf419cc07986bbc668" title="Returns the metadata of this storage. " alt="" coords="317,633,481,675"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1sequential_1_1SequentialRootPage.html#ac02ba584e0201edf862d363a0b1b6b9c" title="foedus::storage::sequential\l::SequentialRootPage::get\l_next_page" alt="" coords="309,699,488,755"/>
<area shape="rect" id="node10" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#af9bcb8a605aecbbc3eabdc6664f6b163" title="foedus::snapshot::Snapshot\lWriter::get_next_page_id" alt="" coords="307,780,491,821"/>
<area shape="rect" id="node11" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a31e0233463f813ec7a645e970bbe499c" title="foedus::snapshot::Snapshot\lWriter::get_numa_node" alt="" coords="307,845,491,887"/>
<area shape="rect" id="node12" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a4f72263ae71f34fad0130151328d6720" title="foedus::snapshot::Snapshot\lWriter::get_page_base" alt="" coords="307,503,491,544"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1sequential_1_1SequentialRootPage.html#a9fea3cf7e25845006b607b7f93630484" title="Returns How many pointers to head pages exist in this page. " alt="" coords="309,911,488,967"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1sequential_1_1SequentialRootPage.html#a6e0e46c921857d48718b7546e23c4b02" title="foedus::storage::sequential\l::SequentialRootPage::get\l_pointers" alt="" coords="309,991,488,1047"/>
<area shape="rect" id="node15" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ad4209f06409d52c010aac8bf98660dbe" title="foedus::snapshot::Snapshot\lWriter::get_snapshot_id" alt="" coords="307,1072,491,1113"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1sequential_1_1SequentialRootPage.html#afef545b729883a0c1e3e52823bd0b892" title="foedus::storage::sequential\l::SequentialRootPage::header" alt="" coords="301,1137,496,1179"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1sequential_1_1SequentialRootPage.html#a6d4507ea59fcd1216ea97985b2c25c1e" title="Called only when this page is initialized. " alt="" coords="297,137,500,193"/>
<area shape="rect" id="node24" href="classfoedus_1_1cache_1_1SnapshotFileSet.html#ad7ea1e9815cd47c3175371d37974526a" title="foedus::cache::SnapshotFile\lSet::read_page" alt="" coords="305,385,492,427"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1sequential_1_1SequentialRootPage.html#ac13b9c792f019166597b2d90d723aa62" title="foedus::storage::sequential\l::SequentialRootPage::set\l_next_page" alt="" coords="309,1203,488,1259"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1sequential_1_1SequentialRootPage.html#a280e0dbdbd414b07b3626ec5046e49f6" title="foedus::storage::sequential\l::SequentialRootPage::set\l_pointers" alt="" coords="309,1283,488,1339"/>
<area shape="rect" id="node37" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="331,1364,466,1405"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a63f8c78241f6fec475322fd836a9429b" title="foedus::storage::sequential\l::SequentialComposer::to_string" alt="" coords="295,1429,503,1471"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1PageHeader.html#a65c4acd213d2f482eb29c6dee0818915" title="foedus::storage::PageHeader\l::init_snapshot" alt="" coords="562,140,753,181"/>
<area shape="rect" id="node19" href="structfoedus_1_1assorted_1_1ProbCounter.html#a8e7b31f9a6b4997f6c0916f7e20d755a" title="foedus::assorted::ProbCounter\l::reset" alt="" coords="812,71,1011,112"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1PageVersion.html#ae40168c82f16645e85bb66f9019e53cf" title="used only while page initialization " alt="" coords="815,136,1007,177"/>
<area shape="rect" id="node21" href="structfoedus_1_1storage_1_1PageVersionStatus.html#af49ef4f3320148130f46f494f1c845aa" title="foedus::storage::PageVersion\lStatus::reset" alt="" coords="1059,104,1251,145"/>
<area shape="rect" id="node22" href="structfoedus_1_1xct_1_1McsWwLock.html#a4114c2dec151ad650a294dedac4f239d" title="used only while page initialization " alt="" coords="1070,169,1239,211"/>
<area shape="rect" id="node23" href="structfoedus_1_1xct_1_1McsWwBlockData.html#a3161e47c41388e9c1b50929f585e366b" title="foedus::xct::McsWwBlockData\l::clear" alt="" coords="1299,169,1500,211"/>
<area shape="rect" id="node25" href="namespacefoedus_1_1storage.html#a3c3e7a984303d1ef88e001db1591b1be" title="foedus::storage::extract\l_local_page_id_from_snapshot\l_pointer" alt="" coords="557,385,757,441"/>
<area shape="rect" id="node26" href="classfoedus_1_1cache_1_1SnapshotFileSet.html#ae5b153acb9f3115c44a48e10ff2262fb" title="foedus::cache::SnapshotFile\lSet::get_or_open_file" alt="" coords="564,268,751,309"/>
<area shape="rect" id="node27" href="classfoedus_1_1fs_1_1DirectIoFile.html#a5353bbb3b2a815d6c858c8190edeccf4" title="A version that receives a raw pointer that has to be aligned (be careful to use this ver)..." alt="" coords="582,465,733,507"/>
<area shape="rect" id="node34" href="classfoedus_1_1fs_1_1DirectIoFile.html#a35814dfec4dab81d5bb46e453f1993e6" title="Sets the position of the next byte to be written/extracted from/to the stream. " alt="" coords="582,531,733,572"/>
<area shape="rect" id="node28" href="namespacefoedus_1_1fs.html#a1a3ea81bf627928d9a5f154986af9c48" title="foedus::fs::is_odirect\l_aligned" alt="" coords="840,624,983,665"/>
<area shape="rect" id="node29" href="classfoedus_1_1fs_1_1DirectIoFile.html#a1d89a9c761a388f13f9b59490b6caa00" title="Whether the file is already and successfully opened. " alt="" coords="836,428,987,469"/>
<area shape="rect" id="node30" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="841,493,981,535"/>
<area shape="rect" id="node31" href="classfoedus_1_1fs_1_1DirectIoFile.html#a1c6bff6aafc955fd4c2a8e11e7f41f40" title="Sequentially read the given amount of contents from the current position. " alt="" coords="836,363,987,404"/>
<area shape="rect" id="node32" href="group__DEBUGGING.html#gac7eac15b41b0fab4e689f62d147ce620" title="Wait until the given CPU cycles elapse. " alt="" coords="844,559,979,600"/>
<area shape="rect" id="node33" href="group__DEBUGGING.html#ga48dd46b3a1382506a34fcb4e6e0941f6" title="Returns the current CPU cycle via x86 RDTSC. " alt="" coords="1087,559,1222,600"/>
<area shape="rect" id="node38" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="577,1331,738,1372"/>
<area shape="rect" id="node39" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="590,1396,725,1437"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_icgraph" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a91db842a6ef8780d3fe4ba2f0f625da7_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Composer.html#adf148cbea7c8146dec88d23d2218452c" title="Construct root page(s) for one storage based on the ouputs of compose(). " alt="" coords="295,5,473,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a93883e6731ee4a8f2efc4cf7cec2560f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html">Composer::DropResult</a> foedus::storage::sequential::SequentialComposer::drop_volatiles </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html">Composer::DropVolatilesArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sequential__composer__impl_8cpp_source.html#l00309">309</a> of file <a class="el" href="sequential__composer__impl_8cpp_source.html">sequential_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="storage__id_8hpp_source.html#l00235">foedus::storage::combine_volatile_page_pointer()</a>, <a class="el" href="thread__id_8hpp_source.html#l00123">foedus::thread::compose_thread_id()</a>, <a class="el" href="composer_8cpp_source.html#l00114">foedus::storage::Composer::DropVolatilesArguments::drop()</a>, <a class="el" href="attachable_8hpp_source.html#l00097">foedus::Attachable&lt; CONTROL_BLOCK &gt;::get_control_block()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00193">foedus::storage::sequential::SequentialPage::get_first_record_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00050">foedus::Engine::get_memory_manager()</a>, <a class="el" href="engine__memory_8hpp_source.html#l00076">foedus::memory::EngineMemory::get_node_memory()</a>, <a class="el" href="storage__id_8hpp_source.html#l00201">foedus::storage::VolatilePagePointer::get_numa_node()</a>, <a class="el" href="storage__id_8hpp_source.html#l00202">foedus::storage::VolatilePagePointer::get_offset()</a>, <a class="el" href="engine_8cpp_source.html#l00039">foedus::Engine::get_options()</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00071">foedus::storage::sequential::SequentialPage::get_record_count()</a>, <a class="el" href="page__pool_8cpp_source.html#l00146">foedus::memory::PagePool::get_resolver()</a>, <a class="el" href="numa__node__memory_8hpp_source.html#l00175">foedus::memory::NumaNodeMemoryRef::get_volatile_pool()</a>, <a class="el" href="thread__options_8hpp_source.html#l00043">foedus::thread::ThreadOptions::group_count_</a>, <a class="el" href="composer_8hpp_source.html#l00152">foedus::storage::Composer::DropVolatilesArguments::my_partition_</a>, <a class="el" href="sequential__page__impl_8hpp_source.html#l00130">foedus::storage::sequential::SequentialPage::next_page()</a>, <a class="el" href="composer_8hpp_source.html#l00154">foedus::storage::Composer::DropVolatilesArguments::partitioned_drop_</a>, <a class="el" href="page__resolver_8hpp_source.html#l00057">foedus::memory::LocalPageResolver::resolve_offset()</a>, <a class="el" href="composer_8hpp_source.html#l00150">foedus::storage::Composer::DropVolatilesArguments::snapshot_</a>, <a class="el" href="engine__options_8hpp_source.html#l00146">foedus::EngineOptions::thread_</a>, <a class="el" href="thread__options_8hpp_source.html#l00050">foedus::thread::ThreadOptions::thread_count_per_group_</a>, <a class="el" href="snapshot_8hpp_source.html#l00055">foedus::snapshot::Snapshot::valid_until_epoch_</a>, and <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>.</p>

<p>Referenced by <a class="el" href="composer_8cpp_source.html#l00083">foedus::storage::Composer::drop_volatiles()</a>.</p>
<div class="fragment"><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                              {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">// In sequential, no need to determine what volatile pages to keep.</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  SequentialStorage storage(engine_, storage_id_);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  SequentialStoragePimpl pimpl(engine_, storage.get_control_block());</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  uint16_t nodes = engine_-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#a97a206187b610b15a6edbfc75a384b1a">thread_</a>.<a class="code" href="structfoedus_1_1thread_1_1ThreadOptions.html#ad9cfcfe5d16d5c394694919d2f59e627">group_count_</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  uint16_t threads_per_node = engine_-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#a97a206187b610b15a6edbfc75a384b1a">thread_</a>.<a class="code" href="structfoedus_1_1thread_1_1ThreadOptions.html#aae76de27898d6474ca21a00cf107a3d4">thread_count_per_group_</a>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">for</span> (uint16_t node = 0; node &lt; nodes; ++node) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (args.partitioned_drop_ &amp;&amp; args.my_partition_ != node) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keyword">const</span> memory::LocalPageResolver&amp; resolver</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      = engine_-&gt;<a class="code" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">get_memory_manager</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8">get_node_memory</a>(node)-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774">get_volatile_pool</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1PagePool.html#a18916c76eea7aa49572e69e48e75717e">get_resolver</a>();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span> (uint16_t local_ordinal = 0; local_ordinal &lt; threads_per_node; ++local_ordinal) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <a class="code" href="group__THREAD.html#ga709a79fc1ed05a3543d8309ba391da93">thread::ThreadId</a> thread_id = <a class="code" href="group__THREAD.html#ga3cfa4441e96554e775ec6013c180e192">thread::compose_thread_id</a>(node, local_ordinal);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a>* head_ptr = pimpl.get_head_pointer(thread_id);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a>* tail_ptr = pimpl.get_tail_pointer(thread_id);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a> tail_offset = *tail_ptr;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordflow">if</span> ((*head_ptr) == 0) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tail_offset == 0);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        VLOG(0) &lt;&lt; <span class="stringliteral">&quot;No volatile pages for thread-&quot;</span> &lt;&lt; thread_id &lt;&lt; <span class="stringliteral">&quot; in sequential-&quot;</span> &lt;&lt; storage_id_;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tail_offset != 0);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a> offset = *head_ptr;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(offset != 0);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="comment">// if the page is newer than the snapshot, keep them.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="comment">// all volatile pages/records are appended in epoch order, so no need to check further.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        SequentialPage* head = <span class="keyword">reinterpret_cast&lt;</span>SequentialPage*<span class="keyword">&gt;</span>(resolver.resolve_offset(offset));</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(head-&gt;get_record_count() &gt; 0);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">if</span> (head-&gt;get_record_count() &gt; 0</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          &amp;&amp; head-&gt;get_first_record_epoch() &gt; args.snapshot_.valid_until_epoch_) {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;          VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Thread-&quot;</span> &lt;&lt; thread_id &lt;&lt; <span class="stringliteral">&quot; in sequential-&quot;</span> &lt;&lt; storage_id_ &lt;&lt; <span class="stringliteral">&quot; keeps volatile&quot;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; pages at and after epoch-&quot;</span> &lt;&lt; head-&gt;get_first_record_epoch();</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment">// okay, drop this</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a> next = head-&gt;next_page().volatile_pointer_.get_offset();</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(next != offset);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(next == 0 || head-&gt;next_page().volatile_pointer_.get_numa_node() == node);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        args.drop(engine_, <a class="code" href="namespacefoedus_1_1storage.html#a0197f5be4c85213e8accd9748e68b6e4">combine_volatile_page_pointer</a>(node, offset));</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">if</span> (next == 0) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;          <span class="comment">// it was the tail</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;          <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tail_offset == offset);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;          VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Thread-&quot;</span> &lt;&lt; thread_id &lt;&lt; <span class="stringliteral">&quot; in sequential-&quot;</span> &lt;&lt; storage_id_ &lt;&lt; <span class="stringliteral">&quot; dropped all&quot;</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; volatile pages&quot;</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          *head_ptr = 0;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;          *tail_ptr = 0;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;          <span class="comment">// move head</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;          *head_ptr = next;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          DVLOG(2) &lt;&lt; <span class="stringliteral">&quot;Thread-&quot;</span> &lt;&lt; thread_id &lt;&lt; <span class="stringliteral">&quot; in sequential-&quot;</span> &lt;&lt; storage_id_ &lt;&lt; <span class="stringliteral">&quot; dropped a&quot;</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; page.&quot;</span>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">return</span> Composer::DropResult(args);  <span class="comment">// always everything dropped</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div>
<div class="ttc" id="group__MEMORY_html_gaf7ed7c23d184b14ce978b1775a86dfae"><div class="ttname"><a href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">foedus::memory::PagePoolOffset</a></div><div class="ttdeci">uint32_t PagePoolOffset</div><div class="ttdoc">Offset in PagePool that compactly represents the page address (unlike 8 bytes pointer). </div><div class="ttdef"><b>Definition:</b> <a href="memory__id_8hpp_source.html#l00044">memory_id.hpp:44</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a0197f5be4c85213e8accd9748e68b6e4"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a0197f5be4c85213e8accd9748e68b6e4">foedus::storage::combine_volatile_page_pointer</a></div><div class="ttdeci">VolatilePagePointer combine_volatile_page_pointer(uint8_t numa_node, memory::PagePoolOffset offset)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00235">storage_id.hpp:235</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a6546930099132529543c320327367ef1"><div class="ttname"><a href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">foedus::Engine::get_options</a></div><div class="ttdeci">const EngineOptions &amp; get_options() const </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00039">engine.cpp:39</a></div></div>
<div class="ttc" id="structfoedus_1_1thread_1_1ThreadOptions_html_aae76de27898d6474ca21a00cf107a3d4"><div class="ttname"><a href="structfoedus_1_1thread_1_1ThreadOptions.html#aae76de27898d6474ca21a00cf107a3d4">foedus::thread::ThreadOptions::thread_count_per_group_</a></div><div class="ttdeci">ThreadLocalOrdinal thread_count_per_group_</div><div class="ttdoc">Number of Thread in each ThreadGroup. </div><div class="ttdef"><b>Definition:</b> <a href="thread__options_8hpp_source.html#l00050">thread_options.hpp:50</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1EngineMemory_html_a8bf8832e627cd97fe92c60d38ed96ac8"><div class="ttname"><a href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8">foedus::memory::EngineMemory::get_node_memory</a></div><div class="ttdeci">NumaNodeMemoryRef * get_node_memory(foedus::thread::ThreadGroupId group) const </div><div class="ttdef"><b>Definition:</b> <a href="engine__memory_8hpp_source.html#l00076">engine_memory.hpp:76</a></div></div>
<div class="ttc" id="structfoedus_1_1thread_1_1ThreadOptions_html_ad9cfcfe5d16d5c394694919d2f59e627"><div class="ttname"><a href="structfoedus_1_1thread_1_1ThreadOptions.html#ad9cfcfe5d16d5c394694919d2f59e627">foedus::thread::ThreadOptions::group_count_</a></div><div class="ttdeci">uint16_t group_count_</div><div class="ttdoc">Number of ThreadGroup in the engine. </div><div class="ttdef"><b>Definition:</b> <a href="thread__options_8hpp_source.html#l00043">thread_options.hpp:43</a></div></div>
<div class="ttc" id="group__THREAD_html_ga3cfa4441e96554e775ec6013c180e192"><div class="ttname"><a href="group__THREAD.html#ga3cfa4441e96554e775ec6013c180e192">foedus::thread::compose_thread_id</a></div><div class="ttdeci">ThreadId compose_thread_id(ThreadGroupId node, ThreadLocalOrdinal local_core)</div><div class="ttdoc">Returns a globally unique ID of Thread (core) for the given node and ordinal in the node...</div><div class="ttdef"><b>Definition:</b> <a href="thread__id_8hpp_source.html#l00123">thread_id.hpp:123</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_a97a206187b610b15a6edbfc75a384b1a"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#a97a206187b610b15a6edbfc75a384b1a">foedus::EngineOptions::thread_</a></div><div class="ttdeci">thread::ThreadOptions thread_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00146">engine_options.hpp:146</a></div></div>
<div class="ttc" id="group__THREAD_html_ga709a79fc1ed05a3543d8309ba391da93"><div class="ttname"><a href="group__THREAD.html#ga709a79fc1ed05a3543d8309ba391da93">foedus::thread::ThreadId</a></div><div class="ttdeci">uint16_t ThreadId</div><div class="ttdoc">Typedef for a global ID of Thread (core), which is unique across NUMA nodes. </div><div class="ttdef"><b>Definition:</b> <a href="thread__id_8hpp_source.html#l00080">thread_id.hpp:80</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1NumaNodeMemoryRef_html_a70b68580143ce771f5b5b1f9a209f774"><div class="ttname"><a href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774">foedus::memory::NumaNodeMemoryRef::get_volatile_pool</a></div><div class="ttdeci">PagePool * get_volatile_pool()</div><div class="ttdef"><b>Definition:</b> <a href="numa__node__memory_8hpp_source.html#l00175">numa_node_memory.hpp:175</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1PagePool_html_a18916c76eea7aa49572e69e48e75717e"><div class="ttname"><a href="classfoedus_1_1memory_1_1PagePool.html#a18916c76eea7aa49572e69e48e75717e">foedus::memory::PagePool::get_resolver</a></div><div class="ttdeci">const LocalPageResolver &amp; get_resolver() const </div><div class="ttdoc">Gives an object to resolve an offset in this page pool (thus local) to an actual pointer and vice ver...</div><div class="ttdef"><b>Definition:</b> <a href="page__pool_8cpp_source.html#l00146">page_pool.cpp:146</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a02ed05009c7baa8d75e04f202a86b2c6"><div class="ttname"><a href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">foedus::Engine::get_memory_manager</a></div><div class="ttdeci">memory::EngineMemory * get_memory_manager() const </div><div class="ttdoc">See Memory Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00050">engine.cpp:50</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_cgraph" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_cgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1storage.html#a0197f5be4c85213e8accd9748e68b6e4" title="foedus::storage::combine\l_volatile_page_pointer" alt="" coords="253,141,421,183"/>
<area shape="rect" id="node4" href="group__THREAD.html#ga3cfa4441e96554e775ec6013c180e192" title="Returns a globally unique ID of Thread (core) for the given node and ordinal in the node..." alt="" coords="255,341,420,383"/>
<area shape="rect" id="node5" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html#aa29872b9c654848dde2e5c0ca1409da0" title="Returns (might cache) the given pointer to volatile pool. " alt="" coords="236,509,439,551"/>
<area shape="rect" id="node9" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6" title="See Memory Manager. " alt="" coords="534,71,669,112"/>
<area shape="rect" id="node10" href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8" title="foedus::memory::EngineMemory\l::get_node_memory" alt="" coords="496,136,707,177"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="505,816,698,857"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1029,601,1191,643"/>
<area shape="rect" id="node13" href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774" title="foedus::memory::NumaNode\lMemoryRef::get_volatile_pool" alt="" coords="506,881,697,923"/>
<area shape="rect" id="node26" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="271,991,403,1032"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#aebcdc0447e1317476fe28d4303680112" title="Returns the epoch of the fist record in this page (undefined behavior if no record). " alt="" coords="248,1107,427,1163"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#adfc56f09f9e4e09466c4f102b9283076" title="Returns how many records in this page placed so far. " alt="" coords="487,1079,716,1120"/>
<area shape="rect" id="node32" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="270,1188,405,1229"/>
<area shape="rect" id="node33" href="classfoedus_1_1memory_1_1PagePool.html#a18916c76eea7aa49572e69e48e75717e" title="Gives an object to resolve an offset in this page pool (thus local) to an actual pointer and vice ver..." alt="" coords="248,1253,427,1295"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a7ed4fd4e290f1e49a0b187d43b83674e" title="foedus::storage::sequential\l::SequentialPage::next_page" alt="" coords="243,1319,432,1360"/>
<area shape="rect" id="node36" href="structfoedus_1_1memory_1_1LocalPageResolver.html#a389ef2027f0d0dc27d35856733e2f9be" title="Resolves offset in this pool to storage::Page*. " alt="" coords="245,925,429,967"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a273a4c4f51c06ebc91663329742e1c69" title="foedus::storage::Volatile\lPagePointer::set" alt="" coords="521,5,682,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ac661b8baf462a1e969a8a1c7e619858b" title="foedus::memory::PagePool\lOffsetChunk::empty" alt="" coords="512,633,691,675"/>
<area shape="rect" id="node7" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ace44cb03e7da84d29f3a02a790c69191" title="foedus::memory::PagePool\lOffsetChunk::full" alt="" coords="776,348,955,389"/>
<area shape="rect" id="node8" href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0" title="Returns the page resolver to convert volatile page ID to page pointer. " alt="" coords="496,437,707,493"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="785,195,946,236"/>
<area shape="rect" id="node15" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#a6f558bb023b2c5c7dd9bf7ab9d054ef0" title="foedus::memory::PagePool\lOffsetChunk::push_back" alt="" coords="512,371,691,412"/>
<area shape="rect" id="node16" href="classfoedus_1_1memory_1_1PagePool.html#a802171ff0578875748d20b4e9c8c9463" title="Returns the specified number of free pages from the chunk. " alt="" coords="512,253,691,295"/>
<area shape="rect" id="node18" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f" title="Resolves offset plus NUMA node ID to storage::Page*. " alt="" coords="500,751,703,792"/>
<area shape="rect" id="node25" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#affa4e09fc9e251f5cc259de81c23c6e2" title="foedus::memory::PagePool\lOffsetChunk::size" alt="" coords="512,568,691,609"/>
<area shape="rect" id="node17" href="classfoedus_1_1memory_1_1PagePoolPimpl.html#a13d785355359fd936c2b3863d296ba2c" title="foedus::memory::PagePool\lPimpl::release" alt="" coords="776,260,955,301"/>
<area shape="rect" id="node19" href="namespacefoedus_1_1storage.html#a9220f4aff16817a668990bd85f2f527d" title="foedus::storage::assert\l_valid_volatile_page" alt="" coords="788,868,943,909"/>
<area shape="rect" id="node21" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="1035,809,1185,851"/>
<area shape="rect" id="node23" href="namespacefoedus_1_1storage.html#a67e1af2de6e13b000e66609cf60849b6" title="foedus::storage::construct\l_volatile_page_pointer" alt="" coords="779,751,952,792"/>
<area shape="rect" id="node24" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a63ab3e809b38145565cef7791f211a35" title="As the name suggests, this version is for new pages, which don&#39;t have sanity checks. " alt="" coords="764,934,967,990"/>
<area shape="rect" id="node20" href="namespacefoedus_1_1storage.html#ab7207e6e276af504c0e358a923ee75ec" title="foedus::storage::assert\l_aligned_page" alt="" coords="1033,940,1187,981"/>
<area shape="rect" id="node22" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956" title="foedus::storage::PageHeader\l::get_page_type" alt="" coords="1015,875,1205,916"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1sequential_1_1SequentialPage.html#a2f8f9a8460228df5790ad3181be49e3b" title="foedus::storage::sequential\l::SequentialPage::owner\l_id_from_offset" alt="" coords="512,1210,691,1266"/>
<area shape="rect" id="node30" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="540,1144,663,1185"/>
<area shape="rect" id="node31" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="804,1144,927,1185"/>
<area shape="rect" id="node34" href="classfoedus_1_1memory_1_1PagePoolPimpl.html#ae901dc06f6b6f4594626ed0b233daec6" title="foedus::memory::PagePool\lPimpl::get_resolver" alt="" coords="512,1291,691,1332"/>
<area shape="rect" id="node37" href="structfoedus_1_1memory_1_1LocalPageResolver.html#aa9d2266686c3a66678b37241a3ac434f" title="As the name suggests, this version is for new pages, which don&#39;t have sanity checks. " alt="" coords="509,947,693,1003"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_icgraph" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a93883e6731ee4a8f2efc4cf7cec2560f_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Composer.html#a0995635b97031b208127004382947acd" title="Drops volatile pages that have not been modified since the snapshotted epoch. " alt="" coords="236,39,415,80"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a26c51902174b692c91aedd15218f01b7" title="subroutine invoked by one thread for one node. " alt="" coords="463,31,647,87"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="695,39,921,80"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="969,31,1180,87"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="1228,5,1439,47"/>
<area shape="rect" id="node8" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="1256,71,1411,112"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1487,5,1681,47"/>
<area shape="rect" id="node9" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1487,71,1681,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a63f8c78241f6fec475322fd836a9429b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string foedus::storage::sequential::SequentialComposer::to_string </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sequential__composer__impl_8cpp_source.html#l00305">305</a> of file <a class="el" href="sequential__composer__impl_8cpp_source.html">sequential_composer_impl.cpp</a>.</p>

<p>Referenced by <a class="el" href="sequential__composer__impl_8cpp_source.html#l00154">compose()</a>, and <a class="el" href="sequential__composer__impl_8cpp_source.html#l00230">construct_root()</a>.</p>
<div class="fragment"><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                                              {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">return</span> std::string(<span class="stringliteral">&quot;SequentialComposer-&quot;</span>) + std::to_string(storage_id_);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a63f8c78241f6fec475322fd836a9429b_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a63f8c78241f6fec475322fd836a9429b_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a63f8c78241f6fec475322fd836a9429b_icgraph" id="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer_a63f8c78241f6fec475322fd836a9429b_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a3e005713f9a1c12bb2a4771a192b47a5" title="foedus::storage::sequential\l::SequentialComposer::compose" alt="" coords="277,5,487,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a91db842a6ef8780d3fe4ba2f0f625da7" title="foedus::storage::sequential\l::SequentialComposer::construct_root" alt="" coords="261,71,503,112"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1Composer.html#a28c752ec784b85418c0bfafab7ee60c0" title="Construct snapshot pages from sorted run files of one storage. " alt="" coords="551,5,729,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1Composer.html#adf148cbea7c8146dec88d23d2218452c" title="Construct root page(s) for one storage based on the ouputs of compose(). " alt="" coords="551,71,729,112"/>
</map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/storage/sequential/<a class="el" href="sequential__composer__impl_8hpp_source.html">sequential_composer_impl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/storage/sequential/<a class="el" href="sequential__composer__impl_8cpp_source.html">sequential_composer_impl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage.html">storage</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage_1_1sequential.html">sequential</a></li><li class="navelem"><a class="el" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html">SequentialComposer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
