<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::xct::XctManagerPimpl Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1xct_1_1XctManagerPimpl.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classfoedus_1_1xct_1_1XctManagerPimpl-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::xct::XctManagerPimpl Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__XCT.html">Transaction Manager</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Pimpl object of <a class="el" href="classfoedus_1_1xct_1_1XctManager.html" title="Xct Manager class that provides API to begin/abort/commit transaction. ">XctManager</a>.  
 <a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Pimpl object of <a class="el" href="classfoedus_1_1xct_1_1XctManager.html" title="Xct Manager class that provides API to begin/abort/commit transaction. ">XctManager</a>. </p>
<p>A private pimpl object for <a class="el" href="classfoedus_1_1xct_1_1XctManager.html" title="Xct Manager class that provides API to begin/abort/commit transaction. ">XctManager</a>. Do not include this header from a client program unless you know what you are doing. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00100">100</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for foedus::xct::XctManagerPimpl:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl__inherit__graph.png" border="0" usemap="#foedus_1_1xct_1_1XctManagerPimpl_inherit__map" alt="Inheritance graph"/></div>
<map name="foedus_1_1xct_1_1XctManagerPimpl_inherit__map" id="foedus_1_1xct_1_1XctManagerPimpl_inherit__map">
<area shape="rect" id="node2" href="classfoedus_1_1DefaultInitializable.html" title="Typical implementation of Initializable as a skeleton base class. " alt="" coords="17,80,189,107"/>
<area shape="rect" id="node3" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="37,5,169,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for foedus::xct::XctManagerPimpl:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl__coll__graph.png" border="0" usemap="#foedus_1_1xct_1_1XctManagerPimpl_coll__map" alt="Collaboration graph"/></div>
<map name="foedus_1_1xct_1_1XctManagerPimpl_coll__map" id="foedus_1_1xct_1_1XctManagerPimpl_coll__map">
<area shape="rect" id="node2" href="classfoedus_1_1DefaultInitializable.html" title="Typical implementation of Initializable as a skeleton base class. " alt="" coords="379,5,551,32"/>
<area shape="rect" id="node3" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="28,23,160,49"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html" title="Database engine object that holds all resources and provides APIs. " alt="" coords="411,56,519,83"/>
<area shape="rect" id="node4" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html" title="Shared data in XctManagerPimpl. " alt="" coords="364,107,567,149"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SharedPolling.html" title="A polling&#45;wait mechanism that can be placed in shared memory and used from multiple processes..." alt="" coords="5,117,183,144"/>
<area shape="rect" id="node7" title="STL class. " alt="" coords="423,173,507,200"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa614bc8e6539640c971112c7c18eb0ac"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aa614bc8e6539640c971112c7c18eb0ac">XctManagerPimpl</a> ()=delete</td></tr>
<tr class="separator:aa614bc8e6539640c971112c7c18eb0ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6ffe7f4c8a982d3978a77e6e68baf78"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aa6ffe7f4c8a982d3978a77e6e68baf78">XctManagerPimpl</a> (<a class="el" href="classfoedus_1_1Engine.html">Engine</a> *engine)</td></tr>
<tr class="separator:aa6ffe7f4c8a982d3978a77e6e68baf78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefb36bf03b0bd29c160f5aa36b219d45"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aefb36bf03b0bd29c160f5aa36b219d45">initialize_once</a> () override</td></tr>
<tr class="separator:aefb36bf03b0bd29c160f5aa36b219d45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fb6cedfd224c44cac4224877c688672"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a8fb6cedfd224c44cac4224877c688672">uninitialize_once</a> () override</td></tr>
<tr class="separator:a8fb6cedfd224c44cac4224877c688672"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a787bb892079cb32d5a2065188825a522"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a> () const </td></tr>
<tr class="separator:a787bb892079cb32d5a2065188825a522"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6071efec3ffc3876192101db2a1873b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4">get_requested_global_epoch</a> () const </td></tr>
<tr class="separator:a6071efec3ffc3876192101db2a1873b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd49fd67f3459df687ed08d5d8b54082"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#acd49fd67f3459df687ed08d5d8b54082">get_current_global_epoch_weak</a> () const </td></tr>
<tr class="separator:acd49fd67f3459df687ed08d5d8b54082"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad01b60a93f2e107d9c63e7c28799ac1a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad01b60a93f2e107d9c63e7c28799ac1a">begin_xct</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="group__XCT.html#ga9ac5dae4b91a288e9d887f28a7124c13">IsolationLevel</a> isolation_level)</td></tr>
<tr class="memdesc:ad01b60a93f2e107d9c63e7c28799ac1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">User transactions related methods.  <a href="#ad01b60a93f2e107d9c63e7c28799ac1a">More...</a><br /></td></tr>
<tr class="separator:ad01b60a93f2e107d9c63e7c28799ac1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a014506b605e14b3df1b1b7522e8a23b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2">precommit_xct</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *commit_epoch)</td></tr>
<tr class="memdesc:a014506b605e14b3df1b1b7522e8a23b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the gut of commit protocol.  <a href="#a014506b605e14b3df1b1b7522e8a23b2">More...</a><br /></td></tr>
<tr class="separator:a014506b605e14b3df1b1b7522e8a23b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71f565f69929d90febd7beb6b1dca696"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a71f565f69929d90febd7beb6b1dca696">abort_xct</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="separator:a71f565f69929d90febd7beb6b1dca696"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69fb51b2a05a90f46b4658cb984928a0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a69fb51b2a05a90f46b4658cb984928a0">wait_for_commit</a> (<a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> commit_epoch, int64_t wait_microseconds)</td></tr>
<tr class="separator:a69fb51b2a05a90f46b4658cb984928a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03678427b184e7ce71f9bbb164dd0bad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad">set_requested_global_epoch</a> (<a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> request)</td></tr>
<tr class="separator:a03678427b184e7ce71f9bbb164dd0bad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a925da0bb4b846daa21eb947e4f67b0c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a925da0bb4b846daa21eb947e4f67b0c6">advance_current_global_epoch</a> ()</td></tr>
<tr class="separator:a925da0bb4b846daa21eb947e4f67b0c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5cb0928185cf79dda519313f05fe0ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#af5cb0928185cf79dda519313f05fe0ee">wait_for_current_global_epoch</a> (<a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> target_epoch, int64_t wait_microseconds)</td></tr>
<tr class="separator:af5cb0928185cf79dda519313f05fe0ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afce787897428bd372c67224acd3e8ea7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7">wakeup_epoch_chime_thread</a> ()</td></tr>
<tr class="separator:afce787897428bd372c67224acd3e8ea7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add42c2f0d559eafa1f67fd9c048a4855"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855">precommit_xct_readonly</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *commit_epoch)</td></tr>
<tr class="memdesc:add42c2f0d559eafa1f67fd9c048a4855"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> if the transaction is read-only  <a href="#add42c2f0d559eafa1f67fd9c048a4855">More...</a><br /></td></tr>
<tr class="separator:add42c2f0d559eafa1f67fd9c048a4855"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a777caaecec0e7bb19b1cd2841771f755"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755">precommit_xct_readwrite</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *commit_epoch)</td></tr>
<tr class="memdesc:a777caaecec0e7bb19b1cd2841771f755"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> if the transaction is read-write  <a href="#a777caaecec0e7bb19b1cd2841771f755">More...</a><br /></td></tr>
<tr class="separator:a777caaecec0e7bb19b1cd2841771f755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5ef5b885ba49a42c2f47b694dc2a63d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab5ef5b885ba49a42c2f47b694dc2a63d">precommit_xct_lock_track_write</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="structfoedus_1_1xct_1_1WriteXctAccess.html">WriteXctAccess</a> *entry)</td></tr>
<tr class="memdesc:ab5ef5b885ba49a42c2f47b694dc2a63d"><td class="mdescLeft">&#160;</td><td class="mdescRight">used from <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896" title="Phase 1 of precommit_xct() ">precommit_xct_lock()</a> to track moved record  <a href="#ab5ef5b885ba49a42c2f47b694dc2a63d">More...</a><br /></td></tr>
<tr class="separator:ab5ef5b885ba49a42c2f47b694dc2a63d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9090dd1fa81513f61620b44a9a8bbd1d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d">precommit_xct_verify_track_read</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="structfoedus_1_1xct_1_1ReadXctAccess.html">ReadXctAccess</a> *entry)</td></tr>
<tr class="memdesc:a9090dd1fa81513f61620b44a9a8bbd1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">used from verification methods to track moved record  <a href="#a9090dd1fa81513f61620b44a9a8bbd1d">More...</a><br /></td></tr>
<tr class="separator:a9090dd1fa81513f61620b44a9a8bbd1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2376431f079ce60800c9c25d89d74896"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896">precommit_xct_lock</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="structfoedus_1_1xct_1_1XctId.html">XctId</a> *max_xct_id)</td></tr>
<tr class="memdesc:a2376431f079ce60800c9c25d89d74896"><td class="mdescLeft">&#160;</td><td class="mdescRight">Phase 1 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a>  <a href="#a2376431f079ce60800c9c25d89d74896">More...</a><br /></td></tr>
<tr class="separator:a2376431f079ce60800c9c25d89d74896"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada7782b43556708daa3bb94f7662409a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ada7782b43556708daa3bb94f7662409a">precommit_xct_lock_batch_track_moved</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="memdesc:ada7782b43556708daa3bb94f7662409a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine of precommit_xct_lock to track <em>most</em> of moved records in write-set.  <a href="#ada7782b43556708daa3bb94f7662409a">More...</a><br /></td></tr>
<tr class="separator:ada7782b43556708daa3bb94f7662409a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c3befa16f448a004d548a2b4675a13b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b">precommit_xct_verify_readonly</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *commit_epoch)</td></tr>
<tr class="memdesc:a2c3befa16f448a004d548a2b4675a13b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Phase 2 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> for read-only case.  <a href="#a2c3befa16f448a004d548a2b4675a13b">More...</a><br /></td></tr>
<tr class="separator:a2c3befa16f448a004d548a2b4675a13b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9534e63f498a012d9fa401a10e2b4e0b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b">precommit_xct_verify_readwrite</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="structfoedus_1_1xct_1_1XctId.html">XctId</a> *max_xct_id)</td></tr>
<tr class="memdesc:a9534e63f498a012d9fa401a10e2b4e0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Phase 2 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> for read-write case.  <a href="#a9534e63f498a012d9fa401a10e2b4e0b">More...</a><br /></td></tr>
<tr class="separator:a9534e63f498a012d9fa401a10e2b4e0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a011f72c9cc830a943b9dccd62d323209"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209">precommit_xct_verify_pointer_set</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="memdesc:a011f72c9cc830a943b9dccd62d323209"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns false if there is any pointer set conflict.  <a href="#a011f72c9cc830a943b9dccd62d323209">More...</a><br /></td></tr>
<tr class="separator:a011f72c9cc830a943b9dccd62d323209"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab21414e107b53d6276e1d20bc12dce9d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d">precommit_xct_verify_page_version_set</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="memdesc:ab21414e107b53d6276e1d20bc12dce9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns false if there is any page version conflict.  <a href="#ab21414e107b53d6276e1d20bc12dce9d">More...</a><br /></td></tr>
<tr class="separator:ab21414e107b53d6276e1d20bc12dce9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad91daff37c2b78b8c6620d67869e9d7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f">precommit_xct_apply</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="structfoedus_1_1xct_1_1XctId.html">XctId</a> max_xct_id, <a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *commit_epoch)</td></tr>
<tr class="memdesc:ad91daff37c2b78b8c6620d67869e9d7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Phase 3 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a>  <a href="#ad91daff37c2b78b8c6620d67869e9d7f">More...</a><br /></td></tr>
<tr class="separator:ad91daff37c2b78b8c6620d67869e9d7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c2ee2d08709ff62e77e0dff6eded376"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a3c2ee2d08709ff62e77e0dff6eded376">release_and_clear_all_current_locks</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="memdesc:a3c2ee2d08709ff62e77e0dff6eded376"><td class="mdescLeft">&#160;</td><td class="mdescRight">unlocking all acquired locks, used when commit/abort.  <a href="#a3c2ee2d08709ff62e77e0dff6eded376">More...</a><br /></td></tr>
<tr class="separator:a3c2ee2d08709ff62e77e0dff6eded376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2f4a34f39a90516756c34aae5916e3a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad2f4a34f39a90516756c34aae5916e3a">precommit_xct_acquire_writer_lock</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="structfoedus_1_1xct_1_1WriteXctAccess.html">WriteXctAccess</a> *write)</td></tr>
<tr class="separator:ad2f4a34f39a90516756c34aae5916e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09e66e6f76cf08131e11a18a44b5d0a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a09e66e6f76cf08131e11a18a44b5d0a4">precommit_xct_sort_access</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="separator:a09e66e6f76cf08131e11a18a44b5d0a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada810d8d8e850b393c75d4531e978126"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ada810d8d8e850b393c75d4531e978126">precommit_xct_try_acquire_writer_locks</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="separator:ada810d8d8e850b393c75d4531e978126"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e8d274897885eab79859a29d6bcd0d2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a5e8d274897885eab79859a29d6bcd0d2">precommit_xct_request_writer_lock</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="structfoedus_1_1xct_1_1WriteXctAccess.html">WriteXctAccess</a> *write)</td></tr>
<tr class="separator:a5e8d274897885eab79859a29d6bcd0d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac95c3e56168f87c3550f908720035d60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60">handle_epoch_chime</a> ()</td></tr>
<tr class="memdesc:ac95c3e56168f87c3550f908720035d60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main routine for epoch_chime_thread_.  <a href="#ac95c3e56168f87c3550f908720035d60">More...</a><br /></td></tr>
<tr class="separator:ac95c3e56168f87c3550f908720035d60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a881d783a084b1225debd5408a9248a51"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a881d783a084b1225debd5408a9248a51">handle_epoch_chime_wait_grace_period</a> (<a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> grace_epoch)</td></tr>
<tr class="memdesc:a881d783a084b1225debd5408a9248a51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Makes sure all worker threads will commit with an epoch larger than grace_epoch.  <a href="#a881d783a084b1225debd5408a9248a51">More...</a><br /></td></tr>
<tr class="separator:a881d783a084b1225debd5408a9248a51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a715645715c1fbc080f9fc77c99b12bac"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">is_stop_requested</a> () const </td></tr>
<tr class="separator:a715645715c1fbc080f9fc77c99b12bac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19be4bae2114e48eb5c041c29e991983"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a19be4bae2114e48eb5c041c29e991983">pause_accepting_xct</a> ()</td></tr>
<tr class="memdesc:a19be4bae2114e48eb5c041c29e991983"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pause all begin_xct until you call <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9affae9e06ad2324c5857d0dd686995c" title="Make sure you call this after pause_accepting_xct(). ">resume_accepting_xct()</a>  <a href="#a19be4bae2114e48eb5c041c29e991983">More...</a><br /></td></tr>
<tr class="separator:a19be4bae2114e48eb5c041c29e991983"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9affae9e06ad2324c5857d0dd686995c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9affae9e06ad2324c5857d0dd686995c">resume_accepting_xct</a> ()</td></tr>
<tr class="memdesc:a9affae9e06ad2324c5857d0dd686995c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make sure you call this after <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a19be4bae2114e48eb5c041c29e991983" title="Pause all begin_xct until you call resume_accepting_xct() ">pause_accepting_xct()</a>.  <a href="#a9affae9e06ad2324c5857d0dd686995c">More...</a><br /></td></tr>
<tr class="separator:a9affae9e06ad2324c5857d0dd686995c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2552e77d289757f643d7e7d4aa5fcf4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ae2552e77d289757f643d7e7d4aa5fcf4">wait_until_resume_accepting_xct</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context)</td></tr>
<tr class="separator:ae2552e77d289757f643d7e7d4aa5fcf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfoedus_1_1DefaultInitializable"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfoedus_1_1DefaultInitializable')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfoedus_1_1DefaultInitializable.html">foedus::DefaultInitializable</a></td></tr>
<tr class="memitem:a5e0a2679baa030e297c1a51847352945 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a5e0a2679baa030e297c1a51847352945">DefaultInitializable</a> ()</td></tr>
<tr class="separator:a5e0a2679baa030e297c1a51847352945 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe7a18ec3e5edd143eb7d6a75d65ef9b inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#afe7a18ec3e5edd143eb7d6a75d65ef9b">~DefaultInitializable</a> ()</td></tr>
<tr class="separator:afe7a18ec3e5edd143eb7d6a75d65ef9b inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd6a8f8296ab570b545430593287d454 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#afd6a8f8296ab570b545430593287d454">DefaultInitializable</a> (const <a class="el" href="classfoedus_1_1DefaultInitializable.html">DefaultInitializable</a> &amp;)=delete</td></tr>
<tr class="separator:afd6a8f8296ab570b545430593287d454 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31eb5acadf0544b97414efd33aed08c7 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1DefaultInitializable.html">DefaultInitializable</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a31eb5acadf0544b97414efd33aed08c7">operator=</a> (const <a class="el" href="classfoedus_1_1DefaultInitializable.html">DefaultInitializable</a> &amp;)=delete</td></tr>
<tr class="separator:a31eb5acadf0544b97414efd33aed08c7 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22a0dc3bbbca682c3bc41eace9b6d1ff inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff">initialize</a> () override final</td></tr>
<tr class="memdesc:a22a0dc3bbbca682c3bc41eace9b6d1ff inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="mdescLeft">&#160;</td><td class="mdescRight">Typical implementation of <a class="el" href="classfoedus_1_1Initializable.html#aa087b096d1edaeb0304c250eadb0d7e1" title="Acquires resources in this object, usually called right after constructor. ">Initializable::initialize()</a> that provides initialize-once semantics.  <a href="#a22a0dc3bbbca682c3bc41eace9b6d1ff">More...</a><br /></td></tr>
<tr class="separator:a22a0dc3bbbca682c3bc41eace9b6d1ff inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab14b136a7d26f9f499ab9dc15a45a8cb inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb">uninitialize</a> () override final</td></tr>
<tr class="memdesc:ab14b136a7d26f9f499ab9dc15a45a8cb inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="mdescLeft">&#160;</td><td class="mdescRight">Typical implementation of <a class="el" href="classfoedus_1_1Initializable.html#afbe5738b0bc85362fba80bdf788fd3c3" title="An idempotent method to release all resources of this object, if any. ">Initializable::uninitialize()</a> that provides uninitialize-once semantics.  <a href="#ab14b136a7d26f9f499ab9dc15a45a8cb">More...</a><br /></td></tr>
<tr class="separator:ab14b136a7d26f9f499ab9dc15a45a8cb inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1abda1e84b8af8bd6916e52fd0a09f3e inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e">is_initialized</a> () const  override final</td></tr>
<tr class="memdesc:a1abda1e84b8af8bd6916e52fd0a09f3e inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns whether the object has been already initialized or not.  <a href="#a1abda1e84b8af8bd6916e52fd0a09f3e">More...</a><br /></td></tr>
<tr class="separator:a1abda1e84b8af8bd6916e52fd0a09f3e inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfoedus_1_1Initializable"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfoedus_1_1Initializable')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfoedus_1_1Initializable.html">foedus::Initializable</a></td></tr>
<tr class="memitem:aff308260543d18b3fd1367fd9017b176 inherit pub_methods_classfoedus_1_1Initializable"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1Initializable.html#aff308260543d18b3fd1367fd9017b176">~Initializable</a> ()</td></tr>
<tr class="separator:aff308260543d18b3fd1367fd9017b176 inherit pub_methods_classfoedus_1_1Initializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a7a0211510229613b4d7349bf8c373207"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1Engine.html">Engine</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a></td></tr>
<tr class="separator:a7a0211510229613b4d7349bf8c373207"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b1c83cfdd7fbf596784dbdc3a784381"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html">XctManagerControlBlock</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a></td></tr>
<tr class="separator:a9b1c83cfdd7fbf596784dbdc3a784381"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba3a68b498376e14438a729f0181cfe0"><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aba3a68b498376e14438a729f0181cfe0">epoch_chime_thread_</a></td></tr>
<tr class="memdesc:aba3a68b498376e14438a729f0181cfe0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This thread keeps advancing the current_global_epoch_.  <a href="#aba3a68b498376e14438a729f0181cfe0">More...</a><br /></td></tr>
<tr class="separator:aba3a68b498376e14438a729f0181cfe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aa614bc8e6539640c971112c7c18eb0ac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::xct::XctManagerPimpl::XctManagerPimpl </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa6ffe7f4c8a982d3978a77e6e68baf78"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::xct::XctManagerPimpl::XctManagerPimpl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Engine.html">Engine</a> *&#160;</td>
          <td class="paramname"><em>engine</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00103">103</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;: <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>(engine) {}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a71f565f69929d90febd7beb6b1dca696"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::abort_xct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00954">954</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="retrospective__lock__list_8cpp_source.html#l00059">foedus::xct::RetrospectiveLockList::clear_entries()</a>, <a class="el" href="retrospective__lock__list_8cpp_source.html#l00252">foedus::xct::RetrospectiveLockList::construct()</a>, <a class="el" href="xct_8hpp_source.html#l00108">foedus::xct::Xct::deactivate()</a>, <a class="el" href="thread__log__buffer_8hpp_source.html#l00358">foedus::log::ThreadLogBuffer::discard_current_xct_log()</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct_8hpp_source.html#l00162">foedus::xct::Xct::get_read_set()</a>, <a class="el" href="xct_8hpp_source.html#l00156">foedus::xct::Xct::get_read_set_size()</a>, <a class="el" href="xct_8hpp_source.html#l00415">foedus::xct::Xct::get_retrospective_lock_list()</a>, <a class="el" href="xct_8hpp_source.html#l00135">foedus::xct::Xct::get_rll_threshold_for_this_xct()</a>, <a class="el" href="thread_8cpp_source.html#l00053">foedus::thread::Thread::get_thread_id()</a>, <a class="el" href="thread_8cpp_source.html#l00078">foedus::thread::Thread::get_thread_log_buffer()</a>, <a class="el" href="xct__id_8cpp_source.html#l00074">foedus::xct::RwLockableXctId::hotter()</a>, <a class="el" href="xct_8hpp_source.html#l00121">foedus::xct::Xct::is_active()</a>, <a class="el" href="xct_8hpp_source.html#l00123">foedus::xct::Xct::is_enable_rll_for_this_xct()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00199">foedus::kErrorCodeXctNoXct</a>, <a class="el" href="xct__access_8hpp_source.html#l00143">foedus::xct::ReadXctAccess::observed_owner_id_</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00997">release_and_clear_all_current_locks()</a>, and <a class="el" href="xct__id_8hpp_source.html#l01137">foedus::xct::RwLockableXctId::xct_id_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00082">foedus::xct::XctManager::abort_xct()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00343">precommit_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                                                          {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">if</span> (!current_xct.is_active()) {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a72dcb6f3cd90cdeb9cbc8fbcecd0da3b">kErrorCodeXctNoXct</a>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Aborted transaction in thread-&quot;</span> &lt;&lt; context-&gt;get_thread_id();</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="comment">// The abort was probably due to read-set verification failure, either in lock()&#39;s</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="comment">// &#39;related_read&#39; check or in verify(). To handle both cases at once, we re-check</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="comment">// all read-sets here and make violating ones hotter.</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="comment">// This might sound like a bit of wasted effort, but anyway aborts must be reasonably</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="comment">// infrequent (otherwise we are screwed!) so this doesn&#39;t add too much.</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// Rather, we want to make sure we surely make them hotter.</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">// Actually, I spent half a day to figure out why a page doesn&#39;t become hot despite</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="comment">// lots of aborts! (A: lock()&#39;s related_read check forgot to make it hotter!)</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  ReadXctAccess*          read_set = current_xct.get_read_set();</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keyword">const</span> uint32_t          read_set_size = current_xct.get_read_set_size();</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; read_set_size; ++i) {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    ReadXctAccess&amp; access = read_set[i];</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">if</span> (access.observed_owner_id_ != access.owner_id_address_-&gt;xct_id_) {</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      access.owner_id_address_-&gt;hotter(context);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    }</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// When we abort, whether in precommit or via user&#39;s explicit abort, we construct RLL.</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="comment">// Abort may happen due to try-failure in reads, so we now put this in here, not precommit.</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="comment">// One drawback is that we can&#39;t check the &quot;cause&quot; of the abort.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="comment">// We should probably construct RLL only in the case of race-abort.</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="comment">// So, we might revist this choice.</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordflow">if</span> (current_xct.is_enable_rll_for_this_xct()) {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keyword">const</span> uint32_t threshold = current_xct.get_rll_threshold_for_this_xct();</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    current_xct.get_retrospective_lock_list()-&gt;construct(context, threshold);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    current_xct.get_retrospective_lock_list()-&gt;clear_entries();</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a3c2ee2d08709ff62e77e0dff6eded376">release_and_clear_all_current_locks</a>(context);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  current_xct.deactivate();</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  context-&gt;get_thread_log_buffer().discard_current_xct_log();</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a3c2ee2d08709ff62e77e0dff6eded376"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a3c2ee2d08709ff62e77e0dff6eded376">foedus::xct::XctManagerPimpl::release_and_clear_all_current_locks</a></div><div class="ttdeci">void release_and_clear_all_current_locks(thread::Thread *context)</div><div class="ttdoc">unlocking all acquired locks, used when commit/abort. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00997">xct_manager_pimpl.cpp:997</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a72dcb6f3cd90cdeb9cbc8fbcecd0da3b"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a72dcb6f3cd90cdeb9cbc8fbcecd0da3b">foedus::kErrorCodeXctNoXct</a></div><div class="ttdoc">0x0A04 : "XCTION : This thread is not running any transaction." . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00199">error_code.hpp:199</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#acdd6c3ee6c1e8b0da192818e70fec846" title="foedus::xct::Retrospective\lLockList::clear_entries" alt="" coords="282,152,454,193"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a38d217000e4df1d2d8e829c37218f93e" title="Fill out this retrospetive lock list for the next run of the given transaction. " alt="" coords="282,677,454,719"/>
<area shape="rect" id="node12" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="560,436,711,477"/>
<area shape="rect" id="node14" href="classfoedus_1_1xct_1_1Xct.html#ae523b00cead387e6addb1366fe08546a" title="foedus::xct::Xct::get\l_read_set" alt="" coords="566,853,705,895"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1Xct.html#af7b9c43800807db798d2e58bc07ad5cd" title="foedus::xct::Xct::get\l_read_set_size" alt="" coords="566,919,705,960"/>
<area shape="rect" id="node18" href="classfoedus_1_1xct_1_1Xct.html#a9a76be25f22fd49683d2a4138ab7b199" title="Returns whether the object is an active transaction. " alt="" coords="570,984,701,1025"/>
<area shape="rect" id="node21" href="classfoedus_1_1xct_1_1Xct.html#abbc9a5e976aadfba9f1fbf9e9fb39a9a" title="Closes the transaction. " alt="" coords="279,895,457,922"/>
<area shape="rect" id="node23" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9fecc418442394a926c49930cb95cc47" title="Called when the current transaction aborts. " alt="" coords="275,947,461,988"/>
<area shape="rect" id="node24" href="classfoedus_1_1xct_1_1Xct.html#a8b718008691c004c92d863b8b75dbe07" title="foedus::xct::Xct::get\l_retrospective_lock_list" alt="" coords="289,1012,447,1053"/>
<area shape="rect" id="node25" href="classfoedus_1_1xct_1_1Xct.html#a8a5728b0376ffa45b801a560051d7d7a" title="foedus::xct::Xct::get\l_rll_threshold_for_this_xct" alt="" coords="281,1077,455,1119"/>
<area shape="rect" id="node26" href="classfoedus_1_1thread_1_1Thread.html#af98ed86adde3f5e39c9cab39440f38da" title="foedus::thread::Thread\l::get_thread_id" alt="" coords="293,1143,443,1184"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee" title="Returns the private log buffer for this thread. " alt="" coords="291,1208,445,1249"/>
<area shape="rect" id="node28" href="structfoedus_1_1xct_1_1RwLockableXctId.html#aba859c4eb829f83fa767720d5b745646" title="foedus::xct::RwLockableXct\lId::hotter" alt="" coords="277,217,459,259"/>
<area shape="rect" id="node32" href="classfoedus_1_1xct_1_1Xct.html#aae4b0ccd575851276efddf752c90a273" title="foedus::xct::Xct::is\l_enable_rll_for_this_xct" alt="" coords="289,1273,447,1315"/>
<area shape="rect" id="node33" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a3c2ee2d08709ff62e77e0dff6eded376" title="unlocking all acquired locks, used when commit/abort. " alt="" coords="248,371,488,412"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a1397c6847c1ee46ba9c09457b4f5866e" title="foedus::xct::Retrospective\lLockList::assert_sorted" alt="" coords="549,736,721,777"/>
<area shape="rect" id="node8" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="2175,682,2341,709"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="561,305,710,347"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1Xct.html#ae5fa3dcdb891b99e5bc7d83ff2029f46" title="foedus::xct::Xct::get\l_write_set" alt="" coords="566,619,705,660"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="566,501,705,543"/>
<area shape="rect" id="node19" href="structfoedus_1_1xct_1_1LockEntry.html#a54190c5faf4f6943043c1d83ed435f44" title="foedus::xct::LockEntry::set" alt="" coords="546,567,725,594"/>
<area shape="rect" id="node20" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="1705,797,1851,839"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a14d555cbd9ddee31c68c9c81ff84c129" title="foedus::xct::Retrospective\lLockList::assert_sorted_impl" alt="" coords="1247,736,1436,777"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1xct.html#a736225e9852f9c75b92e134dbbe40a68" title="foedus::xct::lock_assert\l_sorted" alt="" coords="1925,736,2087,777"/>
<area shape="rect" id="node7" href="structfoedus_1_1storage_1_1Page.html#ac2a6248866335cc84b16bb0530eb76f4" title="foedus::storage::Page\l::get_volatile_page_id" alt="" coords="2183,733,2333,775"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="2177,799,2339,840"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="2412,765,2605,807"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="2428,831,2589,872"/>
<area shape="rect" id="node22" href="classfoedus_1_1xct_1_1CurrentLockList.html#a761b506c86d1d8e5681cab34fac1ad29" title="foedus::xct::CurrentLock\lList::is_empty" alt="" coords="553,1049,717,1091"/>
<area shape="rect" id="node29" href="classfoedus_1_1thread_1_1Thread.html#a83bb972b117e155dc7f0faa56751571b" title="foedus::thread::Thread\l::get_lock_rnd" alt="" coords="560,5,711,47"/>
<area shape="rect" id="node30" href="structfoedus_1_1assorted_1_1ProbCounter.html#a168e04a3f3aa5c426c6f7980b9f358a7" title="foedus::assorted::ProbCounter\l::increment" alt="" coords="536,71,735,112"/>
<area shape="rect" id="node31" href="classfoedus_1_1assorted_1_1UniformRandom.html#a5aba938f3a43d80fbfcca815637bbcfc" title="foedus::assorted::Uniform\lRandom::next_uint32" alt="" coords="789,71,960,112"/>
<area shape="rect" id="node34" href="classfoedus_1_1thread_1_1Thread.html#a21bff0861e0c12573bc0a6b776857b76" title="foedus::thread::Thread\l::cll_release_all_locks" alt="" coords="560,188,711,229"/>
<area shape="rect" id="node36" href="classfoedus_1_1xct_1_1Xct.html#afc0b909c82e905105f4f9701082a16b8" title="foedus::xct::Xct::get\l_current_lock_list" alt="" coords="1037,319,1176,360"/>
<area shape="rect" id="node47" href="classfoedus_1_1xct_1_1CurrentLockList.html#abb020fdb3951460f9c283d4700696ad2" title="foedus::xct::CurrentLock\lList::clear_entries" alt="" coords="553,371,717,412"/>
<area shape="rect" id="node35" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a6367855f3aa3549b2d7b74adf383c87a" title="foedus::thread::ThreadPimpl\l::cll_release_all_locks" alt="" coords="783,188,967,229"/>
<area shape="rect" id="node37" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a33a1b8b428cd84029b8b377867197ea4" title="foedus::thread::ThreadPimpl\l::is_simple_mcs_rw" alt="" coords="1015,253,1199,295"/>
<area shape="rect" id="node38" href="classfoedus_1_1xct_1_1CurrentLockList.html#a069941b140019c23d86092e68cd9b331" title="foedus::xct::CurrentLock\lList::release_all_locks" alt="" coords="1025,188,1189,229"/>
<area shape="rect" id="node39" href="classfoedus_1_1xct_1_1CurrentLockList.html#ace2e6a593d7b975f1756ce9eec0fd1f2" title="Release all locks in CLL whose addresses are canonically ordered before the parameter. " alt="" coords="1259,485,1423,527"/>
<area shape="rect" id="node40" href="classfoedus_1_1xct_1_1CurrentLockList.html#aed99dee60f9529d5cfabb5e1742038da" title="foedus::xct::CurrentLock\lList::assert_last_locked_entry" alt="" coords="1908,615,2104,656"/>
<area shape="rect" id="node43" href="classfoedus_1_1xct_1_1CurrentLockList.html#acbed8e324b88389217b42a132e0547b8" title="foedus::xct::CurrentLock\lList::assert_sorted" alt="" coords="1484,616,1648,657"/>
<area shape="rect" id="node45" href="classfoedus_1_1xct_1_1CurrentLockList.html#ae0cbd2f6b369d0340c3222f124fe122b" title="foedus::xct::CurrentLock\lList::begin" alt="" coords="1484,551,1648,592"/>
<area shape="rect" id="node46" href="classfoedus_1_1xct_1_1CurrentLockList.html#ad34e69a6289f0860fe000c3bbecda1cb" title="foedus::xct::CurrentLock\lList::end" alt="" coords="1484,485,1648,527"/>
<area shape="rect" id="node41" href="classfoedus_1_1xct_1_1CurrentLockList.html#a1a668d5dd1b711abed1a9962a8cb4ec1" title="Calculate last_locked_entry_ by really checking the whole list. " alt="" coords="2152,615,2364,656"/>
<area shape="rect" id="node42" href="classfoedus_1_1xct_1_1CurrentLockList.html#a03e818494c4d716f9fc996081f6c419f" title="Only searches among entries at or before &quot;from&quot;. " alt="" coords="2421,607,2597,663"/>
<area shape="rect" id="node44" href="classfoedus_1_1xct_1_1CurrentLockList.html#a7485f0d26810767b3bef18e12233daa7" title="foedus::xct::CurrentLock\lList::assert_sorted_impl" alt="" coords="1696,616,1860,657"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a71f565f69929d90febd7beb6b1dca696_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#aa176159e8ab007d35ea467226f5d2475" title="Aborts the currently running transaction on the thread. " alt="" coords="264,5,427,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="248,71,443,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="491,71,653,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a925da0bb4b846daa21eb947e4f67b0c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::advance_current_global_epoch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00255">255</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="shared__polling_8cpp_source.html#l00105">foedus::soc::SharedPolling::acquire_ticket()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00072">foedus::xct::XctManagerControlBlock::current_global_epoch_advanced_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">get_current_global_epoch()</a>, <a class="el" href="epoch_8hpp_source.html#l00127">foedus::Epoch::one_more()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00241">set_requested_global_epoch()</a>, <a class="el" href="shared__polling_8cpp_source.html#l00042">foedus::soc::SharedPolling::wait()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00237">wakeup_epoch_chime_thread()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00070">foedus::xct::XctManager::advance_current_global_epoch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                                   {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  Epoch now = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>();</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  Epoch request = now.one_more();</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Requesting to immediately advance epoch. request=&quot;</span> &lt;&lt; request &lt;&lt; <span class="stringliteral">&quot;...&quot;</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad">set_requested_global_epoch</a>(request);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>() &lt; request) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7">wakeup_epoch_chime_thread</a>();</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      uint64_t demand = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">current_global_epoch_advanced_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">acquire_ticket</a>();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>() &lt; request) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">current_global_epoch_advanced_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3">wait</a>(demand);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;epoch advanced. current_global_epoch_=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_afce787897428bd372c67224acd3e8ea7"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7">foedus::xct::XctManagerPimpl::wakeup_epoch_chime_thread</a></div><div class="ttdeci">void wakeup_epoch_chime_thread()</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00237">xct_manager_pimpl.cpp:237</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_a9fc7bfaf57e1f2224be9869a8e9708d3"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3">foedus::soc::SharedPolling::wait</a></div><div class="ttdeci">void wait(uint64_t demanded_ticket, uint64_t polling_spins=kDefaultPollingSpins, uint64_t max_interval_us=kDefaultPollingMaxIntervalUs) const </div><div class="ttdoc">Unconditionally wait for signal. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00042">shared_polling.cpp:42</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a787bb892079cb32d5a2065188825a522"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">foedus::xct::XctManagerPimpl::get_current_global_epoch</a></div><div class="ttdeci">Epoch get_current_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00107">xct_manager_pimpl.hpp:107</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ac6ad7822e42e2e942b55708b1da8516b"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">foedus::soc::SharedPolling::acquire_ticket</a></div><div class="ttdeci">uint64_t acquire_ticket() const </div><div class="ttdoc">Gives the ticket to. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00105">shared_polling.cpp:105</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a03678427b184e7ce71f9bbb164dd0bad"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad">foedus::xct::XctManagerPimpl::set_requested_global_epoch</a></div><div class="ttdeci">void set_requested_global_epoch(Epoch request)</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00241">xct_manager_pimpl.cpp:241</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aa4ec58399c28ee96cbc887f23c02434c"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">foedus::xct::XctManagerControlBlock::current_global_epoch_advanced_</a></div><div class="ttdeci">soc::SharedPolling current_global_epoch_advanced_</div><div class="ttdoc">Fired (broadcast) whenever current_global_epoch_ is advanced. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00072">xct_manager_pimpl.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="518,10,695,51"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch" alt="" coords="263,40,458,82"/>
<area shape="rect" id="node5" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="275,106,446,133"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad" title="foedus::xct::XctManagerPimpl\l::set_requested_global_epoch" alt="" coords="263,158,458,199"/>
<area shape="rect" id="node9" href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3" title="Unconditionally wait for signal. " alt="" coords="272,223,449,264"/>
<area shape="rect" id="node10" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7" title="foedus::xct::XctManagerPimpl\l::wakeup_epoch_chime_thread" alt="" coords="260,288,461,330"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="761,100,934,142"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4" title="foedus::xct::XctManagerPimpl\l::get_requested_global_epoch" alt="" coords="509,130,704,171"/>
<area shape="rect" id="node8" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="535,196,678,222"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="518,268,695,310"/>
<area shape="rect" id="node12" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="752,276,943,302"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a925da0bb4b846daa21eb947e4f67b0c6_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#aa75089821b48c98a00cd7e4ddc0615da" title="Requests to advance the current global epoch as soon as possible and blocks until it actually does..." alt="" coords="260,266,467,307"/>
<area shape="rect" id="node3" href="classfoedus_1_1log_1_1MetaLogBuffer.html#ab94212c9c14361971679c5581c99e7c3" title="Synchronously writes out the given log to metadata log file. " alt="" coords="526,123,702,165"/>
<area shape="rect" id="node9" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a694a2aaa7515ab45a8c9fa12b709defb" title="Subroutine of collect_retired_volatile_page() in case the chunk becomes full. " alt="" coords="522,233,706,274"/>
<area shape="rect" id="node21" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="515,298,713,339"/>
<area shape="rect" id="node24" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="539,371,689,413"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a9eec079742233abb22d147da7b4fa50a" title="foedus::storage::Storage\lManagerPimpl::create_storage\l_and_log" alt="" coords="761,5,960,61"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a252f35e96555817a5eba6ab2e2275d53" title="foedus::storage::Storage\lManagerPimpl::drop_storage" alt="" coords="767,86,955,127"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStoragePimpl.html#a8917edb5d2712fba660a33c6cf2fb19f" title="foedus::storage::sequential\l::SequentialStoragePimpl\l::truncate" alt="" coords="771,152,950,208"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1StorageManager.html#a2f5e7bd059656ae653d0a326141e76f1" title="Removes the storage object. " alt="" coords="1025,86,1189,127"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStorage.html#a9a4d7e58057f2fb648b7ff9ee6ab7fa0" title="Discards all records in this storage before the given epoch. " alt="" coords="1012,159,1203,201"/>
<area shape="rect" id="node10" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a674a8a8e613dc4e19a626da490c883fc" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="765,233,957,274"/>
<area shape="rect" id="node11" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1011,229,1203,270"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a31564163126364e4810f2f00398afd15" title="foedus::storage::masstree\l::Adopt::adopt_case_a" alt="" coords="1265,214,1439,255"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a8febde13f90f2b61abf29bf1f4a89e3d" title="foedus::storage::masstree\l::Adopt::adopt_case_b" alt="" coords="1265,149,1439,190"/>
<area shape="rect" id="node15" href="namespacefoedus_1_1storage_1_1masstree.html#a554f6fb34b45687df09df15076aac190" title="foedus::storage::masstree\l::grow_case_a_common" alt="" coords="1265,345,1439,386"/>
<area shape="rect" id="node18" href="namespacefoedus_1_1storage_1_1masstree.html#a9747d159e12f82f5fefcaed735947480" title="foedus::storage::masstree\l::grow_case_b_common" alt="" coords="1265,279,1439,321"/>
<area shape="rect" id="node19" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="1265,68,1439,124"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a16f4727fa2ce3b72468618be684af41d" title="Execute the system transaction. " alt="" coords="1508,182,1681,223"/>
<area shape="rect" id="node16" href="structfoedus_1_1storage_1_1masstree_1_1GrowFirstLayerRoot.html#a2c3c6cc4a2d74c498cee8f9051d09909" title="Execute the system transaction. " alt="" coords="1508,345,1681,386"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1masstree_1_1GrowNonFirstLayerRoot.html#a9c47822a3dd14ff40020c13d277820ea" title="Execute the system transaction. " alt="" coords="1497,279,1692,321"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="1508,75,1681,117"/>
<area shape="rect" id="node22" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="761,298,960,339"/>
<area shape="rect" id="node23" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1008,298,1207,339"/>
<area shape="rect" id="node25" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="763,379,958,421"/>
<area shape="rect" id="node26" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="1010,395,1205,437"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="1255,410,1449,451"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1513,410,1676,451"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad01b60a93f2e107d9c63e7c28799ac1a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::begin_xct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__XCT.html#ga9ac5dae4b91a288e9d887f28a7124c13">IsolationLevel</a>&#160;</td>
          <td class="paramname"><em>isolation_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>User transactions related methods. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00307">307</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct_8hpp_source.html#l00079">foedus::xct::Xct::activate()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00244">foedus::xct::RetrospectiveLockList::get_last_active_entry()</a>, <a class="el" href="xct_8hpp_source.html#l00159">foedus::xct::Xct::get_lock_free_write_set_size()</a>, <a class="el" href="xct_8hpp_source.html#l00116">foedus::xct::Xct::get_mcs_block_current()</a>, <a class="el" href="thread__log__buffer_8hpp_source.html#l00375">foedus::log::ThreadLogBuffer::get_offset_committed()</a>, <a class="el" href="thread__log__buffer_8hpp_source.html#l00378">foedus::log::ThreadLogBuffer::get_offset_tail()</a>, <a class="el" href="xct_8hpp_source.html#l00156">foedus::xct::Xct::get_read_set_size()</a>, <a class="el" href="xct_8hpp_source.html#l00415">foedus::xct::Xct::get_retrospective_lock_list()</a>, <a class="el" href="thread_8cpp_source.html#l00078">foedus::thread::Thread::get_thread_log_buffer()</a>, <a class="el" href="xct_8hpp_source.html#l00157">foedus::xct::Xct::get_write_set_size()</a>, <a class="el" href="xct_8hpp_source.html#l00121">foedus::xct::Xct::is_active()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00198">foedus::kErrorCodeXctAlreadyRunning</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00090">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a>, <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00334">wait_until_resume_accepting_xct()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00075">foedus::xct::XctManager::begin_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                                                                                          {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">if</span> (current_xct.is_active()) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56ae6921cfa66331f611311d8644675f783">kErrorCodeXctAlreadyRunning</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">new_transaction_paused_</a>.load())) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ae2552e77d289757f643d7e7d4aa5fcf4">wait_until_resume_accepting_xct</a>(context);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Began new transaction.&quot;</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; RLL size=&quot;</span> &lt;&lt; current_xct.get_retrospective_lock_list()-&gt;get_last_active_entry();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  current_xct.activate(isolation_level);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.get_mcs_block_current() == 0);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(context-&gt;get_thread_log_buffer().get_offset_tail()</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    == context-&gt;get_thread_log_buffer().get_offset_committed());</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.get_read_set_size() == 0);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.get_write_set_size() == 0);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.get_lock_free_write_set_size() == 0);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56ae6921cfa66331f611311d8644675f783"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56ae6921cfa66331f611311d8644675f783">foedus::kErrorCodeXctAlreadyRunning</a></div><div class="ttdoc">0x0A03 : "XCTION : This thread is already running a transaction. Commit or abort it first...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00198">error_code.hpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_ae2552e77d289757f643d7e7d4aa5fcf4"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ae2552e77d289757f643d7e7d4aa5fcf4">foedus::xct::XctManagerPimpl::wait_until_resume_accepting_xct</a></div><div class="ttdeci">void wait_until_resume_accepting_xct(thread::Thread *context)</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00334">xct_manager_pimpl.cpp:334</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aba6cb55bfe4729a5cdc4e25237def2fa"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; new_transaction_paused_</div><div class="ttdoc">If true, all new requests to begin_xct() will be paused until this becomes false. ...</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00090">xct_manager_pimpl.hpp:90</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1Xct.html#ac525c6624f248cd869b111b7d4338b30" title="Begins the transaction. " alt="" coords="277,166,441,193"/>
<area shape="rect" id="node20" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#afeae5ce72d1c324ecc32dce36459340a" title="foedus::xct::Retrospective\lLockList::get_last_active_entry" alt="" coords="731,355,932,396"/>
<area shape="rect" id="node22" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="284,348,435,389"/>
<area shape="rect" id="node23" href="classfoedus_1_1xct_1_1Xct.html#a4dfc3cd9b70a93615c3a0a8014aafbe1" title="foedus::xct::Xct::get\l_lock_free_write_set_size" alt="" coords="274,413,445,455"/>
<area shape="rect" id="node24" href="classfoedus_1_1xct_1_1Xct.html#ac81cd23819603f9bdbf780b9f6a18e56" title="foedus::xct::Xct::get\l_mcs_block_current" alt="" coords="290,479,429,520"/>
<area shape="rect" id="node25" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#ad75e847585775d7c506815269a176941" title="This marks the position upto which transaction logs are committed by the thread. " alt="" coords="266,544,453,585"/>
<area shape="rect" id="node26" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a3077294533a21c3aa0a115cfd4c90224" title="The current cursor to which next log will be written. " alt="" coords="266,609,453,651"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1Xct.html#af7b9c43800807db798d2e58bc07ad5cd" title="foedus::xct::Xct::get\l_read_set_size" alt="" coords="290,675,429,716"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1Xct.html#a8b718008691c004c92d863b8b75dbe07" title="foedus::xct::Xct::get\l_retrospective_lock_list" alt="" coords="281,740,438,781"/>
<area shape="rect" id="node29" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee" title="Returns the private log buffer for this thread. " alt="" coords="283,805,436,847"/>
<area shape="rect" id="node30" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="290,871,429,912"/>
<area shape="rect" id="node31" href="classfoedus_1_1xct_1_1Xct.html#a9a76be25f22fd49683d2a4138ab7b199" title="Returns whether the object is an active transaction. " alt="" coords="294,936,425,977"/>
<area shape="rect" id="node32" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ae2552e77d289757f643d7e7d4aa5fcf4" title="foedus::xct::XctManagerPimpl\l::wait_until_resume_accepting_xct" alt="" coords="248,1001,471,1043"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1CurrentLockList.html#abb020fdb3951460f9c283d4700696ad2" title="foedus::xct::CurrentLock\lList::clear_entries" alt="" coords="519,68,683,109"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a6c96bb5725be6694030bd8ce88d68698" title="foedus::xct::Retrospective\lLockList::is_empty" alt="" coords="745,28,917,69"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1CurrentLockList.html#a4a10e19f1d603ab47e74c605a9909fb5" title="Another batch&#45;insert method used at the beginning of a transaction. " alt="" coords="519,185,683,241"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a1397c6847c1ee46ba9c09457b4f5866e" title="foedus::xct::Retrospective\lLockList::assert_sorted" alt="" coords="745,93,917,135"/>
<area shape="rect" id="node14" href="classfoedus_1_1xct_1_1CurrentLockList.html#acbed8e324b88389217b42a132e0547b8" title="foedus::xct::CurrentLock\lList::assert_sorted" alt="" coords="749,159,913,200"/>
<area shape="rect" id="node19" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#acd7b6530aeff7f5323880bf0b6b14ce0" title="foedus::xct::Retrospective\lLockList::get_array" alt="" coords="745,224,917,265"/>
<area shape="rect" id="node21" href="classfoedus_1_1xct_1_1CurrentLockList.html#a761b506c86d1d8e5681cab34fac1ad29" title="foedus::xct::CurrentLock\lList::is_empty" alt="" coords="749,289,913,331"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a14d555cbd9ddee31c68c9c81ff84c129" title="foedus::xct::Retrospective\lLockList::assert_sorted_impl" alt="" coords="980,93,1169,135"/>
<area shape="rect" id="node8" href="namespacefoedus_1_1xct.html#a736225e9852f9c75b92e134dbbe40a68" title="foedus::xct::lock_assert\l_sorted" alt="" coords="1235,93,1396,135"/>
<area shape="rect" id="node9" href="structfoedus_1_1storage_1_1Page.html#ac2a6248866335cc84b16bb0530eb76f4" title="foedus::storage::Page\l::get_volatile_page_id" alt="" coords="1493,5,1642,47"/>
<area shape="rect" id="node10" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="1485,71,1650,98"/>
<area shape="rect" id="node11" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="1486,123,1649,164"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="1721,57,1915,99"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1737,123,1899,164"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1CurrentLockList.html#a7485f0d26810767b3bef18e12233daa7" title="foedus::xct::CurrentLock\lList::assert_sorted_impl" alt="" coords="993,159,1157,200"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1CurrentLockList.html#aed99dee60f9529d5cfabb5e1742038da" title="foedus::xct::CurrentLock\lList::assert_last_locked_entry" alt="" coords="1217,163,1413,204"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1CurrentLockList.html#a1a668d5dd1b711abed1a9962a8cb4ec1" title="Calculate last_locked_entry_ by really checking the whole list. " alt="" coords="1461,192,1673,233"/>
<area shape="rect" id="node18" href="classfoedus_1_1xct_1_1CurrentLockList.html#a03e818494c4d716f9fc996081f6c419f" title="Only searches among entries at or before &quot;from&quot;. " alt="" coords="1730,189,1906,245"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ad01b60a93f2e107d9c63e7c28799ac1a_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#a0cd2ffb750756de7132eabf6d6a284ce" title="Begins a new transaction on the thread. " alt="" coords="248,5,411,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a787bb892079cb32d5a2065188825a522"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> foedus::xct::XctManagerPimpl::get_current_global_epoch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">107</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, and <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00062">foedus::xct::XctManagerControlBlock::current_global_epoch_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00255">advance_current_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00057">foedus::xct::XctManager::get_current_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00063">foedus::xct::XctManager::get_current_grace_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">handle_epoch_chime()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00186">handle_epoch_chime_wait_grace_period()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00084">initialize_once()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00290">wait_for_commit()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00273">wait_for_current_global_epoch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                               {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">return</span> Epoch(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">current_global_epoch_</a>.load());</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a4862a9ec0a5e5eb3c16761d26573ad08"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">foedus::xct::XctManagerControlBlock::current_global_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; current_global_epoch_</div><div class="ttdoc">The current epoch of the entire engine. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00062">xct_manager_pimpl.hpp:62</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a787bb892079cb32d5a2065188825a522_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a787bb892079cb32d5a2065188825a522_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a787bb892079cb32d5a2065188825a522_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a787bb892079cb32d5a2065188825a522_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a925da0bb4b846daa21eb947e4f67b0c6" title="foedus::xct::XctManagerPimpl\l::advance_current_global_epoch" alt="" coords="248,454,455,495"/>
<area shape="rect" id="node30" href="classfoedus_1_1xct_1_1XctManager.html#a419a270d62522ede9bd871dd4adc0e2a" title="Returns the current global epoch, the epoch a newly started transaction will be in. " alt="" coords="531,482,710,523"/>
<area shape="rect" id="node34" href="classfoedus_1_1xct_1_1XctManager.html#addd36d7a9f38e055767f9a36c0889385" title="Returns the current grace&#45;period epoch (global epoch &#45; 1), the epoch some transaction might be still ..." alt="" coords="263,678,439,719"/>
<area shape="rect" id="node37" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60" title="Main routine for epoch_chime_thread_. " alt="" coords="523,795,718,837"/>
<area shape="rect" id="node38" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aefb36bf03b0bd29c160f5aa36b219d45" title="foedus::xct::XctManagerPimpl\l::initialize_once" alt="" coords="789,766,983,807"/>
<area shape="rect" id="node39" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a881d783a084b1225debd5408a9248a51" title="Makes sure all worker threads will commit with an epoch larger than grace_epoch. " alt="" coords="254,845,449,901"/>
<area shape="rect" id="node40" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a69fb51b2a05a90f46b4658cb984928a0" title="foedus::xct::XctManagerPimpl\l::wait_for_commit" alt="" coords="254,926,449,967"/>
<area shape="rect" id="node42" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#af5cb0928185cf79dda519313f05fe0ee" title="foedus::xct::XctManagerPimpl\l::wait_for_current_global_epoch" alt="" coords="249,579,453,621"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManager.html#aa75089821b48c98a00cd7e4ddc0615da" title="Requests to advance the current global epoch as soon as possible and blocks until it actually does..." alt="" coords="517,417,724,458"/>
<area shape="rect" id="node4" href="classfoedus_1_1log_1_1MetaLogBuffer.html#ab94212c9c14361971679c5581c99e7c3" title="Synchronously writes out the given log to metadata log file. " alt="" coords="798,417,974,458"/>
<area shape="rect" id="node10" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a694a2aaa7515ab45a8c9fa12b709defb" title="Subroutine of collect_retired_volatile_page() in case the chunk becomes full. " alt="" coords="794,286,978,327"/>
<area shape="rect" id="node22" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="787,629,985,670"/>
<area shape="rect" id="node25" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="811,351,961,393"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a9eec079742233abb22d147da7b4fa50a" title="foedus::storage::Storage\lManagerPimpl::create_storage\l_and_log" alt="" coords="1033,332,1232,388"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a252f35e96555817a5eba6ab2e2275d53" title="foedus::storage::Storage\lManagerPimpl::drop_storage" alt="" coords="1039,413,1227,454"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStoragePimpl.html#a8917edb5d2712fba660a33c6cf2fb19f" title="foedus::storage::sequential\l::SequentialStoragePimpl\l::truncate" alt="" coords="1043,479,1222,535"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1StorageManager.html#a2f5e7bd059656ae653d0a326141e76f1" title="Removes the storage object. " alt="" coords="1297,413,1461,454"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStorage.html#a9a4d7e58057f2fb648b7ff9ee6ab7fa0" title="Discards all records in this storage before the given epoch. " alt="" coords="1284,486,1475,527"/>
<area shape="rect" id="node11" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a674a8a8e613dc4e19a626da490c883fc" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1037,201,1229,242"/>
<area shape="rect" id="node12" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1283,185,1475,226"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a31564163126364e4810f2f00398afd15" title="foedus::storage::masstree\l::Adopt::adopt_case_a" alt="" coords="1537,86,1711,127"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a8febde13f90f2b61abf29bf1f4a89e3d" title="foedus::storage::masstree\l::Adopt::adopt_case_b" alt="" coords="1537,151,1711,193"/>
<area shape="rect" id="node16" href="namespacefoedus_1_1storage_1_1masstree.html#a554f6fb34b45687df09df15076aac190" title="foedus::storage::masstree\l::grow_case_a_common" alt="" coords="1537,282,1711,323"/>
<area shape="rect" id="node19" href="namespacefoedus_1_1storage_1_1masstree.html#a9747d159e12f82f5fefcaed735947480" title="foedus::storage::masstree\l::grow_case_b_common" alt="" coords="1537,217,1711,258"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="1537,5,1711,61"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a16f4727fa2ce3b72468618be684af41d" title="Execute the system transaction. " alt="" coords="1780,119,1953,161"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1masstree_1_1GrowFirstLayerRoot.html#a2c3c6cc4a2d74c498cee8f9051d09909" title="Execute the system transaction. " alt="" coords="1780,282,1953,323"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1masstree_1_1GrowNonFirstLayerRoot.html#a9c47822a3dd14ff40020c13d277820ea" title="Execute the system transaction. " alt="" coords="1769,217,1964,258"/>
<area shape="rect" id="node21" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="1780,13,1953,54"/>
<area shape="rect" id="node23" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="1033,639,1232,681"/>
<area shape="rect" id="node24" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1280,639,1479,681"/>
<area shape="rect" id="node26" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="1035,266,1230,307"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="1282,282,1477,323"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="1527,347,1721,389"/>
<area shape="rect" id="node29" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1785,347,1948,389"/>
<area shape="rect" id="node31" href="classfoedus_1_1Engine.html#a8d468737935eab05b3f9757cb6757fe1" title="Returns the current global epoch, the epoch a newly started transaction will be in. " alt="" coords="810,482,962,523"/>
<area shape="rect" id="node32" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#ae5e8a2671c819fc0ada038b3fa47105a" title="foedus::savepoint::\lSavepointManagerPimpl\l::savepoint_main" alt="" coords="805,548,967,604"/>
<area shape="rect" id="node33" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#ad75cdea74e547a1f66d62b85a938a2cd" title="foedus::savepoint::\lSavepointManagerPimpl\l::initialize_once" alt="" coords="1052,559,1213,615"/>
<area shape="rect" id="node35" href="classfoedus_1_1Engine.html#ab93f097823724ccb9ed885d6a5d0cd8d" title="Returns the current grace&#45;period epoch (global epoch &#45; 1), the epoch some transaction might be still ..." alt="" coords="545,613,696,654"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1sequential_1_1SequentialCursor.html#a63f0ef6e7a9171191d4117e08da4e7d3" title="Constructs a cursor to read tuples from this storage. " alt="" coords="503,678,739,719"/>
<area shape="rect" id="node41" href="classfoedus_1_1xct_1_1XctManager.html#a577f44c6f10022d645605d171ef4a781" title="Synchronously blocks until the durable global epoch reaches the given commit epoch or the given durat..." alt="" coords="539,926,702,967"/>
<area shape="rect" id="node43" href="classfoedus_1_1xct_1_1XctManager.html#aa3178a6ce1c815fb88b6c8d5607da5d4" title="Passively wait until the current global epoch becomes the given value. " alt="" coords="519,547,723,589"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acd49fd67f3459df687ed08d5d8b54082"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> foedus::xct::XctManagerPimpl::get_current_global_epoch_weak </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00113">113</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, and <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00062">foedus::xct::XctManagerControlBlock::current_global_epoch_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00060">foedus::xct::XctManager::get_current_global_epoch_weak()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00066">foedus::xct::XctManager::get_current_grace_epoch_weak()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00384">precommit_xct_readwrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                                    {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span> Epoch(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">current_global_epoch_</a>.load(std::memory_order_relaxed));</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a4862a9ec0a5e5eb3c16761d26573ad08"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">foedus::xct::XctManagerControlBlock::current_global_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; current_global_epoch_</div><div class="ttdoc">The current epoch of the entire engine. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00062">xct_manager_pimpl.hpp:62</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_acd49fd67f3459df687ed08d5d8b54082_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_acd49fd67f3459df687ed08d5d8b54082_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_acd49fd67f3459df687ed08d5d8b54082_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_acd49fd67f3459df687ed08d5d8b54082_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#a4578dd6dab7925b95d7810335ae5cec0" title="foedus::xct::XctManager\l::get_current_global_epoch_weak" alt="" coords="268,289,483,331"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="1013,348,1208,389"/>
<area shape="rect" id="node19" href="classfoedus_1_1xct_1_1XctManager.html#ac5c5f89e66b63d3eb621906c8f88a654" title="foedus::xct::XctManager\l::get_current_grace_epoch_weak" alt="" coords="269,407,482,448"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a674a8a8e613dc4e19a626da490c883fc" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="531,180,723,221"/>
<area shape="rect" id="node14" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="551,289,702,331"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="772,169,964,211"/>
<area shape="rect" id="node5" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a31564163126364e4810f2f00398afd15" title="foedus::storage::masstree\l::Adopt::adopt_case_a" alt="" coords="1024,5,1197,47"/>
<area shape="rect" id="node7" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a8febde13f90f2b61abf29bf1f4a89e3d" title="foedus::storage::masstree\l::Adopt::adopt_case_b" alt="" coords="1024,71,1197,112"/>
<area shape="rect" id="node8" href="namespacefoedus_1_1storage_1_1masstree.html#a554f6fb34b45687df09df15076aac190" title="foedus::storage::masstree\l::grow_case_a_common" alt="" coords="1024,136,1197,177"/>
<area shape="rect" id="node11" href="namespacefoedus_1_1storage_1_1masstree.html#a9747d159e12f82f5fefcaed735947480" title="foedus::storage::masstree\l::grow_case_b_common" alt="" coords="1024,201,1197,243"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="1024,267,1197,323"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a16f4727fa2ce3b72468618be684af41d" title="Execute the system transaction. " alt="" coords="1267,39,1440,80"/>
<area shape="rect" id="node9" href="structfoedus_1_1storage_1_1masstree_1_1GrowFirstLayerRoot.html#a2c3c6cc4a2d74c498cee8f9051d09909" title="Execute the system transaction. " alt="" coords="1267,201,1440,243"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1masstree_1_1GrowNonFirstLayerRoot.html#a9c47822a3dd14ff40020c13d277820ea" title="Execute the system transaction. " alt="" coords="1256,136,1451,177"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="1267,275,1440,316"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="771,289,965,331"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="1256,348,1451,389"/>
<area shape="rect" id="node18" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1499,348,1661,389"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6071efec3ffc3876192101db2a1873b4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> foedus::xct::XctManagerPimpl::get_requested_global_epoch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00110">110</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, and <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00069">foedus::xct::XctManagerControlBlock::requested_global_epoch_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">handle_epoch_chime()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00241">set_requested_global_epoch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                                                 {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">return</span> Epoch(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a2739200a83eeb40719000abe38e8084e">requested_global_epoch_</a>.load());</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  }</div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a2739200a83eeb40719000abe38e8084e"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a2739200a83eeb40719000abe38e8084e">foedus::xct::XctManagerControlBlock::requested_global_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; requested_global_epoch_</div><div class="ttdoc">If some thread requested to immediately advance epoch, the requested epoch. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00069">xct_manager_pimpl.hpp:69</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a6071efec3ffc3876192101db2a1873b4_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a6071efec3ffc3876192101db2a1873b4_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a6071efec3ffc3876192101db2a1873b4_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a6071efec3ffc3876192101db2a1873b4_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60" title="Main routine for epoch_chime_thread_. " alt="" coords="248,354,443,395"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad" title="foedus::xct::XctManagerPimpl\l::set_requested_global_epoch" alt="" coords="248,451,443,493"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aefb36bf03b0bd29c160f5aa36b219d45" title="foedus::xct::XctManagerPimpl\l::initialize_once" alt="" coords="497,337,691,378"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a925da0bb4b846daa21eb947e4f67b0c6" title="foedus::xct::XctManagerPimpl\l::advance_current_global_epoch" alt="" coords="491,402,697,443"/>
<area shape="rect" id="node33" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#af5cb0928185cf79dda519313f05fe0ee" title="foedus::xct::XctManagerPimpl\l::wait_for_current_global_epoch" alt="" coords="492,467,696,509"/>
<area shape="rect" id="node35" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a69fb51b2a05a90f46b4658cb984928a0" title="foedus::xct::XctManagerPimpl\l::wait_for_commit" alt="" coords="497,533,691,574"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManager.html#aa75089821b48c98a00cd7e4ddc0615da" title="Requests to advance the current global epoch as soon as possible and blocks until it actually does..." alt="" coords="745,402,952,443"/>
<area shape="rect" id="node7" href="classfoedus_1_1log_1_1MetaLogBuffer.html#ab94212c9c14361971679c5581c99e7c3" title="Synchronously writes out the given log to metadata log file. " alt="" coords="1011,402,1187,443"/>
<area shape="rect" id="node13" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a694a2aaa7515ab45a8c9fa12b709defb" title="Subroutine of collect_retired_volatile_page() in case the chunk becomes full. " alt="" coords="1007,211,1191,253"/>
<area shape="rect" id="node25" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="1000,467,1199,509"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="1024,297,1175,338"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a9eec079742233abb22d147da7b4fa50a" title="foedus::storage::Storage\lManagerPimpl::create_storage\l_and_log" alt="" coords="1247,332,1445,388"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a252f35e96555817a5eba6ab2e2275d53" title="foedus::storage::Storage\lManagerPimpl::drop_storage" alt="" coords="1252,413,1440,454"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStoragePimpl.html#a8917edb5d2712fba660a33c6cf2fb19f" title="foedus::storage::sequential\l::SequentialStoragePimpl\l::truncate" alt="" coords="1257,479,1435,535"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1StorageManager.html#a2f5e7bd059656ae653d0a326141e76f1" title="Removes the storage object. " alt="" coords="1511,413,1675,454"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStorage.html#a9a4d7e58057f2fb648b7ff9ee6ab7fa0" title="Discards all records in this storage before the given epoch. " alt="" coords="1497,486,1688,527"/>
<area shape="rect" id="node14" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a674a8a8e613dc4e19a626da490c883fc" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1250,201,1442,242"/>
<area shape="rect" id="node15" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1497,185,1689,226"/>
<area shape="rect" id="node16" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a31564163126364e4810f2f00398afd15" title="foedus::storage::masstree\l::Adopt::adopt_case_a" alt="" coords="1751,217,1924,258"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a8febde13f90f2b61abf29bf1f4a89e3d" title="foedus::storage::masstree\l::Adopt::adopt_case_b" alt="" coords="1751,282,1924,323"/>
<area shape="rect" id="node19" href="namespacefoedus_1_1storage_1_1masstree.html#a554f6fb34b45687df09df15076aac190" title="foedus::storage::masstree\l::grow_case_a_common" alt="" coords="1751,151,1924,193"/>
<area shape="rect" id="node22" href="namespacefoedus_1_1storage_1_1masstree.html#a9747d159e12f82f5fefcaed735947480" title="foedus::storage::masstree\l::grow_case_b_common" alt="" coords="1751,86,1924,127"/>
<area shape="rect" id="node23" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="1751,5,1924,61"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a16f4727fa2ce3b72468618be684af41d" title="Execute the system transaction. " alt="" coords="1993,250,2167,291"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1masstree_1_1GrowFirstLayerRoot.html#a2c3c6cc4a2d74c498cee8f9051d09909" title="Execute the system transaction. " alt="" coords="1993,151,2167,193"/>
<area shape="rect" id="node21" href="structfoedus_1_1storage_1_1masstree_1_1GrowNonFirstLayerRoot.html#a9c47822a3dd14ff40020c13d277820ea" title="Execute the system transaction. " alt="" coords="1983,86,2177,127"/>
<area shape="rect" id="node24" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="1993,13,2167,54"/>
<area shape="rect" id="node26" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="1247,559,1445,601"/>
<area shape="rect" id="node27" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1493,559,1692,601"/>
<area shape="rect" id="node29" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="1249,266,1443,307"/>
<area shape="rect" id="node30" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="1495,282,1690,323"/>
<area shape="rect" id="node31" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="1740,347,1935,389"/>
<area shape="rect" id="node32" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1999,347,2161,389"/>
<area shape="rect" id="node34" href="classfoedus_1_1xct_1_1XctManager.html#aa3178a6ce1c815fb88b6c8d5607da5d4" title="Passively wait until the current global epoch becomes the given value. " alt="" coords="747,467,951,509"/>
<area shape="rect" id="node36" href="classfoedus_1_1xct_1_1XctManager.html#a577f44c6f10022d645605d171ef4a781" title="Synchronously blocks until the durable global epoch reaches the given commit epoch or the given durat..." alt="" coords="767,533,930,574"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac95c3e56168f87c3550f908720035d60"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::handle_epoch_chime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main routine for epoch_chime_thread_. </p>
<p><a class="el" href="classfoedus_1_1Epoch.html" title="Represents a time epoch. ">Epoch</a> Chime related methods.</p>
<p>This method keeps advancing global_epoch with the interval configured in <a class="el" href="structfoedus_1_1xct_1_1XctOptions.html" title="Set of options for xct manager. ">XctOptions</a>. This method exits when this object's <a class="el" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb" title="Typical implementation of Initializable::uninitialize() that provides uninitialize-once semantics...">uninitialize()</a> is called.</p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">135</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="shared__polling_8cpp_source.html#l00105">foedus::soc::SharedPolling::acquire_ticket()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00062">foedus::xct::XctManagerControlBlock::current_global_epoch_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00072">foedus::xct::XctManagerControlBlock::current_global_epoch_advanced_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="xct__options_8hpp_source.html#l00112">foedus::xct::XctOptions::epoch_advance_interval_ms_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00075">foedus::xct::XctManagerControlBlock::epoch_chime_wakeup_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">get_current_global_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="engine_8cpp_source.html#l00039">foedus::Engine::get_options()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00110">get_requested_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00186">handle_epoch_chime_wait_grace_period()</a>, <a class="el" href="initializable_8hpp_source.html#l00196">foedus::DefaultInitializable::is_initialized()</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00125">is_stop_requested()</a>, <a class="el" href="shared__polling_8hpp_source.html#l00029">foedus::soc::kDefaultPollingSpins</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00046">foedus::assorted::memory_fence_acquire()</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="epoch_8hpp_source.html#l00122">foedus::Epoch::one_less()</a>, <a class="el" href="epoch_8hpp_source.html#l00127">foedus::Epoch::one_more()</a>, <a class="el" href="shared__polling_8cpp_source.html#l00100">foedus::soc::SharedPolling::signal()</a>, <a class="el" href="assorted__func_8hpp_source.html#l00256">SPINLOCK_WHILE</a>, <a class="el" href="shared__polling_8cpp_source.html#l00063">foedus::soc::SharedPolling::timedwait()</a>, <a class="el" href="epoch_8hpp_source.html#l00102">foedus::Epoch::value()</a>, <a class="el" href="log__manager_8cpp_source.html#l00035">foedus::log::LogManager::wakeup_loggers()</a>, and <a class="el" href="engine__options_8hpp_source.html#l00147">foedus::EngineOptions::xct_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00084">initialize_once()</a>.</p>
<div class="fragment"><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                         {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;epoch_chime_thread started.&quot;</span>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>());</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// Wait until all the other initializations are done.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="group__ASSORTED.html#gae932f87b60cbd230347151ccf33eed86">SPINLOCK_WHILE</a>(!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">is_stop_requested</a>() &amp;&amp; !<a class="code" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e">is_initialized</a>()) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  uint64_t interval_microsec = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#a1fb740dca84aaaed101bf9f4818c5b4f">xct_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctOptions.html#ac67d4a038ad4875ee420d19e1ffca45d">epoch_advance_interval_ms_</a> * 1000ULL;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;epoch_chime_thread now starts processing. interval_microsec=&quot;</span> &lt;&lt; interval_microsec;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      uint64_t demand = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa6ae7e0c7ae0e28e419a90af9f6f5ded">epoch_chime_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">acquire_ticket</a>();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4">get_requested_global_epoch</a>() &lt;= <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>())  {  <span class="comment">// otherwise no sleep</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordtype">bool</span> signaled = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa6ae7e0c7ae0e28e419a90af9f6f5ded">epoch_chime_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">timedwait</a>(</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          demand,</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          interval_microsec,</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          <a class="code" href="namespacefoedus_1_1soc.html#a7dc9d6d7a8576dd0b9249fd6186c7124">soc::kDefaultPollingSpins</a>,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          interval_microsec);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        VLOG(1) &lt;&lt; <span class="stringliteral">&quot;epoch_chime_thread. wokeup with &quot;</span> &lt;&lt; (signaled ? <span class="stringliteral">&quot;signal&quot;</span> : <span class="stringliteral">&quot;timeout&quot;</span>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    VLOG(1) &lt;&lt; <span class="stringliteral">&quot;epoch_chime_thread. current_global_epoch_=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>().is_valid());</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// Before advanding the epoch, we have to make sure there is no thread that might commit</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// with previous epoch.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    Epoch grace_epoch = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>().<a class="code" href="classfoedus_1_1Epoch.html#a701de077839df51ebe44749a116ec10f">one_less</a>();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a881d783a084b1225debd5408a9248a51">handle_epoch_chime_wait_grace_period</a>(grace_epoch);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="comment">// soc::SharedMutexScope scope(control_block_-&gt;current_global_epoch_advanced_.get_mutex());</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="comment">// There is only one thread (this) that might update current_global_epoch_, so</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="comment">// no mutex needed. just set it and put fence.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">current_global_epoch_</a> = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>().<a class="code" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3">one_more</a>().<a class="code" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf">value</a>();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">current_global_epoch_advanced_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">signal</a>();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#a5c844c3bc8d71ce709999fd286a5e7b8">wakeup_loggers</a>();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;epoch_chime_thread ended.&quot;</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a701de077839df51ebe44749a116ec10f"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a701de077839df51ebe44749a116ec10f">foedus::Epoch::one_less</a></div><div class="ttdeci">Epoch one_less() const </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00122">epoch.hpp:122</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_a5c844c3bc8d71ce709999fd286a5e7b8"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#a5c844c3bc8d71ce709999fd286a5e7b8">foedus::log::LogManager::wakeup_loggers</a></div><div class="ttdeci">void wakeup_loggers()</div><div class="ttdoc">Wake up loggers if they are sleeping. </div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00035">log_manager.cpp:35</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aa6ae7e0c7ae0e28e419a90af9f6f5ded"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa6ae7e0c7ae0e28e419a90af9f6f5ded">foedus::xct::XctManagerControlBlock::epoch_chime_wakeup_</a></div><div class="ttdeci">soc::SharedPolling epoch_chime_wakeup_</div><div class="ttdoc">Fired to wakeup epoch_chime_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00075">xct_manager_pimpl.hpp:75</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a787bb892079cb32d5a2065188825a522"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">foedus::xct::XctManagerPimpl::get_current_global_epoch</a></div><div class="ttdeci">Epoch get_current_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00107">xct_manager_pimpl.hpp:107</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_a1fb740dca84aaaed101bf9f4818c5b4f"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#a1fb740dca84aaaed101bf9f4818c5b4f">foedus::EngineOptions::xct_</a></div><div class="ttdeci">xct::XctOptions xct_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00147">engine_options.hpp:147</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a715645715c1fbc080f9fc77c99b12bac"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">foedus::xct::XctManagerPimpl::is_stop_requested</a></div><div class="ttdeci">bool is_stop_requested() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00125">xct_manager_pimpl.cpp:125</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a6546930099132529543c320327367ef1"><div class="ttname"><a href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">foedus::Engine::get_options</a></div><div class="ttdeci">const EngineOptions &amp; get_options() const </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00039">engine.cpp:39</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ac6ad7822e42e2e942b55708b1da8516b"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">foedus::soc::SharedPolling::acquire_ticket</a></div><div class="ttdeci">uint64_t acquire_ticket() const </div><div class="ttdoc">Gives the ticket to. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00105">shared_polling.cpp:105</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctOptions_html_ac67d4a038ad4875ee420d19e1ffca45d"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctOptions.html#ac67d4a038ad4875ee420d19e1ffca45d">foedus::xct::XctOptions::epoch_advance_interval_ms_</a></div><div class="ttdeci">uint32_t epoch_advance_interval_ms_</div><div class="ttdoc">Intervals in milliseconds between epoch advancements. </div><div class="ttdef"><b>Definition:</b> <a href="xct__options_8hpp_source.html#l00112">xct_options.hpp:112</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a6071efec3ffc3876192101db2a1873b4"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4">foedus::xct::XctManagerPimpl::get_requested_global_epoch</a></div><div class="ttdeci">Epoch get_requested_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00110">xct_manager_pimpl.hpp:110</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gae932f87b60cbd230347151ccf33eed86"><div class="ttname"><a href="group__ASSORTED.html#gae932f87b60cbd230347151ccf33eed86">SPINLOCK_WHILE</a></div><div class="ttdeci">#define SPINLOCK_WHILE(x)</div><div class="ttdoc">A macro to busy-wait (spinlock) with occasional pause. </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8hpp_source.html#l00256">assorted_func.hpp:256</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a786afd92afdc87b54dfa11ef093f06f3"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3">foedus::Epoch::one_more</a></div><div class="ttdeci">Epoch one_more() const </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00127">epoch.hpp:127</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a881d783a084b1225debd5408a9248a51"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a881d783a084b1225debd5408a9248a51">foedus::xct::XctManagerPimpl::handle_epoch_chime_wait_grace_period</a></div><div class="ttdeci">void handle_epoch_chime_wait_grace_period(Epoch grace_epoch)</div><div class="ttdoc">Makes sure all worker threads will commit with an epoch larger than grace_epoch. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00186">xct_manager_pimpl.cpp:186</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaf84f9944a16c5848f69beacdfeedf939"><div class="ttname"><a href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">foedus::assorted::memory_fence_acquire</a></div><div class="ttdeci">void memory_fence_acquire()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_acquire). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00046">atomic_fences.hpp:46</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a4862a9ec0a5e5eb3c16761d26573ad08"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">foedus::xct::XctManagerControlBlock::current_global_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; current_global_epoch_</div><div class="ttdoc">The current epoch of the entire engine. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00062">xct_manager_pimpl.hpp:62</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_a1b9f5c8b129c454887a77d3255956157"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">foedus::soc::SharedPolling::timedwait</a></div><div class="ttdeci">bool timedwait(uint64_t demanded_ticket, uint64_t timeout_microsec, uint64_t polling_spins=kDefaultPollingSpins, uint64_t max_interval_us=kDefaultPollingMaxIntervalUs) const </div><div class="ttdoc">Wait for signal up to the given timeout. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00063">shared_polling.cpp:63</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aa4ec58399c28ee96cbc887f23c02434c"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">foedus::xct::XctManagerControlBlock::current_global_epoch_advanced_</a></div><div class="ttdeci">soc::SharedPolling current_global_epoch_advanced_</div><div class="ttdoc">Fired (broadcast) whenever current_global_epoch_ is advanced. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00072">xct_manager_pimpl.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1DefaultInitializable_html_a1abda1e84b8af8bd6916e52fd0a09f3e"><div class="ttname"><a href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e">foedus::DefaultInitializable::is_initialized</a></div><div class="ttdeci">bool is_initialized() const  override final</div><div class="ttdoc">Returns whether the object has been already initialized or not. </div><div class="ttdef"><b>Definition:</b> <a href="initializable_8hpp_source.html#l00196">initializable.hpp:196</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ae523f3b3bda39c0c81bfb5cb0d5ad626"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">foedus::soc::SharedPolling::signal</a></div><div class="ttdeci">void signal()</div><div class="ttdoc">Signal it to let waiters exit. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00100">shared_polling.cpp:100</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_af13cf48db2b5bd1d273f5f7350a4d8cf"><div class="ttname"><a href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf">foedus::Epoch::value</a></div><div class="ttdeci">EpochInteger value() const </div><div class="ttdoc">Returns the raw integer representation. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00102">epoch.hpp:102</a></div></div>
<div class="ttc" id="namespacefoedus_1_1soc_html_a7dc9d6d7a8576dd0b9249fd6186c7124"><div class="ttname"><a href="namespacefoedus_1_1soc.html#a7dc9d6d7a8576dd0b9249fd6186c7124">foedus::soc::kDefaultPollingSpins</a></div><div class="ttdeci">const uint64_t kDefaultPollingSpins</div><div class="ttdoc">Default value of polling_spins. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8hpp_source.html#l00029">shared_polling.hpp:29</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="257,5,434,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch" alt="" coords="495,188,690,229"/>
<area shape="rect" id="node5" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="278,600,413,641"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="278,665,413,707"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4" title="foedus::xct::XctManagerPimpl\l::get_requested_global_epoch" alt="" coords="248,731,443,772"/>
<area shape="rect" id="node8" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a881d783a084b1225debd5408a9248a51" title="Makes sure all worker threads will commit with an epoch larger than grace_epoch. " alt="" coords="248,469,443,525"/>
<area shape="rect" id="node9" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="768,253,895,295"/>
<area shape="rect" id="node10" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="507,319,678,346"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac" title="foedus::xct::XctManagerPimpl\l::is_stop_requested" alt="" coords="495,253,690,295"/>
<area shape="rect" id="node18" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="745,771,918,812"/>
<area shape="rect" id="node24" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="259,796,431,837"/>
<area shape="rect" id="node25" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="259,861,432,903"/>
<area shape="rect" id="node26" href="classfoedus_1_1Epoch.html#a701de077839df51ebe44749a116ec10f" title="foedus::Epoch::one_less" alt="" coords="263,927,428,954"/>
<area shape="rect" id="node27" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="257,71,434,112"/>
<area shape="rect" id="node29" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="257,979,434,1020"/>
<area shape="rect" id="node31" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="274,1045,417,1071"/>
<area shape="rect" id="node32" href="classfoedus_1_1log_1_1LogManager.html#a5c844c3bc8d71ce709999fd286a5e7b8" title="Wake up loggers if they are sleeping. " alt="" coords="263,1096,427,1137"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="506,9,679,51"/>
<area shape="rect" id="node11" href="classfoedus_1_1Engine.html#a4243a3e399186727d6bbdda5bc98f8cd" title="See Thread and Thread&#45;Group. " alt="" coords="525,421,660,463"/>
<area shape="rect" id="node12" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="525,487,660,528"/>
<area shape="rect" id="node13" href="classfoedus_1_1thread_1_1ThreadPool.html#a990314c9e1ee9ec3a04c73a683e1066c" title="foedus::thread::ThreadPool\l::get_group_ref" alt="" coords="504,552,681,593"/>
<area shape="rect" id="node16" href="classfoedus_1_1thread_1_1ThreadGroupRef.html#a5b15c98366cf1839fe6621f445853fa1" title="Returns the oldest in&#45;commit epoch of the threads in this group. " alt="" coords="491,669,695,711"/>
<area shape="rect" id="node17" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="968,669,1123,695"/>
<area shape="rect" id="node20" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="525,787,660,828"/>
<area shape="rect" id="node21" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="751,836,912,877"/>
<area shape="rect" id="node23" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="510,852,675,893"/>
<area shape="rect" id="node14" href="classfoedus_1_1thread_1_1ThreadPoolPimpl.html#a30a6a44047fc684ddf453d6ce6450783" title="foedus::thread::ThreadPool\lPimpl::get_group" alt="" coords="743,552,920,593"/>
<area shape="rect" id="node19" href="classfoedus_1_1Epoch.html#ae113d98c40171e4b80526cd7f7502c03" title="Kind of std::min(this, other). " alt="" coords="746,669,917,695"/>
<area shape="rect" id="node22" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="764,901,899,943"/>
<area shape="rect" id="node28" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="497,78,688,105"/>
<area shape="rect" id="node30" href="namespacefoedus_1_1soc.html#a875ded688a72b32f8f690f37750e609f" title="foedus::soc::get_now\l_microsec" alt="" coords="520,979,665,1020"/>
<area shape="rect" id="node33" href="classfoedus_1_1log_1_1LogManagerPimpl.html#ae0a0fc275f36ad22a57786bc7d17413e" title="foedus::log::LogManagerPimpl\l::wakeup_loggers" alt="" coords="494,1096,691,1137"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ac95c3e56168f87c3550f908720035d60_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aefb36bf03b0bd29c160f5aa36b219d45" title="foedus::xct::XctManagerPimpl\l::initialize_once" alt="" coords="248,5,443,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a881d783a084b1225debd5408a9248a51"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::handle_epoch_chime_wait_grace_period </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td>
          <td class="paramname"><em>grace_epoch</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Makes sure all worker threads will commit with an epoch larger than grace_epoch. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00186">186</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="stop__watch_8hpp_source.html#l00048">foedus::debugging::StopWatch::elapsed_ms()</a>, <a class="el" href="stop__watch_8hpp_source.html#l00042">foedus::debugging::StopWatch::elapsed_ns()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">get_current_global_epoch()</a>, <a class="el" href="thread__pool_8cpp_source.html#l00066">foedus::thread::ThreadPool::get_group_ref()</a>, <a class="el" href="thread__ref_8cpp_source.html#l00132">foedus::thread::ThreadGroupRef::get_min_in_commit_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00074">foedus::Engine::get_soc_count()</a>, <a class="el" href="engine_8cpp_source.html#l00052">foedus::Engine::get_thread_pool()</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00125">is_stop_requested()</a>, <a class="el" href="epoch_8hpp_source.html#l00096">foedus::Epoch::is_valid()</a>, <a class="el" href="epoch_8hpp_source.html#l00127">foedus::Epoch::one_more()</a>, <a class="el" href="assorted__func_8hpp_source.html#l00256">SPINLOCK_WHILE</a>, and <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">handle_epoch_chime()</a>.</p>
<div class="fragment"><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                                                            {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>());</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(grace_epoch.one_more() == <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>());</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  VLOG(1) &lt;&lt; <span class="stringliteral">&quot;XctManager waiting until all worker threads exit grace_epoch:&quot;</span> &lt;&lt; grace_epoch;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  debugging::StopWatch watch;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">// In most cases, all workers have already switched to the current epoch long before.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// Quickly check it, then really wait if there is suspicious one.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  thread::ThreadPool* pool = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4243a3e399186727d6bbdda5bc98f8cd">get_thread_pool</a>();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  uint16_t nodes = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">get_soc_count</a>();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">for</span> (uint16_t node = 0; node &lt; nodes; ++node) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// Check all threads&#39; in-commit epoch now.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// We might add a background thread in each SOC to avoid checking too many threads</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// in the master engine, but anyway this happens only once in tens of milliseconds.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    thread::ThreadGroupRef* group = pool-&gt;get_group_ref(node);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// @spinlock until the long-running transaction exits.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keyword">const</span> uint32_t kSpins = 1 &lt;&lt; 12;  <span class="comment">// some number of spins first, then sleep.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    uint32_t spins = 0;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <a class="code" href="group__ASSORTED.html#gae932f87b60cbd230347151ccf33eed86">SPINLOCK_WHILE</a>(!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      Epoch min_epoch = group-&gt;get_min_in_commit_epoch();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">if</span> (!min_epoch.is_valid() || min_epoch &gt; grace_epoch) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      ++spins;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (spins == 1U) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// first spin.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Interesting, node-&quot;</span> &lt;&lt; node &lt;&lt; <span class="stringliteral">&quot; has some thread that is still running &quot;</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;epoch-&quot;</span> &lt;&lt; grace_epoch &lt;&lt; <span class="stringliteral">&quot;. we have to wait before advancing epoch. min_epoch=&quot;</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          &lt;&lt; min_epoch;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spins &gt;= kSpins) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">if</span> (spins == kSpins) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;node-&quot;</span> &lt;&lt; node &lt;&lt; <span class="stringliteral">&quot; has some thread that is running &quot;</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;epoch-&quot;</span> &lt;&lt; grace_epoch &lt;&lt; <span class="stringliteral">&quot; for long time. we are still waiting before advancing&quot;</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; epoch. min_epoch=&quot;</span> &lt;&lt; min_epoch;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        std::this_thread::sleep_for(std::chrono::milliseconds(10));</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  watch.stop();</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  VLOG(1) &lt;&lt; <span class="stringliteral">&quot;grace_epoch-&quot;</span> &lt;&lt; grace_epoch &lt;&lt; <span class="stringliteral">&quot; guaranteed. took &quot;</span> &lt;&lt; watch.elapsed_ns() &lt;&lt; <span class="stringliteral">&quot;ns&quot;</span>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">if</span> (watch.elapsed_ms() &gt; 10) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Very interesting, grace_epoch-&quot;</span> &lt;&lt; grace_epoch &lt;&lt; <span class="stringliteral">&quot; took &quot;</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      &lt;&lt; watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms to be guaranteed. Most likely there was a long-running xct&quot;</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a787bb892079cb32d5a2065188825a522"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">foedus::xct::XctManagerPimpl::get_current_global_epoch</a></div><div class="ttdeci">Epoch get_current_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00107">xct_manager_pimpl.hpp:107</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a715645715c1fbc080f9fc77c99b12bac"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac">foedus::xct::XctManagerPimpl::is_stop_requested</a></div><div class="ttdeci">bool is_stop_requested() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00125">xct_manager_pimpl.cpp:125</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_af0ac9dbae9481b295a8492c6d9f6c1d5"><div class="ttname"><a href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">foedus::Engine::get_soc_count</a></div><div class="ttdeci">soc::SocId get_soc_count() const </div><div class="ttdoc">Shorthand for get_options().thread_.group_count_. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00074">engine.cpp:74</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gae932f87b60cbd230347151ccf33eed86"><div class="ttname"><a href="group__ASSORTED.html#gae932f87b60cbd230347151ccf33eed86">SPINLOCK_WHILE</a></div><div class="ttdeci">#define SPINLOCK_WHILE(x)</div><div class="ttdoc">A macro to busy-wait (spinlock) with occasional pause. </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8hpp_source.html#l00256">assorted_func.hpp:256</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a4243a3e399186727d6bbdda5bc98f8cd"><div class="ttname"><a href="classfoedus_1_1Engine.html#a4243a3e399186727d6bbdda5bc98f8cd">foedus::Engine::get_thread_pool</a></div><div class="ttdeci">thread::ThreadPool * get_thread_pool() const </div><div class="ttdoc">See Thread and Thread-Group. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00052">engine.cpp:52</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="267,5,433,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="508,581,669,623"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch" alt="" coords="253,136,447,177"/>
<area shape="rect" id="node5" href="classfoedus_1_1thread_1_1ThreadPool.html#a990314c9e1ee9ec3a04c73a683e1066c" title="foedus::thread::ThreadPool\l::get_group_ref" alt="" coords="261,71,439,112"/>
<area shape="rect" id="node7" href="classfoedus_1_1thread_1_1ThreadGroupRef.html#a5b15c98366cf1839fe6621f445853fa1" title="Returns the oldest in&#45;commit epoch of the threads in this group. " alt="" coords="248,201,452,243"/>
<area shape="rect" id="node8" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="725,217,880,243"/>
<area shape="rect" id="node11" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="283,369,417,411"/>
<area shape="rect" id="node12" href="classfoedus_1_1Engine.html#a4243a3e399186727d6bbdda5bc98f8cd" title="See Thread and Thread&#45;Group. " alt="" coords="283,435,417,476"/>
<area shape="rect" id="node13" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="525,409,652,451"/>
<area shape="rect" id="node14" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac" title="foedus::xct::XctManagerPimpl\l::is_stop_requested" alt="" coords="253,500,447,541"/>
<area shape="rect" id="node15" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="265,617,435,643"/>
<area shape="rect" id="node16" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="283,668,417,709"/>
<area shape="rect" id="node6" href="classfoedus_1_1thread_1_1ThreadPoolPimpl.html#a30a6a44047fc684ddf453d6ce6450783" title="foedus::thread::ThreadPool\lPimpl::get_group" alt="" coords="500,35,677,76"/>
<area shape="rect" id="node9" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="502,100,675,141"/>
<area shape="rect" id="node10" href="classfoedus_1_1Epoch.html#ae113d98c40171e4b80526cd7f7502c03" title="Kind of std::min(this, other). " alt="" coords="503,217,674,243"/>
<area shape="rect" id="node17" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="521,668,656,709"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a881d783a084b1225debd5408a9248a51_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60" title="Main routine for epoch_chime_thread_. " alt="" coords="248,13,443,54"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aefb36bf03b0bd29c160f5aa36b219d45" title="foedus::xct::XctManagerPimpl\l::initialize_once" alt="" coords="491,13,685,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aefb36bf03b0bd29c160f5aa36b219d45"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::xct::XctManagerPimpl::initialize_once </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classfoedus_1_1DefaultInitializable.html#ab8ae37e5f20f312f8b945fc40d3e0250">foedus::DefaultInitializable</a>.</p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00084">84</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00062">foedus::xct::XctManagerControlBlock::current_global_epoch_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00077">foedus::xct::XctManagerControlBlock::epoch_chime_terminate_requested_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00231">epoch_chime_thread_</a>, <a class="el" href="error__stack_8hpp_source.html#l00480">ERROR_STACK</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">get_current_global_epoch()</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00514">foedus::soc::SharedMemoryRepo::get_global_memory_anchors()</a>, <a class="el" href="savepoint__manager_8cpp_source.html#l00036">foedus::savepoint::SavepointManager::get_initial_current_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00053">foedus::Engine::get_savepoint_manager()</a>, <a class="el" href="soc__manager_8cpp_source.html#l00038">foedus::soc::SocManager::get_shared_memory_repo()</a>, <a class="el" href="engine_8cpp_source.html#l00059">foedus::Engine::get_soc_manager()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">handle_epoch_chime()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00044">foedus::xct::XctManagerControlBlock::initialize()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00044">foedus::storage::StorageManager::is_initialized()</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="error__code_8hpp_source.html#l00109">foedus::kErrorCodeDepedentModuleUnavailableInit</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00069">foedus::xct::XctManagerControlBlock::requested_global_epoch_</a>, <a class="el" href="epoch_8hpp_source.html#l00102">foedus::Epoch::value()</a>, and <a class="el" href="shared__memory__repo_8hpp_source.html#l00265">foedus::soc::GlobalMemoryAnchors::xct_manager_memory_</a>.</p>
<div class="fragment"><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                                            {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Initializing XctManager..&quot;</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac">is_initialized</a>()) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a154d6f9c4bf17ea4f3909286f00e2d7d">kErrorCodeDepedentModuleUnavailableInit</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  soc::SharedMemoryRepo* memory_repo = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e">get_soc_manager</a>()-&gt;<a class="code" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c">get_shared_memory_repo</a>();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a> = memory_repo-&gt;get_global_memory_anchors()-&gt;xct_manager_memory_;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>()) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a04554274a71a22a81696461d013ee9ec">initialize</a>();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">current_global_epoch_</a></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">get_savepoint_manager</a>()-&gt;<a class="code" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a82624b3d7edff1d02e29c1b8863dd4ee">get_initial_current_epoch</a>().<a class="code" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf">value</a>();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>().is_valid());</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a2739200a83eeb40719000abe38e8084e">requested_global_epoch_</a> = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">current_global_epoch_</a>.load();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a57ade5130d46393c52e5e6f5862f6dc7">epoch_chime_terminate_requested_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aba3a68b498376e14438a729f0181cfe0">epoch_chime_thread_</a> = std::move(std::thread(&amp;<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60">XctManagerPimpl::handle_epoch_chime</a>, <span class="keyword">this</span>));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa598b0ca7f0de626ecfa17f2cd58d5b4"><div class="ttname"><a href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a></div><div class="ttdeci">#define ERROR_STACK(e)        </div><div class="ttdoc">Instantiates ErrorStack with the given foedus::error_code, creating an error stack with the current f...</div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00480">error_stack.hpp:480</a></div></div>
<div class="ttc" id="classfoedus_1_1savepoint_1_1SavepointManager_html_a82624b3d7edff1d02e29c1b8863dd4ee"><div class="ttname"><a href="classfoedus_1_1savepoint_1_1SavepointManager.html#a82624b3d7edff1d02e29c1b8863dd4ee">foedus::savepoint::SavepointManager::get_initial_current_epoch</a></div><div class="ttdeci">Epoch get_initial_current_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="savepoint__manager_8cpp_source.html#l00036">savepoint_manager.cpp:36</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a2739200a83eeb40719000abe38e8084e"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a2739200a83eeb40719000abe38e8084e">foedus::xct::XctManagerControlBlock::requested_global_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; requested_global_epoch_</div><div class="ttdoc">If some thread requested to immediately advance epoch, the requested epoch. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00069">xct_manager_pimpl.hpp:69</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a154d6f9c4bf17ea4f3909286f00e2d7d"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a154d6f9c4bf17ea4f3909286f00e2d7d">foedus::kErrorCodeDepedentModuleUnavailableInit</a></div><div class="ttdoc">0x0005 : "GENERAL: A dependent module is not initialized yet. This implies a wrong initialization ord...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00109">error_code.hpp:109</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a787bb892079cb32d5a2065188825a522"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">foedus::xct::XctManagerPimpl::get_current_global_epoch</a></div><div class="ttdeci">Epoch get_current_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00107">xct_manager_pimpl.hpp:107</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a04554274a71a22a81696461d013ee9ec"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a04554274a71a22a81696461d013ee9ec">foedus::xct::XctManagerControlBlock::initialize</a></div><div class="ttdeci">void initialize()</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00044">xct_manager_pimpl.hpp:44</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_ac95c3e56168f87c3550f908720035d60"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60">foedus::xct::XctManagerPimpl::handle_epoch_chime</a></div><div class="ttdeci">void handle_epoch_chime()</div><div class="ttdoc">Main routine for epoch_chime_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00135">xct_manager_pimpl.cpp:135</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a4f168d41ea00249fefe905def87e80c8"><div class="ttname"><a href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">foedus::Engine::get_savepoint_manager</a></div><div class="ttdeci">savepoint::SavepointManager * get_savepoint_manager() const </div><div class="ttdoc">See Savepoint Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00053">engine.cpp:53</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a3a9d5aa09e337f0c997a128b805df8ac"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac">foedus::storage::StorageManager::is_initialized</a></div><div class="ttdeci">bool is_initialized() const  override</div><div class="ttdoc">Returns whether the object has been already initialized or not. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager_8cpp_source.html#l00044">storage_manager.cpp:44</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_aba3a68b498376e14438a729f0181cfe0"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aba3a68b498376e14438a729f0181cfe0">foedus::xct::XctManagerPimpl::epoch_chime_thread_</a></div><div class="ttdeci">std::thread epoch_chime_thread_</div><div class="ttdoc">This thread keeps advancing the current_global_epoch_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00231">xct_manager_pimpl.hpp:231</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_ae9ad7ab6a3df52b0e9f0e50ede6faa2e"><div class="ttname"><a href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e">foedus::Engine::get_soc_manager</a></div><div class="ttdeci">soc::SocManager * get_soc_manager() const </div><div class="ttdoc">See SOC and IPC. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00059">engine.cpp:59</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a4862a9ec0a5e5eb3c16761d26573ad08"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a4862a9ec0a5e5eb3c16761d26573ad08">foedus::xct::XctManagerControlBlock::current_global_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; current_global_epoch_</div><div class="ttdoc">The current epoch of the entire engine. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00062">xct_manager_pimpl.hpp:62</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a57ade5130d46393c52e5e6f5862f6dc7"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a57ade5130d46393c52e5e6f5862f6dc7">foedus::xct::XctManagerControlBlock::epoch_chime_terminate_requested_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; epoch_chime_terminate_requested_</div><div class="ttdoc">Protected by the mutex in epoch_chime_wakeup_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00077">xct_manager_pimpl.hpp:77</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_af13cf48db2b5bd1d273f5f7350a4d8cf"><div class="ttname"><a href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf">foedus::Epoch::value</a></div><div class="ttdeci">EpochInteger value() const </div><div class="ttdoc">Returns the raw integer representation. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00102">epoch.hpp:102</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SocManager_html_a627cf434892c441c90c2de7c20637e9c"><div class="ttname"><a href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c">foedus::soc::SocManager::get_shared_memory_repo</a></div><div class="ttdeci">SharedMemoryRepo * get_shared_memory_repo()</div><div class="ttdoc">Returns the shared memories maintained across SOCs. </div><div class="ttdef"><b>Definition:</b> <a href="soc__manager_8cpp_source.html#l00038">soc_manager.cpp:38</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_aefb36bf03b0bd29c160f5aa36b219d45_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_aefb36bf03b0bd29c160f5aa36b219d45_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_aefb36bf03b0bd29c160f5aa36b219d45_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_aefb36bf03b0bd29c160f5aa36b219d45_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch" alt="" coords="746,158,941,199"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb" title="foedus::soc::SharedMemory\lRepo::get_global_memory\l_anchors" alt="" coords="257,85,442,141"/>
<area shape="rect" id="node4" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a82624b3d7edff1d02e29c1b8863dd4ee" title="foedus::savepoint::\lSavepointManager::get\l_initial_current_epoch" alt="" coords="272,5,427,61"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8" title="See Savepoint Manager. " alt="" coords="279,455,419,497"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c" title="Returns the shared memories maintained across SOCs. " alt="" coords="259,521,439,562"/>
<area shape="rect" id="node8" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e" title="See SOC and IPC. " alt="" coords="282,586,417,627"/>
<area shape="rect" id="node9" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="282,651,417,693"/>
<area shape="rect" id="node10" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60" title="Main routine for epoch_chime_thread_. " alt="" coords="252,906,447,947"/>
<area shape="rect" id="node27" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="1019,910,1145,951"/>
<area shape="rect" id="node39" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="525,1435,667,1461"/>
<area shape="rect" id="node42" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a04554274a71a22a81696461d013ee9ec" title="foedus::xct::XctManagerControl\lBlock::initialize" alt="" coords="248,717,451,758"/>
<area shape="rect" id="node44" href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac" title="Returns whether the object has been already initialized or not. " alt="" coords="267,1095,431,1137"/>
<area shape="rect" id="node5" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#a69656b017856d4e6b2bcda9085c0d316" title="foedus::savepoint::\lSavepointManagerPimpl\l::get_initial_current_epoch" alt="" coords="509,5,683,61"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="507,807,685,849"/>
<area shape="rect" id="node13" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="529,1303,663,1345"/>
<area shape="rect" id="node14" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="529,690,663,731"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4" title="foedus::xct::XctManagerPimpl\l::get_requested_global_epoch" alt="" coords="499,938,693,979"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a881d783a084b1225debd5408a9248a51" title="Makes sure all worker threads will commit with an epoch larger than grace_epoch. " alt="" coords="499,501,693,557"/>
<area shape="rect" id="node23" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="995,137,1169,178"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a715645715c1fbc080f9fc77c99b12bac" title="foedus::xct::XctManagerPimpl\l::is_stop_requested" alt="" coords="746,822,941,863"/>
<area shape="rect" id="node29" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="758,224,929,251"/>
<area shape="rect" id="node32" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="510,1369,682,1410"/>
<area shape="rect" id="node33" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="509,1055,683,1097"/>
<area shape="rect" id="node34" href="classfoedus_1_1Epoch.html#a701de077839df51ebe44749a116ec10f" title="foedus::Epoch::one_less" alt="" coords="513,1252,679,1279"/>
<area shape="rect" id="node35" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="507,873,685,914"/>
<area shape="rect" id="node37" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="507,1186,685,1227"/>
<area shape="rect" id="node40" href="classfoedus_1_1log_1_1LogManager.html#a5c844c3bc8d71ce709999fd286a5e7b8" title="Wake up loggers if they are sleeping. " alt="" coords="514,1121,678,1162"/>
<area shape="rect" id="node12" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="757,887,930,929"/>
<area shape="rect" id="node17" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="761,705,926,746"/>
<area shape="rect" id="node18" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="1001,418,1163,459"/>
<area shape="rect" id="node19" href="classfoedus_1_1thread_1_1ThreadPool.html#a990314c9e1ee9ec3a04c73a683e1066c" title="foedus::thread::ThreadPool\l::get_group_ref" alt="" coords="755,574,932,615"/>
<area shape="rect" id="node21" href="classfoedus_1_1thread_1_1ThreadGroupRef.html#a5b15c98366cf1839fe6621f445853fa1" title="Returns the oldest in&#45;commit epoch of the threads in this group. " alt="" coords="741,275,945,317"/>
<area shape="rect" id="node22" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="1219,291,1373,317"/>
<area shape="rect" id="node25" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="776,443,911,485"/>
<area shape="rect" id="node26" href="classfoedus_1_1Engine.html#a4243a3e399186727d6bbdda5bc98f8cd" title="See Thread and Thread&#45;Group. " alt="" coords="776,639,911,681"/>
<area shape="rect" id="node30" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="776,509,911,550"/>
<area shape="rect" id="node20" href="classfoedus_1_1thread_1_1ThreadPoolPimpl.html#a30a6a44047fc684ddf453d6ce6450783" title="foedus::thread::ThreadPool\lPimpl::get_group" alt="" coords="993,574,1171,615"/>
<area shape="rect" id="node24" href="classfoedus_1_1Epoch.html#ae113d98c40171e4b80526cd7f7502c03" title="Kind of std::min(this, other). " alt="" coords="997,240,1167,267"/>
<area shape="rect" id="node31" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="1015,509,1149,550"/>
<area shape="rect" id="node36" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="748,953,939,980"/>
<area shape="rect" id="node38" href="namespacefoedus_1_1soc.html#a875ded688a72b32f8f690f37750e609f" title="foedus::soc::get_now\l_microsec" alt="" coords="771,1186,916,1227"/>
<area shape="rect" id="node41" href="classfoedus_1_1log_1_1LogManagerPimpl.html#ae0a0fc275f36ad22a57786bc7d17413e" title="foedus::log::LogManagerPimpl\l::wakeup_loggers" alt="" coords="745,1121,942,1162"/>
<area shape="rect" id="node43" href="classfoedus_1_1soc_1_1SharedPolling.html#ace449e19d0a13388da16570aefd42994" title="foedus::soc::SharedPolling\l::initialize" alt="" coords="507,625,685,666"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a715645715c1fbc080f9fc77c99b12bac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::is_stop_requested </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00125">125</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00077">foedus::xct::XctManagerControlBlock::epoch_chime_terminate_requested_</a>, and <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">handle_epoch_chime()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00186">handle_epoch_chime_wait_grace_period()</a>.</p>
<div class="fragment"><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                              {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>());</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a57ade5130d46393c52e5e6f5862f6dc7">epoch_chime_terminate_requested_</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a57ade5130d46393c52e5e6f5862f6dc7"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a57ade5130d46393c52e5e6f5862f6dc7">foedus::xct::XctManagerControlBlock::epoch_chime_terminate_requested_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; epoch_chime_terminate_requested_</div><div class="ttdoc">Protected by the mutex in epoch_chime_wakeup_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00077">xct_manager_pimpl.hpp:77</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="248,5,375,47"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a715645715c1fbc080f9fc77c99b12bac_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ac95c3e56168f87c3550f908720035d60" title="Main routine for epoch_chime_thread_. " alt="" coords="491,5,685,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a881d783a084b1225debd5408a9248a51" title="Makes sure all worker threads will commit with an epoch larger than grace_epoch. " alt="" coords="248,30,443,86"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aefb36bf03b0bd29c160f5aa36b219d45" title="foedus::xct::XctManagerPimpl\l::initialize_once" alt="" coords="733,5,928,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a19be4bae2114e48eb5c041c29e991983"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::pause_accepting_xct </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pause all begin_xct until you call <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9affae9e06ad2324c5857d0dd686995c" title="Make sure you call this after pause_accepting_xct(). ">resume_accepting_xct()</a> </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00327">327</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, and <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00090">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager_8cpp_source.html#l00033">foedus::xct::XctManager::pause_accepting_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                          {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">new_transaction_paused_</a>.store(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aba6cb55bfe4729a5cdc4e25237def2fa"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; new_transaction_paused_</div><div class="ttdoc">If true, all new requests to begin_xct() will be paused until this becomes false. ...</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00090">xct_manager_pimpl.hpp:90</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a19be4bae2114e48eb5c041c29e991983_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a19be4bae2114e48eb5c041c29e991983_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a19be4bae2114e48eb5c041c29e991983_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a19be4bae2114e48eb5c041c29e991983_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#a494c96802826b99e62384b72c2252c84" title="Pause all begin_xct until you call resume_accepting_xct() " alt="" coords="248,39,411,80"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="459,39,685,80"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="733,31,944,87"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="992,5,1203,47"/>
<area shape="rect" id="node7" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="1020,71,1175,112"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1251,5,1445,47"/>
<area shape="rect" id="node8" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1251,71,1445,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a014506b605e14b3df1b1b7522e8a23b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::precommit_xct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *&#160;</td>
          <td class="paramname"><em>commit_epoch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the gut of commit protocol. </p>
<p>It's mostly same as [TU2013]. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00343">343</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00954">abort_xct()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct_8hpp_source.html#l00538">foedus::xct::Xct::assert_related_read_write()</a>, <a class="el" href="retrospective__lock__list_8cpp_source.html#l00059">foedus::xct::RetrospectiveLockList::clear_entries()</a>, <a class="el" href="xct_8hpp_source.html#l00108">foedus::xct::Xct::deactivate()</a>, <a class="el" href="xct_8hpp_source.html#l00413">foedus::xct::Xct::get_current_lock_list()</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct_8hpp_source.html#l00415">foedus::xct::Xct::get_retrospective_lock_list()</a>, <a class="el" href="xct_8hpp_source.html#l00121">foedus::xct::Xct::is_active()</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00365">foedus::xct::CurrentLockList::is_empty()</a>, <a class="el" href="xct_8hpp_source.html#l00145">foedus::xct::Xct::is_read_only()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00199">foedus::kErrorCodeXctNoXct</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00371">precommit_xct_readonly()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00384">precommit_xct_readwrite()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00997">release_and_clear_all_current_locks()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00079">foedus::xct::XctManager::precommit_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                                                                   {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (!current_xct.is_active()) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a72dcb6f3cd90cdeb9cbc8fbcecd0da3b">kErrorCodeXctNoXct</a>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.assert_related_read_write());</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> result;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordtype">bool</span> read_only = context-&gt;get_current_xct().is_read_only();</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (read_only) {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    result = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855">precommit_xct_readonly</a>(context, commit_epoch);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    result = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755">precommit_xct_readwrite</a>(context, commit_epoch);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.assert_related_read_write());</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> abort_ret = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a71f565f69929d90febd7beb6b1dca696">abort_xct</a>(context);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(abort_ret == <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Aborting because of contention&quot;</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    current_xct.get_retrospective_lock_list()-&gt;clear_entries();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a3c2ee2d08709ff62e77e0dff6eded376">release_and_clear_all_current_locks</a>(context);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    current_xct.deactivate();</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.get_current_lock_list()-&gt;is_empty());</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a3c2ee2d08709ff62e77e0dff6eded376"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a3c2ee2d08709ff62e77e0dff6eded376">foedus::xct::XctManagerPimpl::release_and_clear_all_current_locks</a></div><div class="ttdeci">void release_and_clear_all_current_locks(thread::Thread *context)</div><div class="ttdoc">unlocking all acquired locks, used when commit/abort. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00997">xct_manager_pimpl.cpp:997</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a777caaecec0e7bb19b1cd2841771f755"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755">foedus::xct::XctManagerPimpl::precommit_xct_readwrite</a></div><div class="ttdeci">ErrorCode precommit_xct_readwrite(thread::Thread *context, Epoch *commit_epoch)</div><div class="ttdoc">precommit_xct() if the transaction is read-write </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00384">xct_manager_pimpl.cpp:384</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a71f565f69929d90febd7beb6b1dca696"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a71f565f69929d90febd7beb6b1dca696">foedus::xct::XctManagerPimpl::abort_xct</a></div><div class="ttdeci">ErrorCode abort_xct(thread::Thread *context)</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00954">xct_manager_pimpl.cpp:954</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a72dcb6f3cd90cdeb9cbc8fbcecd0da3b"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a72dcb6f3cd90cdeb9cbc8fbcecd0da3b">foedus::kErrorCodeXctNoXct</a></div><div class="ttdoc">0x0A04 : "XCTION : This thread is not running any transaction." . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00199">error_code.hpp:199</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_add42c2f0d559eafa1f67fd9c048a4855"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855">foedus::xct::XctManagerPimpl::precommit_xct_readonly</a></div><div class="ttdeci">ErrorCode precommit_xct_readonly(thread::Thread *context, Epoch *commit_epoch)</div><div class="ttdoc">precommit_xct() if the transaction is read-only </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00371">xct_manager_pimpl.cpp:371</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaae5f98d1b4caace7febc49e59ae5ac56"><div class="ttname"><a href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">foedus::ErrorCode</a></div><div class="ttdeci">ErrorCode</div><div class="ttdoc">Enum of error codes defined in error_code.xmacro. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00085">error_code.hpp:85</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a71f565f69929d90febd7beb6b1dca696" title="foedus::xct::XctManagerPimpl\l::abort_xct" alt="" coords="248,543,443,584"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#acdd6c3ee6c1e8b0da192818e70fec846" title="foedus::xct::Retrospective\lLockList::clear_entries" alt="" coords="525,93,697,135"/>
<area shape="rect" id="node6" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="803,1285,953,1327"/>
<area shape="rect" id="node12" href="classfoedus_1_1xct_1_1Xct.html#a9a76be25f22fd49683d2a4138ab7b199" title="Returns whether the object is an active transaction. " alt="" coords="813,111,943,152"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1Xct.html#abbc9a5e976aadfba9f1fbf9e9fb39a9a" title="Closes the transaction. " alt="" coords="521,159,700,186"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1CurrentLockList.html#a761b506c86d1d8e5681cab34fac1ad29" title="foedus::xct::CurrentLock\lList::is_empty" alt="" coords="796,5,960,47"/>
<area shape="rect" id="node19" href="classfoedus_1_1xct_1_1Xct.html#a8b718008691c004c92d863b8b75dbe07" title="foedus::xct::Xct::get\l_retrospective_lock_list" alt="" coords="532,743,689,784"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a3c2ee2d08709ff62e77e0dff6eded376" title="unlocking all acquired locks, used when commit/abort. " alt="" coords="491,808,731,849"/>
<area shape="rect" id="node29" href="classfoedus_1_1xct_1_1Xct.html#afc0b909c82e905105f4f9701082a16b8" title="foedus::xct::Xct::get\l_current_lock_list" alt="" coords="809,939,947,980"/>
<area shape="rect" id="node31" href="classfoedus_1_1xct_1_1Xct.html#a148038efa6f37e2b89f057c5d5cd4cb3" title="This debug method checks whether the related_read_ and related_write_ fileds in read/write sets are c..." alt="" coords="800,1965,956,2007"/>
<area shape="rect" id="node32" href="classfoedus_1_1xct_1_1Xct.html#ab8523ae5dcf4ee3d4554e291ab355230" title="Returns if this transaction makes no writes. " alt="" coords="280,1435,411,1476"/>
<area shape="rect" id="node33" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855" title="precommit_xct() if the transaction is read&#45;only " alt="" coords="248,1024,443,1065"/>
<area shape="rect" id="node40" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="248,1661,443,1703"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a38d217000e4df1d2d8e829c37218f93e" title="Fill out this retrospetive lock list for the next run of the given transaction. " alt="" coords="525,392,697,433"/>
<area shape="rect" id="node8" href="classfoedus_1_1xct_1_1Xct.html#ae523b00cead387e6addb1366fe08546a" title="foedus::xct::Xct::get\l_read_set" alt="" coords="809,632,947,673"/>
<area shape="rect" id="node9" href="classfoedus_1_1xct_1_1Xct.html#af7b9c43800807db798d2e58bc07ad5cd" title="foedus::xct::Xct::get\l_read_set_size" alt="" coords="809,873,947,915"/>
<area shape="rect" id="node18" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9fecc418442394a926c49930cb95cc47" title="Called when the current transaction aborts. " alt="" coords="517,1121,704,1163"/>
<area shape="rect" id="node20" href="classfoedus_1_1xct_1_1Xct.html#a8a5728b0376ffa45b801a560051d7d7a" title="foedus::xct::Xct::get\l_rll_threshold_for_this_xct" alt="" coords="524,509,697,551"/>
<area shape="rect" id="node21" href="classfoedus_1_1thread_1_1Thread.html#af98ed86adde3f5e39c9cab39440f38da" title="foedus::thread::Thread\l::get_thread_id" alt="" coords="535,575,686,616"/>
<area shape="rect" id="node22" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee" title="Returns the private log buffer for this thread. " alt="" coords="534,925,687,967"/>
<area shape="rect" id="node23" href="structfoedus_1_1xct_1_1RwLockableXctId.html#aba859c4eb829f83fa767720d5b745646" title="foedus::xct::RwLockableXct\lId::hotter" alt="" coords="519,261,702,303"/>
<area shape="rect" id="node26" href="classfoedus_1_1xct_1_1Xct.html#aae4b0ccd575851276efddf752c90a273" title="foedus::xct::Xct::is\l_enable_rll_for_this_xct" alt="" coords="531,327,690,368"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1RetrospectiveLockList.html#a1397c6847c1ee46ba9c09457b4f5866e" title="foedus::xct::Retrospective\lLockList::assert_sorted" alt="" coords="792,424,964,465"/>
<area shape="rect" id="node7" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="803,307,953,348"/>
<area shape="rect" id="node10" href="classfoedus_1_1xct_1_1Xct.html#ae5fa3dcdb891b99e5bc7d83ff2029f46" title="foedus::xct::Xct::get\l_write_set" alt="" coords="809,1880,947,1921"/>
<area shape="rect" id="node11" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="809,1815,947,1856"/>
<area shape="rect" id="node13" href="structfoedus_1_1xct_1_1LockEntry.html#a54190c5faf4f6943043c1d83ed435f44" title="foedus::xct::LockEntry::set" alt="" coords="789,490,967,517"/>
<area shape="rect" id="node14" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="795,373,961,399"/>
<area shape="rect" id="node15" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="805,541,951,583"/>
<area shape="rect" id="node24" href="classfoedus_1_1thread_1_1Thread.html#a83bb972b117e155dc7f0faa56751571b" title="foedus::thread::Thread\l::get_lock_rnd" alt="" coords="803,176,953,217"/>
<area shape="rect" id="node25" href="structfoedus_1_1assorted_1_1ProbCounter.html#a168e04a3f3aa5c426c6f7980b9f358a7" title="foedus::assorted::ProbCounter\l::increment" alt="" coords="779,241,977,283"/>
<area shape="rect" id="node28" href="classfoedus_1_1thread_1_1Thread.html#a21bff0861e0c12573bc0a6b776857b76" title="foedus::thread::Thread\l::cll_release_all_locks" alt="" coords="803,743,953,784"/>
<area shape="rect" id="node30" href="classfoedus_1_1xct_1_1CurrentLockList.html#abb020fdb3951460f9c283d4700696ad2" title="foedus::xct::CurrentLock\lList::clear_entries" alt="" coords="796,808,960,849"/>
<area shape="rect" id="node34" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#ad75e847585775d7c506815269a176941" title="This marks the position upto which transaction logs are committed by the thread. " alt="" coords="517,1056,704,1097"/>
<area shape="rect" id="node35" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a3077294533a21c3aa0a115cfd4c90224" title="The current cursor to which next log will be written. " alt="" coords="517,1187,704,1228"/>
<area shape="rect" id="node36" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="524,1252,697,1293"/>
<area shape="rect" id="node37" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b" title="Phase 2 of precommit_xct() for read&#45;only case. " alt="" coords="507,991,715,1032"/>
<area shape="rect" id="node38" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="811,1351,945,1392"/>
<area shape="rect" id="node39" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="792,1128,964,1169"/>
<area shape="rect" id="node41" href="structfoedus_1_1xct_1_1XctId.html#ad18a2d4a528fa063786b6efaf1035377" title="foedus::xct::XctId::set" alt="" coords="537,2047,685,2074"/>
<area shape="rect" id="node42" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896" title="Phase 1 of precommit_xct() " alt="" coords="513,1815,708,1856"/>
<area shape="rect" id="node43" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="811,1720,945,1761"/>
<area shape="rect" id="node44" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#acd49fd67f3459df687ed08d5d8b54082" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch_weak" alt="" coords="503,1485,718,1527"/>
<area shape="rect" id="node45" href="classfoedus_1_1thread_1_1Thread.html#a6f19e6df65000416391b796d9b2f9d66" title="Currently we don&#39;t have sysxct_release_locks() etc. " alt="" coords="532,1551,689,1607"/>
<area shape="rect" id="node46" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="524,1632,697,1673"/>
<area shape="rect" id="node47" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b" title="Phase 2 of precommit_xct() for read&#45;write case. " alt="" coords="505,1317,716,1359"/>
<area shape="rect" id="node48" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="513,1880,708,1921"/>
<area shape="rect" id="node49" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="791,2071,965,2112"/>
<area shape="rect" id="node50" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a58d7c07a52d42d459002bc590421de8a" title="Called when the current transaction is successfully committed. " alt="" coords="517,1749,704,1791"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a014506b605e14b3df1b1b7522e8a23b2_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="248,5,411,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad2f4a34f39a90516756c34aae5916e3a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_acquire_writer_lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1WriteXctAccess.html">WriteXctAccess</a> *&#160;</td>
          <td class="paramname"><em>write</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ad91daff37c2b78b8c6620d67869e9d7f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::precommit_xct_apply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1XctId.html">XctId</a>&#160;</td>
          <td class="paramname"><em>max_xct_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *&#160;</td>
          <td class="paramname"><em>commit_epoch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Phase 3 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>thread context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_xct_id</td><td>largest xct_id this transaction depends on, or max(all xct_id). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">commit_epoch</td><td>commit epoch of this transaction. it's finalized in this function.</td></tr>
  </table>
  </dd>
</dl>
<p>Assuming phase 1 and 2 are successfully completed, apply all changes. This method does NOT release locks yet. This is one difference from SILO. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00868">868</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__id_8hpp_source.html#l01074">foedus::xct::XctId::before()</a>, <a class="el" href="xct__id_8hpp_source.html#l01083">foedus::xct::XctId::clear_status_bits()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct__id_8hpp_source.html#l00964">foedus::xct::XctId::get_epoch()</a>, <a class="el" href="xct_8hpp_source.html#l00151">foedus::xct::Xct::get_id()</a>, <a class="el" href="xct_8hpp_source.html#l00165">foedus::xct::Xct::get_lock_free_write_set()</a>, <a class="el" href="xct_8hpp_source.html#l00159">foedus::xct::Xct::get_lock_free_write_set_size()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00060">foedus::storage::StorageManager::get_name()</a>, <a class="el" href="xct__id_8hpp_source.html#l00976">foedus::xct::XctId::get_ordinal()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="common__log__types_8hpp_source.html#l00078">foedus::log::LogHeader::get_type()</a>, <a class="el" href="xct_8hpp_source.html#l00163">foedus::xct::Xct::get_write_set()</a>, <a class="el" href="xct_8hpp_source.html#l00157">foedus::xct::Xct::get_write_set_size()</a>, <a class="el" href="common__log__types_8hpp_source.html#l00113">foedus::log::BaseLogType::header_</a>, <a class="el" href="log__type__invoke_8hpp_source.html#l00089">foedus::log::invoke_apply_record()</a>, <a class="el" href="xct__id_8hpp_source.html#l01038">foedus::xct::XctId::is_being_written()</a>, <a class="el" href="xct__id_8hpp_source.html#l01040">foedus::xct::XctId::is_deleted()</a>, <a class="el" href="xct__id_8hpp_source.html#l01140">foedus::xct::RwLockableXctId::is_keylocked()</a>, <a class="el" href="epoch_8hpp_source.html#l00096">foedus::Epoch::is_valid()</a>, <a class="el" href="xct_8cpp_source.html#l00134">foedus::xct::Xct::issue_next_id()</a>, <a class="el" href="log__type_8hpp_source.html#l00123">foedus::log::kLogCodeHashDelete</a>, <a class="el" href="log__type_8hpp_source.html#l00128">foedus::log::kLogCodeMasstreeDelete</a>, <a class="el" href="xct__access_8hpp_source.html#l00175">foedus::xct::WriteXctAccess::log_entry_</a>, <a class="el" href="xct__access_8hpp_source.html#l00235">foedus::xct::LockFreeWriteXctAccess::log_entry_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00172">foedus::xct::WriteXctAccess::payload_address_</a>, <a class="el" href="xct__id_8hpp_source.html#l01019">foedus::xct::XctId::set_being_written()</a>, <a class="el" href="xct__id_8hpp_source.html#l01027">foedus::xct::XctId::set_deleted()</a>, <a class="el" href="common__log__types_8hpp_source.html#l00086">foedus::log::LogHeader::set_xct_id()</a>, <a class="el" href="xct__access_8hpp_source.html#l00085">foedus::xct::RecordXctAccess::storage_id_</a>, <a class="el" href="xct__access_8hpp_source.html#l00232">foedus::xct::LockFreeWriteXctAccess::storage_id_</a>, and <a class="el" href="xct__id_8hpp_source.html#l01137">foedus::xct::RwLockableXctId::xct_id_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00384">precommit_xct_readwrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                       {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  WriteXctAccess* write_set = current_xct.get_write_set();</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  uint32_t        write_set_size = current_xct.get_write_set_size();</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  LockFreeWriteXctAccess* lock_free_write_set = current_xct.get_lock_free_write_set();</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  uint32_t                lock_free_write_set_size = current_xct.get_lock_free_write_set_size();</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; applying.. write_set_size=&quot;</span> &lt;&lt; write_set_size</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, lock_free_write_set_size=&quot;</span> &lt;&lt; lock_free_write_set_size;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  current_xct.issue_next_id(max_xct_id, commit_epoch);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  XctId new_xct_id = current_xct.get_id();</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_xct_id.get_epoch() == *commit_epoch);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_xct_id.get_ordinal() &gt; 0);</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  new_xct_id.clear_status_bits();</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  XctId new_deleted_xct_id = new_xct_id;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  new_deleted_xct_id.set_deleted();  <span class="comment">// used if the record after apply is in deleted state.</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; generated new xct id=&quot;</span> &lt;&lt; new_xct_id;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; write_set_size; ++i) {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    WriteXctAccess&amp; write = write_set[i];</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    DVLOG(2) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Applying &quot;</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      &lt;&lt; <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736">get_name</a>(write.storage_id_)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; write.owner_id_address_;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write.owner_id_address_-&gt;is_keylocked());</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="comment">// We must be careful on the memory order of unlock and data write.</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">// We must write data first (invoke_apply), then unlock.</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">// Otherwise the correctness is not guaranteed.</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write.log_entry_);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    write.log_entry_-&gt;header_.set_xct_id(new_xct_id);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_xct_id.get_epoch().is_valid());</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp; write.owner_id_address_ == write_set[i - 1].owner_id_address_) {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="comment">// the previous one has already set being_written and kept the lock</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write.owner_id_address_-&gt;xct_id_.is_being_written());</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!write.owner_id_address_-&gt;xct_id_.is_being_written());</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      write.owner_id_address_-&gt;xct_id_.set_being_written();</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <a class="code" href="group__LOGTYPE.html#gac46f45db4f1520d51bebbca06d12c623">log::invoke_apply_record</a>(</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      write.log_entry_,</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      context,</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      write.storage_id_,</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      write.owner_id_address_,</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      write.payload_address_);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!write.owner_id_address_-&gt;xct_id_.get_epoch().is_valid() ||</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      write.owner_id_address_-&gt;xct_id_.before(new_xct_id));  <span class="comment">// ordered correctly?</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordflow">if</span> (i &lt; write_set_size - 1 &amp;&amp;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      write.owner_id_address_ == write_set[i + 1].owner_id_address_) {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      DVLOG(0) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Multiple write sets on record &quot;</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        &lt;&lt; <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736">get_name</a>(write_set[i].storage_id_)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; write_set[i].owner_id_address_ &lt;&lt; <span class="stringliteral">&quot;. Unlock at the last one of the write sets&quot;</span>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="comment">// keep the lock for the next write set</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="comment">// For this reason, we put memory_fence_release() between data and owner_id writes.</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">if</span> (write.owner_id_address_-&gt;xct_id_.is_deleted()) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="comment">// preserve delete-flag set by delete operations (so, the operation should be delete)</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;          write.log_entry_-&gt;header_.get_type() == <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3a54814d96f40284d750d6bc54d94cfc3e">log::kLogCodeHashDelete</a> ||</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;          write.log_entry_-&gt;header_.get_type() == <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3abb140a328897a4bf18aea0170adbb235">log::kLogCodeMasstreeDelete</a>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        write.owner_id_address_-&gt;xct_id_ = new_deleted_xct_id;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;          write.log_entry_-&gt;header_.get_type() != <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3a54814d96f40284d750d6bc54d94cfc3e">log::kLogCodeHashDelete</a> &amp;&amp;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;          write.log_entry_-&gt;header_.get_type() != <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3abb140a328897a4bf18aea0170adbb235">log::kLogCodeMasstreeDelete</a>);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        write.owner_id_address_-&gt;xct_id_ = new_xct_id;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <span class="comment">// This method does NOT unlock. we do it at the end, all locks together.</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="comment">// This is another difference from SILO.</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="comment">// lock-free write-set doesn&#39;t have to worry about lock or ordering.</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; lock_free_write_set_size; ++i) {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    LockFreeWriteXctAccess&amp; write = lock_free_write_set[i];</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    DVLOG(2) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Applying Lock-Free write &quot;</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      &lt;&lt; <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736">get_name</a>(write.storage_id_);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    write.log_entry_-&gt;header_.set_xct_id(new_xct_id);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <a class="code" href="group__LOGTYPE.html#gac46f45db4f1520d51bebbca06d12c623">log::invoke_apply_record</a>(write.log_entry_, context, write.storage_id_, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; applied and unlocked write set&quot;</span>;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="namespacefoedus_1_1log_html_gafeea30298c4f7a9586bddec3663fc4f3a54814d96f40284d750d6bc54d94cfc3e"><div class="ttname"><a href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3a54814d96f40284d750d6bc54d94cfc3e">foedus::log::kLogCodeHashDelete</a></div><div class="ttdoc">0x002A : foedus::storage::hash::HashDeleteLogType . </div><div class="ttdef"><b>Definition:</b> <a href="log__type_8hpp_source.html#l00123">log_type.hpp:123</a></div></div>
<div class="ttc" id="namespacefoedus_1_1log_html_gafeea30298c4f7a9586bddec3663fc4f3abb140a328897a4bf18aea0170adbb235"><div class="ttname"><a href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3abb140a328897a4bf18aea0170adbb235">foedus::log::kLogCodeMasstreeDelete</a></div><div class="ttdoc">0x0034 : foedus::storage::masstree::MasstreeDeleteLogType . </div><div class="ttdef"><b>Definition:</b> <a href="log__type_8hpp_source.html#l00128">log_type.hpp:128</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_ab3700d71eb463d5b9fae21a2704ea736"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736">foedus::storage::StorageManager::get_name</a></div><div class="ttdeci">const StorageName &amp; get_name(StorageId id)</div><div class="ttdoc">Returns the name of the given storage ID. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager_8cpp_source.html#l00060">storage_manager.cpp:60</a></div></div>
<div class="ttc" id="group__LOGTYPE_html_gac46f45db4f1520d51bebbca06d12c623"><div class="ttname"><a href="group__LOGTYPE.html#gac46f45db4f1520d51bebbca06d12c623">foedus::log::invoke_apply_record</a></div><div class="ttdeci">void invoke_apply_record(void *log_buffer, thread::Thread *context, storage::StorageId storage_id, xct::RwLockableXctId *owner_id_address, char *payload_address)</div><div class="ttdoc">Invokes the apply logic for a record-wise log type. </div><div class="ttdef"><b>Definition:</b> <a href="log__type__invoke_8hpp_source.html#l00089">log_type_invoke.hpp:89</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1xct_1_1XctId.html#ac151128ff0040de166018da6133f8d85" title="Returns if this XctId is before other in serialization order, meaning this is either an invalid (unus..." alt="" coords="787,194,910,235"/>
<area shape="rect" id="node4" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="1263,922,1417,949"/>
<area shape="rect" id="node5" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="1043,86,1166,127"/>
<area shape="rect" id="node7" href="structfoedus_1_1xct_1_1XctId.html#a936888dbc82de6e76194b72c28c9a10f" title="foedus::xct::XctId\l::get_ordinal" alt="" coords="1043,478,1166,519"/>
<area shape="rect" id="node8" href="structfoedus_1_1xct_1_1XctId.html#a228fb7d60491cf151d36c5576be91a3f" title="foedus::xct::XctId\l::clear_status_bits" alt="" coords="275,843,404,884"/>
<area shape="rect" id="node9" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="264,908,415,950"/>
<area shape="rect" id="node10" href="classfoedus_1_1xct_1_1Xct.html#a07b332c0f7f0896ad37dc93373af1cb2" title="Returns the ID of this transaction, but note that it is not issued until commit time! ..." alt="" coords="262,974,417,1001"/>
<area shape="rect" id="node11" href="classfoedus_1_1xct_1_1Xct.html#a8c4f8c691a326c1f632128d13dea2fa2" title="foedus::xct::Xct::get\l_lock_free_write_set" alt="" coords="269,1026,409,1067"/>
<area shape="rect" id="node12" href="classfoedus_1_1xct_1_1Xct.html#a4dfc3cd9b70a93615c3a0a8014aafbe1" title="foedus::xct::Xct::get\l_lock_free_write_set_size" alt="" coords="254,1091,425,1132"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736" title="Returns the name of the given storage ID. " alt="" coords="257,1156,421,1198"/>
<area shape="rect" id="node17" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="272,1222,407,1263"/>
<area shape="rect" id="node18" href="structfoedus_1_1log_1_1LogHeader.html#a6ebe3b99442f2a58a4adeeb60f9a37e0" title="Convenience method to cast into LogCode. " alt="" coords="771,1316,926,1358"/>
<area shape="rect" id="node19" href="classfoedus_1_1xct_1_1Xct.html#ae5fa3dcdb891b99e5bc7d83ff2029f46" title="foedus::xct::Xct::get\l_write_set" alt="" coords="270,1455,409,1496"/>
<area shape="rect" id="node20" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="270,1520,409,1562"/>
<area shape="rect" id="node21" href="group__LOGTYPE.html#gac46f45db4f1520d51bebbca06d12c623" title="Invokes the apply logic for a record&#45;wise log type. " alt="" coords="275,1287,404,1328"/>
<area shape="rect" id="node23" href="structfoedus_1_1xct_1_1XctId.html#ad5be23a25e650f1bad81ce8c87630af0" title="foedus::xct::XctId\l::is_being_written" alt="" coords="278,1586,401,1627"/>
<area shape="rect" id="node24" href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148" title="foedus::xct::XctId\l::is_deleted" alt="" coords="278,1651,401,1692"/>
<area shape="rect" id="node25" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a610d8c1bfd1d86dcde181c3fb0020f0c" title="foedus::xct::RwLockableXct\lId::is_keylocked" alt="" coords="248,1716,431,1758"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="264,415,415,456"/>
<area shape="rect" id="node47" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="253,1782,426,1823"/>
<area shape="rect" id="node48" href="structfoedus_1_1xct_1_1XctId.html#a6f9fc5f612e4aebaa25b78de4e328eaf" title="foedus::xct::XctId\l::set_being_written" alt="" coords="274,1847,405,1888"/>
<area shape="rect" id="node49" href="structfoedus_1_1xct_1_1XctId.html#a4fe6746e50f7bd8ca61c9d141eafc8a2" title="foedus::xct::XctId\l::set_deleted" alt="" coords="278,1912,401,1954"/>
<area shape="rect" id="node50" href="structfoedus_1_1log_1_1LogHeader.html#a27ad88f5e7d7730af696e001ca1425ff" title="Because of the special case of FillerLogType, we must use this method to set xct_id. " alt="" coords="509,1404,663,1446"/>
<area shape="rect" id="node3" href="classfoedus_1_1Epoch.html#aaef554452ea9ac7b072af98cde1558dc" title="Returns if this epoch is before the given epoch in the sense of distance defined in RFC 1982..." alt="" coords="1031,426,1179,453"/>
<area shape="rect" id="node6" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="1279,194,1401,235"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1StorageControlBlock.html#af1f0b118bed183f7daf070409112ca93" title="foedus::storage::Storage\lControlBlock::exists" alt="" coords="504,1163,668,1204"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523" title="Returns the storage of given ID. " alt="" coords="504,1098,668,1139"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#aea8861d6bf6c13c0df6d0c9777cdaa99" title="foedus::storage::Storage\lManagerPimpl::get_storage" alt="" coords="758,1098,939,1139"/>
<area shape="rect" id="node22" href="group__LOGTYPE.html#gad2d33090f44d00949a05c245e5ff1046" title="Invokes the assertion logic of each log type. " alt="" coords="521,1287,651,1328"/>
<area shape="rect" id="node26" href="structfoedus_1_1xct_1_1McsRwLock.html#adc5e6612e3cecf3d2f15d02237b4ef8f" title="foedus::xct::McsRwLock\l::is_locked" alt="" coords="503,1716,669,1758"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1XctManager.html#aa75089821b48c98a00cd7e4ddc0615da" title="Requests to advance the current global epoch as soon as possible and blocks until it actually does..." alt="" coords="483,759,689,800"/>
<area shape="rect" id="node37" href="classfoedus_1_1xct_1_1XctManager.html#a419a270d62522ede9bd871dd4adc0e2a" title="Returns the current global epoch, the epoch a newly started transaction will be in. " alt="" coords="759,642,938,683"/>
<area shape="rect" id="node38" href="classfoedus_1_1xct_1_1XctManager.html#a4578dd6dab7925b95d7810335ae5cec0" title="foedus::xct::XctManager\l::get_current_global_epoch_weak" alt="" coords="479,474,693,515"/>
<area shape="rect" id="node40" href="classfoedus_1_1Engine.html#a48d5e1f7ce2f70161c253f650c75ed95" title="See Transaction Manager. " alt="" coords="519,356,653,398"/>
<area shape="rect" id="node41" href="structfoedus_1_1xct_1_1XctId.html#a449da7fea452dd81c194f94b28e7a7e2" title="foedus::xct::XctId\l::is_valid" alt="" coords="787,318,910,359"/>
<area shape="rect" id="node42" href="classfoedus_1_1xct_1_1Xct.html#a054cf2fca2ce0e5047c817ed10ae1a80" title="foedus::xct::Xct::remember\l_previous_xct_id" alt="" coords="497,226,675,267"/>
<area shape="rect" id="node43" href="structfoedus_1_1xct_1_1XctId.html#af25a0de9ca35e854b50d5f5621fb23dc" title="foedus::xct::XctId\l::set_epoch" alt="" coords="525,95,647,136"/>
<area shape="rect" id="node45" href="structfoedus_1_1xct_1_1XctId.html#a27c23f58d7a94bed0dde10dd57a9dcce" title="foedus::xct::XctId\l::set_ordinal" alt="" coords="525,291,647,332"/>
<area shape="rect" id="node46" href="structfoedus_1_1xct_1_1XctId.html#a2878cd14b103f72c8bce5a330e03e2b2" title="Kind of std::max(this, other). " alt="" coords="525,160,647,202"/>
<area shape="rect" id="node29" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a925da0bb4b846daa21eb947e4f67b0c6" title="foedus::xct::XctManagerPimpl\l::advance_current_global_epoch" alt="" coords="745,759,952,800"/>
<area shape="rect" id="node30" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="1016,856,1193,898"/>
<area shape="rect" id="node32" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch" alt="" coords="1007,543,1202,584"/>
<area shape="rect" id="node33" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="1019,609,1190,636"/>
<area shape="rect" id="node34" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad" title="foedus::xct::XctManagerPimpl\l::set_requested_global_epoch" alt="" coords="1007,660,1202,702"/>
<area shape="rect" id="node35" href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3" title="Unconditionally wait for signal. " alt="" coords="1016,726,1193,767"/>
<area shape="rect" id="node36" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7" title="foedus::xct::XctManagerPimpl\l::wakeup_epoch_chime_thread" alt="" coords="1004,791,1205,832"/>
<area shape="rect" id="node31" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="1253,856,1427,898"/>
<area shape="rect" id="node39" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#acd49fd67f3459df687ed08d5d8b54082" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch_weak" alt="" coords="741,474,956,515"/>
<area shape="rect" id="node44" href="structfoedus_1_1xct_1_1XctId.html#afd81e3e00ee902aa673a9d3fe62be17b" title="foedus::xct::XctId\l::set_epoch_int" alt="" coords="787,95,910,136"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ad91daff37c2b78b8c6620d67869e9d7f_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="248,5,443,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="491,5,685,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="733,5,896,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2376431f079ce60800c9c25d89d74896"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::precommit_xct_lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1XctId.html">XctId</a> *&#160;</td>
          <td class="paramname"><em>max_xct_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Phase 1 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>thread context </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">max_xct_id</td><td>largest xct_id this transaction depends on, or max(locked xct_id). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if successful. false if we need to abort the transaction, in which case locks are not obtained yet (so no need for unlock).</dd></dl>
<p>Try to lock all records we are going to write. After phase 2, we take memory fence. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00539">539</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct_8hpp_source.html#l00538">foedus::xct::Xct::assert_related_read_write()</a>, <a class="el" href="retrospective__lock__list_8cpp_source.html#l00329">foedus::xct::CurrentLockList::batch_insert_write_placeholders()</a>, <a class="el" href="error__code_8hpp_source.html#l00155">CHECK_ERROR_CODE</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00844">foedus::thread::Thread::cll_release_all_locks_after()</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00850">foedus::thread::Thread::cll_try_or_acquire_single_lock()</a>, <a class="el" href="xct__options_8hpp_source.html#l00155">foedus::xct::XctOptions::force_canonical_xlocks_in_precommit_</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00350">foedus::xct::CurrentLockList::get_array()</a>, <a class="el" href="xct_8hpp_source.html#l00413">foedus::xct::Xct::get_current_lock_list()</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="thread_8cpp_source.html#l00052">foedus::thread::Thread::get_engine()</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00383">foedus::xct::CurrentLockList::get_last_locked_entry()</a>, <a class="el" href="engine_8cpp_source.html#l00039">foedus::Engine::get_options()</a>, <a class="el" href="xct_8hpp_source.html#l00163">foedus::xct::Xct::get_write_set()</a>, <a class="el" href="xct_8hpp_source.html#l00157">foedus::xct::Xct::get_write_set_size()</a>, <a class="el" href="xct__id_8hpp_source.html#l01140">foedus::xct::RwLockableXctId::is_keylocked()</a>, <a class="el" href="xct__id_8hpp_source.html#l01142">foedus::xct::RwLockableXctId::is_moved()</a>, <a class="el" href="xct__id_8hpp_source.html#l01143">foedus::xct::RwLockableXctId::is_next_layer()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00259">foedus::xct::CurrentLockListIteratorForWriteSet::is_valid()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00200">foedus::kErrorCodeXctRaceAbort</a>, <a class="el" href="xct__id_8hpp_source.html#l00149">foedus::xct::kLockListPositionInvalid</a>, <a class="el" href="xct__id_8hpp_source.html#l00110">foedus::xct::kWriteLock</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00130">foedus::xct::LockEntry::lock_</a>, <a class="el" href="xct__id_8hpp_source.html#l01144">foedus::xct::RwLockableXctId::needs_track_moved()</a>, <a class="el" href="xct__access_8hpp_source.html#l00143">foedus::xct::ReadXctAccess::observed_owner_id_</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00514">precommit_xct_lock_batch_track_moved()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00478">precommit_xct_sort_access()</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00136">foedus::xct::LockEntry::preferred_mode_</a>, <a class="el" href="xct__access_8hpp_source.html#l00178">foedus::xct::WriteXctAccess::related_read_</a>, <a class="el" href="xct__id_8hpp_source.html#l01059">foedus::xct::XctId::store_max()</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00139">foedus::xct::LockEntry::taken_mode_</a>, <a class="el" href="retrospective__lock__list_8hpp_source.html#l00125">foedus::xct::LockEntry::universal_lock_id_</a>, <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>, <a class="el" href="engine__options_8hpp_source.html#l00147">foedus::EngineOptions::xct_</a>, and <a class="el" href="xct__id_8hpp_source.html#l01137">foedus::xct::RwLockableXctId::xct_id_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00384">precommit_xct_readwrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                                                                      {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  WriteXctAccess* write_set = current_xct.get_write_set();</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  uint32_t        write_set_size = current_xct.get_write_set_size();</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  CurrentLockList* cll = current_xct.get_current_lock_list();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> force_canonical</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    = context-&gt;get_engine()-&gt;get_options().xct_.force_canonical_xlocks_in_precommit_;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; #write_sets=&quot;</span> &lt;&lt; write_set_size &lt;&lt; <span class="stringliteral">&quot;, addr=&quot;</span> &lt;&lt; write_set;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// Initially, write-sets must be ordered by the insertion order.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; write_set_size; ++i) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i].ordinal_ == i);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// Because of RLL, the write-set might or might not already have a corresponding lock</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;moved_retry:</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ada7782b43556708daa3bb94f7662409a">precommit_xct_lock_batch_track_moved</a>(context));</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a09e66e6f76cf08131e11a18a44b5d0a4">precommit_xct_sort_access</a>(context);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// TODO(Hideaki) Because of how the new locks work, I&#39;m not sure the prefetch still helps.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">// Previously it did, but not significant either, so let&#39;s disable for now and revisit this later.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="comment">// we have to access the owner_id&#39;s pointed address. let&#39;s prefetch them in parallel</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">// for (uint32_t i = 0; i &lt; write_set_size; ++i) {</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">//   assorted::prefetch_cacheline(write_set[i].owner_id_address_);</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="comment">// Create entries in CLL for all write sets. At this point they are not locked yet.</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  cll-&gt;batch_insert_write_placeholders(write_set, write_set_size);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.assert_related_read_write());</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="comment">// Note: one alterantive is to sequentailly iterate over write-set and CLL,</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="comment">// both of which are sorted. It will be faster, but probably not that different</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="comment">// unless we have a large number of locks. For now binary_search each time.</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="comment">// Both write-set and CLL are sorted in canonical order. Simply iterate over in order.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="comment">// This is way faster than invoking cll-&gt;binary_search() for each write-set entry.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="comment">// Remember one thing, tho: write-set might have multiple entries for one record!</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">for</span> (CurrentLockListIteratorForWriteSet it(write_set, cll, write_set_size);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        it.is_valid();</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        it.next_writes()) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">// for multiple writes on one record, only the first one (write_cur_pos_) takes the lock</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    WriteXctAccess* entry = write_set + it.write_cur_pos_;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <a class="code" href="group__XCT.html#gaf1e1817b6663c210b329ce1ea57e63fb">LockListPosition</a> lock_pos = it.cll_pos_;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(lock_pos != <a class="code" href="namespacefoedus_1_1xct.html#a3882c3684e3adb4a6992ef230443a02c">kLockListPositionInvalid</a>);  <span class="comment">// we have put placeholders for all!</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    LockEntry* lock_entry = cll-&gt;get_array() + lock_pos;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(lock_entry-&gt;lock_ == entry-&gt;owner_id_address_);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(lock_entry-&gt;preferred_mode_ == <a class="code" href="group__XCT.html#ggae2b82bc723691c581c22944ef3cef43ca05c9c6b8c4d5e6e6cb32d7d407189826">kWriteLock</a>);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span> (lock_entry-&gt;taken_mode_ == <a class="code" href="group__XCT.html#ggae2b82bc723691c581c22944ef3cef43ca05c9c6b8c4d5e6e6cb32d7d407189826">kWriteLock</a>) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      DVLOG(2) &lt;&lt; <span class="stringliteral">&quot;Yay, already taken. Probably Thanks to RLL?&quot;</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">// We need to take or upgrade the lock.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">// This might return kErrorCodeXctRaceAbort when we are not in canonical mode and</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="comment">// we could not immediately acquire the lock.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keyword">const</span> <a class="code" href="group__XCT.html#gaf1e1817b6663c210b329ce1ea57e63fb">LockListPosition</a> last_locked_pos = cll-&gt;get_last_locked_entry();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">if</span> (force_canonical &amp;&amp;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        (last_locked_pos != <a class="code" href="namespacefoedus_1_1xct.html#a3882c3684e3adb4a6992ef230443a02c">kLockListPositionInvalid</a> &amp;&amp; last_locked_pos &gt;= lock_pos)) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="comment">// We are not in canonical mode. Let&#39;s aggressively restore canonical mode.</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        DVLOG(0) &lt;&lt; <span class="stringliteral">&quot;Aggressively releasing locks to restore canonical mode in precommit&quot;</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        context-&gt;cll_release_all_locks_after(lock_entry-&gt;universal_lock_id_ - 1U);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keyword">const</span> <a class="code" href="group__XCT.html#gaf1e1817b6663c210b329ce1ea57e63fb">LockListPosition</a> new_pos = cll-&gt;get_last_locked_entry();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_pos == <a class="code" href="namespacefoedus_1_1xct.html#a3882c3684e3adb4a6992ef230443a02c">kLockListPositionInvalid</a> || new_pos &lt; lock_pos);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;cll_try_or_acquire_single_lock(lock_pos));</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(entry-&gt;owner_id_address_-&gt;needs_track_moved())) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="comment">// Because we invoked precommit_xct_lock_batch_track_moved beforehand,</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="comment">// this happens only when a concurrent thread again split some of the overlapping page.</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// Though rare, it happens. In that case redo the procedure.</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      DLOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Someone has split the page and moved our record after we check. Retry..&quot;</span>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="keywordflow">goto</span> moved_retry;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!entry-&gt;owner_id_address_-&gt;is_moved());</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!entry-&gt;owner_id_address_-&gt;is_next_layer());</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;owner_id_address_-&gt;is_keylocked());</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    max_xct_id-&gt;store_max(entry-&gt;owner_id_address_-&gt;xct_id_);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">// If we have to abort, we should abort early to not waste time.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">// Thus, we check related read sets right here.</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">// For other writes of the same record, too.</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">for</span> (uint32_t rec = it.write_cur_pos_; rec &lt; it.write_next_pos_; ++rec) {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      WriteXctAccess* r = write_set + rec;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;owner_id_address_ == r-&gt;owner_id_address_);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="keywordflow">if</span> (r-&gt;related_read_) {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(r-&gt;related_read_-&gt;owner_id_address_ == r-&gt;owner_id_address_);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">if</span> (r-&gt;owner_id_address_-&gt;xct_id_ != r-&gt;related_read_-&gt;observed_owner_id_) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">kErrorCodeXctRaceAbort</a>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      }</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; locked write set&quot;</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; write_set_size; ++i) {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i].owner_id_address_-&gt;is_keylocked());</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_ada7782b43556708daa3bb94f7662409a"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ada7782b43556708daa3bb94f7662409a">foedus::xct::XctManagerPimpl::precommit_xct_lock_batch_track_moved</a></div><div class="ttdeci">ErrorCode precommit_xct_lock_batch_track_moved(thread::Thread *context)</div><div class="ttdoc">Subroutine of precommit_xct_lock to track most of moved records in write-set. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00514">xct_manager_pimpl.cpp:514</a></div></div>
<div class="ttc" id="namespacefoedus_1_1xct_html_a3882c3684e3adb4a6992ef230443a02c"><div class="ttname"><a href="namespacefoedus_1_1xct.html#a3882c3684e3adb4a6992ef230443a02c">foedus::xct::kLockListPositionInvalid</a></div><div class="ttdeci">const LockListPosition kLockListPositionInvalid</div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l00149">xct_id.hpp:149</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="group__XCT_html_gaf1e1817b6663c210b329ce1ea57e63fb"><div class="ttname"><a href="group__XCT.html#gaf1e1817b6663c210b329ce1ea57e63fb">foedus::xct::LockListPosition</a></div><div class="ttdeci">uint32_t LockListPosition</div><div class="ttdoc">Index in a lock-list, either RLL or CLL. </div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l00148">xct_id.hpp:148</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a09e66e6f76cf08131e11a18a44b5d0a4"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a09e66e6f76cf08131e11a18a44b5d0a4">foedus::xct::XctManagerPimpl::precommit_xct_sort_access</a></div><div class="ttdeci">void precommit_xct_sort_access(thread::Thread *context)</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00478">xct_manager_pimpl.cpp:478</a></div></div>
<div class="ttc" id="group__XCT_html_ggae2b82bc723691c581c22944ef3cef43ca05c9c6b8c4d5e6e6cb32d7d407189826"><div class="ttname"><a href="group__XCT.html#ggae2b82bc723691c581c22944ef3cef43ca05c9c6b8c4d5e6e6cb32d7d407189826">foedus::xct::kWriteLock</a></div><div class="ttdoc">taken_mode_: we took a write-lock. </div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l00110">xct_id.hpp:110</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa3832e1d1faf1540161d389edf2a9c17"><div class="ttname"><a href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a></div><div class="ttdeci">#define CHECK_ERROR_CODE(x)</div><div class="ttdoc">This macro calls x and checks its returned error code. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00155">error_code.hpp:155</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">foedus::kErrorCodeXctRaceAbort</a></div><div class="ttdoc">0x0A05 : "XCTION : Aborted a transaction because of a race condition. This is an expected error in hi...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00200">error_code.hpp:200</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1Xct.html#a148038efa6f37e2b89f057c5d5cd4cb3" title="This debug method checks whether the related_read_ and related_write_ fileds in read/write sets are c..." alt="" coords="531,5,687,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1CurrentLockList.html#abaacdb674d1296394cff252f995ce001" title="Create entries for all write&#45;sets in one&#45;shot. " alt="" coords="784,419,948,475"/>
<area shape="rect" id="node12" href="classfoedus_1_1thread_1_1Thread.html#a4ff4d49ae69ae490afb0cc09c4c19507" title="Release all locks in CLL of this thread whose addresses are canonically ordered before the parameter..." alt="" coords="259,500,441,541"/>
<area shape="rect" id="node14" href="classfoedus_1_1xct_1_1Xct.html#afc0b909c82e905105f4f9701082a16b8" title="foedus::xct::Xct::get\l_current_lock_list" alt="" coords="797,683,935,724"/>
<area shape="rect" id="node18" href="classfoedus_1_1thread_1_1Thread.html#ab52244fbb6c13b0c0774431af72d482e" title="Methods related to Current Lock List (CLL) These are the only interface in Thread to lock records..." alt="" coords="248,565,452,607"/>
<area shape="rect" id="node21" href="classfoedus_1_1xct_1_1CurrentLockList.html#a75e45c9dd7129e1f202252cf124e76ff" title="foedus::xct::CurrentLock\lList::get_array" alt="" coords="268,683,432,724"/>
<area shape="rect" id="node22" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="533,71,684,112"/>
<area shape="rect" id="node23" href="classfoedus_1_1thread_1_1Thread.html#a64fa1150b812810a2697bd6293aaac9a" title="foedus::thread::Thread\l::get_engine" alt="" coords="275,748,425,789"/>
<area shape="rect" id="node24" href="classfoedus_1_1xct_1_1CurrentLockList.html#ad18887a3fb16dc1ca458892ce4b0b27c" title="foedus::xct::CurrentLock\lList::get_last_locked_entry" alt="" coords="261,813,439,855"/>
<area shape="rect" id="node25" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="283,879,417,920"/>
<area shape="rect" id="node26" href="classfoedus_1_1xct_1_1Xct.html#ae5fa3dcdb891b99e5bc7d83ff2029f46" title="foedus::xct::Xct::get\l_write_set" alt="" coords="539,201,678,243"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="539,267,678,308"/>
<area shape="rect" id="node28" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a610d8c1bfd1d86dcde181c3fb0020f0c" title="foedus::xct::RwLockableXct\lId::is_keylocked" alt="" coords="259,944,441,985"/>
<area shape="rect" id="node30" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36" title="foedus::xct::RwLockableXct\lId::is_moved" alt="" coords="259,1009,441,1051"/>
<area shape="rect" id="node32" href="structfoedus_1_1xct_1_1RwLockableXctId.html#ac49bd73652693a170f3755c1daf96736" title="foedus::xct::RwLockableXct\lId::is_next_layer" alt="" coords="259,1075,441,1116"/>
<area shape="rect" id="node34" href="structfoedus_1_1xct_1_1CurrentLockListIteratorForWriteSet.html#afadf5849c06ecc853e53d79783d2459d" title="foedus::xct::CurrentLock\lListIteratorForWriteSet\l::is_valid" alt="" coords="268,1141,432,1197"/>
<area shape="rect" id="node35" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="775,353,957,395"/>
<area shape="rect" id="node37" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ada7782b43556708daa3bb94f7662409a" title="Subroutine of precommit_xct_lock to track most of moved records in write&#45;set. " alt="" coords="253,259,447,315"/>
<area shape="rect" id="node42" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a09e66e6f76cf08131e11a18a44b5d0a4" title="foedus::xct::XctManagerPimpl\l::precommit_xct_sort_access" alt="" coords="253,139,447,180"/>
<area shape="rect" id="node45" href="structfoedus_1_1xct_1_1XctId.html#a2878cd14b103f72c8bce5a330e03e2b2" title="Kind of std::max(this, other). " alt="" coords="289,1221,411,1263"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1CurrentLockList.html#acbed8e324b88389217b42a132e0547b8" title="foedus::xct::CurrentLock\lList::assert_sorted" alt="" coords="1022,449,1186,491"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1CurrentLockList.html#a1a668d5dd1b711abed1a9962a8cb4ec1" title="Calculate last_locked_entry_ by really checking the whole list. " alt="" coords="1739,561,1951,603"/>
<area shape="rect" id="node10" href="classfoedus_1_1xct_1_1CurrentLockList.html#a3cb71937e25bc68318ef0c9808a4a482" title="Analogous to std::binary_search() for the given lock. " alt="" coords="1262,415,1426,456"/>
<area shape="rect" id="node11" href="structfoedus_1_1xct_1_1LockEntry.html#a54190c5faf4f6943043c1d83ed435f44" title="foedus::xct::LockEntry::set" alt="" coords="1015,347,1193,374"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1CurrentLockList.html#a7485f0d26810767b3bef18e12233daa7" title="foedus::xct::CurrentLock\lList::assert_sorted_impl" alt="" coords="1262,484,1426,525"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1CurrentLockList.html#aed99dee60f9529d5cfabb5e1742038da" title="foedus::xct::CurrentLock\lList::assert_last_locked_entry" alt="" coords="1495,561,1691,603"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1xct.html#a736225e9852f9c75b92e134dbbe40a68" title="foedus::xct::lock_assert\l_sorted" alt="" coords="1512,484,1673,525"/>
<area shape="rect" id="node8" href="classfoedus_1_1xct_1_1CurrentLockList.html#a03e818494c4d716f9fc996081f6c419f" title="Only searches among entries at or before &quot;from&quot;. " alt="" coords="1999,586,2175,642"/>
<area shape="rect" id="node13" href="classfoedus_1_1thread_1_1ThreadPimpl.html#af1783a8b90bfcd0fa87c4947fc406b0b" title="RW&#45;locks. " alt="" coords="517,500,701,541"/>
<area shape="rect" id="node15" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a33a1b8b428cd84029b8b377867197ea4" title="foedus::thread::ThreadPimpl\l::is_simple_mcs_rw" alt="" coords="774,565,958,607"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1CurrentLockList.html#ace2e6a593d7b975f1756ce9eec0fd1f2" title="Release all locks in CLL whose addresses are canonically ordered before the parameter. " alt="" coords="784,500,948,541"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1CurrentLockList.html#ae0cbd2f6b369d0340c3222f124fe122b" title="foedus::xct::CurrentLock\lList::begin" alt="" coords="1022,515,1186,556"/>
<area shape="rect" id="node19" href="classfoedus_1_1thread_1_1ThreadPimpl.html#afd87e3c9d855306d2c8115571eb79fa6" title="foedus::thread::ThreadPimpl\l::cll_try_or_acquire_single_lock" alt="" coords="507,565,711,607"/>
<area shape="rect" id="node20" href="classfoedus_1_1xct_1_1CurrentLockList.html#aa8023ecc3dc58816a010a3415ebfc1dd" title="Methods below take or release locks, so they receive MCS_RW_IMPL, a template param. " alt="" coords="1241,628,1447,669"/>
<area shape="rect" id="node29" href="structfoedus_1_1xct_1_1McsRwLock.html#adc5e6612e3cecf3d2f15d02237b4ef8f" title="foedus::xct::McsRwLock\l::is_locked" alt="" coords="526,944,691,985"/>
<area shape="rect" id="node31" href="structfoedus_1_1xct_1_1XctId.html#a41264f4ced33dae443651f57bc09e964" title="foedus::xct::XctId\l::is_moved" alt="" coords="547,1009,670,1051"/>
<area shape="rect" id="node33" href="structfoedus_1_1xct_1_1XctId.html#aa3d33ca4fe97b735ce59594993a1dd94" title="foedus::xct::XctId\l::is_next_layer" alt="" coords="547,1075,670,1116"/>
<area shape="rect" id="node36" href="structfoedus_1_1xct_1_1XctId.html#aa17818f701d2c61588f290c3d2cc1330" title="is_moved() || is_next_layer() " alt="" coords="1031,231,1177,272"/>
<area shape="rect" id="node38" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab5ef5b885ba49a42c2f47b694dc2a63d" title="used from precommit_xct_lock() to track moved record " alt="" coords="500,332,717,373"/>
<area shape="rect" id="node39" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="799,288,933,329"/>
<area shape="rect" id="node40" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="791,142,941,198"/>
<area shape="rect" id="node41" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ace820ba89437e4d3a59fdb47a47525ba" title="Calculate owner_lock_id using the resolver. " alt="" coords="765,223,967,264"/>
<area shape="rect" id="node43" href="structfoedus_1_1xct_1_1WriteXctAccess.html#a4ff6663f61aa1e2ea251c15f16796974" title="foedus::xct::WriteXctAccess\l::compare" alt="" coords="515,136,702,177"/>
<area shape="rect" id="node44" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ab99f8c62595322b828742165a3cbb9d8" title="sort the write set in a unique order. " alt="" coords="767,76,965,117"/>
<area shape="rect" id="node46" href="structfoedus_1_1xct_1_1XctId.html#ac151128ff0040de166018da6133f8d85" title="Returns if this XctId is before other in serialization order, meaning this is either an invalid (unus..." alt="" coords="547,1221,670,1263"/>
<area shape="rect" id="node47" href="classfoedus_1_1Epoch.html#aaef554452ea9ac7b072af98cde1558dc" title="Returns if this epoch is before the given epoch in the sense of distance defined in RFC 1982..." alt="" coords="792,1258,940,1285"/>
<area shape="rect" id="node48" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="805,1127,927,1168"/>
<area shape="rect" id="node49" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="1043,1213,1165,1255"/>
<area shape="rect" id="node50" href="structfoedus_1_1xct_1_1XctId.html#a936888dbc82de6e76194b72c28c9a10f" title="foedus::xct::XctId\l::get_ordinal" alt="" coords="805,1192,927,1233"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a2376431f079ce60800c9c25d89d74896_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="248,5,443,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="491,5,685,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="733,5,896,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ada7782b43556708daa3bb94f7662409a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::precommit_xct_lock_batch_track_moved </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine of precommit_xct_lock to track <em>most</em> of moved records in write-set. </p>
<p>We initially did it per-record while we take a lock, but then we need lots of redoing when the transaction is batch-loading a bunch of records that cause many splits. Thus, <em>before</em> we take X-locks and do final check, we invoke this method to do best-effort tracking in one shot. Note that there still is a chance that the record is moved after this method before we take lock. In that case we redo the process. It happens. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00514">514</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct_8hpp_source.html#l00163">foedus::xct::Xct::get_write_set()</a>, <a class="el" href="xct_8hpp_source.html#l00157">foedus::xct::Xct::get_write_set_size()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00200">foedus::kErrorCodeXctRaceAbort</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00432">precommit_xct_lock_track_write()</a>, and <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00539">precommit_xct_lock()</a>.</p>
<div class="fragment"><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                                                                                     {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  WriteXctAccess* write_set = current_xct.get_write_set();</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  uint32_t        write_set_size = current_xct.get_write_set_size();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  uint32_t moved_count = 0;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; write_set_size; ++i) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    WriteXctAccess* entry = write_set + i;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keyword">auto</span>* rec = entry-&gt;owner_id_address_;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(rec-&gt;needs_track_moved())) {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab5ef5b885ba49a42c2f47b694dc2a63d">precommit_xct_lock_track_write</a>(context, entry)) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        DLOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Failed to track moved record?? this must be very rare&quot;</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">kErrorCodeXctRaceAbort</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;owner_id_address_ != rec);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      ++moved_count;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  DVLOG(1) &lt;&lt; <span class="stringliteral">&quot;Tracked &quot;</span> &lt;&lt; moved_count &lt;&lt; <span class="stringliteral">&quot; moved records in precommit_xct_lock.&quot;</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">if</span> (moved_count &gt; 100U) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Tracked &quot;</span> &lt;&lt; moved_count &lt;&lt; <span class="stringliteral">&quot; moved records in precommit_xct_lock.&quot;</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; That&#39;s a lot. maybe this is a batch-loading transaction?&quot;</span>;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;}</div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_ab5ef5b885ba49a42c2f47b694dc2a63d"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab5ef5b885ba49a42c2f47b694dc2a63d">foedus::xct::XctManagerPimpl::precommit_xct_lock_track_write</a></div><div class="ttdeci">bool precommit_xct_lock_track_write(thread::Thread *context, WriteXctAccess *entry)</div><div class="ttdoc">used from precommit_xct_lock() to track moved record </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00432">xct_manager_pimpl.cpp:432</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">foedus::kErrorCodeXctRaceAbort</a></div><div class="ttdoc">0x0A05 : "XCTION : Aborted a transaction because of a race condition. This is an expected error in hi...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00200">error_code.hpp:200</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="281,5,432,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1Xct.html#ae5fa3dcdb891b99e5bc7d83ff2029f46" title="foedus::xct::Xct::get\l_write_set" alt="" coords="287,71,426,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="287,136,426,177"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab5ef5b885ba49a42c2f47b694dc2a63d" title="used from precommit_xct_lock() to track moved record " alt="" coords="248,201,465,243"/>
<area shape="rect" id="node6" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="523,99,705,140"/>
<area shape="rect" id="node8" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="547,164,681,205"/>
<area shape="rect" id="node9" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="539,230,689,286"/>
<area shape="rect" id="node10" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ace820ba89437e4d3a59fdb47a47525ba" title="Calculate owner_lock_id using the resolver. " alt="" coords="513,311,715,352"/>
<area shape="rect" id="node7" href="structfoedus_1_1xct_1_1XctId.html#aa17818f701d2c61588f290c3d2cc1330" title="is_moved() || is_next_layer() " alt="" coords="789,99,934,140"/>
<area shape="rect" id="node11" href="structfoedus_1_1xct_1_1RecordXctAccess.html#adf2e2a9d414bf5cfe86f33198ebdf434" title="Setter for owner_id_address_/owner_lock_id_. " alt="" coords="763,277,960,319"/>
<area shape="rect" id="node12" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="789,343,934,384"/>
<area shape="rect" id="node13" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="1008,343,1171,384"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="1219,309,1412,351"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1235,375,1396,416"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ada7782b43556708daa3bb94f7662409a_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896" title="Phase 1 of precommit_xct() " alt="" coords="248,13,443,54"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="491,13,685,54"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="733,13,928,54"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="976,13,1139,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab5ef5b885ba49a42c2f47b694dc2a63d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_lock_track_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1WriteXctAccess.html">WriteXctAccess</a> *&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>used from <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896" title="Phase 1 of precommit_xct() ">precommit_xct_lock()</a> to track moved record </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00432">432</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="thread_8cpp_source.html#l00125">foedus::thread::Thread::get_global_volatile_page_resolver()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="xct__id_8hpp_source.html#l01144">foedus::xct::RwLockableXctId::needs_track_moved()</a>, <a class="el" href="xct__id_8hpp_source.html#l01186">foedus::xct::TrackMovedRecordResult::new_owner_address_</a>, <a class="el" href="xct__id_8hpp_source.html#l01187">foedus::xct::TrackMovedRecordResult::new_payload_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00172">foedus::xct::WriteXctAccess::payload_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00178">foedus::xct::WriteXctAccess::related_read_</a>, <a class="el" href="xct__access_8hpp_source.html#l00153">foedus::xct::ReadXctAccess::related_write_</a>, <a class="el" href="xct__access_8cpp_source.html#l00093">foedus::xct::RecordXctAccess::set_owner_id_resolve_lock_id()</a>, and <a class="el" href="xct__access_8hpp_source.html#l00085">foedus::xct::RecordXctAccess::storage_id_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00514">precommit_xct_lock_batch_track_moved()</a>.</p>
<div class="fragment"><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                                {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;owner_id_address_-&gt;needs_track_moved());</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  storage::StorageManager* st = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  TrackMovedRecordResult result = st-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076">track_moved_record</a>(</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    entry-&gt;storage_id_,</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    entry-&gt;owner_id_address_,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    entry);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">if</span> (result.new_owner_address_ == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// failed to track down even with the write set. this is a quite rare event.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// in that case, retry the whole transaction.</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    DLOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Failed to track moved record even with write set&quot;</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; resolver = context-&gt;get_global_volatile_page_resolver();</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span> (entry-&gt;related_read_) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// also apply the result to related read access so that we don&#39;t have to track twice.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;related_read_-&gt;related_write_ == entry);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;related_read_-&gt;owner_id_address_ == entry-&gt;owner_id_address_);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    entry-&gt;related_read_-&gt;set_owner_id_resolve_lock_id(resolver, result.new_owner_address_);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  entry-&gt;set_owner_id_resolve_lock_id(resolver, result.new_owner_address_);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  entry-&gt;payload_address_ = result.new_payload_address_;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a02513539acf9d7cd9805d34154281076"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076">foedus::storage::StorageManager::track_moved_record</a></div><div class="ttdeci">xct::TrackMovedRecordResult track_moved_record(StorageId storage_id, xct::RwLockableXctId *old_address, xct::WriteXctAccess *write_set)</div><div class="ttdoc">Resolves a "moved" record. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager__pimpl_8cpp_source.html#l00445">storage_manager_pimpl.cpp:445</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="296,5,447,61"/>
<area shape="rect" id="node3" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="304,86,439,127"/>
<area shape="rect" id="node4" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="280,151,463,193"/>
<area shape="rect" id="node6" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ace820ba89437e4d3a59fdb47a47525ba" title="Calculate owner_lock_id using the resolver. " alt="" coords="271,217,472,258"/>
<area shape="rect" id="node5" href="structfoedus_1_1xct_1_1XctId.html#aa17818f701d2c61588f290c3d2cc1330" title="is_moved() || is_next_layer() " alt="" coords="546,151,691,193"/>
<area shape="rect" id="node7" href="structfoedus_1_1xct_1_1RecordXctAccess.html#adf2e2a9d414bf5cfe86f33198ebdf434" title="Setter for owner_id_address_/owner_lock_id_. " alt="" coords="520,217,717,258"/>
<area shape="rect" id="node8" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="546,282,691,323"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="765,282,928,323"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="976,249,1169,290"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="992,314,1153,355"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ab5ef5b885ba49a42c2f47b694dc2a63d_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ada7782b43556708daa3bb94f7662409a" title="Subroutine of precommit_xct_lock to track most of moved records in write&#45;set. " alt="" coords="271,5,465,61"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896" title="Phase 1 of precommit_xct() " alt="" coords="513,13,708,54"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="756,13,951,54"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="999,13,1193,54"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1241,13,1404,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="add42c2f0d559eafa1f67fd9c048a4855"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::precommit_xct_readonly </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *&#160;</td>
          <td class="paramname"><em>commit_epoch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> if the transaction is read-only </p>
<p>If the transaction is read-only, commit-epoch (serialization point) is the largest epoch number in the read set. We don't have to take two memory fences in this case. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00371">371</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="thread__log__buffer_8hpp_source.html#l00375">foedus::log::ThreadLogBuffer::get_offset_committed()</a>, <a class="el" href="thread__log__buffer_8hpp_source.html#l00378">foedus::log::ThreadLogBuffer::get_offset_tail()</a>, <a class="el" href="thread_8cpp_source.html#l00078">foedus::thread::Thread::get_thread_log_buffer()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00200">foedus::kErrorCodeXctRaceAbort</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00046">foedus::assorted::memory_fence_acquire()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00648">precommit_xct_verify_readonly()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00343">precommit_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                                                                            {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Committing read_only&quot;</span>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(context-&gt;get_thread_log_buffer().get_offset_committed() ==</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      context-&gt;get_thread_log_buffer().get_offset_tail());</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  *commit_epoch = Epoch();</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();  <span class="comment">// this is enough for read-only case</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b">precommit_xct_verify_readonly</a>(context, commit_epoch)) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">kErrorCodeXctRaceAbort</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a2c3befa16f448a004d548a2b4675a13b"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b">foedus::xct::XctManagerPimpl::precommit_xct_verify_readonly</a></div><div class="ttdeci">bool precommit_xct_verify_readonly(thread::Thread *context, Epoch *commit_epoch)</div><div class="ttdoc">Phase 2 of precommit_xct() for read-only case. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00648">xct_manager_pimpl.cpp:648</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaf84f9944a16c5848f69beacdfeedf939"><div class="ttname"><a href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">foedus::assorted::memory_fence_acquire</a></div><div class="ttdeci">void memory_fence_acquire()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_acquire). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00046">atomic_fences.hpp:46</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">foedus::kErrorCodeXctRaceAbort</a></div><div class="ttdoc">0x0A05 : "XCTION : Aborted a transaction because of a race condition. This is an expected error in hi...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00200">error_code.hpp:200</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#ad75e847585775d7c506815269a176941" title="This marks the position upto which transaction logs are committed by the thread. " alt="" coords="259,312,445,353"/>
<area shape="rect" id="node3" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a3077294533a21c3aa0a115cfd4c90224" title="The current cursor to which next log will be written. " alt="" coords="259,377,445,419"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee" title="Returns the private log buffer for this thread. " alt="" coords="275,443,429,484"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="265,508,439,549"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b" title="Phase 2 of precommit_xct() for read&#45;only case. " alt="" coords="248,573,456,615"/>
<area shape="rect" id="node7" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="808,136,959,177"/>
<area shape="rect" id="node8" href="classfoedus_1_1xct_1_1Xct.html#ae523b00cead387e6addb1366fe08546a" title="foedus::xct::Xct::get\l_read_set" alt="" coords="546,340,685,381"/>
<area shape="rect" id="node9" href="classfoedus_1_1xct_1_1Xct.html#af7b9c43800807db798d2e58bc07ad5cd" title="foedus::xct::Xct::get\l_read_set_size" alt="" coords="546,405,685,447"/>
<area shape="rect" id="node10" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="816,397,951,439"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="797,201,969,243"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736" title="Returns the name of the given storage ID. " alt="" coords="533,639,697,680"/>
<area shape="rect" id="node16" href="structfoedus_1_1xct_1_1XctId.html#ad5be23a25e650f1bad81ce8c87630af0" title="foedus::xct::XctId\l::is_being_written" alt="" coords="554,704,677,745"/>
<area shape="rect" id="node17" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="792,463,975,504"/>
<area shape="rect" id="node19" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d" title="used from verification methods to track moved record " alt="" coords="505,573,725,615"/>
<area shape="rect" id="node36" href="classfoedus_1_1Epoch.html#adf886b8b219538b7dac2da820fbec68c" title="Kind of std::max(this, other). " alt="" coords="528,770,703,797"/>
<area shape="rect" id="node38" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="554,821,677,863"/>
<area shape="rect" id="node40" href="classfoedus_1_1xct_1_1Xct.html#a245cedc62930a99cee57290d24932c56" title="foedus::xct::Xct::get\l_lock_free_read_set" alt="" coords="546,887,685,928"/>
<area shape="rect" id="node41" href="classfoedus_1_1xct_1_1Xct.html#af39a25162bfa65a4cc2dea0d64460cbe" title="foedus::xct::Xct::get\l_lock_free_read_set_size" alt="" coords="531,952,700,993"/>
<area shape="rect" id="node42" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="548,1017,683,1059"/>
<area shape="rect" id="node43" href="classfoedus_1_1log_1_1LogManager.html#ac152369417a895120dac55370f8a750e" title="Non&#45;atomic version of the method. " alt="" coords="507,1083,724,1124"/>
<area shape="rect" id="node45" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209" title="Returns false if there is any pointer set conflict. " alt="" coords="504,92,727,133"/>
<area shape="rect" id="node48" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d" title="Returns false if there is any page version conflict. " alt="" coords="518,259,713,315"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1StorageControlBlock.html#af1f0b118bed183f7daf070409112ca93" title="foedus::storage::Storage\lControlBlock::exists" alt="" coords="1290,799,1454,840"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523" title="Returns the storage of given ID. " alt="" coords="801,740,965,781"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#aea8861d6bf6c13c0df6d0c9777cdaa99" title="foedus::storage::Storage\lManagerPimpl::get_storage" alt="" coords="1048,740,1229,781"/>
<area shape="rect" id="node18" href="structfoedus_1_1xct_1_1XctId.html#aa17818f701d2c61588f290c3d2cc1330" title="is_moved() || is_next_layer() " alt="" coords="1066,463,1211,504"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076" title="Resolves a &quot;moved&quot; record. " alt="" coords="785,675,981,716"/>
<area shape="rect" id="node29" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="808,529,959,585"/>
<area shape="rect" id="node30" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ace820ba89437e4d3a59fdb47a47525ba" title="Calculate owner_lock_id using the resolver. " alt="" coords="783,609,984,651"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a3248d8440d805f772ad7b6122a4d309b" title="foedus::storage::Storage\lManagerPimpl::track_moved\l_record" alt="" coords="1045,659,1232,715"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#ab763d5d37f053808257f662611f2e603" title="Resolves a &quot;moved&quot; record. " alt="" coords="1299,718,1445,774"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStorage.html#a2370f71beab1eb4b8b02e3ac9e4f29bd" title="Resolves a &quot;moved&quot; record. " alt="" coords="1285,638,1459,694"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af3a7066a8881f653e759362cf39e01c4" title="foedus::storage::hash\l::HashStoragePimpl::track\l_moved_record" alt="" coords="1516,718,1691,774"/>
<area shape="rect" id="node24" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#ad66913658c856c60c06500b1179db779" title="used only for sanity check. " alt="" coords="1748,786,1936,842"/>
<area shape="rect" id="node25" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36" title="foedus::xct::RwLockableXct\lId::is_moved" alt="" coords="1751,720,1933,761"/>
<area shape="rect" id="node26" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="1759,658,1925,685"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff57df4d2b237e63e459d5fefe9d4cfb" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::track_moved_record" alt="" coords="1517,638,1690,694"/>
<area shape="rect" id="node31" href="structfoedus_1_1xct_1_1RecordXctAccess.html#adf2e2a9d414bf5cfe86f33198ebdf434" title="Setter for owner_id_address_/owner_lock_id_. " alt="" coords="1040,528,1237,569"/>
<area shape="rect" id="node32" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="1066,593,1211,635"/>
<area shape="rect" id="node33" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="1291,572,1453,613"/>
<area shape="rect" id="node34" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="1507,507,1700,548"/>
<area shape="rect" id="node35" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1523,572,1684,613"/>
<area shape="rect" id="node37" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="806,857,961,883"/>
<area shape="rect" id="node39" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="822,908,945,949"/>
<area shape="rect" id="node44" href="classfoedus_1_1log_1_1LogManagerPimpl.html#a275d6ceca892089d89622fcf866c80d8" title="foedus::log::LogManagerPimpl\l::get_durable_global_epoch_weak" alt="" coords="775,1083,992,1124"/>
<area shape="rect" id="node46" href="classfoedus_1_1xct_1_1Xct.html#a91010b6195657c14f3b681da8102163d" title="foedus::xct::Xct::get\l_pointer_set" alt="" coords="814,5,953,47"/>
<area shape="rect" id="node47" href="classfoedus_1_1xct_1_1Xct.html#a6b0f4d5bf1485c376f62e97c6053ea43" title="foedus::xct::Xct::get\l_pointer_set_size" alt="" coords="814,71,953,112"/>
<area shape="rect" id="node49" href="classfoedus_1_1xct_1_1Xct.html#a98dcc8bc01ee8a365e68c0742c605d08" title="foedus::xct::Xct::get\l_page_version_set" alt="" coords="814,267,953,308"/>
<area shape="rect" id="node50" href="classfoedus_1_1xct_1_1Xct.html#a67f1a970106386aa9f367195c0a43208" title="foedus::xct::Xct::get\l_page_version_set_size" alt="" coords="803,332,963,373"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_add42c2f0d559eafa1f67fd9c048a4855_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="248,5,443,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="491,5,653,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a777caaecec0e7bb19b1cd2841771f755"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::precommit_xct_readwrite </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *&#160;</td>
          <td class="paramname"><em>commit_epoch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> if the transaction is read-write </p>
<p>See [TU2013] for the full protocol in this case. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00384">384</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="thread__log__buffer_8hpp_source.html#l00358">foedus::log::ThreadLogBuffer::discard_current_xct_log()</a>, <a class="el" href="log__options_8hpp_source.html#l00104">foedus::log::LogOptions::emulation_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00113">get_current_global_epoch_weak()</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="thread_8cpp_source.html#l00055">foedus::thread::Thread::get_in_commit_epoch_address()</a>, <a class="el" href="engine_8cpp_source.html#l00039">foedus::Engine::get_options()</a>, <a class="el" href="thread_8cpp_source.html#l00078">foedus::thread::Thread::get_thread_log_buffer()</a>, <a class="el" href="xct_8hpp_source.html#l00163">foedus::xct::Xct::get_write_set()</a>, <a class="el" href="xct_8hpp_source.html#l00157">foedus::xct::Xct::get_write_set_size()</a>, <a class="el" href="epoch_8hpp_source.html#l00070">foedus::Epoch::kEpochInitialDurable</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00200">foedus::kErrorCodeXctRaceAbort</a>, <a class="el" href="engine__options_8hpp_source.html#l00138">foedus::EngineOptions::log_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00069">foedus::assorted::memory_fence_acq_rel()</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="device__emulation__options_8hpp_source.html#l00049">foedus::fs::DeviceEmulationOptions::null_device_</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00868">precommit_xct_apply()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00539">precommit_xct_lock()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00731">precommit_xct_verify_readwrite()</a>, <a class="el" href="thread__log__buffer_8hpp_source.html#l00345">foedus::log::ThreadLogBuffer::publish_committed_log()</a>, and <a class="el" href="xct__id_8hpp_source.html#l00958">foedus::xct::XctId::set()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00343">precommit_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                                                                             {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Committing read-write&quot;</span>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  XctId max_xct_id;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  max_xct_id.set(<a class="code" href="classfoedus_1_1Epoch.html#a987db657e61845e18835ce4b1617470fa5fb5da158901984d4b85c2f26f58a33f">Epoch::kEpochInitialDurable</a>, 1);  <span class="comment">// TODO(Hideaki) not quite..</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> lock_ret = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896">precommit_xct_lock</a>(context, &amp;max_xct_id);  <span class="comment">// Phase 1</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (lock_ret != <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">return</span> lock_ret;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="comment">// BEFORE the first fence, update the in commit epoch for epoch chime.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// see InCommitEpochGuard class comments for why we need to do this.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  Epoch conservative_epoch = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#acd49fd67f3459df687ed08d5d8b54082">get_current_global_epoch_weak</a>();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  InCommitEpochGuard guard(context-&gt;get_in_commit_epoch_address(), conservative_epoch);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf">assorted::memory_fence_acq_rel</a>();</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  *commit_epoch = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#acd49fd67f3459df687ed08d5d8b54082">get_current_global_epoch_weak</a>();  <span class="comment">// serialization point!</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Acquired read-write commit epoch &quot;</span> &lt;&lt; *commit_epoch;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <a class="code" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf">assorted::memory_fence_acq_rel</a>();</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordtype">bool</span> verified = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b">precommit_xct_verify_readwrite</a>(context, &amp;max_xct_id);  <span class="comment">// phase 2</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    WriteXctAccess* write_set = context-&gt;get_current_xct().get_write_set();</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    uint32_t        write_set_size = context-&gt;get_current_xct().get_write_set_size();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; write_set_size; ++i) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i].owner_id_address_-&gt;is_keylocked());</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!write_set[i].owner_id_address_-&gt;needs_track_moved());</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i].log_entry_);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i].payload_address_);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span> (verified) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f">precommit_xct_apply</a>(context, max_xct_id, commit_epoch);  <span class="comment">// phase 3. this does NOT unlock</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// announce log AFTER (with fence) apply, because apply sets xct_order in the logs.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#aee56a2e02a140b766a74d9e9c3088ddb">log_</a>.<a class="code" href="structfoedus_1_1log_1_1LogOptions.html#a75c5412a901752fecbf7117d6829c444">emulation_</a>.<a class="code" href="structfoedus_1_1fs_1_1DeviceEmulationOptions.html#a965362432b72417b499d4dcfabc94505">null_device_</a>) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      context-&gt;get_thread_log_buffer().discard_current_xct_log();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      context-&gt;get_thread_log_buffer().publish_committed_log(*commit_epoch);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">kErrorCodeXctRaceAbort</a>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_acd49fd67f3459df687ed08d5d8b54082"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#acd49fd67f3459df687ed08d5d8b54082">foedus::xct::XctManagerPimpl::get_current_global_epoch_weak</a></div><div class="ttdeci">Epoch get_current_global_epoch_weak() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00113">xct_manager_pimpl.hpp:113</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_ad91daff37c2b78b8c6620d67869e9d7f"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f">foedus::xct::XctManagerPimpl::precommit_xct_apply</a></div><div class="ttdeci">void precommit_xct_apply(thread::Thread *context, XctId max_xct_id, Epoch *commit_epoch)</div><div class="ttdoc">Phase 3 of precommit_xct() </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00868">xct_manager_pimpl.cpp:868</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9534e63f498a012d9fa401a10e2b4e0b"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b">foedus::xct::XctManagerPimpl::precommit_xct_verify_readwrite</a></div><div class="ttdeci">bool precommit_xct_verify_readwrite(thread::Thread *context, XctId *max_xct_id)</div><div class="ttdoc">Phase 2 of precommit_xct() for read-write case. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00731">xct_manager_pimpl.cpp:731</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a2376431f079ce60800c9c25d89d74896"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896">foedus::xct::XctManagerPimpl::precommit_xct_lock</a></div><div class="ttdeci">ErrorCode precommit_xct_lock(thread::Thread *context, XctId *max_xct_id)</div><div class="ttdoc">Phase 1 of precommit_xct() </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00539">xct_manager_pimpl.cpp:539</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a6546930099132529543c320327367ef1"><div class="ttname"><a href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">foedus::Engine::get_options</a></div><div class="ttdeci">const EngineOptions &amp; get_options() const </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00039">engine.cpp:39</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="structfoedus_1_1log_1_1LogOptions_html_a75c5412a901752fecbf7117d6829c444"><div class="ttname"><a href="structfoedus_1_1log_1_1LogOptions.html#a75c5412a901752fecbf7117d6829c444">foedus::log::LogOptions::emulation_</a></div><div class="ttdeci">foedus::fs::DeviceEmulationOptions emulation_</div><div class="ttdoc">Settings to emulate slower logging device. </div><div class="ttdef"><b>Definition:</b> <a href="log__options_8hpp_source.html#l00104">log_options.hpp:104</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a987db657e61845e18835ce4b1617470fa5fb5da158901984d4b85c2f26f58a33f"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a987db657e61845e18835ce4b1617470fa5fb5da158901984d4b85c2f26f58a33f">foedus::Epoch::kEpochInitialDurable</a></div><div class="ttdoc">As there is no transaction in ep-1, initial durable_epoch is 1. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00070">epoch.hpp:70</a></div></div>
<div class="ttc" id="structfoedus_1_1fs_1_1DeviceEmulationOptions_html_a965362432b72417b499d4dcfabc94505"><div class="ttname"><a href="structfoedus_1_1fs_1_1DeviceEmulationOptions.html#a965362432b72417b499d4dcfabc94505">foedus::fs::DeviceEmulationOptions::null_device_</a></div><div class="ttdeci">bool null_device_</div><div class="ttdoc">[Experiments] as if we write out to /dev/null. </div><div class="ttdef"><b>Definition:</b> <a href="device__emulation__options_8hpp_source.html#l00049">device_emulation_options.hpp:49</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">foedus::kErrorCodeXctRaceAbort</a></div><div class="ttdoc">0x0A05 : "XCTION : Aborted a transaction because of a race condition. This is an expected error in hi...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00200">error_code.hpp:200</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_aee56a2e02a140b766a74d9e9c3088ddb"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#aee56a2e02a140b766a74d9e9c3088ddb">foedus::EngineOptions::log_</a></div><div class="ttdeci">log::LogOptions log_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00138">engine_options.hpp:138</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaae5f98d1b4caace7febc49e59ae5ac56"><div class="ttname"><a href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">foedus::ErrorCode</a></div><div class="ttdeci">ErrorCode</div><div class="ttdoc">Enum of error codes defined in error_code.xmacro. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00085">error_code.hpp:85</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaff9fa4aedd631410da28740f6e1dddbf"><div class="ttname"><a href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf">foedus::assorted::memory_fence_acq_rel</a></div><div class="ttdeci">void memory_fence_acq_rel()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00069">atomic_fences.hpp:69</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9fecc418442394a926c49930cb95cc47" title="Called when the current transaction aborts. " alt="" coords="262,5,449,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#acd49fd67f3459df687ed08d5d8b54082" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch_weak" alt="" coords="248,71,463,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="765,947,916,988"/>
<area shape="rect" id="node5" href="classfoedus_1_1thread_1_1Thread.html#a6f19e6df65000416391b796d9b2f9d66" title="Currently we don&#39;t have sysxct_release_locks() etc. " alt="" coords="277,2206,434,2262"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="545,239,680,280"/>
<area shape="rect" id="node7" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee" title="Returns the private log buffer for this thread. " alt="" coords="279,2287,432,2328"/>
<area shape="rect" id="node8" href="classfoedus_1_1xct_1_1Xct.html#ae5fa3dcdb891b99e5bc7d83ff2029f46" title="foedus::xct::Xct::get\l_write_set" alt="" coords="771,852,910,893"/>
<area shape="rect" id="node9" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="771,1281,910,1323"/>
<area shape="rect" id="node10" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="269,2352,442,2393"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="526,2924,699,2965"/>
<area shape="rect" id="node12" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="258,2089,453,2131"/>
<area shape="rect" id="node33" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896" title="Phase 1 of precommit_xct() " alt="" coords="258,917,453,959"/>
<area shape="rect" id="node48" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b" title="Phase 2 of precommit_xct() for read&#45;write case. " alt="" coords="250,1613,461,1655"/>
<area shape="rect" id="node49" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a58d7c07a52d42d459002bc590421de8a" title="Called when the current transaction is successfully committed. " alt="" coords="262,2417,449,2459"/>
<area shape="rect" id="node50" href="structfoedus_1_1xct_1_1XctId.html#ad18a2d4a528fa063786b6efaf1035377" title="foedus::xct::XctId::set" alt="" coords="281,2483,429,2510"/>
<area shape="rect" id="node13" href="structfoedus_1_1xct_1_1XctId.html#ac151128ff0040de166018da6133f8d85" title="Returns if this XctId is before other in serialization order, meaning this is either an invalid (unus..." alt="" coords="967,2261,1089,2303"/>
<area shape="rect" id="node14" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="1137,2371,1260,2412"/>
<area shape="rect" id="node15" href="structfoedus_1_1xct_1_1XctId.html#a936888dbc82de6e76194b72c28c9a10f" title="foedus::xct::XctId\l::get_ordinal" alt="" coords="1137,2261,1260,2303"/>
<area shape="rect" id="node16" href="structfoedus_1_1xct_1_1XctId.html#a228fb7d60491cf151d36c5576be91a3f" title="foedus::xct::XctId\l::clear_status_bits" alt="" coords="548,2807,677,2848"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1Xct.html#a07b332c0f7f0896ad37dc93373af1cb2" title="Returns the ID of this transaction, but note that it is not issued until commit time! ..." alt="" coords="535,2873,690,2899"/>
<area shape="rect" id="node18" href="classfoedus_1_1xct_1_1Xct.html#a8c4f8c691a326c1f632128d13dea2fa2" title="foedus::xct::Xct::get\l_lock_free_write_set" alt="" coords="543,2024,683,2065"/>
<area shape="rect" id="node19" href="classfoedus_1_1xct_1_1Xct.html#a4dfc3cd9b70a93615c3a0a8014aafbe1" title="foedus::xct::Xct::get\l_lock_free_write_set_size" alt="" coords="527,2089,698,2131"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736" title="Returns the name of the given storage ID. " alt="" coords="531,1675,695,1716"/>
<area shape="rect" id="node21" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="545,1740,680,1781"/>
<area shape="rect" id="node22" href="structfoedus_1_1log_1_1LogHeader.html#a6ebe3b99442f2a58a4adeeb60f9a37e0" title="Convenience method to cast into LogCode. " alt="" coords="763,2624,918,2665"/>
<area shape="rect" id="node23" href="group__LOGTYPE.html#gac46f45db4f1520d51bebbca06d12c623" title="Invokes the apply logic for a record&#45;wise log type. " alt="" coords="548,2624,677,2665"/>
<area shape="rect" id="node24" href="structfoedus_1_1xct_1_1XctId.html#ad5be23a25e650f1bad81ce8c87630af0" title="foedus::xct::XctId\l::is_being_written" alt="" coords="551,1805,674,1847"/>
<area shape="rect" id="node25" href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148" title="foedus::xct::XctId\l::is_deleted" alt="" coords="551,2207,674,2248"/>
<area shape="rect" id="node26" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a610d8c1bfd1d86dcde181c3fb0020f0c" title="foedus::xct::RwLockableXct\lId::is_keylocked" alt="" coords="521,1609,704,1651"/>
<area shape="rect" id="node27" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="535,2390,690,2417"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="537,2324,688,2365"/>
<area shape="rect" id="node30" href="structfoedus_1_1xct_1_1XctId.html#a6f9fc5f612e4aebaa25b78de4e328eaf" title="foedus::xct::XctId\l::set_being_written" alt="" coords="547,2441,678,2483"/>
<area shape="rect" id="node31" href="structfoedus_1_1xct_1_1XctId.html#a4fe6746e50f7bd8ca61c9d141eafc8a2" title="foedus::xct::XctId\l::set_deleted" alt="" coords="551,2507,674,2548"/>
<area shape="rect" id="node32" href="structfoedus_1_1log_1_1LogHeader.html#a27ad88f5e7d7730af696e001ca1425ff" title="Because of the special case of FillerLogType, we must use this method to set xct_id. " alt="" coords="535,2689,690,2731"/>
<area shape="rect" id="node29" href="structfoedus_1_1xct_1_1XctId.html#a2878cd14b103f72c8bce5a330e03e2b2" title="Kind of std::max(this, other). " alt="" coords="779,1820,902,1861"/>
<area shape="rect" id="node34" href="classfoedus_1_1xct_1_1Xct.html#a148038efa6f37e2b89f057c5d5cd4cb3" title="This debug method checks whether the related_read_ and related_write_ fileds in read/write sets are c..." alt="" coords="763,1099,919,1140"/>
<area shape="rect" id="node35" href="classfoedus_1_1xct_1_1CurrentLockList.html#abaacdb674d1296394cff252f995ce001" title="Create entries for all write&#45;sets in one&#45;shot. " alt="" coords="531,502,695,558"/>
<area shape="rect" id="node36" href="classfoedus_1_1thread_1_1Thread.html#a4ff4d49ae69ae490afb0cc09c4c19507" title="Release all locks in CLL of this thread whose addresses are canonically ordered before the parameter..." alt="" coords="521,583,704,624"/>
<area shape="rect" id="node37" href="classfoedus_1_1thread_1_1Thread.html#ab52244fbb6c13b0c0774431af72d482e" title="Methods related to Current Lock List (CLL) These are the only interface in Thread to lock records..." alt="" coords="511,648,715,689"/>
<area shape="rect" id="node38" href="classfoedus_1_1xct_1_1CurrentLockList.html#a75e45c9dd7129e1f202252cf124e76ff" title="foedus::xct::CurrentLock\lList::get_array" alt="" coords="531,713,695,755"/>
<area shape="rect" id="node39" href="classfoedus_1_1xct_1_1Xct.html#afc0b909c82e905105f4f9701082a16b8" title="foedus::xct::Xct::get\l_current_lock_list" alt="" coords="543,779,682,820"/>
<area shape="rect" id="node40" href="classfoedus_1_1thread_1_1Thread.html#a64fa1150b812810a2697bd6293aaac9a" title="foedus::thread::Thread\l::get_engine" alt="" coords="537,1041,688,1083"/>
<area shape="rect" id="node41" href="classfoedus_1_1xct_1_1CurrentLockList.html#ad18887a3fb16dc1ca458892ce4b0b27c" title="foedus::xct::CurrentLock\lList::get_last_locked_entry" alt="" coords="523,1107,702,1148"/>
<area shape="rect" id="node42" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36" title="foedus::xct::RwLockableXct\lId::is_moved" alt="" coords="521,1172,704,1213"/>
<area shape="rect" id="node43" href="structfoedus_1_1xct_1_1RwLockableXctId.html#ac49bd73652693a170f3755c1daf96736" title="foedus::xct::RwLockableXct\lId::is_next_layer" alt="" coords="521,356,704,397"/>
<area shape="rect" id="node44" href="structfoedus_1_1xct_1_1CurrentLockListIteratorForWriteSet.html#afadf5849c06ecc853e53d79783d2459d" title="foedus::xct::CurrentLock\lListIteratorForWriteSet\l::is_valid" alt="" coords="531,422,695,478"/>
<area shape="rect" id="node45" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="521,1441,704,1483"/>
<area shape="rect" id="node46" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ada7782b43556708daa3bb94f7662409a" title="Subroutine of precommit_xct_lock to track most of moved records in write&#45;set. " alt="" coords="515,845,710,901"/>
<area shape="rect" id="node47" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a09e66e6f76cf08131e11a18a44b5d0a4" title="foedus::xct::XctManagerPimpl\l::precommit_xct_sort_access" alt="" coords="515,976,710,1017"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a777caaecec0e7bb19b1cd2841771f755_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="248,5,443,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="491,5,653,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5e8d274897885eab79859a29d6bcd0d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_request_writer_lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1WriteXctAccess.html">WriteXctAccess</a> *&#160;</td>
          <td class="paramname"><em>write</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a09e66e6f76cf08131e11a18a44b5d0a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::precommit_xct_sort_access </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00478">478</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct_8hpp_source.html#l00538">foedus::xct::Xct::assert_related_read_write()</a>, <a class="el" href="xct__access_8hpp_source.html#l00181">foedus::xct::WriteXctAccess::compare()</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct_8hpp_source.html#l00163">foedus::xct::Xct::get_write_set()</a>, <a class="el" href="xct_8hpp_source.html#l00157">foedus::xct::Xct::get_write_set_size()</a>, <a class="el" href="xct__access_8hpp_source.html#l00096">foedus::xct::RecordXctAccess::ordinal_</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00178">foedus::xct::WriteXctAccess::related_read_</a>, and <a class="el" href="xct__access_8hpp_source.html#l00153">foedus::xct::ReadXctAccess::related_write_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00539">precommit_xct_lock()</a>.</p>
<div class="fragment"><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                                                                     {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  WriteXctAccess* write_set = current_xct.get_write_set();</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  uint32_t        write_set_size = current_xct.get_write_set_size();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.assert_related_read_write());</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  std::sort(write_set, write_set + write_set_size, <a class="code" href="structfoedus_1_1xct_1_1WriteXctAccess.html#a4ff6663f61aa1e2ea251c15f16796974">WriteXctAccess::compare</a>);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// after the sorting, the related-link from read-set to write-set is now broken.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">// we fix it by following the back-link from write-set to read-set.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; write_set_size; ++i) {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    WriteXctAccess* entry = write_set + i;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (entry-&gt;related_read_) {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;owner_id_address_ == entry-&gt;related_read_-&gt;owner_id_address_);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;related_read_-&gt;related_write_);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      entry-&gt;related_read_-&gt;related_write_ = entry;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    entry-&gt;ordinal_ = i;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.assert_related_read_write());</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(current_xct.assert_related_read_write());</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">// check that write sets are now sorted.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="comment">// when address is the same, they must be ordered by the order they are created.</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">// eg: repeated overwrites to one record should be applied in the order the user issued.</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 1; i &lt; write_set_size; ++i) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i - 1].ordinal_ != write_set[i].ordinal_);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span> (write_set[i].owner_lock_id_ == write_set[i - 1].owner_lock_id_) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i - 1].ordinal_ &lt; write_set[i].ordinal_);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set[i - 1].owner_lock_id_ &lt; write_set[i].owner_lock_id_);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1xct_1_1WriteXctAccess_html_a4ff6663f61aa1e2ea251c15f16796974"><div class="ttname"><a href="structfoedus_1_1xct_1_1WriteXctAccess.html#a4ff6663f61aa1e2ea251c15f16796974">foedus::xct::WriteXctAccess::compare</a></div><div class="ttdeci">static bool compare(const WriteXctAccess &amp;left, const WriteXctAccess &amp;right) __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="xct__access_8hpp_source.html#l00181">xct_access.hpp:181</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1Xct.html#a148038efa6f37e2b89f057c5d5cd4cb3" title="This debug method checks whether the related_read_ and related_write_ fileds in read/write sets are c..." alt="" coords="263,5,419,47"/>
<area shape="rect" id="node3" href="structfoedus_1_1xct_1_1WriteXctAccess.html#a4ff6663f61aa1e2ea251c15f16796974" title="foedus::xct::WriteXctAccess\l::compare" alt="" coords="248,71,435,112"/>
<area shape="rect" id="node5" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="266,136,417,177"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1Xct.html#ae5fa3dcdb891b99e5bc7d83ff2029f46" title="foedus::xct::Xct::get\l_write_set" alt="" coords="272,201,411,243"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1Xct.html#a674e3ce0252c1c9d2f73edf3b3c4307e" title="foedus::xct::Xct::get\l_write_set_size" alt="" coords="272,267,411,308"/>
<area shape="rect" id="node4" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ab99f8c62595322b828742165a3cbb9d8" title="sort the write set in a unique order. " alt="" coords="483,71,680,112"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a09e66e6f76cf08131e11a18a44b5d0a4_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2376431f079ce60800c9c25d89d74896" title="Phase 1 of precommit_xct() " alt="" coords="248,5,443,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="491,5,685,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="733,5,928,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="976,5,1139,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ada810d8d8e850b393c75d4531e978126"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_try_acquire_writer_locks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab21414e107b53d6276e1d20bc12dce9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_verify_page_version_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns false if there is any page version conflict. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00847">847</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__access_8hpp_source.html#l00076">foedus::xct::PageVersionAccess::address_</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct_8hpp_source.html#l00161">foedus::xct::Xct::get_page_version_set()</a>, <a class="el" href="xct_8hpp_source.html#l00155">foedus::xct::Xct::get_page_version_set_size()</a>, <a class="el" href="xct__access_8hpp_source.html#l00079">foedus::xct::PageVersionAccess::observed_</a>, <a class="el" href="cacheline_8hpp_source.html#l00049">foedus::assorted::prefetch_cacheline()</a>, and <a class="el" href="page_8hpp_source.html#l00172">foedus::storage::PageVersion::status_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00648">precommit_xct_verify_readonly()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00731">precommit_xct_verify_readwrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                                                                 {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keyword">const</span> Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keyword">const</span> PageVersionAccess*  page_version_set = current_xct.get_page_version_set();</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keyword">const</span> uint32_t            page_version_set_size = current_xct.get_page_version_set_size();</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; page_version_set_size; ++i) {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// let&#39;s prefetch address_ in parallel</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">if</span> (i % <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> == 0) {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">for</span> (uint32_t j = i; j &lt; i + <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> &amp;&amp; j &lt; page_version_set_size; ++j) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <a class="code" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">assorted::prefetch_cacheline</a>(page_version_set[j].address_);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keyword">const</span> PageVersionAccess&amp; access = page_version_set[i];</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> (access.address_-&gt;status_ != access.observed_) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      DLOG(WARNING) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; page version is changed by other transaction. will abort&quot;</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="stringliteral">&quot; observed=&quot;</span> &lt;&lt; access.observed_ &lt;&lt; <span class="stringliteral">&quot;, now=&quot;</span> &lt;&lt; access.address_-&gt;status_;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div>
<div class="ttc" id="group__ASSORTED_html_ga354bfce84ebf918859d54ba97b8ddc36"><div class="ttname"><a href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">foedus::assorted::prefetch_cacheline</a></div><div class="ttdeci">void prefetch_cacheline(const void *address)</div><div class="ttdoc">Prefetch one cacheline to L1 cache. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00049">cacheline.hpp:49</a></div></div>
<div class="ttc" id="namespacefoedus_1_1xct_html_a65ecaec821d3ea1425e27112ddbd5a3a"><div class="ttname"><a href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">foedus::xct::kReadsetPrefetchBatch</a></div><div class="ttdeci">const uint16_t kReadsetPrefetchBatch</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00646">xct_manager_pimpl.cpp:646</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="259,5,409,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1Xct.html#a98dcc8bc01ee8a365e68c0742c605d08" title="foedus::xct::Xct::get\l_page_version_set" alt="" coords="265,71,403,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1Xct.html#a67f1a970106386aa9f367195c0a43208" title="foedus::xct::Xct::get\l_page_version_set_size" alt="" coords="254,136,414,177"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="248,201,420,243"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ab21414e107b53d6276e1d20bc12dce9d_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b" title="Phase 2 of precommit_xct() for read&#45;only case. " alt="" coords="249,5,457,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b" title="Phase 2 of precommit_xct() for read&#45;write case. " alt="" coords="248,71,459,112"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855" title="precommit_xct() if the transaction is read&#45;only " alt="" coords="507,5,701,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="749,39,944,80"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="992,39,1155,80"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="507,71,701,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a011f72c9cc830a943b9dccd62d323209"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_verify_pointer_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns false if there is any pointer set conflict. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00828">828</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__access_8hpp_source.html#l00052">foedus::xct::PointerAccess::address_</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct_8hpp_source.html#l00160">foedus::xct::Xct::get_pointer_set()</a>, <a class="el" href="xct_8hpp_source.html#l00154">foedus::xct::Xct::get_pointer_set_size()</a>, <a class="el" href="xct__access_8hpp_source.html#l00055">foedus::xct::PointerAccess::observed_</a>, <a class="el" href="cacheline_8hpp_source.html#l00049">foedus::assorted::prefetch_cacheline()</a>, and <a class="el" href="storage__id_8hpp_source.html#l00195">foedus::storage::VolatilePagePointer::word</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00648">precommit_xct_verify_readonly()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00731">precommit_xct_verify_readwrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                                                                            {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keyword">const</span> Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keyword">const</span> PointerAccess*    pointer_set = current_xct.get_pointer_set();</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keyword">const</span> uint32_t          pointer_set_size = current_xct.get_pointer_set_size();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; pointer_set_size; ++i) {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="comment">// let&#39;s prefetch address_ in parallel</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (i % <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> == 0) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keywordflow">for</span> (uint32_t j = i; j &lt; i + <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> &amp;&amp; j &lt; pointer_set_size; ++j) {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">assorted::prefetch_cacheline</a>(pointer_set[j].address_);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keyword">const</span> PointerAccess&amp; access = pointer_set[i];</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">if</span> (access.address_-&gt;word !=  access.observed_.word) {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      DLOG(WARNING) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; volatile ptr is changed by other transaction. will abort&quot;</span>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div>
<div class="ttc" id="group__ASSORTED_html_ga354bfce84ebf918859d54ba97b8ddc36"><div class="ttname"><a href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">foedus::assorted::prefetch_cacheline</a></div><div class="ttdeci">void prefetch_cacheline(const void *address)</div><div class="ttdoc">Prefetch one cacheline to L1 cache. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00049">cacheline.hpp:49</a></div></div>
<div class="ttc" id="namespacefoedus_1_1xct_html_a65ecaec821d3ea1425e27112ddbd5a3a"><div class="ttname"><a href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">foedus::xct::kReadsetPrefetchBatch</a></div><div class="ttdeci">const uint16_t kReadsetPrefetchBatch</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00646">xct_manager_pimpl.cpp:646</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="287,5,437,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1Xct.html#a91010b6195657c14f3b681da8102163d" title="foedus::xct::Xct::get\l_pointer_set" alt="" coords="293,71,431,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1Xct.html#a6b0f4d5bf1485c376f62e97c6053ea43" title="foedus::xct::Xct::get\l_pointer_set_size" alt="" coords="293,136,431,177"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="276,201,448,243"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a011f72c9cc830a943b9dccd62d323209_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b" title="Phase 2 of precommit_xct() for read&#45;only case. " alt="" coords="277,5,485,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b" title="Phase 2 of precommit_xct() for read&#45;write case. " alt="" coords="276,71,487,112"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855" title="precommit_xct() if the transaction is read&#45;only " alt="" coords="535,5,729,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="777,39,972,80"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1020,39,1183,80"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="535,71,729,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2c3befa16f448a004d548a2b4675a13b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_verify_readonly </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> *&#160;</td>
          <td class="paramname"><em>commit_epoch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Phase 2 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> for read-only case. </p>
<dl class="section return"><dt>Returns</dt><dd>true if verification succeeded. false if we need to abort.</dd></dl>
<p>Verify the observed read set and set the commit epoch to the highest epoch it observed. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00648">648</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="log__manager_8cpp_source.html#l00039">foedus::log::LogManager::get_durable_global_epoch_weak()</a>, <a class="el" href="xct__id_8hpp_source.html#l00964">foedus::xct::XctId::get_epoch()</a>, <a class="el" href="xct_8hpp_source.html#l00164">foedus::xct::Xct::get_lock_free_read_set()</a>, <a class="el" href="xct_8hpp_source.html#l00158">foedus::xct::Xct::get_lock_free_read_set_size()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00060">foedus::storage::StorageManager::get_name()</a>, <a class="el" href="xct_8hpp_source.html#l00162">foedus::xct::Xct::get_read_set()</a>, <a class="el" href="xct_8hpp_source.html#l00156">foedus::xct::Xct::get_read_set_size()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="xct__id_8hpp_source.html#l01038">foedus::xct::XctId::is_being_written()</a>, <a class="el" href="xct__id_8hpp_source.html#l01144">foedus::xct::RwLockableXctId::needs_track_moved()</a>, <a class="el" href="xct__access_8hpp_source.html#l00143">foedus::xct::ReadXctAccess::observed_owner_id_</a>, <a class="el" href="xct__access_8hpp_source.html#l00204">foedus::xct::LockFreeReadXctAccess::observed_owner_id_</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00210">foedus::xct::LockFreeReadXctAccess::owner_id_address_</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00847">precommit_xct_verify_page_version_set()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00828">precommit_xct_verify_pointer_set()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00458">precommit_xct_verify_track_read()</a>, <a class="el" href="cacheline_8hpp_source.html#l00049">foedus::assorted::prefetch_cacheline()</a>, <a class="el" href="xct__access_8hpp_source.html#l00085">foedus::xct::RecordXctAccess::storage_id_</a>, <a class="el" href="epoch_8hpp_source.html#l00165">foedus::Epoch::store_max()</a>, <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>, and <a class="el" href="xct__id_8hpp_source.html#l01137">foedus::xct::RwLockableXctId::xct_id_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00371">precommit_xct_readonly()</a>.</p>
<div class="fragment"><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                                                                              {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  ReadXctAccess*    read_set = current_xct.get_read_set();</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keyword">const</span> uint32_t    read_set_size = current_xct.get_read_set_size();</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  storage::StorageManager* st = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>();</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; read_set_size; ++i) {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(read_set[i].related_write_ == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="comment">// let&#39;s prefetch owner_id in parallel</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> (i % <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> == 0) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">for</span> (uint32_t j = i; j &lt; i + <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> &amp;&amp; j &lt; read_set_size; ++j) {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <a class="code" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">assorted::prefetch_cacheline</a>(read_set[j].owner_id_address_);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    ReadXctAccess&amp; access = read_set[i];</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    DVLOG(2) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot;Verifying &quot;</span> &lt;&lt; st-&gt;get_name(access.storage_id_)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; access.owner_id_address_ &lt;&lt; <span class="stringliteral">&quot;. observed_xid=&quot;</span> &lt;&lt; access.observed_owner_id_</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, now_xid=&quot;</span> &lt;&lt; access.owner_id_address_-&gt;xct_id_;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(access.observed_owner_id_.is_being_written())) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">// safety net. observing this case.</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="comment">// hm, this should be checked and retried during transaction.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="comment">// probably there still is some code to forget that.</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="comment">// At least safe to abort here, so keep it this way for now.</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      DLOG(WARNING) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot;?? this should have been checked. being_written! will abort&quot;</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// Implementation Note: we do verify the versions whether we took a lock on this record or not.</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">// In a sentence, this is the simplest and most reliable while wasted cost is not that much.</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">// In a paragraph.. We could check whether it&#39;s locked, and in \e some case skip verification,</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="comment">// but think of case 1) read A without read-lock, later take a write-lock on A due to RLL.</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// also case 2) read A without read-lock, then read A again but this time with read-lock.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// Yes, we could rule these cases out by checking something for each read/write,</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// but that&#39;s fragile. too much complexity for little. we just verify always. period.</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(access.owner_id_address_-&gt;needs_track_moved())) {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d">precommit_xct_verify_track_read</a>(context, &amp;access)) {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">if</span> (access.observed_owner_id_ != access.owner_id_address_-&gt;xct_id_) {</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      DLOG(WARNING) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; read set changed by other transaction. will abort&quot;</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="comment">// read clobbered</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">// Remembers the highest epoch observed.</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    commit_epoch-&gt;store_max(access.observed_owner_id_.get_epoch());</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// Check lock-free read-set, which is a bit simpler.</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  LockFreeReadXctAccess* lock_free_read_set = current_xct.get_lock_free_read_set();</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keyword">const</span> uint32_t    lock_free_read_set_size = current_xct.get_lock_free_read_set_size();</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; lock_free_read_set_size; ++i) {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keyword">const</span> LockFreeReadXctAccess&amp; access = lock_free_read_set[i];</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!access.owner_id_address_-&gt;needs_track_moved());</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">if</span> (access.observed_owner_id_ != access.owner_id_address_-&gt;xct_id_) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      DLOG(WARNING) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; lock free read set changed by other transaction. will abort&quot;</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    commit_epoch-&gt;store_max(access.observed_owner_id_.get_epoch());</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  }</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot;Read-only higest epoch observed: &quot;</span> &lt;&lt; *commit_epoch;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordflow">if</span> (!commit_epoch-&gt;is_valid()) {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    DVLOG(1) &lt;&lt; *context</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; Read-only higest epoch was empty. The transaction has no read set??&quot;</span>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">// In this case, set already-durable epoch. We don&#39;t have to use atomic version because</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">// it&#39;s just conservatively telling how long it should wait.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    *commit_epoch = Epoch(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#ac152369417a895120dac55370f8a750e">get_durable_global_epoch_weak</a>());</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">// Check Page Pointer/Version</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209">precommit_xct_verify_pointer_set</a>(context)) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d">precommit_xct_verify_page_version_set</a>(context)) {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_ac152369417a895120dac55370f8a750e"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#ac152369417a895120dac55370f8a750e">foedus::log::LogManager::get_durable_global_epoch_weak</a></div><div class="ttdeci">Epoch get_durable_global_epoch_weak() const </div><div class="ttdoc">Non-atomic version of the method. </div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00039">log_manager.cpp:39</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga354bfce84ebf918859d54ba97b8ddc36"><div class="ttname"><a href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">foedus::assorted::prefetch_cacheline</a></div><div class="ttdeci">void prefetch_cacheline(const void *address)</div><div class="ttdoc">Prefetch one cacheline to L1 cache. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00049">cacheline.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a011f72c9cc830a943b9dccd62d323209"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209">foedus::xct::XctManagerPimpl::precommit_xct_verify_pointer_set</a></div><div class="ttdeci">bool precommit_xct_verify_pointer_set(thread::Thread *context)</div><div class="ttdoc">Returns false if there is any pointer set conflict. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00828">xct_manager_pimpl.cpp:828</a></div></div>
<div class="ttc" id="namespacefoedus_1_1xct_html_a65ecaec821d3ea1425e27112ddbd5a3a"><div class="ttname"><a href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">foedus::xct::kReadsetPrefetchBatch</a></div><div class="ttdeci">const uint16_t kReadsetPrefetchBatch</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00646">xct_manager_pimpl.cpp:646</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_ab21414e107b53d6276e1d20bc12dce9d"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d">foedus::xct::XctManagerPimpl::precommit_xct_verify_page_version_set</a></div><div class="ttdeci">bool precommit_xct_verify_page_version_set(thread::Thread *context)</div><div class="ttdoc">Returns false if there is any page version conflict. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00847">xct_manager_pimpl.cpp:847</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9090dd1fa81513f61620b44a9a8bbd1d"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d">foedus::xct::XctManagerPimpl::precommit_xct_verify_track_read</a></div><div class="ttdeci">bool precommit_xct_verify_track_read(thread::Thread *context, ReadXctAccess *entry)</div><div class="ttdoc">used from verification methods to track moved record </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00458">xct_manager_pimpl.cpp:458</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="565,136,716,177"/>
<area shape="rect" id="node3" href="classfoedus_1_1log_1_1LogManager.html#ac152369417a895120dac55370f8a750e" title="Non&#45;atomic version of the method. " alt="" coords="264,328,481,369"/>
<area shape="rect" id="node5" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="311,393,434,435"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1Xct.html#a245cedc62930a99cee57290d24932c56" title="foedus::xct::Xct::get\l_lock_free_read_set" alt="" coords="303,459,442,500"/>
<area shape="rect" id="node8" href="classfoedus_1_1xct_1_1Xct.html#af39a25162bfa65a4cc2dea0d64460cbe" title="foedus::xct::Xct::get\l_lock_free_read_set_size" alt="" coords="288,524,457,565"/>
<area shape="rect" id="node9" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="305,589,440,631"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736" title="Returns the name of the given storage ID. " alt="" coords="291,655,455,696"/>
<area shape="rect" id="node14" href="classfoedus_1_1xct_1_1Xct.html#ae523b00cead387e6addb1366fe08546a" title="foedus::xct::Xct::get\l_read_set" alt="" coords="303,889,442,931"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1Xct.html#af7b9c43800807db798d2e58bc07ad5cd" title="foedus::xct::Xct::get\l_read_set_size" alt="" coords="303,955,442,996"/>
<area shape="rect" id="node16" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="573,707,708,748"/>
<area shape="rect" id="node17" href="structfoedus_1_1xct_1_1XctId.html#ad5be23a25e650f1bad81ce8c87630af0" title="foedus::xct::XctId\l::is_being_written" alt="" coords="311,1020,434,1061"/>
<area shape="rect" id="node18" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="549,984,732,1025"/>
<area shape="rect" id="node20" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d" title="Returns false if there is any page version conflict. " alt="" coords="275,81,470,137"/>
<area shape="rect" id="node23" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="555,201,727,243"/>
<area shape="rect" id="node24" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209" title="Returns false if there is any pointer set conflict. " alt="" coords="261,263,484,304"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d" title="used from verification methods to track moved record " alt="" coords="263,772,483,813"/>
<area shape="rect" id="node49" href="classfoedus_1_1Epoch.html#adf886b8b219538b7dac2da820fbec68c" title="Kind of std::max(this, other). " alt="" coords="285,1086,460,1113"/>
<area shape="rect" id="node4" href="classfoedus_1_1log_1_1LogManagerPimpl.html#a275d6ceca892089d89622fcf866c80d8" title="foedus::log::LogManagerPimpl\l::get_durable_global_epoch_weak" alt="" coords="532,397,749,439"/>
<area shape="rect" id="node6" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="579,463,702,504"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1StorageControlBlock.html#af1f0b118bed183f7daf070409112ca93" title="foedus::storage::Storage\lControlBlock::exists" alt="" coords="1047,604,1211,645"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523" title="Returns the storage of given ID. " alt="" coords="559,641,723,683"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#aea8861d6bf6c13c0df6d0c9777cdaa99" title="foedus::storage::Storage\lManagerPimpl::get_storage" alt="" coords="805,641,987,683"/>
<area shape="rect" id="node19" href="structfoedus_1_1xct_1_1XctId.html#aa17818f701d2c61588f290c3d2cc1330" title="is_moved() || is_next_layer() " alt="" coords="823,984,969,1025"/>
<area shape="rect" id="node21" href="classfoedus_1_1xct_1_1Xct.html#a98dcc8bc01ee8a365e68c0742c605d08" title="foedus::xct::Xct::get\l_page_version_set" alt="" coords="571,71,710,112"/>
<area shape="rect" id="node22" href="classfoedus_1_1xct_1_1Xct.html#a67f1a970106386aa9f367195c0a43208" title="foedus::xct::Xct::get\l_page_version_set_size" alt="" coords="561,5,721,47"/>
<area shape="rect" id="node25" href="classfoedus_1_1xct_1_1Xct.html#a91010b6195657c14f3b681da8102163d" title="foedus::xct::Xct::get\l_pointer_set" alt="" coords="571,267,710,308"/>
<area shape="rect" id="node26" href="classfoedus_1_1xct_1_1Xct.html#a6b0f4d5bf1485c376f62e97c6053ea43" title="foedus::xct::Xct::get\l_pointer_set_size" alt="" coords="571,332,710,373"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076" title="Resolves a &quot;moved&quot; record. " alt="" coords="543,772,739,813"/>
<area shape="rect" id="node42" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="565,838,716,894"/>
<area shape="rect" id="node43" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ace820ba89437e4d3a59fdb47a47525ba" title="Calculate owner_lock_id using the resolver. " alt="" coords="540,919,741,960"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a3248d8440d805f772ad7b6122a4d309b" title="foedus::storage::Storage\lManagerPimpl::track_moved\l_record" alt="" coords="803,718,989,774"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#ab763d5d37f053808257f662611f2e603" title="Resolves a &quot;moved&quot; record. " alt="" coords="1056,675,1203,731"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStorage.html#a2370f71beab1eb4b8b02e3ac9e4f29bd" title="Resolves a &quot;moved&quot; record. " alt="" coords="1043,766,1216,822"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af3a7066a8881f653e759362cf39e01c4" title="foedus::storage::hash\l::HashStoragePimpl::track\l_moved_record" alt="" coords="1273,603,1448,659"/>
<area shape="rect" id="node32" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#ad66913658c856c60c06500b1179db779" title="used only for sanity check. " alt="" coords="1506,603,1694,659"/>
<area shape="rect" id="node33" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36" title="foedus::xct::RwLockableXct\lId::is_moved" alt="" coords="1743,572,1925,613"/>
<area shape="rect" id="node34" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="1517,683,1683,710"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a144ddbe7819e7b3576611d456aa46c77" title="foedus::storage::hash\l::HashStoragePimpl::track\l_moved_record_search" alt="" coords="1513,523,1687,579"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff57df4d2b237e63e459d5fefe9d4cfb" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::track_moved_record" alt="" coords="1274,767,1447,823"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a1a6f55a5a59bcab9631bbb879da689ec" title="foedus::storage::masstree\l::MasstreePage::is_border" alt="" coords="1513,865,1687,907"/>
<area shape="rect" id="node39" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35" title="foedus::storage::masstree\l::MasstreePage::is_moved" alt="" coords="1746,775,1922,816"/>
<area shape="rect" id="node40" href="structfoedus_1_1xct_1_1RwLockableXctId.html#ac49bd73652693a170f3755c1daf96736" title="foedus::xct::RwLockableXct\lId::is_next_layer" alt="" coords="1743,899,1925,940"/>
<area shape="rect" id="node41" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#ab905ff02e9f747f00d44e72ffc16f546" title="foedus::storage::masstree\l::MasstreeBorderPage::track\l_moved_record" alt="" coords="1505,734,1695,790"/>
<area shape="rect" id="node44" href="structfoedus_1_1xct_1_1RecordXctAccess.html#adf2e2a9d414bf5cfe86f33198ebdf434" title="Setter for owner_id_address_/owner_lock_id_. " alt="" coords="797,919,995,960"/>
<area shape="rect" id="node45" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="823,853,969,895"/>
<area shape="rect" id="node46" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="1048,853,1211,895"/>
<area shape="rect" id="node47" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="1264,851,1457,892"/>
<area shape="rect" id="node48" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1280,916,1441,957"/>
<area shape="rect" id="node50" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="563,1086,718,1113"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a2c3befa16f448a004d548a2b4675a13b_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855" title="precommit_xct() if the transaction is read&#45;only " alt="" coords="261,5,456,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="504,5,699,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="747,5,909,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9534e63f498a012d9fa401a10e2b4e0b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_verify_readwrite </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1XctId.html">XctId</a> *&#160;</td>
          <td class="paramname"><em>max_xct_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Phase 2 of <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. ">precommit_xct()</a> for read-write case. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>thread context </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">max_xct_id</td><td>largest xct_id this transaction depends on, or max(all xct_id). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if verification succeeded. false if we need to abort.</dd></dl>
<p>Verify the observed read set and write set against the same record. Because phase 2 is after the memory fence, no thread would take new locks while checking. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00731">731</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>, <a class="el" href="xct_8hpp_source.html#l00164">foedus::xct::Xct::get_lock_free_read_set()</a>, <a class="el" href="xct_8hpp_source.html#l00158">foedus::xct::Xct::get_lock_free_read_set_size()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00060">foedus::storage::StorageManager::get_name()</a>, <a class="el" href="xct_8hpp_source.html#l00162">foedus::xct::Xct::get_read_set()</a>, <a class="el" href="xct_8hpp_source.html#l00156">foedus::xct::Xct::get_read_set_size()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="xct__id_8hpp_source.html#l01038">foedus::xct::XctId::is_being_written()</a>, <a class="el" href="xct__id_8hpp_source.html#l01144">foedus::xct::RwLockableXctId::needs_track_moved()</a>, <a class="el" href="xct__access_8hpp_source.html#l00143">foedus::xct::ReadXctAccess::observed_owner_id_</a>, <a class="el" href="xct__access_8hpp_source.html#l00204">foedus::xct::LockFreeReadXctAccess::observed_owner_id_</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00210">foedus::xct::LockFreeReadXctAccess::owner_id_address_</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00847">precommit_xct_verify_page_version_set()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00828">precommit_xct_verify_pointer_set()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00458">precommit_xct_verify_track_read()</a>, <a class="el" href="cacheline_8hpp_source.html#l00049">foedus::assorted::prefetch_cacheline()</a>, <a class="el" href="xct__access_8hpp_source.html#l00153">foedus::xct::ReadXctAccess::related_write_</a>, <a class="el" href="xct__access_8hpp_source.html#l00085">foedus::xct::RecordXctAccess::storage_id_</a>, <a class="el" href="xct__id_8hpp_source.html#l01059">foedus::xct::XctId::store_max()</a>, <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>, and <a class="el" href="xct__id_8hpp_source.html#l01137">foedus::xct::RwLockableXctId::xct_id_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00384">precommit_xct_readwrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                                                                                             {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  Xct&amp; current_xct = context-&gt;get_current_xct();</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  ReadXctAccess*          read_set = current_xct.get_read_set();</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keyword">const</span> uint32_t          read_set_size = current_xct.get_read_set_size();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; read_set_size; ++i) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">// let&#39;s prefetch owner_id in parallel</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">if</span> (i % <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> == 0) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordflow">for</span> (uint32_t j = i; j &lt; i + <a class="code" href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">kReadsetPrefetchBatch</a> &amp;&amp; j &lt; read_set_size; ++j) {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">if</span> (read_set[j].related_write_ == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <a class="code" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">assorted::prefetch_cacheline</a>(read_set[j].owner_id_address_);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// The owning transaction has changed.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="comment">// We don&#39;t check ordinal here because there is no change we are racing with ourselves.</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    ReadXctAccess&amp; access = read_set[i];</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(access.observed_owner_id_.is_being_written())) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="comment">// same as above.</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      DLOG(WARNING) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot;?? this should have been checked. being_written! will abort&quot;</span>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    storage::StorageManager* st = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>();</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span> (access.related_write_) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// we already checked this in lock()</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      DVLOG(3) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; skipped read-sets that are already checked&quot;</span>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(access.observed_owner_id_ == access.owner_id_address_-&gt;xct_id_);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    DVLOG(2) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; Verifying &quot;</span> &lt;&lt; st-&gt;get_name(access.storage_id_)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; access.owner_id_address_ &lt;&lt; <span class="stringliteral">&quot;. observed_xid=&quot;</span> &lt;&lt; access.observed_owner_id_</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, now_xid=&quot;</span> &lt;&lt; access.owner_id_address_-&gt;xct_id_;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="comment">// As noted in precommit_xct_verify_readonly, we verify read-set whether it&#39;s locked or not.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">// read-set has to also track moved records.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">// however, unlike write-set locks, we don&#39;t have to do retry-loop.</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">// if the rare event (yet another concurrent split) happens, we just abort the transaction.</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(access.owner_id_address_-&gt;needs_track_moved())) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d">precommit_xct_verify_track_read</a>(context, &amp;access)) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    }</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">if</span> (access.observed_owner_id_ != access.owner_id_address_-&gt;xct_id_) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      DVLOG(1) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; read set changed by other transaction. will abort&quot;</span>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="comment">// same as read_only</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">    // Hideaki[2016Feb] I think I remember why I kept this here. When we didn&#39;t have the</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">    // &quot;being_written&quot; flag, we did need it even after splitting XID/TID.</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">    // But, now that we have it in XID, it&#39;s surely safe without this.</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">    // Still.. in case I miss something, I leave it here commented out.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">    // Hideaki: Umm, after several changes, I&#39;m now not sure if we still need this check.</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">    // As far as XID hasn&#39;t changed, do we care whether others locked it or not?</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">    // Thanks to the separation of XID and Lock-word, I think this is now unnecessary.</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">    // If it&#39;s our own lock, we haven&#39;t applied our changes yet, so safe. If it&#39;s other&#39;s lock,</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">    // why do we care as far as XID hasn&#39;nt changed? Everyone updates XID -&gt; unlocks in this order.</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">    // Anyways, we are in the course of a bigger change, so revisit it later.</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">    if (access.owner_id_address_-&gt;is_keylocked()) {</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">      DVLOG(2) &lt;&lt; *context</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">        &lt;&lt; &quot; read set contained a locked record. was it myself who locked it?&quot;;</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">      LockListPosition my_lock_pos = cll-&gt;binary_search(access.owner_id_address_);</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">      if (my_lock_pos != kLockListPositionInvalid &amp;&amp; cll-&gt;get_array()[my_lock_pos].is_locked()) {</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">        DVLOG(2) &lt;&lt; *context &lt;&lt; &quot; okay, myself. go on.&quot;;</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">      } else {</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">        DVLOG(1) &lt;&lt; *context &lt;&lt; &quot; no, not me. will abort&quot;;</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    max_xct_id-&gt;store_max(access.observed_owner_id_);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="comment">// Check Page Pointer/Version</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">// Check lock-free read-set, which is a bit simpler.</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  LockFreeReadXctAccess* lock_free_read_set = current_xct.get_lock_free_read_set();</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keyword">const</span> uint32_t    lock_free_read_set_size = current_xct.get_lock_free_read_set_size();</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; lock_free_read_set_size; ++i) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keyword">const</span> LockFreeReadXctAccess&amp; access = lock_free_read_set[i];</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!access.owner_id_address_-&gt;needs_track_moved());</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">if</span> (access.observed_owner_id_ != access.owner_id_address_-&gt;xct_id_) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      DLOG(WARNING) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; lock free read set changed by other transaction. will abort&quot;</span>;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209">precommit_xct_verify_pointer_set</a>(context)) {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d">precommit_xct_verify_page_version_set</a>(context)) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga354bfce84ebf918859d54ba97b8ddc36"><div class="ttname"><a href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36">foedus::assorted::prefetch_cacheline</a></div><div class="ttdeci">void prefetch_cacheline(const void *address)</div><div class="ttdoc">Prefetch one cacheline to L1 cache. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00049">cacheline.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a011f72c9cc830a943b9dccd62d323209"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209">foedus::xct::XctManagerPimpl::precommit_xct_verify_pointer_set</a></div><div class="ttdeci">bool precommit_xct_verify_pointer_set(thread::Thread *context)</div><div class="ttdoc">Returns false if there is any pointer set conflict. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00828">xct_manager_pimpl.cpp:828</a></div></div>
<div class="ttc" id="namespacefoedus_1_1xct_html_a65ecaec821d3ea1425e27112ddbd5a3a"><div class="ttname"><a href="namespacefoedus_1_1xct.html#a65ecaec821d3ea1425e27112ddbd5a3a">foedus::xct::kReadsetPrefetchBatch</a></div><div class="ttdeci">const uint16_t kReadsetPrefetchBatch</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00646">xct_manager_pimpl.cpp:646</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_ab21414e107b53d6276e1d20bc12dce9d"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d">foedus::xct::XctManagerPimpl::precommit_xct_verify_page_version_set</a></div><div class="ttdeci">bool precommit_xct_verify_page_version_set(thread::Thread *context)</div><div class="ttdoc">Returns false if there is any page version conflict. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00847">xct_manager_pimpl.cpp:847</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9090dd1fa81513f61620b44a9a8bbd1d"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d">foedus::xct::XctManagerPimpl::precommit_xct_verify_track_read</a></div><div class="ttdeci">bool precommit_xct_verify_track_read(thread::Thread *context, ReadXctAccess *entry)</div><div class="ttdoc">used from verification methods to track moved record </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00458">xct_manager_pimpl.cpp:458</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="560,136,711,177"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1Xct.html#a245cedc62930a99cee57290d24932c56" title="foedus::xct::Xct::get\l_lock_free_read_set" alt="" coords="306,329,445,371"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1Xct.html#af39a25162bfa65a4cc2dea0d64460cbe" title="foedus::xct::Xct::get\l_lock_free_read_set_size" alt="" coords="291,395,460,436"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1StorageManager.html#ab3700d71eb463d5b9fae21a2704ea736" title="Returns the name of the given storage ID. " alt="" coords="293,460,457,501"/>
<area shape="rect" id="node9" href="classfoedus_1_1xct_1_1Xct.html#ae523b00cead387e6addb1366fe08546a" title="foedus::xct::Xct::get\l_read_set" alt="" coords="306,695,445,736"/>
<area shape="rect" id="node10" href="classfoedus_1_1xct_1_1Xct.html#af7b9c43800807db798d2e58bc07ad5cd" title="foedus::xct::Xct::get\l_read_set_size" alt="" coords="306,760,445,801"/>
<area shape="rect" id="node11" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="568,515,703,556"/>
<area shape="rect" id="node12" href="structfoedus_1_1xct_1_1XctId.html#ad5be23a25e650f1bad81ce8c87630af0" title="foedus::xct::XctId\l::is_being_written" alt="" coords="314,825,437,867"/>
<area shape="rect" id="node13" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="544,792,727,833"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ab21414e107b53d6276e1d20bc12dce9d" title="Returns false if there is any page version conflict. " alt="" coords="278,82,473,138"/>
<area shape="rect" id="node18" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="549,201,721,243"/>
<area shape="rect" id="node19" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a011f72c9cc830a943b9dccd62d323209" title="Returns false if there is any pointer set conflict. " alt="" coords="264,264,487,305"/>
<area shape="rect" id="node22" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9090dd1fa81513f61620b44a9a8bbd1d" title="used from verification methods to track moved record " alt="" coords="265,577,485,619"/>
<area shape="rect" id="node44" href="structfoedus_1_1xct_1_1XctId.html#a2878cd14b103f72c8bce5a330e03e2b2" title="Kind of std::max(this, other). " alt="" coords="314,900,437,941"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1StorageControlBlock.html#af1f0b118bed183f7daf070409112ca93" title="foedus::storage::Storage\lControlBlock::exists" alt="" coords="1034,464,1198,505"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523" title="Returns the storage of given ID. " alt="" coords="553,397,717,439"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#aea8861d6bf6c13c0df6d0c9777cdaa99" title="foedus::storage::Storage\lManagerPimpl::get_storage" alt="" coords="792,397,973,439"/>
<area shape="rect" id="node14" href="structfoedus_1_1xct_1_1XctId.html#aa17818f701d2c61588f290c3d2cc1330" title="is_moved() || is_next_layer() " alt="" coords="810,792,955,833"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1Xct.html#a98dcc8bc01ee8a365e68c0742c605d08" title="foedus::xct::Xct::get\l_page_version_set" alt="" coords="566,5,705,47"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1Xct.html#a67f1a970106386aa9f367195c0a43208" title="foedus::xct::Xct::get\l_page_version_set_size" alt="" coords="555,71,715,112"/>
<area shape="rect" id="node20" href="classfoedus_1_1xct_1_1Xct.html#a91010b6195657c14f3b681da8102163d" title="foedus::xct::Xct::get\l_pointer_set" alt="" coords="566,267,705,308"/>
<area shape="rect" id="node21" href="classfoedus_1_1xct_1_1Xct.html#a6b0f4d5bf1485c376f62e97c6053ea43" title="foedus::xct::Xct::get\l_pointer_set_size" alt="" coords="566,332,705,373"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076" title="Resolves a &quot;moved&quot; record. " alt="" coords="537,580,733,621"/>
<area shape="rect" id="node37" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="560,646,711,702"/>
<area shape="rect" id="node38" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ace820ba89437e4d3a59fdb47a47525ba" title="Calculate owner_lock_id using the resolver. " alt="" coords="535,727,736,768"/>
<area shape="rect" id="node24" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a3248d8440d805f772ad7b6122a4d309b" title="foedus::storage::Storage\lManagerPimpl::track_moved\l_record" alt="" coords="789,559,976,615"/>
<area shape="rect" id="node25" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#ab763d5d37f053808257f662611f2e603" title="Resolves a &quot;moved&quot; record. " alt="" coords="1043,637,1189,693"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStorage.html#a2370f71beab1eb4b8b02e3ac9e4f29bd" title="Resolves a &quot;moved&quot; record. " alt="" coords="1029,546,1203,602"/>
<area shape="rect" id="node26" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af3a7066a8881f653e759362cf39e01c4" title="foedus::storage::hash\l::HashStoragePimpl::track\l_moved_record" alt="" coords="1260,641,1435,697"/>
<area shape="rect" id="node27" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#ad66913658c856c60c06500b1179db779" title="used only for sanity check. " alt="" coords="1493,786,1681,842"/>
<area shape="rect" id="node28" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36" title="foedus::xct::RwLockableXct\lId::is_moved" alt="" coords="1729,580,1912,621"/>
<area shape="rect" id="node29" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="1504,605,1669,631"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a144ddbe7819e7b3576611d456aa46c77" title="foedus::storage::hash\l::HashStoragePimpl::track\l_moved_record_search" alt="" coords="1499,706,1674,762"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff57df4d2b237e63e459d5fefe9d4cfb" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::track_moved_record" alt="" coords="1261,510,1434,566"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a1a6f55a5a59bcab9631bbb879da689ec" title="foedus::storage::masstree\l::MasstreePage::is_border" alt="" coords="1499,488,1674,529"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35" title="foedus::storage::masstree\l::MasstreePage::is_moved" alt="" coords="1733,383,1909,424"/>
<area shape="rect" id="node35" href="structfoedus_1_1xct_1_1RwLockableXctId.html#ac49bd73652693a170f3755c1daf96736" title="foedus::xct::RwLockableXct\lId::is_next_layer" alt="" coords="1729,497,1912,539"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#ab905ff02e9f747f00d44e72ffc16f546" title="foedus::storage::masstree\l::MasstreeBorderPage::track\l_moved_record" alt="" coords="1492,407,1681,463"/>
<area shape="rect" id="node39" href="structfoedus_1_1xct_1_1RecordXctAccess.html#adf2e2a9d414bf5cfe86f33198ebdf434" title="Setter for owner_id_address_/owner_lock_id_. " alt="" coords="784,661,981,703"/>
<area shape="rect" id="node40" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="810,727,955,768"/>
<area shape="rect" id="node41" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="1035,727,1197,768"/>
<area shape="rect" id="node42" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="1251,724,1444,765"/>
<area shape="rect" id="node43" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1267,789,1428,831"/>
<area shape="rect" id="node45" href="structfoedus_1_1xct_1_1XctId.html#ac151128ff0040de166018da6133f8d85" title="Returns if this XctId is before other in serialization order, meaning this is either an invalid (unus..." alt="" coords="574,909,697,951"/>
<area shape="rect" id="node46" href="classfoedus_1_1Epoch.html#aaef554452ea9ac7b072af98cde1558dc" title="Returns if this epoch is before the given epoch in the sense of distance defined in RFC 1982..." alt="" coords="809,975,957,1002"/>
<area shape="rect" id="node48" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="821,909,944,951"/>
<area shape="rect" id="node49" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="1055,880,1177,921"/>
<area shape="rect" id="node50" href="structfoedus_1_1xct_1_1XctId.html#a936888dbc82de6e76194b72c28c9a10f" title="foedus::xct::XctId\l::get_ordinal" alt="" coords="821,1027,944,1068"/>
<area shape="rect" id="node47" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="1039,975,1193,1002"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a9534e63f498a012d9fa401a10e2b4e0b_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="264,5,459,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="507,5,701,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="749,5,912,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9090dd1fa81513f61620b44a9a8bbd1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::xct::XctManagerPimpl::precommit_xct_verify_track_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1ReadXctAccess.html">ReadXctAccess</a> *&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>used from verification methods to track moved record </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00458">458</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="thread_8cpp_source.html#l00125">foedus::thread::Thread::get_global_volatile_page_resolver()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="xct__id_8hpp_source.html#l01144">foedus::xct::RwLockableXctId::needs_track_moved()</a>, <a class="el" href="xct__id_8hpp_source.html#l01186">foedus::xct::TrackMovedRecordResult::new_owner_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00102">foedus::xct::RecordXctAccess::owner_id_address_</a>, <a class="el" href="xct__access_8hpp_source.html#l00153">foedus::xct::ReadXctAccess::related_write_</a>, <a class="el" href="xct__access_8cpp_source.html#l00093">foedus::xct::RecordXctAccess::set_owner_id_resolve_lock_id()</a>, <a class="el" href="xct__access_8hpp_source.html#l00085">foedus::xct::RecordXctAccess::storage_id_</a>, and <a class="el" href="storage__manager__pimpl_8cpp_source.html#l00445">foedus::storage::StorageManager::track_moved_record()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00648">precommit_xct_verify_readonly()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00731">precommit_xct_verify_readwrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                               {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;owner_id_address_-&gt;needs_track_moved());</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(entry-&gt;related_write_ == <span class="keyword">nullptr</span>);  <span class="comment">// if there is, lock() should have updated it.</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  storage::StorageManager* st = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>();</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  TrackMovedRecordResult result = st-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076">track_moved_record</a>(</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    entry-&gt;storage_id_,</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    entry-&gt;owner_id_address_,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    entry-&gt;related_write_);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (result.new_owner_address_ == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// failed to track down. if entry-&gt;related_write_ is null, this always happens when</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// the record is now in next layer. in this case, retry the whole transaction.</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; resolver = context-&gt;get_global_volatile_page_resolver();</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  entry-&gt;set_owner_id_resolve_lock_id(resolver, result.new_owner_address_);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a02513539acf9d7cd9805d34154281076"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076">foedus::storage::StorageManager::track_moved_record</a></div><div class="ttdeci">xct::TrackMovedRecordResult track_moved_record(StorageId storage_id, xct::RwLockableXctId *old_address, xct::WriteXctAccess *write_set)</div><div class="ttdoc">Resolves a "moved" record. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager__pimpl_8cpp_source.html#l00445">storage_manager_pimpl.cpp:445</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="299,89,449,145"/>
<area shape="rect" id="node3" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="307,169,441,211"/>
<area shape="rect" id="node4" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a36088cc39846c59f78352695f08fcbf9" title="foedus::xct::RwLockableXct\lId::needs_track_moved" alt="" coords="283,235,465,276"/>
<area shape="rect" id="node6" href="structfoedus_1_1xct_1_1RecordXctAccess.html#ace820ba89437e4d3a59fdb47a47525ba" title="Calculate owner_lock_id using the resolver. " alt="" coords="273,300,475,341"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1StorageManager.html#a02513539acf9d7cd9805d34154281076" title="Resolves a &quot;moved&quot; record. " alt="" coords="276,521,472,563"/>
<area shape="rect" id="node5" href="structfoedus_1_1xct_1_1XctId.html#aa17818f701d2c61588f290c3d2cc1330" title="is_moved() || is_next_layer() " alt="" coords="549,201,694,243"/>
<area shape="rect" id="node7" href="structfoedus_1_1xct_1_1RecordXctAccess.html#adf2e2a9d414bf5cfe86f33198ebdf434" title="Setter for owner_id_address_/owner_lock_id_. " alt="" coords="523,267,720,308"/>
<area shape="rect" id="node8" href="namespacefoedus_1_1xct.html#ae36b3307af22f430a8f11765e3e57748" title="foedus::xct::xct_id\l_to_universal_lock_id" alt="" coords="549,332,694,373"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="773,64,936,105"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="989,5,1183,47"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1759,144,1920,185"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a3248d8440d805f772ad7b6122a4d309b" title="foedus::storage::Storage\lManagerPimpl::track_moved\l_record" alt="" coords="528,702,715,758"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1StorageControlBlock.html#af1f0b118bed183f7daf070409112ca93" title="foedus::storage::Storage\lControlBlock::exists" alt="" coords="773,672,937,713"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#ab763d5d37f053808257f662611f2e603" title="Resolves a &quot;moved&quot; record. " alt="" coords="781,738,928,794"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStorage.html#a2370f71beab1eb4b8b02e3ac9e4f29bd" title="Resolves a &quot;moved&quot; record. " alt="" coords="768,1058,941,1114"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af3a7066a8881f653e759362cf39e01c4" title="foedus::storage::hash\l::HashStoragePimpl::track\l_moved_record" alt="" coords="999,738,1173,794"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#ad66913658c856c60c06500b1179db779" title="used only for sanity check. " alt="" coords="1231,158,1419,214"/>
<area shape="rect" id="node20" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36" title="foedus::xct::RwLockableXct\lId::is_moved" alt="" coords="1482,1041,1665,1083"/>
<area shape="rect" id="node22" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="1243,1037,1408,1063"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a144ddbe7819e7b3576611d456aa46c77" title="foedus::storage::hash\l::HashStoragePimpl::track\l_moved_record_search" alt="" coords="1238,618,1413,674"/>
<area shape="rect" id="node18" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="1493,122,1653,149"/>
<area shape="rect" id="node19" href="group__HASH.html#ga8c4ca78e36b2188f1feac100ce7df679" title="Calculates hash value for general input. " alt="" coords="1766,293,1913,335"/>
<area shape="rect" id="node21" href="structfoedus_1_1xct_1_1XctId.html#a41264f4ced33dae443651f57bc09e964" title="foedus::xct::XctId\l::is_moved" alt="" coords="1778,855,1901,896"/>
<area shape="rect" id="node24" href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0" title="Returns the page resolver to convert volatile page ID to page pointer. " alt="" coords="1468,895,1679,951"/>
<area shape="rect" id="node25" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6" title="See Memory Manager. " alt="" coords="1506,976,1641,1017"/>
<area shape="rect" id="node26" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="1727,523,1952,564"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ab696a16e6a995a515736ff0a28b47885" title="same as &amp;get_slot(), but this is more explicit and easier to understand/maintain " alt="" coords="1488,683,1659,739"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="1491,764,1655,805"/>
<area shape="rect" id="node29" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="1493,224,1654,265"/>
<area shape="rect" id="node30" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="1487,829,1660,871"/>
<area shape="rect" id="node31" href="group__ASSORTED.html#ga641117f56315b0f239d72948cf5aa56f" title="Equivalent to std::atomic_thread_fence(std::memory_order_consume). " alt="" coords="1487,289,1660,331"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a6286d91dcdb8b6455e20bc770155a0be" title="foedus::storage::hash\l::HashDataPage::next\l_page_address" alt="" coords="1498,355,1649,411"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07" title="foedus::storage::hash\l::HashDataPage::record\l_from_offset" alt="" coords="1759,603,1920,659"/>
<area shape="rect" id="node34" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f" title="Resolves offset plus NUMA node ID to storage::Page*. " alt="" coords="1472,436,1675,477"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e" title="Search for a physical slot that exactly contains the given key. " alt="" coords="1491,553,1655,609"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff57df4d2b237e63e459d5fefe9d4cfb" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::track_moved_record" alt="" coords="999,1257,1173,1313"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a1a6f55a5a59bcab9631bbb879da689ec" title="foedus::storage::masstree\l::MasstreePage::is_border" alt="" coords="1238,1547,1413,1588"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35" title="foedus::storage::masstree\l::MasstreePage::is_moved" alt="" coords="1485,1428,1661,1469"/>
<area shape="rect" id="node42" href="structfoedus_1_1xct_1_1RwLockableXctId.html#ac49bd73652693a170f3755c1daf96736" title="foedus::xct::RwLockableXct\lId::is_next_layer" alt="" coords="1482,1493,1665,1535"/>
<area shape="rect" id="node44" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#ab905ff02e9f747f00d44e72ffc16f546" title="foedus::storage::masstree\l::MasstreeBorderPage::track\l_moved_record" alt="" coords="1231,1213,1420,1269"/>
<area shape="rect" id="node39" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956" title="foedus::storage::PageHeader\l::get_page_type" alt="" coords="1478,1559,1669,1600"/>
<area shape="rect" id="node41" href="structfoedus_1_1storage_1_1PageVersion.html#a2b63daa9a7f39c8c85bf2d43f4c18d78" title="foedus::storage::PageVersion\l::is_moved" alt="" coords="1743,1457,1935,1499"/>
<area shape="rect" id="node43" href="structfoedus_1_1xct_1_1XctId.html#aa3d33ca4fe97b735ce59594993a1dd94" title="foedus::xct::XctId\l::is_next_layer" alt="" coords="2042,1449,2165,1491"/>
<area shape="rect" id="node45" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#a04113a783c1b0022d35e7e8d7eae02a8" title="foedus::storage::masstree\l::MasstreeBorderPage::does\l_point_to_layer" alt="" coords="1745,1377,1933,1433"/>
<area shape="rect" id="node46" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#a8b7973f3eb0f4f3c6894c278c18d7145" title="foedus::storage::masstree\l::MasstreeBorderPage::get_slot" alt="" coords="2000,1319,2207,1360"/>
<area shape="rect" id="node47" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec" title="physical key count (those keys might be deleted) in this page. " alt="" coords="2255,1201,2461,1243"/>
<area shape="rect" id="node48" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#a6883c1c1e9ef2fb0e6a40d7863f2d85b" title="Navigates a searching key&#45;slice to one of the record in this page. " alt="" coords="1469,1209,1677,1251"/>
<area shape="rect" id="node49" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#a2c1e8415916dbf458aee87572741890f" title="foedus::storage::masstree\l::MasstreeBorderPage::get_record" alt="" coords="1729,1143,1950,1184"/>
<area shape="rect" id="node50" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeBorderPage.html#a42cee2c2a116efdd26420284e95a20f7" title="foedus::storage::masstree\l::MasstreeBorderPage::get_slice" alt="" coords="1733,1260,1945,1301"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a9090dd1fa81513f61620b44a9a8bbd1d_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a2c3befa16f448a004d548a2b4675a13b" title="Phase 2 of precommit_xct() for read&#45;only case. " alt="" coords="275,5,483,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9534e63f498a012d9fa401a10e2b4e0b" title="Phase 2 of precommit_xct() for read&#45;write case. " alt="" coords="273,71,484,112"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#add42c2f0d559eafa1f67fd9c048a4855" title="precommit_xct() if the transaction is read&#45;only " alt="" coords="532,5,727,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="775,39,969,80"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1017,39,1180,80"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="532,71,727,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3c2ee2d08709ff62e77e0dff6eded376"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::release_and_clear_all_current_locks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>unlocking all acquired locks, used when commit/abort. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00997">997</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="retrospective__lock__list_8cpp_source.html#l00096">foedus::xct::CurrentLockList::clear_entries()</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00841">foedus::thread::Thread::cll_release_all_locks()</a>, <a class="el" href="xct_8hpp_source.html#l00413">foedus::xct::Xct::get_current_lock_list()</a>, and <a class="el" href="thread_8cpp_source.html#l00075">foedus::thread::Thread::get_current_xct()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00954">abort_xct()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00343">precommit_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                                                                               {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  context-&gt;cll_release_all_locks();</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  CurrentLockList* cll = context-&gt;get_current_xct().get_current_lock_list();</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  cll-&gt;clear_entries();</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1CurrentLockList.html#abb020fdb3951460f9c283d4700696ad2" title="foedus::xct::CurrentLock\lList::clear_entries" alt="" coords="293,5,457,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1Thread.html#a21bff0861e0c12573bc0a6b776857b76" title="foedus::thread::Thread\l::cll_release_all_locks" alt="" coords="300,123,451,164"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1Xct.html#afc0b909c82e905105f4f9701082a16b8" title="foedus::xct::Xct::get\l_current_lock_list" alt="" coords="760,61,899,103"/>
<area shape="rect" id="node22" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3" title="Returns the transaction that is currently running on this thread. " alt="" coords="300,188,451,229"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a6367855f3aa3549b2d7b74adf383c87a" title="foedus::thread::ThreadPimpl\l::cll_release_all_locks" alt="" coords="505,125,689,167"/>
<area shape="rect" id="node6" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a33a1b8b428cd84029b8b377867197ea4" title="foedus::thread::ThreadPimpl\l::is_simple_mcs_rw" alt="" coords="737,127,921,168"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1CurrentLockList.html#a069941b140019c23d86092e68cd9b331" title="foedus::xct::CurrentLock\lList::release_all_locks" alt="" coords="747,192,911,233"/>
<area shape="rect" id="node8" href="classfoedus_1_1xct_1_1CurrentLockList.html#ace2e6a593d7b975f1756ce9eec0fd1f2" title="Release all locks in CLL whose addresses are canonically ordered before the parameter. " alt="" coords="969,192,1133,233"/>
<area shape="rect" id="node9" href="classfoedus_1_1xct_1_1CurrentLockList.html#aed99dee60f9529d5cfabb5e1742038da" title="foedus::xct::CurrentLock\lList::assert_last_locked_entry" alt="" coords="1605,100,1801,141"/>
<area shape="rect" id="node12" href="classfoedus_1_1xct_1_1CurrentLockList.html#acbed8e324b88389217b42a132e0547b8" title="foedus::xct::CurrentLock\lList::assert_sorted" alt="" coords="1181,159,1345,200"/>
<area shape="rect" id="node20" href="classfoedus_1_1xct_1_1CurrentLockList.html#ae0cbd2f6b369d0340c3222f124fe122b" title="foedus::xct::CurrentLock\lList::begin" alt="" coords="1181,224,1345,265"/>
<area shape="rect" id="node21" href="classfoedus_1_1xct_1_1CurrentLockList.html#ad34e69a6289f0860fe000c3bbecda1cb" title="foedus::xct::CurrentLock\lList::end" alt="" coords="1181,289,1345,331"/>
<area shape="rect" id="node10" href="classfoedus_1_1xct_1_1CurrentLockList.html#a1a668d5dd1b711abed1a9962a8cb4ec1" title="Calculate last_locked_entry_ by really checking the whole list. " alt="" coords="1849,85,2061,127"/>
<area shape="rect" id="node11" href="classfoedus_1_1xct_1_1CurrentLockList.html#a03e818494c4d716f9fc996081f6c419f" title="Only searches among entries at or before &quot;from&quot;. " alt="" coords="2118,78,2294,134"/>
<area shape="rect" id="node13" href="classfoedus_1_1xct_1_1CurrentLockList.html#a7485f0d26810767b3bef18e12233daa7" title="foedus::xct::CurrentLock\lList::assert_sorted_impl" alt="" coords="1393,159,1557,200"/>
<area shape="rect" id="node14" href="namespacefoedus_1_1xct.html#a736225e9852f9c75b92e134dbbe40a68" title="foedus::xct::lock_assert\l_sorted" alt="" coords="1623,195,1784,236"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1Page.html#ac2a6248866335cc84b16bb0530eb76f4" title="foedus::storage::Page\l::get_volatile_page_id" alt="" coords="1881,151,2030,192"/>
<area shape="rect" id="node16" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25" title="super&#45;dirty way to obtain Page the address belongs to. " alt="" coords="1873,217,2038,243"/>
<area shape="rect" id="node17" href="namespacefoedus_1_1xct.html#a94b21516b530d0be271c6005a72009ad" title="foedus::xct::to_universal\l_lock_id" alt="" coords="1874,268,2037,309"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="2109,235,2303,276"/>
<area shape="rect" id="node19" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="2125,300,2287,341"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a3c2ee2d08709ff62e77e0dff6eded376_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a71f565f69929d90febd7beb6b1dca696" title="foedus::xct::XctManagerPimpl\l::abort_xct" alt="" coords="293,12,488,53"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="536,71,731,112"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManager.html#aa176159e8ab007d35ea467226f5d2475" title="Aborts the currently running transaction on the thread. " alt="" coords="552,5,715,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="779,71,941,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9affae9e06ad2324c5857d0dd686995c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::resume_accepting_xct </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Make sure you call this after <a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a19be4bae2114e48eb5c041c29e991983" title="Pause all begin_xct until you call resume_accepting_xct() ">pause_accepting_xct()</a>. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00330">330</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, and <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00090">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager_8cpp_source.html#l00034">foedus::xct::XctManager::resume_accepting_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                           {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">new_transaction_paused_</a>.store(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aba6cb55bfe4729a5cdc4e25237def2fa"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; new_transaction_paused_</div><div class="ttdoc">If true, all new requests to begin_xct() will be paused until this becomes false. ...</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00090">xct_manager_pimpl.hpp:90</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a9affae9e06ad2324c5857d0dd686995c_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a9affae9e06ad2324c5857d0dd686995c_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a9affae9e06ad2324c5857d0dd686995c_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a9affae9e06ad2324c5857d0dd686995c_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#ad1e49dd4bd9a1d87db8bbe2c107d7d98" title="Make sure you call this after pause_accepting_xct(). " alt="" coords="248,39,411,80"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="459,39,685,80"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="733,31,944,87"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="992,5,1203,47"/>
<area shape="rect" id="node7" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="1020,71,1175,112"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1251,5,1445,47"/>
<area shape="rect" id="node8" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1251,71,1445,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a03678427b184e7ce71f9bbb164dd0bad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::set_requested_global_epoch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td>
          <td class="paramname"><em>request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00241">241</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00110">get_requested_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00069">foedus::xct::XctManagerControlBlock::requested_global_epoch_</a>, and <a class="el" href="epoch_8hpp_source.html#l00102">foedus::Epoch::value()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00255">advance_current_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00290">wait_for_commit()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00273">wait_for_current_global_epoch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                                                              {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">// set request value, atomically</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    Epoch already_requested = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4">get_requested_global_epoch</a>();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (already_requested &gt;= request) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="classfoedus_1_1Epoch.html#a62a30a9e703c23a5ef1b0fdaab0c34e1">Epoch::EpochInteger</a> cmp = already_requested.value();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a2739200a83eeb40719000abe38e8084e">requested_global_epoch_</a>.compare_exchange_strong(cmp, request.value())) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a2739200a83eeb40719000abe38e8084e"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a2739200a83eeb40719000abe38e8084e">foedus::xct::XctManagerControlBlock::requested_global_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; requested_global_epoch_</div><div class="ttdoc">If some thread requested to immediately advance epoch, the requested epoch. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00069">xct_manager_pimpl.hpp:69</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a62a30a9e703c23a5ef1b0fdaab0c34e1"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a62a30a9e703c23a5ef1b0fdaab0c34e1">foedus::Epoch::EpochInteger</a></div><div class="ttdeci">uint32_t EpochInteger</div><div class="ttdoc">Unsigned integer representation of epoch. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00064">epoch.hpp:64</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a6071efec3ffc3876192101db2a1873b4"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4">foedus::xct::XctManagerPimpl::get_requested_global_epoch</a></div><div class="ttdeci">Epoch get_requested_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00110">xct_manager_pimpl.hpp:110</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4" title="foedus::xct::XctManagerPimpl\l::get_requested_global_epoch" alt="" coords="248,5,443,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="274,71,417,98"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a03678427b184e7ce71f9bbb164dd0bad_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a925da0bb4b846daa21eb947e4f67b0c6" title="foedus::xct::XctManagerPimpl\l::advance_current_global_epoch" alt="" coords="248,297,455,338"/>
<area shape="rect" id="node30" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a69fb51b2a05a90f46b4658cb984928a0" title="foedus::xct::XctManagerPimpl\l::wait_for_commit" alt="" coords="254,427,449,469"/>
<area shape="rect" id="node32" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#af5cb0928185cf79dda519313f05fe0ee" title="foedus::xct::XctManagerPimpl\l::wait_for_current_global_epoch" alt="" coords="249,362,453,403"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManager.html#aa75089821b48c98a00cd7e4ddc0615da" title="Requests to advance the current global epoch as soon as possible and blocks until it actually does..." alt="" coords="503,297,709,338"/>
<area shape="rect" id="node4" href="classfoedus_1_1log_1_1MetaLogBuffer.html#ab94212c9c14361971679c5581c99e7c3" title="Synchronously writes out the given log to metadata log file. " alt="" coords="769,130,945,171"/>
<area shape="rect" id="node10" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a694a2aaa7515ab45a8c9fa12b709defb" title="Subroutine of collect_retired_volatile_page() in case the chunk becomes full. " alt="" coords="765,231,949,273"/>
<area shape="rect" id="node22" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="757,362,956,403"/>
<area shape="rect" id="node25" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="781,297,932,338"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a9eec079742233abb22d147da7b4fa50a" title="foedus::storage::Storage\lManagerPimpl::create_storage\l_and_log" alt="" coords="1004,85,1203,141"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a252f35e96555817a5eba6ab2e2275d53" title="foedus::storage::Storage\lManagerPimpl::drop_storage" alt="" coords="1009,166,1197,207"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStoragePimpl.html#a8917edb5d2712fba660a33c6cf2fb19f" title="foedus::storage::sequential\l::SequentialStoragePimpl\l::truncate" alt="" coords="1014,5,1193,61"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1StorageManager.html#a2f5e7bd059656ae653d0a326141e76f1" title="Removes the storage object. " alt="" coords="1268,166,1432,207"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStorage.html#a9a4d7e58057f2fb648b7ff9ee6ab7fa0" title="Discards all records in this storage before the given epoch. " alt="" coords="1255,13,1445,54"/>
<area shape="rect" id="node11" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a674a8a8e613dc4e19a626da490c883fc" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1007,231,1199,273"/>
<area shape="rect" id="node12" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1254,231,1446,273"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a31564163126364e4810f2f00398afd15" title="foedus::storage::masstree\l::Adopt::adopt_case_a" alt="" coords="1508,263,1681,305"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a8febde13f90f2b61abf29bf1f4a89e3d" title="foedus::storage::masstree\l::Adopt::adopt_case_b" alt="" coords="1508,329,1681,370"/>
<area shape="rect" id="node16" href="namespacefoedus_1_1storage_1_1masstree.html#a554f6fb34b45687df09df15076aac190" title="foedus::storage::masstree\l::grow_case_a_common" alt="" coords="1508,198,1681,239"/>
<area shape="rect" id="node19" href="namespacefoedus_1_1storage_1_1masstree.html#a9747d159e12f82f5fefcaed735947480" title="foedus::storage::masstree\l::grow_case_b_common" alt="" coords="1508,133,1681,174"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="1508,52,1681,108"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a16f4727fa2ce3b72468618be684af41d" title="Execute the system transaction. " alt="" coords="1751,297,1924,338"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1masstree_1_1GrowFirstLayerRoot.html#a2c3c6cc4a2d74c498cee8f9051d09909" title="Execute the system transaction. " alt="" coords="1751,198,1924,239"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1masstree_1_1GrowNonFirstLayerRoot.html#a9c47822a3dd14ff40020c13d277820ea" title="Execute the system transaction. " alt="" coords="1740,133,1935,174"/>
<area shape="rect" id="node21" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="1751,59,1924,101"/>
<area shape="rect" id="node23" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="1004,362,1203,403"/>
<area shape="rect" id="node24" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1251,362,1449,403"/>
<area shape="rect" id="node26" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="1006,297,1201,338"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="1253,297,1447,338"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="1497,394,1692,435"/>
<area shape="rect" id="node29" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1756,394,1919,435"/>
<area shape="rect" id="node31" href="classfoedus_1_1xct_1_1XctManager.html#a577f44c6f10022d645605d171ef4a781" title="Synchronously blocks until the durable global epoch reaches the given commit epoch or the given durat..." alt="" coords="525,427,687,469"/>
<area shape="rect" id="node33" href="classfoedus_1_1xct_1_1XctManager.html#aa3178a6ce1c815fb88b6c8d5607da5d4" title="Passively wait until the current global epoch becomes the given value. " alt="" coords="504,362,708,403"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8fb6cedfd224c44cac4224877c688672"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::xct::XctManagerPimpl::uninitialize_once </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classfoedus_1_1DefaultInitializable.html#a764be22ce1454279e7a7e78f4c8e380b">foedus::DefaultInitializable</a>.</p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00104">104</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="error__stack__batch_8hpp_source.html#l00083">foedus::ErrorStackBatch::emprace_back()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00077">foedus::xct::XctManagerControlBlock::epoch_chime_terminate_requested_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00231">epoch_chime_thread_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00075">foedus::xct::XctManagerControlBlock::epoch_chime_wakeup_</a>, <a class="el" href="error__stack_8hpp_source.html#l00480">ERROR_STACK</a>, <a class="el" href="engine_8cpp_source.html#l00047">foedus::Engine::get_cache_manager()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00044">foedus::storage::StorageManager::is_initialized()</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="error__code_8hpp_source.html#l00110">foedus::kErrorCodeDepedentModuleUnavailableUninit</a>, <a class="el" href="shared__polling_8cpp_source.html#l00100">foedus::soc::SharedPolling::signal()</a>, <a class="el" href="cache__manager_8cpp_source.html#l00038">foedus::cache::CacheManager::stop_cleaner()</a>, <a class="el" href="error__stack__batch_8hpp_source.html#l00136">SUMMARIZE_ERROR_BATCH</a>, and <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00049">foedus::xct::XctManagerControlBlock::uninitialize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                                              {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Uninitializing XctManager..&quot;</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  ErrorStackBatch batch;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac">is_initialized</a>()) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    batch.emprace_back(<a class="code" href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a3f20fb5c9683a0a7ac634160b380d504">kErrorCodeDepedentModuleUnavailableUninit</a>));</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// See CacheManager&#39;s comments for why we have to stop the cleaner here</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a183f17eb6fccac2010d2e2f7d529fdaf">get_cache_manager</a>()-&gt;<a class="code" href="classfoedus_1_1cache_1_1CacheManager.html#ad3fb77fc199a9556115435bbf7557edc">stop_cleaner</a>());</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>()) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aba3a68b498376e14438a729f0181cfe0">epoch_chime_thread_</a>.joinable()) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a57ade5130d46393c52e5e6f5862f6dc7">epoch_chime_terminate_requested_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa6ae7e0c7ae0e28e419a90af9f6f5ded">epoch_chime_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">signal</a>();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aba3a68b498376e14438a729f0181cfe0">epoch_chime_thread_</a>.join();</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a7a6cb4b32714830a156e8d4b86dce679">uninitialize</a>();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga67390b22b0afbe5a4938df9847eafda9">SUMMARIZE_ERROR_BATCH</a>(batch);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_a183f17eb6fccac2010d2e2f7d529fdaf"><div class="ttname"><a href="classfoedus_1_1Engine.html#a183f17eb6fccac2010d2e2f7d529fdaf">foedus::Engine::get_cache_manager</a></div><div class="ttdeci">cache::CacheManager * get_cache_manager() const </div><div class="ttdoc">See Snapshot Cache Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00047">engine.cpp:47</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa598b0ca7f0de626ecfa17f2cd58d5b4"><div class="ttname"><a href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a></div><div class="ttdeci">#define ERROR_STACK(e)        </div><div class="ttdoc">Instantiates ErrorStack with the given foedus::error_code, creating an error stack with the current f...</div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00480">error_stack.hpp:480</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aa6ae7e0c7ae0e28e419a90af9f6f5ded"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa6ae7e0c7ae0e28e419a90af9f6f5ded">foedus::xct::XctManagerControlBlock::epoch_chime_wakeup_</a></div><div class="ttdeci">soc::SharedPolling epoch_chime_wakeup_</div><div class="ttdoc">Fired to wakeup epoch_chime_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00075">xct_manager_pimpl.hpp:75</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheManager_html_ad3fb77fc199a9556115435bbf7557edc"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheManager.html#ad3fb77fc199a9556115435bbf7557edc">foedus::cache::CacheManager::stop_cleaner</a></div><div class="ttdeci">ErrorStack stop_cleaner()</div><div class="ttdoc">Stops internal eviction thread even before uninitialize() of this object is called. </div><div class="ttdef"><b>Definition:</b> <a href="cache__manager_8cpp_source.html#l00038">cache_manager.cpp:38</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a7a6cb4b32714830a156e8d4b86dce679"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a7a6cb4b32714830a156e8d4b86dce679">foedus::xct::XctManagerControlBlock::uninitialize</a></div><div class="ttdeci">void uninitialize()</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00049">xct_manager_pimpl.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a3a9d5aa09e337f0c997a128b805df8ac"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac">foedus::storage::StorageManager::is_initialized</a></div><div class="ttdeci">bool is_initialized() const  override</div><div class="ttdoc">Returns whether the object has been already initialized or not. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager_8cpp_source.html#l00044">storage_manager.cpp:44</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_aba3a68b498376e14438a729f0181cfe0"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#aba3a68b498376e14438a729f0181cfe0">foedus::xct::XctManagerPimpl::epoch_chime_thread_</a></div><div class="ttdeci">std::thread epoch_chime_thread_</div><div class="ttdoc">This thread keeps advancing the current_global_epoch_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00231">xct_manager_pimpl.hpp:231</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga67390b22b0afbe5a4938df9847eafda9"><div class="ttname"><a href="group__ERRORCODES.html#ga67390b22b0afbe5a4938df9847eafda9">SUMMARIZE_ERROR_BATCH</a></div><div class="ttdeci">#define SUMMARIZE_ERROR_BATCH(x)</div><div class="ttdoc">This macro calls ErrorStackBatch::summarize() with automatically provided parameters. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack__batch_8hpp_source.html#l00136">error_stack_batch.hpp:136</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a3f20fb5c9683a0a7ac634160b380d504"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a3f20fb5c9683a0a7ac634160b380d504">foedus::kErrorCodeDepedentModuleUnavailableUninit</a></div><div class="ttdoc">0x0006 : "GENERAL: A dependent module is already uninitialized. This implies a wrong uninitialization...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00110">error_code.hpp:110</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_a57ade5130d46393c52e5e6f5862f6dc7"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a57ade5130d46393c52e5e6f5862f6dc7">foedus::xct::XctManagerControlBlock::epoch_chime_terminate_requested_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; epoch_chime_terminate_requested_</div><div class="ttdoc">Protected by the mutex in epoch_chime_wakeup_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00077">xct_manager_pimpl.hpp:77</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ae523f3b3bda39c0c81bfb5cb0d5ad626"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">foedus::soc::SharedPolling::signal</a></div><div class="ttdeci">void signal()</div><div class="ttdoc">Signal it to let waiters exit. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00100">shared_polling.cpp:100</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a8fb6cedfd224c44cac4224877c688672_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a8fb6cedfd224c44cac4224877c688672_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a8fb6cedfd224c44cac4224877c688672_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a8fb6cedfd224c44cac4224877c688672_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1ErrorStackBatch.html#a1fe18afaafed459feb5c644ba9d7c56e" title="If the given ErrorStack is an error, this method adds it to the end of this batch. " alt="" coords="267,5,431,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1Engine.html#a183f17eb6fccac2010d2e2f7d529fdaf" title="See Snapshot Cache Manager. " alt="" coords="282,71,417,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="282,136,417,177"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac" title="Returns whether the object has been already initialized or not. " alt="" coords="267,201,431,243"/>
<area shape="rect" id="node7" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="286,267,413,308"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="261,332,438,373"/>
<area shape="rect" id="node11" href="classfoedus_1_1cache_1_1CacheManager.html#ad3fb77fc199a9556115435bbf7557edc" title="Stops internal eviction thread even before uninitialize() of this object is called. " alt="" coords="250,397,449,439"/>
<area shape="rect" id="node13" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#a7a6cb4b32714830a156e8d4b86dce679" title="foedus::xct::XctManagerControl\lBlock::uninitialize" alt="" coords="248,463,451,504"/>
<area shape="rect" id="node6" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="512,201,684,243"/>
<area shape="rect" id="node9" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="511,276,685,317"/>
<area shape="rect" id="node10" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="503,342,693,369"/>
<area shape="rect" id="node12" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a913ee4a71391ff0261b6725ca658925a" title="foedus::cache::CacheManager\lPimpl::stop_cleaner" alt="" coords="499,397,697,439"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a69fb51b2a05a90f46b4658cb984928a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::xct::XctManagerPimpl::wait_for_commit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td>
          <td class="paramname"><em>commit_epoch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>wait_microseconds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00290">290</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">engine_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">get_current_global_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="epoch_8hpp_source.html#l00127">foedus::Epoch::one_more()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00241">set_requested_global_epoch()</a>, <a class="el" href="log__manager_8cpp_source.html#l00046">foedus::log::LogManager::wait_until_durable()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00237">wakeup_epoch_chime_thread()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00071">foedus::xct::XctManager::wait_for_commit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                                                                        {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// to durably commit transactions in commit_epoch, the current global epoch should be</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// commit_epoch + 2 or more. (current-1 is grace epoch. current-2 is the the latest loggable ep)</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  Epoch target_epoch = commit_epoch.one_more().one_more();</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordflow">if</span> (target_epoch &gt; <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>()) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad">set_requested_global_epoch</a>(target_epoch);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7">wakeup_epoch_chime_thread</a>();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#aeadbabd0bc163b2301c3a9260f625f91">wait_until_durable</a>(commit_epoch, wait_microseconds);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_afce787897428bd372c67224acd3e8ea7"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7">foedus::xct::XctManagerPimpl::wakeup_epoch_chime_thread</a></div><div class="ttdeci">void wakeup_epoch_chime_thread()</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00237">xct_manager_pimpl.cpp:237</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a787bb892079cb32d5a2065188825a522"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">foedus::xct::XctManagerPimpl::get_current_global_epoch</a></div><div class="ttdeci">Epoch get_current_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00107">xct_manager_pimpl.hpp:107</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_aeadbabd0bc163b2301c3a9260f625f91"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#aeadbabd0bc163b2301c3a9260f625f91">foedus::log::LogManager::wait_until_durable</a></div><div class="ttdeci">ErrorCode wait_until_durable(Epoch commit_epoch, int64_t wait_microseconds=-1)</div><div class="ttdoc">Synchronously blocks until the durable global epoch reaches the given commit epoch or the given durat...</div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00046">log_manager.cpp:46</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a7a0211510229613b4d7349bf8c373207"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a7a0211510229613b4d7349bf8c373207">foedus::xct::XctManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00224">xct_manager_pimpl.hpp:224</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a03678427b184e7ce71f9bbb164dd0bad"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad">foedus::xct::XctManagerPimpl::set_requested_global_epoch</a></div><div class="ttdeci">void set_requested_global_epoch(Epoch request)</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00241">xct_manager_pimpl.cpp:241</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch" alt="" coords="251,5,446,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="281,71,416,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="263,137,434,163"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad" title="foedus::xct::XctManagerPimpl\l::set_requested_global_epoch" alt="" coords="251,188,446,229"/>
<area shape="rect" id="node8" href="classfoedus_1_1log_1_1LogManager.html#aeadbabd0bc163b2301c3a9260f625f91" title="Synchronously blocks until the durable global epoch reaches the given commit epoch or the given durat..." alt="" coords="267,253,431,295"/>
<area shape="rect" id="node17" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#afce787897428bd372c67224acd3e8ea7" title="foedus::xct::XctManagerPimpl\l::wakeup_epoch_chime_thread" alt="" coords="248,379,449,420"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4" title="foedus::xct::XctManagerPimpl\l::get_requested_global_epoch" alt="" coords="499,131,693,172"/>
<area shape="rect" id="node7" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="525,197,667,223"/>
<area shape="rect" id="node9" href="classfoedus_1_1log_1_1LogManagerPimpl.html#a9835b4e2ce92a8ac46edd153be80a09d" title="foedus::log::LogManagerPimpl\l::wait_until_durable" alt="" coords="497,251,695,292"/>
<area shape="rect" id="node10" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="753,217,930,259"/>
<area shape="rect" id="node12" href="classfoedus_1_1log_1_1LogManagerPimpl.html#a61e44b4b7bb5dfc3d4111bb6bef25ea9" title="foedus::log::LogManagerPimpl\l::get_durable_global_epoch" alt="" coords="743,283,940,324"/>
<area shape="rect" id="node13" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="755,348,928,389"/>
<area shape="rect" id="node14" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="753,87,930,128"/>
<area shape="rect" id="node16" href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3" title="Unconditionally wait for signal. " alt="" coords="753,152,930,193"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="988,337,1161,379"/>
<area shape="rect" id="node15" href="namespacefoedus_1_1soc.html#a875ded688a72b32f8f690f37750e609f" title="foedus::soc::get_now\l_microsec" alt="" coords="1002,87,1147,128"/>
<area shape="rect" id="node18" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="507,407,685,448"/>
<area shape="rect" id="node19" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="746,414,937,441"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_a69fb51b2a05a90f46b4658cb984928a0_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#a577f44c6f10022d645605d171ef4a781" title="Synchronously blocks until the durable global epoch reaches the given commit epoch or the given durat..." alt="" coords="248,5,411,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af5cb0928185cf79dda519313f05fe0ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::wait_for_current_global_epoch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td>
          <td class="paramname"><em>target_epoch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>wait_microseconds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00273">273</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="shared__polling_8cpp_source.html#l00105">foedus::soc::SharedPolling::acquire_ticket()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00072">foedus::xct::XctManagerControlBlock::current_global_epoch_advanced_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">get_current_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00241">set_requested_global_epoch()</a>, <a class="el" href="shared__polling_8cpp_source.html#l00063">foedus::soc::SharedPolling::timedwait()</a>, and <a class="el" href="shared__polling_8cpp_source.html#l00042">foedus::soc::SharedPolling::wait()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager_8cpp_source.html#l00035">foedus::xct::XctManager::wait_for_current_global_epoch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                                                                                 {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="comment">// this method doesn&#39;t aggressively wake up the epoch-advance thread. it just waits.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad">set_requested_global_epoch</a>(target_epoch);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>() &lt; target_epoch) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    uint64_t demand = <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">current_global_epoch_advanced_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">acquire_ticket</a>();</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">get_current_global_epoch</a>() &lt; target_epoch) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keywordflow">if</span> (wait_microseconds &lt; 0) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">current_global_epoch_advanced_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3">wait</a>(demand);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">current_global_epoch_advanced_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">timedwait</a>(demand, wait_microseconds);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_a9fc7bfaf57e1f2224be9869a8e9708d3"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3">foedus::soc::SharedPolling::wait</a></div><div class="ttdeci">void wait(uint64_t demanded_ticket, uint64_t polling_spins=kDefaultPollingSpins, uint64_t max_interval_us=kDefaultPollingMaxIntervalUs) const </div><div class="ttdoc">Unconditionally wait for signal. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00042">shared_polling.cpp:42</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a787bb892079cb32d5a2065188825a522"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522">foedus::xct::XctManagerPimpl::get_current_global_epoch</a></div><div class="ttdeci">Epoch get_current_global_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00107">xct_manager_pimpl.hpp:107</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ac6ad7822e42e2e942b55708b1da8516b"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">foedus::soc::SharedPolling::acquire_ticket</a></div><div class="ttdeci">uint64_t acquire_ticket() const </div><div class="ttdoc">Gives the ticket to. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00105">shared_polling.cpp:105</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a03678427b184e7ce71f9bbb164dd0bad"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad">foedus::xct::XctManagerPimpl::set_requested_global_epoch</a></div><div class="ttdeci">void set_requested_global_epoch(Epoch request)</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8cpp_source.html#l00241">xct_manager_pimpl.cpp:241</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_a1b9f5c8b129c454887a77d3255956157"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">foedus::soc::SharedPolling::timedwait</a></div><div class="ttdeci">bool timedwait(uint64_t demanded_ticket, uint64_t timeout_microsec, uint64_t polling_spins=kDefaultPollingSpins, uint64_t max_interval_us=kDefaultPollingMaxIntervalUs) const </div><div class="ttdoc">Wait for signal up to the given timeout. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00063">shared_polling.cpp:63</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aa4ec58399c28ee96cbc887f23c02434c"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa4ec58399c28ee96cbc887f23c02434c">foedus::xct::XctManagerControlBlock::current_global_epoch_advanced_</a></div><div class="ttdeci">soc::SharedPolling current_global_epoch_advanced_</div><div class="ttdoc">Fired (broadcast) whenever current_global_epoch_ is advanced. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00072">xct_manager_pimpl.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="266,5,443,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a787bb892079cb32d5a2065188825a522" title="foedus::xct::XctManagerPimpl\l::get_current_global_epoch" alt="" coords="257,71,452,112"/>
<area shape="rect" id="node5" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a03678427b184e7ce71f9bbb164dd0bad" title="foedus::xct::XctManagerPimpl\l::set_requested_global_epoch" alt="" coords="257,136,452,177"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="266,201,443,243"/>
<area shape="rect" id="node10" href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3" title="Unconditionally wait for signal. " alt="" coords="266,267,443,308"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="511,5,684,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a6071efec3ffc3876192101db2a1873b4" title="foedus::xct::XctManagerPimpl\l::get_requested_global_epoch" alt="" coords="500,80,695,121"/>
<area shape="rect" id="node7" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="526,146,669,173"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1soc.html#a875ded688a72b32f8f690f37750e609f" title="foedus::soc::get_now\l_microsec" alt="" coords="525,201,670,243"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_af5cb0928185cf79dda519313f05fe0ee_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManager.html#aa3178a6ce1c815fb88b6c8d5607da5d4" title="Passively wait until the current global epoch becomes the given value. " alt="" coords="257,5,461,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="509,5,708,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="756,5,955,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1003,5,1201,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae2552e77d289757f643d7e7d4aa5fcf4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::wait_until_resume_accepting_xct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00334">334</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, and <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00090">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00307">begin_xct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                                                           {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  LOG(INFO) &lt;&lt; *context &lt;&lt; <span class="stringliteral">&quot; realized that new transactions are not accepted now.&quot;</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; waits until it is allowed to start a new transaction&quot;</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">// no complex thing here. just sleep-check. this happens VERY infrequently.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">new_transaction_paused_</a>.load()) {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    std::this_thread::sleep_for(std::chrono::milliseconds(20));</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aba6cb55bfe4729a5cdc4e25237def2fa"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aba6cb55bfe4729a5cdc4e25237def2fa">foedus::xct::XctManagerControlBlock::new_transaction_paused_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; new_transaction_paused_</div><div class="ttdoc">If true, all new requests to begin_xct() will be paused until this becomes false. ...</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00090">xct_manager_pimpl.hpp:90</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_ae2552e77d289757f643d7e7d4aa5fcf4_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_ae2552e77d289757f643d7e7d4aa5fcf4_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_ae2552e77d289757f643d7e7d4aa5fcf4_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_ae2552e77d289757f643d7e7d4aa5fcf4_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad01b60a93f2e107d9c63e7c28799ac1a" title="User transactions related methods. " alt="" coords="276,5,471,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManager.html#a0cd2ffb750756de7132eabf6d6a284ce" title="Begins a new transaction on the thread. " alt="" coords="519,5,681,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afce787897428bd372c67224acd3e8ea7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::xct::XctManagerPimpl::wakeup_epoch_chime_thread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00237">237</a> of file <a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">control_block_</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00075">foedus::xct::XctManagerControlBlock::epoch_chime_wakeup_</a>, and <a class="el" href="shared__polling_8cpp_source.html#l00100">foedus::soc::SharedPolling::signal()</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00255">advance_current_global_epoch()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00290">wait_for_commit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                                {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa6ae7e0c7ae0e28e419a90af9f6f5ded">epoch_chime_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">signal</a>();  <span class="comment">// hurrrrry up!</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctManagerControlBlock_html_aa6ae7e0c7ae0e28e419a90af9f6f5ded"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctManagerControlBlock.html#aa6ae7e0c7ae0e28e419a90af9f6f5ded">foedus::xct::XctManagerControlBlock::epoch_chime_wakeup_</a></div><div class="ttdeci">soc::SharedPolling epoch_chime_wakeup_</div><div class="ttdoc">Fired to wakeup epoch_chime_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00075">xct_manager_pimpl.hpp:75</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManagerPimpl_html_a9b1c83cfdd7fbf596784dbdc3a784381"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9b1c83cfdd7fbf596784dbdc3a784381">foedus::xct::XctManagerPimpl::control_block_</a></div><div class="ttdeci">XctManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="xct__manager__pimpl_8hpp_source.html#l00225">xct_manager_pimpl.hpp:225</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ae523f3b3bda39c0c81bfb5cb0d5ad626"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">foedus::soc::SharedPolling::signal</a></div><div class="ttdeci">void signal()</div><div class="ttdoc">Signal it to let waiters exit. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00100">shared_polling.cpp:100</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_cgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_cgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_cgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="255,35,432,76"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="489,5,662,47"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="480,71,671,98"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_icgraph.png" border="0" usemap="#classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_icgraph" alt=""/></div>
<map name="classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_icgraph" id="classfoedus_1_1xct_1_1XctManagerPimpl_afce787897428bd372c67224acd3e8ea7_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a925da0bb4b846daa21eb947e4f67b0c6" title="foedus::xct::XctManagerPimpl\l::advance_current_global_epoch" alt="" coords="255,266,461,307"/>
<area shape="rect" id="node30" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a69fb51b2a05a90f46b4658cb984928a0" title="foedus::xct::XctManagerPimpl\l::wait_for_commit" alt="" coords="261,331,455,373"/>
<area shape="rect" id="node3" href="classfoedus_1_1xct_1_1XctManager.html#aa75089821b48c98a00cd7e4ddc0615da" title="Requests to advance the current global epoch as soon as possible and blocks until it actually does..." alt="" coords="509,266,716,307"/>
<area shape="rect" id="node4" href="classfoedus_1_1log_1_1MetaLogBuffer.html#ab94212c9c14361971679c5581c99e7c3" title="Synchronously writes out the given log to metadata log file. " alt="" coords="775,123,951,165"/>
<area shape="rect" id="node10" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a694a2aaa7515ab45a8c9fa12b709defb" title="Subroutine of collect_retired_volatile_page() in case the chunk becomes full. " alt="" coords="771,233,955,274"/>
<area shape="rect" id="node22" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="764,298,963,339"/>
<area shape="rect" id="node25" href="classfoedus_1_1xct_1_1Xct.html#a208310505c3d16cf2dc10f94f968d4a4" title="Called while a successful commit of xct to issue a new xct id. " alt="" coords="788,363,939,405"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a9eec079742233abb22d147da7b4fa50a" title="foedus::storage::Storage\lManagerPimpl::create_storage\l_and_log" alt="" coords="1011,5,1209,61"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a252f35e96555817a5eba6ab2e2275d53" title="foedus::storage::Storage\lManagerPimpl::drop_storage" alt="" coords="1016,86,1204,127"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStoragePimpl.html#a8917edb5d2712fba660a33c6cf2fb19f" title="foedus::storage::sequential\l::SequentialStoragePimpl\l::truncate" alt="" coords="1021,152,1199,208"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1StorageManager.html#a2f5e7bd059656ae653d0a326141e76f1" title="Removes the storage object. " alt="" coords="1275,86,1439,127"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1sequential_1_1SequentialStorage.html#a9a4d7e58057f2fb648b7ff9ee6ab7fa0" title="Discards all records in this storage before the given epoch. " alt="" coords="1261,159,1452,201"/>
<area shape="rect" id="node11" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a674a8a8e613dc4e19a626da490c883fc" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1014,233,1206,274"/>
<area shape="rect" id="node12" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="1261,229,1453,270"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a31564163126364e4810f2f00398afd15" title="foedus::storage::masstree\l::Adopt::adopt_case_a" alt="" coords="1515,167,1688,209"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a8febde13f90f2b61abf29bf1f4a89e3d" title="foedus::storage::masstree\l::Adopt::adopt_case_b" alt="" coords="1515,102,1688,143"/>
<area shape="rect" id="node16" href="namespacefoedus_1_1storage_1_1masstree.html#a554f6fb34b45687df09df15076aac190" title="foedus::storage::masstree\l::grow_case_a_common" alt="" coords="1515,298,1688,339"/>
<area shape="rect" id="node19" href="namespacefoedus_1_1storage_1_1masstree.html#a9747d159e12f82f5fefcaed735947480" title="foedus::storage::masstree\l::grow_case_b_common" alt="" coords="1515,233,1688,274"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="1515,21,1688,77"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1masstree_1_1Adopt.html#a16f4727fa2ce3b72468618be684af41d" title="Execute the system transaction. " alt="" coords="1757,135,1931,177"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1masstree_1_1GrowFirstLayerRoot.html#a2c3c6cc4a2d74c498cee8f9051d09909" title="Execute the system transaction. " alt="" coords="1757,298,1931,339"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1masstree_1_1GrowNonFirstLayerRoot.html#a9c47822a3dd14ff40020c13d277820ea" title="Execute the system transaction. " alt="" coords="1747,233,1941,274"/>
<area shape="rect" id="node21" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="1757,29,1931,70"/>
<area shape="rect" id="node23" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="1011,298,1209,339"/>
<area shape="rect" id="node24" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1257,298,1456,339"/>
<area shape="rect" id="node26" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#ad91daff37c2b78b8c6620d67869e9d7f" title="Phase 3 of precommit_xct() " alt="" coords="1013,363,1207,405"/>
<area shape="rect" id="node27" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a777caaecec0e7bb19b1cd2841771f755" title="precommit_xct() if the transaction is read&#45;write " alt="" coords="1259,363,1454,405"/>
<area shape="rect" id="node28" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a014506b605e14b3df1b1b7522e8a23b2" title="This is the gut of commit protocol. " alt="" coords="1504,363,1699,405"/>
<area shape="rect" id="node29" href="classfoedus_1_1xct_1_1XctManager.html#a486c653445cb64cc9514af3f1031bdf0" title="Prepares the currently running transaction on the thread for commit. " alt="" coords="1763,363,1925,405"/>
<area shape="rect" id="node31" href="classfoedus_1_1xct_1_1XctManager.html#a577f44c6f10022d645605d171ef4a781" title="Synchronously blocks until the durable global epoch reaches the given commit epoch or the given durat..." alt="" coords="531,331,694,373"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a9b1c83cfdd7fbf596784dbdc3a784381"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfoedus_1_1xct_1_1XctManagerControlBlock.html">XctManagerControlBlock</a>* foedus::xct::XctManagerPimpl::control_block_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00225">225</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00255">advance_current_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00307">begin_xct()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00107">get_current_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00113">get_current_global_epoch_weak()</a>, <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00110">get_requested_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">handle_epoch_chime()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00084">initialize_once()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00125">is_stop_requested()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00327">pause_accepting_xct()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00330">resume_accepting_xct()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00241">set_requested_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00104">uninitialize_once()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00273">wait_for_current_global_epoch()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00334">wait_until_resume_accepting_xct()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00237">wakeup_epoch_chime_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a7a0211510229613b4d7349bf8c373207"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1Engine.html">Engine</a>* const foedus::xct::XctManagerPimpl::engine_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00224">224</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00135">handle_epoch_chime()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00186">handle_epoch_chime_wait_grace_period()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00084">initialize_once()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00125">is_stop_requested()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00868">precommit_xct_apply()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00432">precommit_xct_lock_track_write()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00384">precommit_xct_readwrite()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00648">precommit_xct_verify_readonly()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00731">precommit_xct_verify_readwrite()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00458">precommit_xct_verify_track_read()</a>, <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00104">uninitialize_once()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00290">wait_for_commit()</a>.</p>

</div>
</div>
<a class="anchor" id="aba3a68b498376e14438a729f0181cfe0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::thread foedus::xct::XctManagerPimpl::epoch_chime_thread_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This thread keeps advancing the current_global_epoch_. </p>
<p>Launched only in master engine. </p>

<p>Definition at line <a class="el" href="xct__manager__pimpl_8hpp_source.html#l00231">231</a> of file <a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00084">initialize_once()</a>, and <a class="el" href="xct__manager__pimpl_8cpp_source.html#l00104">uninitialize_once()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/xct/<a class="el" href="xct__manager__pimpl_8hpp_source.html">xct_manager_pimpl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/xct/<a class="el" href="xct__manager__pimpl_8cpp_source.html">xct_manager_pimpl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1xct.html">xct</a></li><li class="navelem"><a class="el" href="classfoedus_1_1xct_1_1XctManagerPimpl.html">XctManagerPimpl</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
