<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::storage::hash::ReserveRecords Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::storage::hash::ReserveRecords Struct Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__STORAGE.html">Storage Manager</a> &raquo; <a class="el" href="group__HASH.html">Hashtable Storage</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A system transaction to reserve a physical record(s) in a hash data page.  
 <a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A system transaction to reserve a physical record(s) in a hash data page. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__SYSXCT.html">Physical-only, short-living system transactions.</a></dd></dl>
<p>A record insertion happens in two steps: </p><ul>
<li>During Execution: Physically inserts a deleted record for the key in the data page. </li>
<li>During Commit: Logically flips the delete-bit and installs the payload.</li>
</ul>
<p>This system transaction does the former.</p>
<p>This does nothing and returns kErrorCodeOk in the following cases: </p><ul>
<li>The page turns out to already contain a satisfying physical record for the key.</li>
</ul>
<p>In all other cases, this sysxct creates or finds the record. In other words, this sysxct guarantees a success as far as it returns kErrorCodeOk.</p>
<p>Locks taken in this sysxct (in order of taking): </p><ul>
<li>Page-lock of the target or the tail page if target_ is not the tail (in the order of the chain, so no deadlock). </li>
<li>Record-lock of an existing, matching record. Only when we have to expand the record. This also happens after the page-lock of the enclosing page, before the page-lock of following pages, so every lock is in order.</li>
</ul>
<p>Note, however, that it might not be in address order (address order might be tail -&gt; head). We thus might have a false deadlock-abort. However, as far as the first lock on the target_ page is unconditional, all locks after that should be non-racy, so all try-lock should succeed. We might want to specify a bit larger max_retries (5?) for this reason.</p>
<dl class="section user"><dt>Differences from Masstree's reserve</dt><dd>This sysxct is simpler than <a class="el" href="structfoedus_1_1storage_1_1masstree_1_1ReserveRecords.html" title="A system transaction to reserve a physical record(s) in a border page. ">masstree::ReserveRecords</a> for a few reasons. <ul>
<li>No need to split the page </li>
<li>No need to adopt a split page</li>
</ul>
We thus contain all required logics (reserve/expansion/migrate) in this sysxct. In all circumstances, this sysxct finds or reserves the required record. Simpler for the caller.</dd></dl>
<p>So far this sysxct installs only one physical record at a time. TASK(Hideaki): Probably it helps by batching several records. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00073">73</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for foedus::storage::hash::ReserveRecords:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords__inherit__graph.png" border="0" usemap="#foedus_1_1storage_1_1hash_1_1ReserveRecords_inherit__map" alt="Inheritance graph"/></div>
<map name="foedus_1_1storage_1_1hash_1_1ReserveRecords_inherit__map" id="foedus_1_1storage_1_1hash_1_1ReserveRecords_inherit__map">
<area shape="rect" id="node2" href="structfoedus_1_1xct_1_1SysxctFunctor.html" title="A functor representing the logic in a system transaction via virtual&#45;function. " alt="" coords="5,5,184,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for foedus::storage::hash::ReserveRecords:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords__coll__graph.png" border="0" usemap="#foedus_1_1storage_1_1hash_1_1ReserveRecords_coll__map" alt="Collaboration graph"/></div>
<map name="foedus_1_1storage_1_1hash_1_1ReserveRecords_coll__map" id="foedus_1_1storage_1_1hash_1_1ReserveRecords_coll__map">
<area shape="rect" id="node2" href="structfoedus_1_1xct_1_1SysxctFunctor.html" title="A functor representing the logic in a system transaction via virtual&#45;function. " alt="" coords="279,5,457,32"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html" title="Represents an individual data page in Hashtable Storage. " alt="" coords="295,57,441,98"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1Thread.html" title="Represents one thread running on one NUMA core. " alt="" coords="293,123,443,149"/>
<area shape="rect" id="node5" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="18,123,150,149"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html" title="A set of information that are used in many places, extracted from the given key. " alt="" coords="295,174,441,215"/>
<area shape="rect" id="node7" href="unionfoedus_1_1storage_1_1hash_1_1IntermediateRoute.html" title="Compactly represents the route of intermediate pages to reach the given hash bin. ..." alt="" coords="11,174,157,215"/>
<area shape="rect" id="node8" href="structfoedus_1_1storage_1_1hash_1_1BloomFilterFingerprint.html" title="A fingerprint for bloom filter in each HashDataPage. " alt="" coords="5,239,163,281"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a96e02b06756aadd6e1e2909201344725"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a96e02b06756aadd6e1e2909201344725">ReserveRecords</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *target, const void *key, <a class="el" href="group__HASH.html#ga80072e9a1d445f90ee2bd91a16a44267">KeyLength</a> key_length, const <a class="el" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a> &amp;combo, <a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a> payload_count, <a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a> aggressive_payload_count_hint, <a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> hint_check_from)</td></tr>
<tr class="separator:a96e02b06756aadd6e1e2909201344725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e1a17602380cbf9c736d93591a84f5e"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e">run</a> (<a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *sysxct_workspace) override</td></tr>
<tr class="memdesc:a7e1a17602380cbf9c736d93591a84f5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute the system transaction.  <a href="#a7e1a17602380cbf9c736d93591a84f5e">More...</a><br /></td></tr>
<tr class="separator:a7e1a17602380cbf9c736d93591a84f5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad189e0523907caacae334102d9383b15"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15">find_or_create_or_expand</a> (<a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *sysxct_workspace, <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *page, <a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> examined_records)</td></tr>
<tr class="memdesc:ad189e0523907caacae334102d9383b15"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main loop (well, recursion actually).  <a href="#ad189e0523907caacae334102d9383b15">More...</a><br /></td></tr>
<tr class="separator:ad189e0523907caacae334102d9383b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a846dcb3f3938a2b266756e2d95c0df76"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76">expand_record</a> (<a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *sysxct_workspace, <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *page, <a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> index)</td></tr>
<tr class="separator:a846dcb3f3938a2b266756e2d95c0df76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a68802f41a8b163aae60825c4ebd38"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ab6a68802f41a8b163aae60825c4ebd38">find_and_lock_spacious_tail</a> (<a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *sysxct_workspace, <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *from_page, <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> **tail)</td></tr>
<tr class="separator:ab6a68802f41a8b163aae60825c4ebd38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc93c206465207018eb9e29a5fa5342b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acc93c206465207018eb9e29a5fa5342b">create_new_record_in_tail_page</a> (<a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *tail)</td></tr>
<tr class="memdesc:acc93c206465207018eb9e29a5fa5342b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Installs it as a fresh-new physical record, assuming the given page is the tail and already locked.  <a href="#acc93c206465207018eb9e29a5fa5342b">More...</a><br /></td></tr>
<tr class="separator:acc93c206465207018eb9e29a5fa5342b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22cd4e9f8619968685921c525d6fa4b8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8">create_new_tail_page</a> (<a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *cur_tail, <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> **new_tail)</td></tr>
<tr class="separator:a22cd4e9f8619968685921c525d6fa4b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0947f74956ac95cf143ff61f6493dcc4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a0947f74956ac95cf143ff61f6493dcc4">search_within_page</a> (const <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *page, <a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> key_count, <a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> examined_records) const </td></tr>
<tr class="separator:a0947f74956ac95cf143ff61f6493dcc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a958308b83b377f31e6b01b39979e23b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2">append_record_to_page</a> (<a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *page, <a class="el" href="structfoedus_1_1xct_1_1XctId.html">xct::XctId</a> initial_xid) const </td></tr>
<tr class="memdesc:a958308b83b377f31e6b01b39979e23b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Appends a new physical record to the page.  <a href="#a958308b83b377f31e6b01b39979e23b2">More...</a><br /></td></tr>
<tr class="separator:a958308b83b377f31e6b01b39979e23b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:aac7ca8e18b21379d89a60450c41fbdb3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a></td></tr>
<tr class="memdesc:aac7ca8e18b21379d89a60450c41fbdb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread context.  <a href="#aac7ca8e18b21379d89a60450c41fbdb3">More...</a><br /></td></tr>
<tr class="separator:aac7ca8e18b21379d89a60450c41fbdb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdbcbeccc292c431d3dc6d76948b597f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acdbcbeccc292c431d3dc6d76948b597f">target_</a></td></tr>
<tr class="memdesc:acdbcbeccc292c431d3dc6d76948b597f"><td class="mdescLeft">&#160;</td><td class="mdescRight">The data page to install a new physical record.  <a href="#acdbcbeccc292c431d3dc6d76948b597f">More...</a><br /></td></tr>
<tr class="separator:acdbcbeccc292c431d3dc6d76948b597f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a313e539df6d2141feee95e34811cb3e2"><td class="memItemLeft" align="right" valign="top">const void *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a313e539df6d2141feee95e34811cb3e2">key_</a></td></tr>
<tr class="memdesc:a313e539df6d2141feee95e34811cb3e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">The key of the new record.  <a href="#a313e539df6d2141feee95e34811cb3e2">More...</a><br /></td></tr>
<tr class="separator:a313e539df6d2141feee95e34811cb3e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cb9976c1cdec59a897a4e757fe0a0d4"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">combo_</a></td></tr>
<tr class="memdesc:a1cb9976c1cdec59a897a4e757fe0a0d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hash info of the key.  <a href="#a1cb9976c1cdec59a897a4e757fe0a0d4">More...</a><br /></td></tr>
<tr class="separator:a1cb9976c1cdec59a897a4e757fe0a0d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92629528d23870897ae37aeff4dc4b8b"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="group__HASH.html#ga80072e9a1d445f90ee2bd91a16a44267">KeyLength</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a></td></tr>
<tr class="memdesc:a92629528d23870897ae37aeff4dc4b8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Byte length of the key.  <a href="#a92629528d23870897ae37aeff4dc4b8b">More...</a><br /></td></tr>
<tr class="separator:a92629528d23870897ae37aeff4dc4b8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a972e277f807b48c13caa20aa32d20721"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">payload_count_</a></td></tr>
<tr class="memdesc:a972e277f807b48c13caa20aa32d20721"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimal required length of the payload.  <a href="#a972e277f807b48c13caa20aa32d20721">More...</a><br /></td></tr>
<tr class="separator:a972e277f807b48c13caa20aa32d20721"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd97205289303877be35fa02b41ca235"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">aggressive_payload_count_hint_</a></td></tr>
<tr class="memdesc:acd97205289303877be35fa02b41ca235"><td class="mdescLeft">&#160;</td><td class="mdescRight">When we expand the record or allocate a new record, we might allocate a larger-than-necessary space guided by this hint.  <a href="#acd97205289303877be35fa02b41ca235">More...</a><br /></td></tr>
<tr class="separator:acd97205289303877be35fa02b41ca235"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa13c8c6d82babdbbd970634b33179bb4"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aa13c8c6d82babdbbd970634b33179bb4">hint_check_from_</a></td></tr>
<tr class="memdesc:aa13c8c6d82babdbbd970634b33179bb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">The in-page location from which this sysxct will look for matching records.  <a href="#aa13c8c6d82babdbbd970634b33179bb4">More...</a><br /></td></tr>
<tr class="separator:aa13c8c6d82babdbbd970634b33179bb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad34d7b80062bae0e2a0cb703109d848c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a></td></tr>
<tr class="memdesc:ad34d7b80062bae0e2a0cb703109d848c"><td class="mdescLeft">&#160;</td><td class="mdescRight">[Out] The slot of the record that is found or created.  <a href="#ad34d7b80062bae0e2a0cb703109d848c">More...</a><br /></td></tr>
<tr class="separator:ad34d7b80062bae0e2a0cb703109d848c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad95de6d2f7cbec7e2d08f758d5165166"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">out_page_</a></td></tr>
<tr class="memdesc:ad95de6d2f7cbec7e2d08f758d5165166"><td class="mdescLeft">&#160;</td><td class="mdescRight">[Out] The page that contains the found/created record.  <a href="#ad95de6d2f7cbec7e2d08f758d5165166">More...</a><br /></td></tr>
<tr class="separator:ad95de6d2f7cbec7e2d08f758d5165166"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a96e02b06756aadd6e1e2909201344725"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::storage::hash::ReserveRecords::ReserveRecords </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__HASH.html#ga80072e9a1d445f90ee2bd91a16a44267">KeyLength</a>&#160;</td>
          <td class="paramname"><em>key_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a> &amp;&#160;</td>
          <td class="paramname"><em>combo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a>&#160;</td>
          <td class="paramname"><em>payload_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a>&#160;</td>
          <td class="paramname"><em>aggressive_payload_count_hint</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td>
          <td class="paramname"><em>hint_check_from</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00142">142</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    : xct::SysxctFunctor(),</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>(context),</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acdbcbeccc292c431d3dc6d76948b597f">target_</a>(target),</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a313e539df6d2141feee95e34811cb3e2">key_</a>(key),</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">combo_</a>(combo),</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>(key_length),</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">payload_count_</a>(payload_count),</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">aggressive_payload_count_hint_</a>(aggressive_payload_count_hint),</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aa13c8c6d82babdbbd970634b33179bb4">hint_check_from_</a>(hint_check_from),</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a>(<a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>),</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">out_page_</a>(<span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  }</div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acdbcbeccc292c431d3dc6d76948b597f"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acdbcbeccc292c431d3dc6d76948b597f">foedus::storage::hash::ReserveRecords::target_</a></div><div class="ttdeci">HashDataPage *const target_</div><div class="ttdoc">The data page to install a new physical record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00095">hash_reserve_impl.hpp:95</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad34d7b80062bae0e2a0cb703109d848c"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">foedus::storage::hash::ReserveRecords::out_slot_</a></div><div class="ttdeci">DataPageSlotIndex out_slot_</div><div class="ttdoc">[Out] The slot of the record that is found or created. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00133">hash_reserve_impl.hpp:133</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a972e277f807b48c13caa20aa32d20721"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">foedus::storage::hash::ReserveRecords::payload_count_</a></div><div class="ttdeci">const PayloadLength payload_count_</div><div class="ttdoc">Minimal required length of the payload. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00106">hash_reserve_impl.hpp:106</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1hash_html_a33cdddb3771cf2fdc3e65465792b6c96"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">foedus::storage::hash::kSlotNotFound</a></div><div class="ttdeci">const DataPageSlotIndex kSlotNotFound</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00197">hash_id.hpp:197</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad95de6d2f7cbec7e2d08f758d5165166"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">foedus::storage::hash::ReserveRecords::out_page_</a></div><div class="ttdeci">HashDataPage * out_page_</div><div class="ttdoc">[Out] The page that contains the found/created record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00140">hash_reserve_impl.hpp:140</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a313e539df6d2141feee95e34811cb3e2"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a313e539df6d2141feee95e34811cb3e2">foedus::storage::hash::ReserveRecords::key_</a></div><div class="ttdeci">const void *const key_</div><div class="ttdoc">The key of the new record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00097">hash_reserve_impl.hpp:97</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a92629528d23870897ae37aeff4dc4b8b"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">foedus::storage::hash::ReserveRecords::key_length_</a></div><div class="ttdeci">const KeyLength key_length_</div><div class="ttdoc">Byte length of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00104">hash_reserve_impl.hpp:104</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_aa13c8c6d82babdbbd970634b33179bb4"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aa13c8c6d82babdbbd970634b33179bb4">foedus::storage::hash::ReserveRecords::hint_check_from_</a></div><div class="ttdeci">const DataPageSlotIndex hint_check_from_</div><div class="ttdoc">The in-page location from which this sysxct will look for matching records. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00124">hash_reserve_impl.hpp:124</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_aac7ca8e18b21379d89a60450c41fbdb3"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">foedus::storage::hash::ReserveRecords::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00075">hash_reserve_impl.hpp:75</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acd97205289303877be35fa02b41ca235"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">foedus::storage::hash::ReserveRecords::aggressive_payload_count_hint_</a></div><div class="ttdeci">const PayloadLength aggressive_payload_count_hint_</div><div class="ttdoc">When we expand the record or allocate a new record, we might allocate a larger-than-necessary space g...</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00113">hash_reserve_impl.hpp:113</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a1cb9976c1cdec59a897a4e757fe0a0d4"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">foedus::storage::hash::ReserveRecords::combo_</a></div><div class="ttdeci">const HashCombo &amp; combo_</div><div class="ttdoc">Hash info of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00102">hash_reserve_impl.hpp:102</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a958308b83b377f31e6b01b39979e23b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> foedus::storage::hash::ReserveRecords::append_record_to_page </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1XctId.html">xct::XctId</a>&#160;</td>
          <td class="paramname"><em>initial_xid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Appends a new physical record to the page. </p>
<p>The caller must make sure there is no race in the page. In other words, the page must be either locked or a not-yet-published page. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">261</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="hash__hashinate_8hpp_source.html#l00165">foedus::storage::hash::DataPageBloomFilter::add()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00113">aggressive_payload_count_hint_</a>, <a class="el" href="assorted__func_8hpp_source.html#l00058">foedus::assorted::align8()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00281">foedus::storage::hash::HashDataPage::available_space()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00102">combo_</a>, <a class="el" href="hash__combo_8hpp_source.html#l00051">foedus::storage::hash::HashCombo::fingerprint_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00254">foedus::storage::hash::HashDataPage::get_new_slot()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00246">foedus::storage::hash::HashDataPage::get_record_count()</a>, <a class="el" href="hash__combo_8hpp_source.html#l00049">foedus::storage::hash::HashCombo::hash_</a>, <a class="el" href="page_8hpp_source.html#l00318">foedus::storage::PageHeader::increment_key_count()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00097">key_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00104">key_length_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00291">foedus::storage::hash::HashDataPage::next_offset()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00171">foedus::storage::hash::HashDataPage::Slot::offset_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00106">payload_count_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00275">foedus::storage::hash::HashDataPage::record_from_offset()</a>, and <a class="el" href="hash__page__impl_8hpp_source.html#l00302">foedus::storage::hash::HashDataPage::required_space()</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">create_new_record_in_tail_page()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                              {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;available_space()</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    &gt;= <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">HashDataPage::required_space</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">aggressive_payload_count_hint_</a>));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> index = page-&gt;get_record_count();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keyword">auto</span>&amp; slot = page-&gt;get_new_slot(index);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  slot.offset_ = page-&gt;next_offset();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  slot.hash_ = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">combo_</a>.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  slot.key_length_ = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  slot.physical_record_length_ = <a class="code" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52">assorted::align8</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>) + <a class="code" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52">assorted::align8</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">payload_count_</a>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  slot.payload_length_ = 0;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordtype">char</span>* record = page-&gt;record_from_offset(slot.offset_);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  std::memcpy(record, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a313e539df6d2141feee95e34811cb3e2">key_</a>, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a> % 8 != 0) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    std::memset(record + <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>, 0, 8 - (<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a> % 8));</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  slot.tid_.reset();</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  slot.tid_.xct_id_ = initial_xid;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// we install the fingerprint to bloom filter BEFORE we increment key count.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// it&#39;s okay for concurrent reads to see false positives, but false negatives are wrong!</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  page-&gt;bloom_filter_.add(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">combo_</a>.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">fingerprint_</a>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// we increment key count AFTER installing the key because otherwise the optimistic read</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">// might see the record but find that the key doesn&#39;t match. we need a fence to prevent it.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  page-&gt;header_.increment_key_count();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div>
<div class="ttc" id="group__ASSORTED_html_ga34d731a5b871bbd8a43b748808e9ce52"><div class="ttname"><a href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52">foedus::assorted::align8</a></div><div class="ttdeci">T align8(T value)</div><div class="ttdoc">8-alignment. </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8hpp_source.html#l00058">assorted_func.hpp:58</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a972e277f807b48c13caa20aa32d20721"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">foedus::storage::hash::ReserveRecords::payload_count_</a></div><div class="ttdeci">const PayloadLength payload_count_</div><div class="ttdoc">Minimal required length of the payload. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00106">hash_reserve_impl.hpp:106</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a313e539df6d2141feee95e34811cb3e2"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a313e539df6d2141feee95e34811cb3e2">foedus::storage::hash::ReserveRecords::key_</a></div><div class="ttdeci">const void *const key_</div><div class="ttdoc">The key of the new record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00097">hash_reserve_impl.hpp:97</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a92629528d23870897ae37aeff4dc4b8b"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">foedus::storage::hash::ReserveRecords::key_length_</a></div><div class="ttdeci">const KeyLength key_length_</div><div class="ttdoc">Byte length of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00104">hash_reserve_impl.hpp:104</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1hash_html_a476dd04e514ebe83142d21135e8b91c7"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">foedus::storage::hash::DataPageSlotIndex</a></div><div class="ttdeci">uint16_t DataPageSlotIndex</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00196">hash_id.hpp:196</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_a19d9cee1d8cd64d33d7645b59b6536fd"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">foedus::storage::hash::HashCombo::hash_</a></div><div class="ttdeci">HashValue hash_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00049">hash_combo.hpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_a7dd89264e53c0c98b32e883ab6800ba1"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">foedus::storage::hash::HashCombo::fingerprint_</a></div><div class="ttdeci">BloomFilterFingerprint fingerprint_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00051">hash_combo.hpp:51</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_a446f51ede965fce59769df74a0044dd8"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">foedus::storage::hash::HashDataPage::required_space</a></div><div class="ttdeci">static uint16_t required_space(uint16_t key_length, uint16_t payload_length)</div><div class="ttdoc">returns physical_record_length_ for a new record </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00302">hash_page_impl.hpp:302</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acd97205289303877be35fa02b41ca235"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">foedus::storage::hash::ReserveRecords::aggressive_payload_count_hint_</a></div><div class="ttdeci">const PayloadLength aggressive_payload_count_hint_</div><div class="ttdoc">When we expand the record or allocate a new record, we might allocate a larger-than-necessary space g...</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00113">hash_reserve_impl.hpp:113</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a1cb9976c1cdec59a897a4e757fe0a0d4"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">foedus::storage::hash::ReserveRecords::combo_</a></div><div class="ttdeci">const HashCombo &amp; combo_</div><div class="ttdoc">Hash info of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00102">hash_reserve_impl.hpp:102</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a41762390daf4751147dee762c64d8a61" title="Adds the fingerprint to this bloom filter. " alt="" coords="245,5,427,47"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="492,414,652,441"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ae4d03b6ce42261195e565bdccaeb12b9" title="Returns usable space in bytes. " alt="" coords="228,123,444,164"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="700,115,925,156"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a9ac1ba8382fecd225d2ad1b6e13dae55" title="Returns offset of a next record. " alt="" coords="497,173,647,229"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a501d3dfae095bac5a8f35d578ab9bfab" title="foedus::storage::hash\l::HashDataPage::get_new_slot" alt="" coords="235,291,437,332"/>
<area shape="rect" id="node9" href="structfoedus_1_1storage_1_1PageHeader.html#a3f361aa72342a7354ef9b8130b10d21f" title="foedus::storage::PageHeader\l::increment_key_count" alt="" coords="241,356,431,397"/>
<area shape="rect" id="node10" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="249,421,423,463"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07" title="foedus::storage::hash\l::HashDataPage::record\l_from_offset" alt="" coords="255,487,417,543"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8" title="returns physical_record_length_ for a new record " alt="" coords="229,568,443,609"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac2e82163d7348a6c88fecff711025b08" title="foedus::storage::hash\l::HashDataPage::get_slot" alt="" coords="727,180,898,221"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_icgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a958308b83b377f31e6b01b39979e23b2_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acc93c206465207018eb9e29a5fa5342b" title="Installs it as a fresh&#45;new physical record, assuming the given page is the tail and already locked..." alt="" coords="230,5,401,61"/>
<area shape="rect" id="node5" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76" title="foedus::storage::hash\l::ReserveRecords::expand\l_record" alt="" coords="228,85,403,141"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15" title="The main loop (well, recursion actually). " alt="" coords="451,45,603,101"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e" title="Execute the system transaction. " alt="" coords="651,53,801,94"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acc93c206465207018eb9e29a5fa5342b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::storage::hash::ReserveRecords::create_new_record_in_tail_page </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>tail</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Installs it as a fresh-new physical record, assuming the given page is the tail and already locked. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">208</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="hash__reserve__impl_8hpp_source.html#l00113">aggressive_payload_count_hint_</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">append_record_to_page()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00281">foedus::storage::hash::HashDataPage::available_space()</a>, <a class="el" href="error__code_8hpp_source.html#l00155">CHECK_ERROR_CODE</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00187">create_new_tail_page()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00229">foedus::storage::hash::HashDataPage::get_volatile_page_id()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00225">foedus::storage::hash::HashDataPage::header()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00227">foedus::storage::hash::HashDataPage::is_locked()</a>, <a class="el" href="storage__id_8hpp_source.html#l00210">foedus::storage::VolatilePagePointer::is_null()</a>, <a class="el" href="epoch_8hpp_source.html#l00077">foedus::Epoch::kEpochInitialCurrent</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00104">key_length_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00238">foedus::storage::hash::HashDataPage::next_page()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00140">out_page_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00133">out_slot_</a>, <a class="el" href="page_8hpp_source.html#l00272">foedus::storage::PageHeader::page_version_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00302">foedus::storage::hash::HashDataPage::required_space()</a>, <a class="el" href="xct__id_8hpp_source.html#l00958">foedus::xct::XctId::set()</a>, <a class="el" href="xct__id_8hpp_source.html#l01027">foedus::xct::XctId::set_deleted()</a>, <a class="el" href="page_8hpp_source.html#l00154">foedus::storage::PageVersion::set_has_next_page()</a>, and <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>.</p>
<div class="fragment"><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                                                           {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tail-&gt;is_locked());</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tail-&gt;next_page().volatile_pointer_.is_null());</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// do we have enough room in this page?</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keyword">const</span> uint16_t available_space = tail-&gt;available_space();</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keyword">const</span> uint16_t required_space</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    = <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">HashDataPage::required_space</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">aggressive_payload_count_hint_</a>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  xct::XctId initial_xid;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  initial_xid.set(</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="classfoedus_1_1Epoch.html#a987db657e61845e18835ce4b1617470fabfe4d611fb293208a4a9141666b16575">Epoch::kEpochInitialCurrent</a>,  <span class="comment">// TODO(Hideaki) this should be something else</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    0);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  initial_xid.set_deleted();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">if</span> (available_space &lt; required_space) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// This page can&#39;t hold it. Let&#39;s make a new page.</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    HashDataPage* new_tail;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8">create_new_tail_page</a>(tail, &amp;new_tail));</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// Then append a record to it.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a> = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2">append_record_to_page</a>(new_tail, initial_xid);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a> == 0);  <span class="comment">// it&#39;s the first record in the new page</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">out_page_</a> = new_tail;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">// Then, after all, we &quot;publish&quot; this new page</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();  <span class="comment">// so that others don&#39;t see uninitialized page</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    tail-&gt;next_page().volatile_pointer_ = new_tail-&gt;get_volatile_page_id();</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();  <span class="comment">// so that others don&#39;t have &quot;where&#39;s the next page&quot; issue</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    tail-&gt;header().page_version_.set_has_next_page();</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// the page is enough spacious, and has no next page. we rule!</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a> = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2">append_record_to_page</a>(tail, initial_xid);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">out_page_</a> = tail;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a987db657e61845e18835ce4b1617470fabfe4d611fb293208a4a9141666b16575"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a987db657e61845e18835ce4b1617470fabfe4d611fb293208a4a9141666b16575">foedus::Epoch::kEpochInitialCurrent</a></div><div class="ttdoc">The first epoch (before wrap-around) that might have transactions is ep-3. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00077">epoch.hpp:77</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad34d7b80062bae0e2a0cb703109d848c"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">foedus::storage::hash::ReserveRecords::out_slot_</a></div><div class="ttdeci">DataPageSlotIndex out_slot_</div><div class="ttdoc">[Out] The slot of the record that is found or created. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00133">hash_reserve_impl.hpp:133</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad95de6d2f7cbec7e2d08f758d5165166"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">foedus::storage::hash::ReserveRecords::out_page_</a></div><div class="ttdeci">HashDataPage * out_page_</div><div class="ttdoc">[Out] The page that contains the found/created record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00140">hash_reserve_impl.hpp:140</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a92629528d23870897ae37aeff4dc4b8b"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">foedus::storage::hash::ReserveRecords::key_length_</a></div><div class="ttdeci">const KeyLength key_length_</div><div class="ttdoc">Byte length of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00104">hash_reserve_impl.hpp:104</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a22cd4e9f8619968685921c525d6fa4b8"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8">foedus::storage::hash::ReserveRecords::create_new_tail_page</a></div><div class="ttdeci">ErrorCode create_new_tail_page(HashDataPage *cur_tail, HashDataPage **new_tail)</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00187">hash_reserve_impl.cpp:187</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_a446f51ede965fce59769df74a0044dd8"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">foedus::storage::hash::HashDataPage::required_space</a></div><div class="ttdeci">static uint16_t required_space(uint16_t key_length, uint16_t payload_length)</div><div class="ttdoc">returns physical_record_length_ for a new record </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00302">hash_page_impl.hpp:302</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa3832e1d1faf1540161d389edf2a9c17"><div class="ttname"><a href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a></div><div class="ttdeci">#define CHECK_ERROR_CODE(x)</div><div class="ttdoc">This macro calls x and checks its returned error code. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00155">error_code.hpp:155</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acd97205289303877be35fa02b41ca235"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">foedus::storage::hash::ReserveRecords::aggressive_payload_count_hint_</a></div><div class="ttdeci">const PayloadLength aggressive_payload_count_hint_</div><div class="ttdoc">When we expand the record or allocate a new record, we might allocate a larger-than-necessary space g...</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00113">hash_reserve_impl.hpp:113</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a958308b83b377f31e6b01b39979e23b2"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2">foedus::storage::hash::ReserveRecords::append_record_to_page</a></div><div class="ttdeci">DataPageSlotIndex append_record_to_page(HashDataPage *page, xct::XctId initial_xid) const </div><div class="ttdoc">Appends a new physical record to the page. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00261">hash_reserve_impl.cpp:261</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2" title="Appends a new physical record to the page. " alt="" coords="233,305,407,361"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ae4d03b6ce42261195e565bdccaeb12b9" title="Returns usable space in bytes. " alt="" coords="464,123,680,164"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="485,567,659,608"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8" title="returns physical_record_length_ for a new record " alt="" coords="465,5,679,47"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8" title="foedus::storage::hash\l::ReserveRecords::create\l_new_tail_page" alt="" coords="236,921,404,977"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2fa612bf9214b1d94366eba360167df" title="foedus::storage::hash\l::HashDataPage::is_locked" alt="" coords="482,684,662,725"/>
<area shape="rect" id="node24" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="491,1259,653,1300"/>
<area shape="rect" id="node41" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="490,1324,654,1365"/>
<area shape="rect" id="node42" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a2203e4757be26e410e6f49263e439c53" title="foedus::storage::hash\l::HashDataPage::get_volatile\l_page_id" alt="" coords="225,1102,415,1158"/>
<area shape="rect" id="node43" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32" title="foedus::storage::hash\l::HashDataPage::next_page" alt="" coords="227,1183,413,1224"/>
<area shape="rect" id="node44" href="structfoedus_1_1xct_1_1XctId.html#ad18a2d4a528fa063786b6efaf1035377" title="foedus::xct::XctId::set" alt="" coords="246,1249,394,1275"/>
<area shape="rect" id="node45" href="structfoedus_1_1xct_1_1XctId.html#a4fe6746e50f7bd8ca61c9d141eafc8a2" title="foedus::xct::XctId\l::set_deleted" alt="" coords="259,1300,381,1341"/>
<area shape="rect" id="node46" href="structfoedus_1_1storage_1_1PageVersion.html#af79f8865c1a91b11b10bc0a24f40b22e" title="foedus::storage::PageVersion\l::set_has_next_page" alt="" coords="224,749,416,791"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a41762390daf4751147dee762c64d8a61" title="Adds the fingerprint to this bloom filter. " alt="" coords="481,501,663,543"/>
<area shape="rect" id="node4" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="753,42,913,69"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="987,181,1212,223"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a9ac1ba8382fecd225d2ad1b6e13dae55" title="Returns offset of a next record. " alt="" coords="758,239,909,295"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a501d3dfae095bac5a8f35d578ab9bfab" title="foedus::storage::hash\l::HashDataPage::get_new_slot" alt="" coords="471,371,673,412"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1PageHeader.html#a3f361aa72342a7354ef9b8130b10d21f" title="foedus::storage::PageHeader\l::increment_key_count" alt="" coords="477,436,667,477"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07" title="foedus::storage::hash\l::HashDataPage::record\l_from_offset" alt="" coords="491,239,653,295"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac2e82163d7348a6c88fecff711025b08" title="foedus::storage::hash\l::HashDataPage::get_slot" alt="" coords="1014,247,1185,288"/>
<area shape="rect" id="node18" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e" title="Returns the private memory repository of this thread. " alt="" coords="497,1193,647,1235"/>
<area shape="rect" id="node19" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98" title="Wrapper for grab_free_volatile_page(). " alt="" coords="480,881,664,937"/>
<area shape="rect" id="node25" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="753,1480,914,1521"/>
<area shape="rect" id="node26" href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242" title="foedus::thread::Thread\l::resolve_newpage_cast" alt="" coords="492,815,652,856"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a03dc5746931434bcc27b2b3b6856c33f" title="foedus::storage::hash\l::HashDataPage::initialize\l_volatile_page" alt="" coords="486,961,658,1017"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd" title="foedus::storage::hash\l::HashDataPage::get_bin" alt="" coords="750,1415,917,1456"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a47a8118e0aa8c3ce3c5c6138f2f1aa8c" title="foedus::storage::hash\l::HashDataPage::get_bin\l_shifts" alt="" coords="750,1334,917,1390"/>
<area shape="rect" id="node16" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="737,372,929,413"/>
<area shape="rect" id="node17" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="1015,372,1184,413"/>
<area shape="rect" id="node20" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#ad09e335bbca636246cf2c3d60ec22570" title="Acquires one free volatile page from local page pool. " alt="" coords="728,764,939,805"/>
<area shape="rect" id="node23" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a273a4c4f51c06ebc91663329742e1c69" title="foedus::storage::Volatile\lPagePointer::set" alt="" coords="753,699,914,740"/>
<area shape="rect" id="node21" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ac661b8baf462a1e969a8a1c7e619858b" title="foedus::memory::PagePool\lOffsetChunk::empty" alt="" coords="1260,777,1439,819"/>
<area shape="rect" id="node22" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#af897b38ac1ef4217ff99018436c0112e" title="foedus::memory::PagePool\lOffsetChunk::pop_back" alt="" coords="1010,807,1189,848"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1Thread.html#a628464b9d773c8b17717719cc5af6371" title="Shorthand for get_global_volatile_page_resolver.resolve_offset_newpage() " alt="" coords="758,633,909,675"/>
<area shape="rect" id="node28" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="1024,658,1175,714"/>
<area shape="rect" id="node29" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a63ab3e809b38145565cef7791f211a35" title="As the name suggests, this version is for new pages, which don&#39;t have sanity checks. " alt="" coords="998,578,1201,634"/>
<area shape="rect" id="node31" href="structfoedus_1_1storage_1_1hash_1_1HashBinRange.html#af492eb6df181653434b727ba29e5c833" title="foedus::storage::hash\l::HashBinRange::contains" alt="" coords="747,1041,920,1083"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#ac5e2de81d5e512b5a0f735a9fc413629" title="foedus::storage::hash\l::HashIntermediatePage\l::get_bin_range" alt="" coords="753,1107,914,1163"/>
<area shape="rect" id="node35" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="759,1188,908,1229"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f" title="foedus::storage::hash\l::HashIntermediatePage\l::get_level" alt="" coords="753,1254,914,1310"/>
<area shape="rect" id="node38" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956" title="foedus::storage::PageHeader\l::get_page_type" alt="" coords="738,829,929,871"/>
<area shape="rect" id="node39" href="structfoedus_1_1storage_1_1PageHeader.html#a5a84eed10b8675e5df2f35f791991eb5" title="foedus::storage::PageHeader\l::init_volatile" alt="" coords="738,895,929,936"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad76f0d1e0caffa655e5ffe03c2a59864" title="this method should be called only in page creation. " alt="" coords="744,961,923,1017"/>
<area shape="rect" id="node37" href="structfoedus_1_1storage_1_1PageHeader.html#ac40b3dad0a38d9a142bd14ea5000b669" title="foedus::storage::PageHeader\l::get_in_layer_level" alt="" coords="1004,1261,1195,1303"/>
<area shape="rect" id="node47" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac07d54d78de464e4f8a52d606e140b35" title="foedus::storage::PageVersion\lStatus::set_has_next_page" alt="" coords="476,749,668,791"/>
<area shape="rect" id="node48" href="structfoedus_1_1storage_1_1PageVersionStatus.html#a8360836cebd9fbeadfeb2a31809270c2" title="foedus::storage::PageVersion\lStatus::has_next_page" alt="" coords="737,568,929,609"/>
<area shape="rect" id="node49" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac3214863fa74628187ce46b2879994ae" title="foedus::storage::PageVersion\lStatus::is_moved" alt="" coords="737,437,929,479"/>
<area shape="rect" id="node50" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ab07c3c3d030fab04f79b59dee83ecd2e" title="foedus::storage::PageVersion\lStatus::is_retired" alt="" coords="737,503,929,544"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_icgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_acc93c206465207018eb9e29a5fa5342b_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15" title="The main loop (well, recursion actually). " alt="" coords="224,5,376,61"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e" title="Execute the system transaction. " alt="" coords="424,13,575,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a22cd4e9f8619968685921c525d6fa4b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::storage::hash::ReserveRecords::create_new_tail_page </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>cur_tail</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> **&#160;</td>
          <td class="paramname"><em>new_tail</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00187">187</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00075">context_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00412">foedus::storage::hash::HashDataPage::get_bin()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00422">foedus::storage::hash::HashDataPage::get_bin_shifts()</a>, <a class="el" href="storage__id_8hpp_source.html#l00202">foedus::storage::VolatilePagePointer::get_offset()</a>, <a class="el" href="thread_8cpp_source.html#l00057">foedus::thread::Thread::get_thread_memory()</a>, <a class="el" href="numa__core__memory_8cpp_source.html#l00208">foedus::memory::NumaCoreMemory::grab_free_volatile_page_pointer()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00225">foedus::storage::hash::HashDataPage::header()</a>, <a class="el" href="hash__page__impl_8cpp_source.html#l00070">foedus::storage::hash::HashDataPage::initialize_volatile_page()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00227">foedus::storage::hash::HashDataPage::is_locked()</a>, <a class="el" href="storage__id_8hpp_source.html#l00210">foedus::storage::VolatilePagePointer::is_null()</a>, <a class="el" href="error__code_8hpp_source.html#l00142">foedus::kErrorCodeMemoryNoFreePages</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="thread_8hpp_source.html#l00113">foedus::thread::Thread::resolve_newpage_cast()</a>, <a class="el" href="page_8hpp_source.html#l00196">foedus::storage::PageHeader::storage_id_</a>, and <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">create_new_record_in_tail_page()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00139">find_and_lock_spacious_tail()</a>.</p>
<div class="fragment"><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                           {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_tail-&gt;is_locked());</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  DVLOG(2) &lt;&lt; <span class="stringliteral">&quot;Volatile HashDataPage is full. Adding a next page..&quot;</span>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keyword">const</span> VolatilePagePointer new_pointer</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e">get_thread_memory</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98">grab_free_volatile_page_pointer</a>();</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(new_pointer.is_null())) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a2ddd0cd462e4ae138f0e572106ad098c">kErrorCodeMemoryNoFreePages</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  *new_tail = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242">resolve_newpage_cast</a>&lt;HashDataPage&gt;(new_pointer.get_offset());</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  (*new_tail)-&gt;initialize_volatile_page(</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    cur_tail-&gt;header().storage_id_,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    new_pointer,</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keyword">reinterpret_cast&lt;</span>Page*<span class="keyword">&gt;</span>(cur_tail),</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    cur_tail-&gt;get_bin(),</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    cur_tail-&gt;get_bin_shifts());</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a4e553f5e14ec00d8ba23fbdfa26d687e"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e">foedus::thread::Thread::get_thread_memory</a></div><div class="ttdeci">memory::NumaCoreMemory * get_thread_memory() const </div><div class="ttdoc">Returns the private memory repository of this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00057">thread.cpp:57</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1NumaCoreMemory_html_afb436d68c982228d9e4bc66104b2aa98"><div class="ttname"><a href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98">foedus::memory::NumaCoreMemory::grab_free_volatile_page_pointer</a></div><div class="ttdeci">storage::VolatilePagePointer grab_free_volatile_page_pointer()</div><div class="ttdoc">Wrapper for grab_free_volatile_page(). </div><div class="ttdef"><b>Definition:</b> <a href="numa__core__memory_8cpp_source.html#l00208">numa_core_memory.cpp:208</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a5a3d3dfea35515ae7971106bce95b242"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242">foedus::thread::Thread::resolve_newpage_cast</a></div><div class="ttdeci">P * resolve_newpage_cast(storage::VolatilePagePointer ptr) const </div><div class="ttdef"><b>Definition:</b> <a href="thread_8hpp_source.html#l00113">thread.hpp:113</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a2ddd0cd462e4ae138f0e572106ad098c"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a2ddd0cd462e4ae138f0e572106ad098c">foedus::kErrorCodeMemoryNoFreePages</a></div><div class="ttdoc">0x0301 : "MEMORY : Not enough free volatile pages. Check the config of MemoryOptions" ...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00142">error_code.hpp:142</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_aac7ca8e18b21379d89a60450c41fbdb3"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">foedus::storage::hash::ReserveRecords::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00075">hash_reserve_impl.hpp:75</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd" title="foedus::storage::hash\l::HashDataPage::get_bin" alt="" coords="475,5,642,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a47a8118e0aa8c3ce3c5c6138f2f1aa8c" title="foedus::storage::hash\l::HashDataPage::get_bin\l_shifts" alt="" coords="475,71,642,127"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="478,657,639,699"/>
<area shape="rect" id="node5" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e" title="Returns the private memory repository of this thread. " alt="" coords="238,649,389,691"/>
<area shape="rect" id="node6" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98" title="Wrapper for grab_free_volatile_page(). " alt="" coords="221,715,405,771"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="231,796,395,837"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a03dc5746931434bcc27b2b3b6856c33f" title="foedus::storage::hash\l::HashDataPage::initialize\l_volatile_page" alt="" coords="227,330,399,386"/>
<area shape="rect" id="node26" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2fa612bf9214b1d94366eba360167df" title="foedus::storage::hash\l::HashDataPage::is_locked" alt="" coords="223,861,403,903"/>
<area shape="rect" id="node30" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="233,584,394,625"/>
<area shape="rect" id="node31" href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242" title="foedus::thread::Thread\l::resolve_newpage_cast" alt="" coords="233,928,393,969"/>
<area shape="rect" id="node7" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#ad09e335bbca636246cf2c3d60ec22570" title="Acquires one free volatile page from local page pool. " alt="" coords="453,723,664,764"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a273a4c4f51c06ebc91663329742e1c69" title="foedus::storage::Volatile\lPagePointer::set" alt="" coords="478,788,639,829"/>
<area shape="rect" id="node8" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ac661b8baf462a1e969a8a1c7e619858b" title="foedus::memory::PagePool\lOffsetChunk::empty" alt="" coords="974,723,1153,764"/>
<area shape="rect" id="node9" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#af897b38ac1ef4217ff99018436c0112e" title="foedus::memory::PagePool\lOffsetChunk::pop_back" alt="" coords="724,752,903,793"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1hash_1_1HashBinRange.html#af492eb6df181653434b727ba29e5c833" title="foedus::storage::hash\l::HashBinRange::contains" alt="" coords="472,152,645,193"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#ac5e2de81d5e512b5a0f735a9fc413629" title="foedus::storage::hash\l::HashIntermediatePage\l::get_bin_range" alt="" coords="478,218,639,274"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="484,299,633,340"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f" title="foedus::storage::hash\l::HashIntermediatePage\l::get_level" alt="" coords="478,365,639,421"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956" title="foedus::storage::PageHeader\l::get_page_type" alt="" coords="463,445,654,487"/>
<area shape="rect" id="node19" href="structfoedus_1_1storage_1_1PageHeader.html#a5a84eed10b8675e5df2f35f791991eb5" title="foedus::storage::PageHeader\l::init_volatile" alt="" coords="463,511,654,552"/>
<area shape="rect" id="node25" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad76f0d1e0caffa655e5ffe03c2a59864" title="this method should be called only in page creation. " alt="" coords="469,577,648,633"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1PageHeader.html#ac40b3dad0a38d9a142bd14ea5000b669" title="foedus::storage::PageHeader\l::get_in_layer_level" alt="" coords="718,372,909,413"/>
<area shape="rect" id="node20" href="structfoedus_1_1assorted_1_1ProbCounter.html#a8e7b31f9a6b4997f6c0916f7e20d755a" title="foedus::assorted::ProbCounter\l::reset" alt="" coords="714,479,913,520"/>
<area shape="rect" id="node21" href="structfoedus_1_1storage_1_1PageVersion.html#ae40168c82f16645e85bb66f9019e53cf" title="used only while page initialization " alt="" coords="717,544,909,585"/>
<area shape="rect" id="node22" href="structfoedus_1_1storage_1_1PageVersionStatus.html#af49ef4f3320148130f46f494f1c845aa" title="foedus::storage::PageVersion\lStatus::reset" alt="" coords="967,577,1159,619"/>
<area shape="rect" id="node23" href="structfoedus_1_1xct_1_1McsWwLock.html#a4114c2dec151ad650a294dedac4f239d" title="used only while page initialization " alt="" coords="979,512,1148,553"/>
<area shape="rect" id="node24" href="structfoedus_1_1xct_1_1McsWwBlockData.html#a3161e47c41388e9c1b50929f585e366b" title="foedus::xct::McsWwBlockData\l::clear" alt="" coords="1212,512,1413,553"/>
<area shape="rect" id="node27" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="463,857,655,899"/>
<area shape="rect" id="node28" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="729,856,898,897"/>
<area shape="rect" id="node29" href="structfoedus_1_1xct_1_1McsWwBlockData.html#aa6a3e9b495bb234bf4c840a0e43d082e" title="foedus::xct::McsWwBlockData\l::is_valid_relaxed" alt="" coords="963,856,1164,897"/>
<area shape="rect" id="node32" href="classfoedus_1_1thread_1_1Thread.html#a628464b9d773c8b17717719cc5af6371" title="Shorthand for get_global_volatile_page_resolver.resolve_offset_newpage() " alt="" coords="483,929,634,971"/>
<area shape="rect" id="node33" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="738,922,889,978"/>
<area shape="rect" id="node34" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a63ab3e809b38145565cef7791f211a35" title="As the name suggests, this version is for new pages, which don&#39;t have sanity checks. " alt="" coords="712,1002,915,1058"/>
<area shape="rect" id="node35" href="namespacefoedus_1_1storage.html#ab7207e6e276af504c0e358a923ee75ec" title="foedus::storage::assert\l_aligned_page" alt="" coords="986,1009,1141,1051"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_icgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a22cd4e9f8619968685921c525d6fa4b8_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acc93c206465207018eb9e29a5fa5342b" title="Installs it as a fresh&#45;new physical record, assuming the given page is the tail and already locked..." alt="" coords="435,5,606,61"/>
<area shape="rect" id="node5" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ab6a68802f41a8b163aae60825c4ebd38" title="foedus::storage::hash\l::ReserveRecords::find\l_and_lock_spacious_tail" alt="" coords="221,79,385,135"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15" title="The main loop (well, recursion actually). " alt="" coords="656,45,808,101"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e" title="Execute the system transaction. " alt="" coords="856,53,1007,94"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76" title="foedus::storage::hash\l::ReserveRecords::expand\l_record" alt="" coords="433,85,608,141"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a846dcb3f3938a2b266756e2d95c0df76"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::storage::hash::ReserveRecords::expand_record </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *&#160;</td>
          <td class="paramname"><em>sysxct_workspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">101</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="hash__reserve__impl_8hpp_source.html#l00113">aggressive_payload_count_hint_</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">append_record_to_page()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00281">foedus::storage::hash::HashDataPage::available_space()</a>, <a class="el" href="error__code_8hpp_source.html#l00155">CHECK_ERROR_CODE</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00075">context_</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00139">find_and_lock_spacious_tail()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00248">foedus::storage::hash::HashDataPage::get_slot()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00229">foedus::storage::hash::HashDataPage::get_volatile_page_id()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00227">foedus::storage::hash::HashDataPage::is_locked()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="error__code_8hpp_source.html#l00200">foedus::kErrorCodeXctRaceAbort</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00104">key_length_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00140">out_page_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00133">out_slot_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00302">foedus::storage::hash::HashDataPage::required_space()</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00955">foedus::thread::Thread::sysxct_record_lock()</a>, and <a class="el" href="hash__page__impl_8hpp_source.html#l00165">foedus::storage::hash::HashDataPage::Slot::tid_</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>.</p>
<div class="fragment"><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                           {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keyword">auto</span>* record = &amp;page-&gt;get_slot(index).tid_;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a383dee9d2971403e9bc3bef4a2d33d44">sysxct_record_lock</a>(</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    sysxct_workspace,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    page-&gt;get_volatile_page_id(),</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    record));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// After locking, now the record status is finalized.</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">if</span> (record-&gt;is_moved()) {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// If we now find it moved, we have two choices.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">//  1) resume the search. the new location should be somewhere after here.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">//  2) retry the whole sysxct.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// We do 2) to save coding (yikes!). Excuse: This case should be rare.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Rare. The record turns out to be moved after locking. Retry the sysxct&quot;</span>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">kErrorCodeXctRaceAbort</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// Now, because we locked a record of the key, and because it wasn&#39;t moved yet,</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// we are sure that this is the only record in this hash bucket that might contain this key.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// We&#39;ll be done as soon as we figure out where to move this record.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  HashDataPage* tail;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ab6a68802f41a8b163aae60825c4ebd38">find_and_lock_spacious_tail</a>(sysxct_workspace, page, &amp;tail));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tail-&gt;is_locked());</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tail-&gt;available_space()</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    &gt;= <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">HashDataPage::required_space</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">aggressive_payload_count_hint_</a>));</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// Copy the XID of the existing record</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a> = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2">append_record_to_page</a>(tail, record-&gt;xct_id_);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">out_page_</a> = tail;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// Now we mark the old record as moved</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  record-&gt;xct_id_.set_moved();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ab6a68802f41a8b163aae60825c4ebd38"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ab6a68802f41a8b163aae60825c4ebd38">foedus::storage::hash::ReserveRecords::find_and_lock_spacious_tail</a></div><div class="ttdeci">ErrorCode find_and_lock_spacious_tail(xct::SysxctWorkspace *sysxct_workspace, HashDataPage *from_page, HashDataPage **tail)</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00139">hash_reserve_impl.cpp:139</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a383dee9d2971403e9bc3bef4a2d33d44"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a383dee9d2971403e9bc3bef4a2d33d44">foedus::thread::Thread::sysxct_record_lock</a></div><div class="ttdeci">ErrorCode sysxct_record_lock(xct::SysxctWorkspace *sysxct_workspace, storage::VolatilePagePointer page_id, xct::RwLockableXctId *lock)</div><div class="ttdoc">Takes a lock for a sysxct running under this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread__pimpl_8cpp_source.html#l00955">thread_pimpl.cpp:955</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad34d7b80062bae0e2a0cb703109d848c"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">foedus::storage::hash::ReserveRecords::out_slot_</a></div><div class="ttdeci">DataPageSlotIndex out_slot_</div><div class="ttdoc">[Out] The slot of the record that is found or created. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00133">hash_reserve_impl.hpp:133</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad95de6d2f7cbec7e2d08f758d5165166"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">foedus::storage::hash::ReserveRecords::out_page_</a></div><div class="ttdeci">HashDataPage * out_page_</div><div class="ttdoc">[Out] The page that contains the found/created record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00140">hash_reserve_impl.hpp:140</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a92629528d23870897ae37aeff4dc4b8b"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">foedus::storage::hash::ReserveRecords::key_length_</a></div><div class="ttdeci">const KeyLength key_length_</div><div class="ttdoc">Byte length of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00104">hash_reserve_impl.hpp:104</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_aac7ca8e18b21379d89a60450c41fbdb3"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">foedus::storage::hash::ReserveRecords::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00075">hash_reserve_impl.hpp:75</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_a446f51ede965fce59769df74a0044dd8"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">foedus::storage::hash::HashDataPage::required_space</a></div><div class="ttdeci">static uint16_t required_space(uint16_t key_length, uint16_t payload_length)</div><div class="ttdoc">returns physical_record_length_ for a new record </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00302">hash_page_impl.hpp:302</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa3832e1d1faf1540161d389edf2a9c17"><div class="ttname"><a href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a></div><div class="ttdeci">#define CHECK_ERROR_CODE(x)</div><div class="ttdoc">This macro calls x and checks its returned error code. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00155">error_code.hpp:155</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acd97205289303877be35fa02b41ca235"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">foedus::storage::hash::ReserveRecords::aggressive_payload_count_hint_</a></div><div class="ttdeci">const PayloadLength aggressive_payload_count_hint_</div><div class="ttdoc">When we expand the record or allocate a new record, we might allocate a larger-than-necessary space g...</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00113">hash_reserve_impl.hpp:113</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a958308b83b377f31e6b01b39979e23b2"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2">foedus::storage::hash::ReserveRecords::append_record_to_page</a></div><div class="ttdeci">DataPageSlotIndex append_record_to_page(HashDataPage *page, xct::XctId initial_xid) const </div><div class="ttdoc">Appends a new physical record to the page. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00261">hash_reserve_impl.cpp:261</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aa5f11dac739aec74f9a79d67faa13596">foedus::kErrorCodeXctRaceAbort</a></div><div class="ttdoc">0x0A05 : "XCTION : Aborted a transaction because of a race condition. This is an expected error in hi...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00200">error_code.hpp:200</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2" title="Appends a new physical record to the page. " alt="" coords="228,319,403,375"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ae4d03b6ce42261195e565bdccaeb12b9" title="Returns usable space in bytes. " alt="" coords="451,501,667,542"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac2e82163d7348a6c88fecff711025b08" title="foedus::storage::hash\l::HashDataPage::get_slot" alt="" coords="982,345,1153,386"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="472,618,645,659"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8" title="returns physical_record_length_ for a new record " alt="" coords="452,435,665,477"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ab6a68802f41a8b163aae60825c4ebd38" title="foedus::storage::hash\l::ReserveRecords::find\l_and_lock_spacious_tail" alt="" coords="233,771,397,827"/>
<area shape="rect" id="node41" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2fa612bf9214b1d94366eba360167df" title="foedus::storage::hash\l::HashDataPage::is_locked" alt="" coords="721,1295,901,1337"/>
<area shape="rect" id="node46" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a2203e4757be26e410e6f49263e439c53" title="foedus::storage::hash\l::HashDataPage::get_volatile\l_page_id" alt="" coords="464,1187,653,1243"/>
<area shape="rect" id="node49" href="classfoedus_1_1thread_1_1Thread.html#a383dee9d2971403e9bc3bef4a2d33d44" title="Takes a lock for a sysxct running under this thread. " alt="" coords="240,1371,391,1413"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a41762390daf4751147dee762c64d8a61" title="Adds the fingerprint to this bloom filter. " alt="" coords="467,267,650,309"/>
<area shape="rect" id="node4" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="731,325,891,352"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="955,279,1180,321"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a9ac1ba8382fecd225d2ad1b6e13dae55" title="Returns offset of a next record. " alt="" coords="735,376,886,432"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a501d3dfae095bac5a8f35d578ab9bfab" title="foedus::storage::hash\l::HashDataPage::get_new_slot" alt="" coords="458,55,659,97"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1PageHeader.html#a3f361aa72342a7354ef9b8130b10d21f" title="foedus::storage::PageHeader\l::increment_key_count" alt="" coords="463,121,654,162"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07" title="foedus::storage::hash\l::HashDataPage::record\l_from_offset" alt="" coords="478,187,639,243"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32" title="foedus::storage::hash\l::HashDataPage::next_page" alt="" coords="466,683,651,725"/>
<area shape="rect" id="node16" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="730,667,891,709"/>
<area shape="rect" id="node18" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118" title="resolve() plus reinterpret_cast " alt="" coords="483,749,634,790"/>
<area shape="rect" id="node23" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255" title="Takes a page lock in the same page for a sysxct running under this thread. " alt="" coords="483,1121,634,1162"/>
<area shape="rect" id="node26" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8" title="foedus::storage::hash\l::ReserveRecords::create\l_new_tail_page" alt="" coords="475,924,643,980"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="729,1178,893,1219"/>
<area shape="rect" id="node47" href="structfoedus_1_1storage_1_1PageVersion.html#af79f8865c1a91b11b10bc0a24f40b22e" title="foedus::storage::PageVersion\l::set_has_next_page" alt="" coords="463,1055,655,1097"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="987,527,1148,569"/>
<area shape="rect" id="node19" href="classfoedus_1_1thread_1_1Thread.html#ade1f89cfaad84ff5dda0b6f7999a519e" title="Shorthand for get_global_volatile_page_resolver.resolve_offset() " alt="" coords="735,602,886,643"/>
<area shape="rect" id="node20" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="1237,911,1388,967"/>
<area shape="rect" id="node21" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f" title="Resolves offset plus NUMA node ID to storage::Page*. " alt="" coords="966,410,1169,451"/>
<area shape="rect" id="node22" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="1238,563,1387,605"/>
<area shape="rect" id="node24" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a2cd3cb727c6e211c8e6a72ccb00f3854" title="foedus::thread::ThreadPimpl\l::sysxct_page_lock" alt="" coords="719,1426,903,1467"/>
<area shape="rect" id="node25" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a33a1b8b428cd84029b8b377867197ea4" title="foedus::thread::ThreadPimpl\l::is_simple_mcs_rw" alt="" coords="975,1491,1159,1533"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd" title="foedus::storage::hash\l::HashDataPage::get_bin" alt="" coords="984,1295,1151,1337"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a47a8118e0aa8c3ce3c5c6138f2f1aa8c" title="foedus::storage::hash\l::HashDataPage::get_bin\l_shifts" alt="" coords="984,1215,1151,1271"/>
<area shape="rect" id="node29" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e" title="Returns the private memory repository of this thread. " alt="" coords="735,945,886,986"/>
<area shape="rect" id="node30" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98" title="Wrapper for grab_free_volatile_page(). " alt="" coords="719,784,903,840"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a03dc5746931434bcc27b2b3b6856c33f" title="foedus::storage::hash\l::HashDataPage::initialize\l_volatile_page" alt="" coords="725,864,897,920"/>
<area shape="rect" id="node44" href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242" title="foedus::thread::Thread\l::resolve_newpage_cast" alt="" coords="731,1113,891,1154"/>
<area shape="rect" id="node31" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#ad09e335bbca636246cf2c3d60ec22570" title="Acquires one free volatile page from local page pool. " alt="" coords="962,593,1173,634"/>
<area shape="rect" id="node32" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a273a4c4f51c06ebc91663329742e1c69" title="foedus::storage::Volatile\lPagePointer::set" alt="" coords="987,658,1148,699"/>
<area shape="rect" id="node35" href="structfoedus_1_1storage_1_1hash_1_1HashBinRange.html#af492eb6df181653434b727ba29e5c833" title="foedus::storage::hash\l::HashBinRange::contains" alt="" coords="981,922,1154,963"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#ac5e2de81d5e512b5a0f735a9fc413629" title="foedus::storage::hash\l::HashIntermediatePage\l::get_bin_range" alt="" coords="987,988,1148,1044"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f" title="foedus::storage::hash\l::HashIntermediatePage\l::get_level" alt="" coords="987,1068,1148,1124"/>
<area shape="rect" id="node38" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956" title="foedus::storage::PageHeader\l::get_page_type" alt="" coords="972,1149,1163,1190"/>
<area shape="rect" id="node39" href="structfoedus_1_1storage_1_1PageHeader.html#a5a84eed10b8675e5df2f35f791991eb5" title="foedus::storage::PageHeader\l::init_volatile" alt="" coords="972,775,1163,817"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad76f0d1e0caffa655e5ffe03c2a59864" title="this method should be called only in page creation. " alt="" coords="978,841,1157,897"/>
<area shape="rect" id="node42" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="971,1426,1163,1467"/>
<area shape="rect" id="node43" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="1228,1426,1397,1467"/>
<area shape="rect" id="node45" href="classfoedus_1_1thread_1_1Thread.html#a628464b9d773c8b17717719cc5af6371" title="Shorthand for get_global_volatile_page_resolver.resolve_offset_newpage() " alt="" coords="992,1361,1143,1402"/>
<area shape="rect" id="node48" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac07d54d78de464e4f8a52d606e140b35" title="foedus::storage::PageVersion\lStatus::set_has_next_page" alt="" coords="715,1361,907,1402"/>
<area shape="rect" id="node50" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a056563bc302fb45ad684a7fa28d00161" title="foedus::thread::ThreadPimpl\l::sysxct_record_lock" alt="" coords="719,1491,903,1533"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_icgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a846dcb3f3938a2b266756e2d95c0df76_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15" title="The main loop (well, recursion actually). " alt="" coords="228,5,380,61"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e" title="Execute the system transaction. " alt="" coords="428,13,579,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab6a68802f41a8b163aae60825c4ebd38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::storage::hash::ReserveRecords::find_and_lock_spacious_tail </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *&#160;</td>
          <td class="paramname"><em>sysxct_workspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>from_page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> **&#160;</td>
          <td class="paramname"><em>tail</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00139">139</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="hash__reserve__impl_8hpp_source.html#l00113">aggressive_payload_count_hint_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00281">foedus::storage::hash::HashDataPage::available_space()</a>, <a class="el" href="error__code_8hpp_source.html#l00155">CHECK_ERROR_CODE</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00075">context_</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00187">create_new_tail_page()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00229">foedus::storage::hash::HashDataPage::get_volatile_page_id()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00225">foedus::storage::hash::HashDataPage::header()</a>, <a class="el" href="storage__id_8hpp_source.html#l00210">foedus::storage::VolatilePagePointer::is_null()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00104">key_length_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00238">foedus::storage::hash::HashDataPage::next_page()</a>, <a class="el" href="page_8hpp_source.html#l00272">foedus::storage::PageHeader::page_version_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00302">foedus::storage::hash::HashDataPage::required_space()</a>, <a class="el" href="thread_8hpp_source.html#l00110">foedus::thread::Thread::resolve_cast()</a>, <a class="el" href="page_8hpp_source.html#l00154">foedus::storage::PageVersion::set_has_next_page()</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00968">foedus::thread::Thread::sysxct_page_lock()</a>, and <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                       {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  *tail = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  HashDataPage* cur = from_page;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    VolatilePagePointer next_pointer = cur-&gt;next_page().volatile_pointer_;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (!next_pointer.is_null()) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      cur = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118">resolve_cast</a>&lt;HashDataPage&gt;(next_pointer);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// cur looks like a tail page, but we need to confirm that after locking.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255">sysxct_page_lock</a>(sysxct_workspace, reinterpret_cast&lt;Page*&gt;(cur)));</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (!cur-&gt;next_page().volatile_pointer_.is_null()) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Rare. Someone has just made a next page&quot;</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keyword">const</span> uint16_t available_space = cur-&gt;available_space();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keyword">const</span> uint16_t required_space</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      = <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">HashDataPage::required_space</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">aggressive_payload_count_hint_</a>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (available_space &gt;= required_space) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      *tail = cur;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="comment">// need to make a new page..</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      HashDataPage* new_tail;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8">create_new_tail_page</a>(cur, &amp;new_tail));</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="comment">// Then, after all, we &quot;publish&quot; this new page</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();  <span class="comment">// so that others don&#39;t see uninitialized page</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      cur-&gt;next_page().volatile_pointer_ = new_tail-&gt;get_volatile_page_id();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();  <span class="comment">// so that others don&#39;t have &quot;where&#39;s the next page&quot; issue</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      cur-&gt;header().page_version_.set_has_next_page();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="comment">// We could immediately make a record in this page before the publish above.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="comment">// If we do that we could avoid lock here. But the code becomes a bit uglier.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="comment">// record-expand is anyway a costly operation, so ok for now.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255">sysxct_page_lock</a>(</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        sysxct_workspace,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        reinterpret_cast&lt;Page*&gt;(new_tail)));</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      *tail = new_tail;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a92629528d23870897ae37aeff4dc4b8b"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">foedus::storage::hash::ReserveRecords::key_length_</a></div><div class="ttdeci">const KeyLength key_length_</div><div class="ttdoc">Byte length of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00104">hash_reserve_impl.hpp:104</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a7ac249b3b032751e9bf0903ad7e45255"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255">foedus::thread::Thread::sysxct_page_lock</a></div><div class="ttdeci">ErrorCode sysxct_page_lock(xct::SysxctWorkspace *sysxct_workspace, storage::Page *page)</div><div class="ttdoc">Takes a page lock in the same page for a sysxct running under this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread__pimpl_8cpp_source.html#l00968">thread_pimpl.cpp:968</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a22cd4e9f8619968685921c525d6fa4b8"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8">foedus::storage::hash::ReserveRecords::create_new_tail_page</a></div><div class="ttdeci">ErrorCode create_new_tail_page(HashDataPage *cur_tail, HashDataPage **new_tail)</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00187">hash_reserve_impl.cpp:187</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a17f375db3d50174cf49746e04ce00118"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118">foedus::thread::Thread::resolve_cast</a></div><div class="ttdeci">P * resolve_cast(storage::VolatilePagePointer ptr) const </div><div class="ttdoc">resolve() plus reinterpret_cast </div><div class="ttdef"><b>Definition:</b> <a href="thread_8hpp_source.html#l00110">thread.hpp:110</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_aac7ca8e18b21379d89a60450c41fbdb3"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">foedus::storage::hash::ReserveRecords::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00075">hash_reserve_impl.hpp:75</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_a446f51ede965fce59769df74a0044dd8"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8">foedus::storage::hash::HashDataPage::required_space</a></div><div class="ttdeci">static uint16_t required_space(uint16_t key_length, uint16_t payload_length)</div><div class="ttdoc">returns physical_record_length_ for a new record </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00302">hash_page_impl.hpp:302</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa3832e1d1faf1540161d389edf2a9c17"><div class="ttname"><a href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a></div><div class="ttdeci">#define CHECK_ERROR_CODE(x)</div><div class="ttdoc">This macro calls x and checks its returned error code. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00155">error_code.hpp:155</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acd97205289303877be35fa02b41ca235"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">foedus::storage::hash::ReserveRecords::aggressive_payload_count_hint_</a></div><div class="ttdeci">const PayloadLength aggressive_payload_count_hint_</div><div class="ttdoc">When we expand the record or allocate a new record, we might allocate a larger-than-necessary space g...</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00113">hash_reserve_impl.hpp:113</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ae4d03b6ce42261195e565bdccaeb12b9" title="Returns usable space in bytes. " alt="" coords="217,133,433,175"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8" title="foedus::storage::hash\l::ReserveRecords::create\l_new_tail_page" alt="" coords="241,698,409,754"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="495,983,659,1024"/>
<area shape="rect" id="node31" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="497,407,658,448"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a2203e4757be26e410e6f49263e439c53" title="foedus::storage::hash\l::HashDataPage::get_volatile\l_page_id" alt="" coords="231,1087,420,1143"/>
<area shape="rect" id="node36" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="239,1168,412,1209"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32" title="foedus::storage::hash\l::HashDataPage::next_page" alt="" coords="233,1233,418,1275"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8" title="returns physical_record_length_ for a new record " alt="" coords="219,1299,432,1340"/>
<area shape="rect" id="node40" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118" title="resolve() plus reinterpret_cast " alt="" coords="250,331,401,372"/>
<area shape="rect" id="node43" href="structfoedus_1_1storage_1_1PageVersion.html#af79f8865c1a91b11b10bc0a24f40b22e" title="foedus::storage::PageVersion\l::set_has_next_page" alt="" coords="229,1021,421,1063"/>
<area shape="rect" id="node48" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255" title="Takes a page lock in the same page for a sysxct running under this thread. " alt="" coords="250,1376,401,1417"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="721,71,947,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a9ac1ba8382fecd225d2ad1b6e13dae55" title="Returns offset of a next record. " alt="" coords="502,61,653,117"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac2e82163d7348a6c88fecff711025b08" title="foedus::storage::hash\l::HashDataPage::get_slot" alt="" coords="749,5,919,47"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd" title="foedus::storage::hash\l::HashDataPage::get_bin" alt="" coords="751,319,917,360"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a47a8118e0aa8c3ce3c5c6138f2f1aa8c" title="foedus::storage::hash\l::HashDataPage::get_bin\l_shifts" alt="" coords="751,385,917,441"/>
<area shape="rect" id="node9" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="753,253,915,295"/>
<area shape="rect" id="node10" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e" title="Returns the private memory repository of this thread. " alt="" coords="502,771,653,812"/>
<area shape="rect" id="node11" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98" title="Wrapper for grab_free_volatile_page(). " alt="" coords="485,837,669,893"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a03dc5746931434bcc27b2b3b6856c33f" title="foedus::storage::hash\l::HashDataPage::initialize\l_volatile_page" alt="" coords="491,625,663,681"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2fa612bf9214b1d94366eba360167df" title="foedus::storage::hash\l::HashDataPage::is_locked" alt="" coords="487,917,667,959"/>
<area shape="rect" id="node32" href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242" title="foedus::thread::Thread\l::resolve_newpage_cast" alt="" coords="497,705,657,747"/>
<area shape="rect" id="node12" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#ad09e335bbca636246cf2c3d60ec22570" title="Acquires one free volatile page from local page pool. " alt="" coords="729,1020,939,1061"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a273a4c4f51c06ebc91663329742e1c69" title="foedus::storage::Volatile\lPagePointer::set" alt="" coords="753,1085,915,1127"/>
<area shape="rect" id="node13" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ac661b8baf462a1e969a8a1c7e619858b" title="foedus::memory::PagePool\lOffsetChunk::empty" alt="" coords="1241,1049,1420,1091"/>
<area shape="rect" id="node14" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#af897b38ac1ef4217ff99018436c0112e" title="foedus::memory::PagePool\lOffsetChunk::pop_back" alt="" coords="1005,1020,1183,1061"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1hash_1_1HashBinRange.html#af492eb6df181653434b727ba29e5c833" title="foedus::storage::hash\l::HashBinRange::contains" alt="" coords="747,808,921,849"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#ac5e2de81d5e512b5a0f735a9fc413629" title="foedus::storage::hash\l::HashIntermediatePage\l::get_bin_range" alt="" coords="753,515,915,571"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e" title="At least the basic header exists in all pages. " alt="" coords="1019,297,1169,339"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f" title="foedus::storage::hash\l::HashIntermediatePage\l::get_level" alt="" coords="753,874,915,930"/>
<area shape="rect" id="node23" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956" title="foedus::storage::PageHeader\l::get_page_type" alt="" coords="739,743,929,784"/>
<area shape="rect" id="node24" href="structfoedus_1_1storage_1_1PageHeader.html#a5a84eed10b8675e5df2f35f791991eb5" title="foedus::storage::PageHeader\l::init_volatile" alt="" coords="739,596,929,637"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad76f0d1e0caffa655e5ffe03c2a59864" title="this method should be called only in page creation. " alt="" coords="745,662,923,718"/>
<area shape="rect" id="node22" href="structfoedus_1_1storage_1_1PageHeader.html#ac40b3dad0a38d9a142bd14ea5000b669" title="foedus::storage::PageHeader\l::get_in_layer_level" alt="" coords="999,873,1189,915"/>
<area shape="rect" id="node25" href="structfoedus_1_1assorted_1_1ProbCounter.html#a8e7b31f9a6b4997f6c0916f7e20d755a" title="foedus::assorted::ProbCounter\l::reset" alt="" coords="995,564,1193,605"/>
<area shape="rect" id="node26" href="structfoedus_1_1storage_1_1PageVersion.html#ae40168c82f16645e85bb66f9019e53cf" title="used only while page initialization " alt="" coords="998,629,1190,671"/>
<area shape="rect" id="node29" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="738,1151,930,1192"/>
<area shape="rect" id="node30" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="1009,1151,1179,1192"/>
<area shape="rect" id="node33" href="classfoedus_1_1thread_1_1Thread.html#a628464b9d773c8b17717719cc5af6371" title="Shorthand for get_global_volatile_page_resolver.resolve_offset_newpage() " alt="" coords="759,955,909,996"/>
<area shape="rect" id="node34" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="1019,939,1169,995"/>
<area shape="rect" id="node39" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="497,1306,657,1333"/>
<area shape="rect" id="node41" href="classfoedus_1_1thread_1_1Thread.html#ade1f89cfaad84ff5dda0b6f7999a519e" title="Shorthand for get_global_volatile_page_resolver.resolve_offset() " alt="" coords="502,195,653,236"/>
<area shape="rect" id="node42" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f" title="Resolves offset plus NUMA node ID to storage::Page*. " alt="" coords="733,136,935,177"/>
<area shape="rect" id="node44" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac07d54d78de464e4f8a52d606e140b35" title="foedus::storage::PageVersion\lStatus::set_has_next_page" alt="" coords="481,1236,673,1277"/>
<area shape="rect" id="node45" href="structfoedus_1_1storage_1_1PageVersionStatus.html#a8360836cebd9fbeadfeb2a31809270c2" title="foedus::storage::PageVersion\lStatus::has_next_page" alt="" coords="738,1281,930,1323"/>
<area shape="rect" id="node46" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac3214863fa74628187ce46b2879994ae" title="foedus::storage::PageVersion\lStatus::is_moved" alt="" coords="738,1347,930,1388"/>
<area shape="rect" id="node47" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ab07c3c3d030fab04f79b59dee83ecd2e" title="foedus::storage::PageVersion\lStatus::is_retired" alt="" coords="738,1216,930,1257"/>
<area shape="rect" id="node49" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a2cd3cb727c6e211c8e6a72ccb00f3854" title="foedus::thread::ThreadPimpl\l::sysxct_page_lock" alt="" coords="485,1400,669,1441"/>
<area shape="rect" id="node50" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a33a1b8b428cd84029b8b377867197ea4" title="foedus::thread::ThreadPimpl\l::is_simple_mcs_rw" alt="" coords="742,1412,926,1453"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_icgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ab6a68802f41a8b163aae60825c4ebd38_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76" title="foedus::storage::hash\l::ReserveRecords::expand\l_record" alt="" coords="217,5,392,61"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15" title="The main loop (well, recursion actually). " alt="" coords="440,5,592,61"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e" title="Execute the system transaction. " alt="" coords="640,13,791,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad189e0523907caacae334102d9383b15"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::storage::hash::ReserveRecords::find_or_create_or_expand </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *&#160;</td>
          <td class="paramname"><em>sysxct_workspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td>
          <td class="paramname"><em>examined_records</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main loop (well, recursion actually). </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">36</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="error__code_8hpp_source.html#l00155">CHECK_ERROR_CODE</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00075">context_</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">create_new_record_in_tail_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00197">foedus::storage::hash::HashDataPage::Slot::get_max_payload()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00246">foedus::storage::hash::HashDataPage::get_record_count()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00248">foedus::storage::hash::HashDataPage::get_slot()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00225">foedus::storage::hash::HashDataPage::header()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00227">foedus::storage::hash::HashDataPage::is_locked()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="hash__id_8hpp_source.html#l00197">foedus::storage::hash::kSlotNotFound</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00046">foedus::assorted::memory_fence_acquire()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00238">foedus::storage::hash::HashDataPage::next_page()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00140">out_page_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00133">out_slot_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00106">payload_count_</a>, <a class="el" href="thread_8hpp_source.html#l00110">foedus::thread::Thread::resolve_cast()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00244">search_within_page()</a>, <a class="el" href="page_8hpp_source.html#l00211">foedus::storage::PageHeader::snapshot_</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00968">foedus::thread::Thread::sysxct_page_lock()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00095">target_</a>, and <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00031">run()</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                      {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!page-&gt;header().snapshot_);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// lock the page first so that there is no race on new keys.</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  VolatilePagePointer next_pointer = page-&gt;next_page().volatile_pointer_;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> (next_pointer.is_null()) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255">sysxct_page_lock</a>(sysxct_workspace, reinterpret_cast&lt;Page*&gt;(page)));</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    next_pointer = page-&gt;next_page().volatile_pointer_;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// If the page already has a next-page pointer, the page is already finalized. Skip locking.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();  <span class="comment">// must check next-page BEFORE everything else</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// In either case, from now on this page is finalized</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;is_locked() || !next_pointer.is_null());</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> count = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acdbcbeccc292c431d3dc6d76948b597f">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">get_record_count</a>();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(examined_records &lt;= count);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// Locate the key in this page.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> index;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> (examined_records == count) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// is examined_records correct? let&#39;s confirm</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    index = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a0947f74956ac95cf143ff61f6493dcc4">search_within_page</a>(page, examined_records, 0);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(index == <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    index = <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// We can skip the first examined_records records.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// We took the page lock, so physical-only search is enough.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    index = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a0947f74956ac95cf143ff61f6493dcc4">search_within_page</a>(page, count, examined_records);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">if</span> (index == <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// still no match, This is simpler.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (!next_pointer.is_null()) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="comment">// We have a next page, let&#39;s go on.</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="comment">// This is so far a recursion. Easier to debug than a loop.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="comment">// Stackoverflow? If you have a long chain in hash bucket, you are already screwed</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      HashDataPage* next_page = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118">resolve_cast</a>&lt;HashDataPage&gt;(next_pointer);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15">find_or_create_or_expand</a>(sysxct_workspace, next_page, 0);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">// This is the tail page. and we locked it.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="comment">// We simply create a new physical record.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;is_locked());</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acc93c206465207018eb9e29a5fa5342b">create_new_record_in_tail_page</a>(page);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// We found a match! This is either super easy or complex</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(index &gt;= examined_records);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(index &lt; count);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (page-&gt;get_slot(index).get_max_payload() &gt;= <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">payload_count_</a>) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="comment">// This record is enough spacious. we are done! a super easy case.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a> = index;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">out_page_</a> = page;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="comment">// We need to expand this record. To do that, we need to lock this record and move it.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="comment">// This can be complex.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76">expand_record</a>(sysxct_workspace, page, index);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acdbcbeccc292c431d3dc6d76948b597f"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acdbcbeccc292c431d3dc6d76948b597f">foedus::storage::hash::ReserveRecords::target_</a></div><div class="ttdeci">HashDataPage *const target_</div><div class="ttdoc">The data page to install a new physical record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00095">hash_reserve_impl.hpp:95</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad34d7b80062bae0e2a0cb703109d848c"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">foedus::storage::hash::ReserveRecords::out_slot_</a></div><div class="ttdeci">DataPageSlotIndex out_slot_</div><div class="ttdoc">[Out] The slot of the record that is found or created. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00133">hash_reserve_impl.hpp:133</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a972e277f807b48c13caa20aa32d20721"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">foedus::storage::hash::ReserveRecords::payload_count_</a></div><div class="ttdeci">const PayloadLength payload_count_</div><div class="ttdoc">Minimal required length of the payload. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00106">hash_reserve_impl.hpp:106</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1hash_html_a33cdddb3771cf2fdc3e65465792b6c96"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">foedus::storage::hash::kSlotNotFound</a></div><div class="ttdeci">const DataPageSlotIndex kSlotNotFound</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00197">hash_id.hpp:197</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad189e0523907caacae334102d9383b15"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15">foedus::storage::hash::ReserveRecords::find_or_create_or_expand</a></div><div class="ttdeci">ErrorCode find_or_create_or_expand(xct::SysxctWorkspace *sysxct_workspace, HashDataPage *page, DataPageSlotIndex examined_records)</div><div class="ttdoc">The main loop (well, recursion actually). </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00036">hash_reserve_impl.cpp:36</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad95de6d2f7cbec7e2d08f758d5165166"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">foedus::storage::hash::ReserveRecords::out_page_</a></div><div class="ttdeci">HashDataPage * out_page_</div><div class="ttdoc">[Out] The page that contains the found/created record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00140">hash_reserve_impl.hpp:140</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a7ac249b3b032751e9bf0903ad7e45255"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255">foedus::thread::Thread::sysxct_page_lock</a></div><div class="ttdeci">ErrorCode sysxct_page_lock(xct::SysxctWorkspace *sysxct_workspace, storage::Page *page)</div><div class="ttdoc">Takes a page lock in the same page for a sysxct running under this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread__pimpl_8cpp_source.html#l00968">thread_pimpl.cpp:968</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acc93c206465207018eb9e29a5fa5342b"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acc93c206465207018eb9e29a5fa5342b">foedus::storage::hash::ReserveRecords::create_new_record_in_tail_page</a></div><div class="ttdeci">ErrorCode create_new_record_in_tail_page(HashDataPage *tail)</div><div class="ttdoc">Installs it as a fresh-new physical record, assuming the given page is the tail and already locked...</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00208">hash_reserve_impl.cpp:208</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1hash_html_a476dd04e514ebe83142d21135e8b91c7"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">foedus::storage::hash::DataPageSlotIndex</a></div><div class="ttdeci">uint16_t DataPageSlotIndex</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00196">hash_id.hpp:196</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a17f375db3d50174cf49746e04ce00118"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118">foedus::thread::Thread::resolve_cast</a></div><div class="ttdeci">P * resolve_cast(storage::VolatilePagePointer ptr) const </div><div class="ttdoc">resolve() plus reinterpret_cast </div><div class="ttdef"><b>Definition:</b> <a href="thread_8hpp_source.html#l00110">thread.hpp:110</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_aac7ca8e18b21379d89a60450c41fbdb3"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aac7ca8e18b21379d89a60450c41fbdb3">foedus::storage::hash::ReserveRecords::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00075">hash_reserve_impl.hpp:75</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a846dcb3f3938a2b266756e2d95c0df76"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76">foedus::storage::hash::ReserveRecords::expand_record</a></div><div class="ttdeci">ErrorCode expand_record(xct::SysxctWorkspace *sysxct_workspace, HashDataPage *page, DataPageSlotIndex index)</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00101">hash_reserve_impl.cpp:101</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa3832e1d1faf1540161d389edf2a9c17"><div class="ttname"><a href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a></div><div class="ttdeci">#define CHECK_ERROR_CODE(x)</div><div class="ttdoc">This macro calls x and checks its returned error code. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00155">error_code.hpp:155</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaf84f9944a16c5848f69beacdfeedf939"><div class="ttname"><a href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">foedus::assorted::memory_fence_acquire</a></div><div class="ttdeci">void memory_fence_acquire()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_acquire). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00046">atomic_fences.hpp:46</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a0947f74956ac95cf143ff61f6493dcc4"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a0947f74956ac95cf143ff61f6493dcc4">foedus::storage::hash::ReserveRecords::search_within_page</a></div><div class="ttdeci">DataPageSlotIndex search_within_page(const HashDataPage *page, DataPageSlotIndex key_count, DataPageSlotIndex examined_records) const </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00244">hash_reserve_impl.cpp:244</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_ac6b4a13e6f057be1874f637fb9f87c51"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">foedus::storage::hash::HashDataPage::get_record_count</a></div><div class="ttdeci">uint16_t get_record_count() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00246">hash_page_impl.hpp:246</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acc93c206465207018eb9e29a5fa5342b" title="Installs it as a fresh&#45;new physical record, assuming the given page is the tail and already locked..." alt="" coords="207,631,378,687"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="1155,987,1380,1028"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac2e82163d7348a6c88fecff711025b08" title="foedus::storage::hash\l::HashDataPage::get_slot" alt="" coords="1182,1429,1353,1471"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="929,632,1093,673"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2fa612bf9214b1d94366eba360167df" title="foedus::storage::hash\l::HashDataPage::is_locked" alt="" coords="921,5,1101,47"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32" title="foedus::storage::hash\l::HashDataPage::next_page" alt="" coords="918,1295,1103,1336"/>
<area shape="rect" id="node34" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76" title="foedus::storage::hash\l::ReserveRecords::expand\l_record" alt="" coords="205,1451,380,1507"/>
<area shape="rect" id="node36" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118" title="resolve() plus reinterpret_cast " alt="" coords="683,2059,834,2100"/>
<area shape="rect" id="node40" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255" title="Takes a page lock in the same page for a sysxct running under this thread. " alt="" coords="683,1861,834,1903"/>
<area shape="rect" id="node44" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#add6863451ba01bcf490fc84d86a7c579" title="foedus::storage::hash\l::HashDataPage::Slot\l::get_max_payload" alt="" coords="219,1642,367,1698"/>
<area shape="rect" id="node46" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="206,2029,379,2071"/>
<area shape="rect" id="node47" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a0947f74956ac95cf143ff61f6493dcc4" title="foedus::storage::hash\l::ReserveRecords::search\l_within_page" alt="" coords="673,682,844,738"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2" title="Appends a new physical record to the page. " alt="" coords="428,1098,603,1154"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ae4d03b6ce42261195e565bdccaeb12b9" title="Returns usable space in bytes. " alt="" coords="651,1265,867,1307"/>
<area shape="rect" id="node12" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="672,1396,845,1437"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8" title="returns physical_record_length_ for a new record " alt="" coords="652,1331,865,1372"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8" title="foedus::storage::hash\l::ReserveRecords::create\l_new_tail_page" alt="" coords="675,435,843,491"/>
<area shape="rect" id="node26" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="930,697,1091,739"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a2203e4757be26e410e6f49263e439c53" title="foedus::storage::hash\l::HashDataPage::get_volatile\l_page_id" alt="" coords="664,1614,853,1670"/>
<area shape="rect" id="node30" href="structfoedus_1_1xct_1_1XctId.html#ad18a2d4a528fa063786b6efaf1035377" title="foedus::xct::XctId::set" alt="" coords="441,493,589,519"/>
<area shape="rect" id="node31" href="structfoedus_1_1xct_1_1XctId.html#a4fe6746e50f7bd8ca61c9d141eafc8a2" title="foedus::xct::XctId\l::set_deleted" alt="" coords="454,544,577,585"/>
<area shape="rect" id="node32" href="structfoedus_1_1storage_1_1PageVersion.html#af79f8865c1a91b11b10bc0a24f40b22e" title="foedus::storage::PageVersion\l::set_has_next_page" alt="" coords="663,369,855,411"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a41762390daf4751147dee762c64d8a61" title="Adds the fingerprint to this bloom filter. " alt="" coords="667,929,850,971"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="931,1361,1091,1387"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a9ac1ba8382fecd225d2ad1b6e13dae55" title="Returns offset of a next record. " alt="" coords="935,1163,1086,1219"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a501d3dfae095bac5a8f35d578ab9bfab" title="foedus::storage::hash\l::HashDataPage::get_new_slot" alt="" coords="658,1047,859,1088"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1PageHeader.html#a3f361aa72342a7354ef9b8130b10d21f" title="foedus::storage::PageHeader\l::increment_key_count" alt="" coords="663,864,854,905"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07" title="foedus::storage::hash\l::HashDataPage::record\l_from_offset" alt="" coords="1187,903,1348,959"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd" title="foedus::storage::hash\l::HashDataPage::get_bin" alt="" coords="1184,216,1351,257"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a47a8118e0aa8c3ce3c5c6138f2f1aa8c" title="foedus::storage::hash\l::HashDataPage::get_bin\l_shifts" alt="" coords="1184,293,1351,349"/>
<area shape="rect" id="node18" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1187,591,1348,632"/>
<area shape="rect" id="node19" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e" title="Returns the private memory repository of this thread. " alt="" coords="935,369,1086,411"/>
<area shape="rect" id="node20" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98" title="Wrapper for grab_free_volatile_page(). " alt="" coords="919,435,1103,491"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a03dc5746931434bcc27b2b3b6856c33f" title="foedus::storage::hash\l::HashDataPage::initialize\l_volatile_page" alt="" coords="925,238,1097,294"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242" title="foedus::thread::Thread\l::resolve_newpage_cast" alt="" coords="931,567,1091,608"/>
<area shape="rect" id="node24" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="1171,129,1363,171"/>
<area shape="rect" id="node25" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="1428,129,1597,171"/>
<area shape="rect" id="node33" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac07d54d78de464e4f8a52d606e140b35" title="foedus::storage::PageVersion\lStatus::set_has_next_page" alt="" coords="915,71,1107,112"/>
<area shape="rect" id="node35" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ab6a68802f41a8b163aae60825c4ebd38" title="foedus::storage::hash\l::ReserveRecords::find\l_and_lock_spacious_tail" alt="" coords="433,1483,597,1539"/>
<area shape="rect" id="node42" href="classfoedus_1_1thread_1_1Thread.html#a383dee9d2971403e9bc3bef4a2d33d44" title="Takes a lock for a sysxct running under this thread. " alt="" coords="440,1803,591,1844"/>
<area shape="rect" id="node37" href="classfoedus_1_1thread_1_1Thread.html#ade1f89cfaad84ff5dda0b6f7999a519e" title="Shorthand for get_global_volatile_page_resolver.resolve_offset() " alt="" coords="935,2059,1086,2100"/>
<area shape="rect" id="node38" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="1192,2087,1343,2143"/>
<area shape="rect" id="node39" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f" title="Resolves offset plus NUMA node ID to storage::Page*. " alt="" coords="1166,2021,1369,2063"/>
<area shape="rect" id="node41" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a2cd3cb727c6e211c8e6a72ccb00f3854" title="foedus::thread::ThreadPimpl\l::sysxct_page_lock" alt="" coords="919,1861,1103,1903"/>
<area shape="rect" id="node43" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a056563bc302fb45ad684a7fa28d00161" title="foedus::thread::ThreadPimpl\l::sysxct_record_lock" alt="" coords="667,1796,851,1837"/>
<area shape="rect" id="node45" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#a35da6a7faa712cb7cf70355803634063" title="foedus::storage::hash\l::HashDataPage::Slot\l::get_aligned_key_length" alt="" coords="432,1722,599,1778"/>
<area shape="rect" id="node48" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e" title="Search for a physical slot that exactly contains the given key. " alt="" coords="929,814,1093,870"/>
<area shape="rect" id="node49" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a4e5601b652daaffbcb9fa81aee6746c6" title="foedus::storage::hash\l::DataPageBloomFilter\l::contains" alt="" coords="1191,821,1344,877"/>
<area shape="rect" id="node50" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a28a11a7b04e04d895b21f29709eacd1f" title="foedus::storage::hash\l::DataPageBloomFilter\l::extract_fingerprint" alt="" coords="1191,741,1344,797"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_icgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_ad189e0523907caacae334102d9383b15_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e" title="Execute the system transaction. " alt="" coords="205,13,356,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7e1a17602380cbf9c736d93591a84f5e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::storage::hash::ReserveRecords::run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *&#160;</td>
          <td class="paramname"><em>sysxct_workspace</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute the system transaction. </p>
<p>You should override this method. </p>

<p>Implements <a class="el" href="structfoedus_1_1xct_1_1SysxctFunctor.html#a383a9cfd5d8fa5caf45c7ffb6dc05535">foedus::xct::SysxctFunctor</a>.</p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00031">31</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="hash__reserve__impl_8hpp_source.html#l00113">aggressive_payload_count_hint_</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00124">hint_check_from_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00106">payload_count_</a>, and <a class="el" href="hash__reserve__impl_8hpp_source.html#l00095">target_</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                                                  {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">aggressive_payload_count_hint_</a> &gt;= <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">payload_count_</a>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15">find_or_create_or_expand</a>(sysxct_workspace, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acdbcbeccc292c431d3dc6d76948b597f">target_</a>, <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aa13c8c6d82babdbbd970634b33179bb4">hint_check_from_</a>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acdbcbeccc292c431d3dc6d76948b597f"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acdbcbeccc292c431d3dc6d76948b597f">foedus::storage::hash::ReserveRecords::target_</a></div><div class="ttdeci">HashDataPage *const target_</div><div class="ttdoc">The data page to install a new physical record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00095">hash_reserve_impl.hpp:95</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a972e277f807b48c13caa20aa32d20721"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a972e277f807b48c13caa20aa32d20721">foedus::storage::hash::ReserveRecords::payload_count_</a></div><div class="ttdeci">const PayloadLength payload_count_</div><div class="ttdoc">Minimal required length of the payload. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00106">hash_reserve_impl.hpp:106</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad189e0523907caacae334102d9383b15"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15">foedus::storage::hash::ReserveRecords::find_or_create_or_expand</a></div><div class="ttdeci">ErrorCode find_or_create_or_expand(xct::SysxctWorkspace *sysxct_workspace, HashDataPage *page, DataPageSlotIndex examined_records)</div><div class="ttdoc">The main loop (well, recursion actually). </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8cpp_source.html#l00036">hash_reserve_impl.cpp:36</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_aa13c8c6d82babdbbd970634b33179bb4"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#aa13c8c6d82babdbbd970634b33179bb4">foedus::storage::hash::ReserveRecords::hint_check_from_</a></div><div class="ttdeci">const DataPageSlotIndex hint_check_from_</div><div class="ttdoc">The in-page location from which this sysxct will look for matching records. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00124">hash_reserve_impl.hpp:124</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_acd97205289303877be35fa02b41ca235"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acd97205289303877be35fa02b41ca235">foedus::storage::hash::ReserveRecords::aggressive_payload_count_hint_</a></div><div class="ttdeci">const PayloadLength aggressive_payload_count_hint_</div><div class="ttdoc">When we expand the record or allocate a new record, we might allocate a larger-than-necessary space g...</div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00113">hash_reserve_impl.hpp:113</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a7e1a17602380cbf9c736d93591a84f5e_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a7e1a17602380cbf9c736d93591a84f5e_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a7e1a17602380cbf9c736d93591a84f5e_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a7e1a17602380cbf9c736d93591a84f5e_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15" title="The main loop (well, recursion actually). " alt="" coords="204,1357,356,1413"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#acc93c206465207018eb9e29a5fa5342b" title="Installs it as a fresh&#45;new physical record, assuming the given page is the tail and already locked..." alt="" coords="406,1165,577,1221"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="1353,542,1579,583"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac2e82163d7348a6c88fecff711025b08" title="foedus::storage::hash\l::HashDataPage::get_slot" alt="" coords="1381,269,1551,310"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="1127,1602,1291,1643"/>
<area shape="rect" id="node24" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2fa612bf9214b1d94366eba360167df" title="foedus::storage::hash\l::HashDataPage::is_locked" alt="" coords="1119,975,1299,1017"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32" title="foedus::storage::hash\l::HashDataPage::next_page" alt="" coords="1117,1667,1302,1709"/>
<area shape="rect" id="node35" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a846dcb3f3938a2b266756e2d95c0df76" title="foedus::storage::hash\l::ReserveRecords::expand\l_record" alt="" coords="404,531,579,587"/>
<area shape="rect" id="node37" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118" title="resolve() plus reinterpret_cast " alt="" coords="882,1791,1033,1833"/>
<area shape="rect" id="node41" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255" title="Takes a page lock in the same page for a sysxct running under this thread. " alt="" coords="882,1623,1033,1665"/>
<area shape="rect" id="node45" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#add6863451ba01bcf490fc84d86a7c579" title="foedus::storage::hash\l::HashDataPage::Slot\l::get_max_payload" alt="" coords="417,375,565,431"/>
<area shape="rect" id="node47" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="405,1842,578,1883"/>
<area shape="rect" id="node48" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a0947f74956ac95cf143ff61f6493dcc4" title="foedus::storage::hash\l::ReserveRecords::search\l_within_page" alt="" coords="872,1260,1043,1316"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a958308b83b377f31e6b01b39979e23b2" title="Appends a new physical record to the page. " alt="" coords="627,640,801,696"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ae4d03b6ce42261195e565bdccaeb12b9" title="Returns usable space in bytes. " alt="" coords="849,509,1065,550"/>
<area shape="rect" id="node13" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="871,925,1044,966"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a446f51ede965fce59769df74a0044dd8" title="returns physical_record_length_ for a new record " alt="" coords="851,261,1064,302"/>
<area shape="rect" id="node16" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a22cd4e9f8619968685921c525d6fa4b8" title="foedus::storage::hash\l::ReserveRecords::create\l_new_tail_page" alt="" coords="873,1340,1041,1396"/>
<area shape="rect" id="node27" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="1129,1041,1290,1082"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a2203e4757be26e410e6f49263e439c53" title="foedus::storage::hash\l::HashDataPage::get_volatile\l_page_id" alt="" coords="863,327,1052,383"/>
<area shape="rect" id="node31" href="structfoedus_1_1xct_1_1XctId.html#ad18a2d4a528fa063786b6efaf1035377" title="foedus::xct::XctId::set" alt="" coords="640,1268,788,1295"/>
<area shape="rect" id="node32" href="structfoedus_1_1xct_1_1XctId.html#a4fe6746e50f7bd8ca61c9d141eafc8a2" title="foedus::xct::XctId\l::set_deleted" alt="" coords="653,1202,775,1243"/>
<area shape="rect" id="node33" href="structfoedus_1_1storage_1_1PageVersion.html#af79f8865c1a91b11b10bc0a24f40b22e" title="foedus::storage::PageVersion\l::set_has_next_page" alt="" coords="861,1042,1053,1083"/>
<area shape="rect" id="node5" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a41762390daf4751147dee762c64d8a61" title="Adds the fingerprint to this bloom filter. " alt="" coords="866,677,1049,718"/>
<area shape="rect" id="node6" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="1129,268,1289,295"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a9ac1ba8382fecd225d2ad1b6e13dae55" title="Returns offset of a next record. " alt="" coords="1134,444,1285,500"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a501d3dfae095bac5a8f35d578ab9bfab" title="foedus::storage::hash\l::HashDataPage::get_new_slot" alt="" coords="857,807,1058,849"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1PageHeader.html#a3f361aa72342a7354ef9b8130b10d21f" title="foedus::storage::PageHeader\l::increment_key_count" alt="" coords="862,742,1053,783"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07" title="foedus::storage::hash\l::HashDataPage::record\l_from_offset" alt="" coords="1385,648,1547,704"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd" title="foedus::storage::hash\l::HashDataPage::get_bin" alt="" coords="1383,1525,1549,1566"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a47a8118e0aa8c3ce3c5c6138f2f1aa8c" title="foedus::storage::hash\l::HashDataPage::get_bin\l_shifts" alt="" coords="1383,1425,1549,1481"/>
<area shape="rect" id="node19" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="1385,1342,1547,1383"/>
<area shape="rect" id="node20" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e" title="Returns the private memory repository of this thread. " alt="" coords="1134,1223,1285,1265"/>
<area shape="rect" id="node21" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98" title="Wrapper for grab_free_volatile_page(). " alt="" coords="1117,1289,1301,1345"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a03dc5746931434bcc27b2b3b6856c33f" title="foedus::storage::hash\l::HashDataPage::initialize\l_volatile_page" alt="" coords="1123,1471,1295,1527"/>
<area shape="rect" id="node28" href="classfoedus_1_1thread_1_1Thread.html#a5a3d3dfea35515ae7971106bce95b242" title="foedus::thread::Thread\l::resolve_newpage_cast" alt="" coords="1129,1158,1289,1199"/>
<area shape="rect" id="node25" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="1370,975,1562,1017"/>
<area shape="rect" id="node26" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="1627,975,1796,1017"/>
<area shape="rect" id="node34" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac07d54d78de464e4f8a52d606e140b35" title="foedus::storage::PageVersion\lStatus::set_has_next_page" alt="" coords="1113,677,1305,718"/>
<area shape="rect" id="node36" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ab6a68802f41a8b163aae60825c4ebd38" title="foedus::storage::hash\l::ReserveRecords::find\l_and_lock_spacious_tail" alt="" coords="632,1071,796,1127"/>
<area shape="rect" id="node43" href="classfoedus_1_1thread_1_1Thread.html#a383dee9d2971403e9bc3bef4a2d33d44" title="Takes a lock for a sysxct running under this thread. " alt="" coords="639,263,789,305"/>
<area shape="rect" id="node38" href="classfoedus_1_1thread_1_1Thread.html#ade1f89cfaad84ff5dda0b6f7999a519e" title="Shorthand for get_global_volatile_page_resolver.resolve_offset() " alt="" coords="1134,1798,1285,1839"/>
<area shape="rect" id="node39" href="classfoedus_1_1thread_1_1Thread.html#aa77cde98794b5a55e0d295284acb3e6d" title="Returns the page resolver to convert page ID to page pointer. " alt="" coords="1391,1753,1541,1809"/>
<area shape="rect" id="node40" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f" title="Resolves offset plus NUMA node ID to storage::Page*. " alt="" coords="1365,1834,1567,1875"/>
<area shape="rect" id="node42" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a2cd3cb727c6e211c8e6a72ccb00f3854" title="foedus::thread::ThreadPimpl\l::sysxct_page_lock" alt="" coords="1117,1733,1301,1774"/>
<area shape="rect" id="node44" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a056563bc302fb45ad684a7fa28d00161" title="foedus::thread::ThreadPimpl\l::sysxct_record_lock" alt="" coords="865,195,1049,237"/>
<area shape="rect" id="node46" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#a35da6a7faa712cb7cf70355803634063" title="foedus::storage::hash\l::HashDataPage::Slot\l::get_aligned_key_length" alt="" coords="631,175,797,231"/>
<area shape="rect" id="node49" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e" title="Search for a physical slot that exactly contains the given key. " alt="" coords="1127,793,1291,849"/>
<area shape="rect" id="node50" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a4e5601b652daaffbcb9fa81aee6746c6" title="foedus::storage::hash\l::DataPageBloomFilter\l::contains" alt="" coords="1389,793,1543,849"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0947f74956ac95cf143ff61f6493dcc4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> foedus::storage::hash::ReserveRecords::search_within_page </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a> *&#160;</td>
          <td class="paramname"><em>page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td>
          <td class="paramname"><em>key_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>&#160;</td>
          <td class="paramname"><em>examined_records</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="hash__reserve__impl_8cpp_source.html#l00244">244</a> of file <a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00102">combo_</a>, <a class="el" href="hash__combo_8hpp_source.html#l00051">foedus::storage::hash::HashCombo::fingerprint_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00246">foedus::storage::hash::HashDataPage::get_record_count()</a>, <a class="el" href="hash__combo_8hpp_source.html#l00049">foedus::storage::hash::HashCombo::hash_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00225">foedus::storage::hash::HashDataPage::header()</a>, <a class="el" href="page_8hpp_source.html#l00138">foedus::storage::PageVersion::is_locked()</a>, <a class="el" href="storage__id_8hpp_source.html#l00210">foedus::storage::VolatilePagePointer::is_null()</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00097">key_</a>, <a class="el" href="hash__reserve__impl_8hpp_source.html#l00104">key_length_</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00238">foedus::storage::hash::HashDataPage::next_page()</a>, <a class="el" href="page_8hpp_source.html#l00272">foedus::storage::PageHeader::page_version_</a>, <a class="el" href="hash__page__impl_8cpp_source.html#l00106">foedus::storage::hash::HashDataPage::search_key_physical()</a>, <a class="el" href="page_8hpp_source.html#l00211">foedus::storage::PageHeader::snapshot_</a>, and <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>.</p>
<div class="fragment"><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                            {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!page-&gt;header().snapshot_);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;header().page_version_.is_locked()</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    || !page-&gt;next_page().volatile_pointer_.is_null());</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(key_count == page-&gt;get_record_count());</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">return</span> page-&gt;search_key_physical(</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">combo_</a>.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">combo_</a>.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">fingerprint_</a>,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a313e539df6d2141feee95e34811cb3e2">key_</a>,</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">key_length_</a>,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    key_count,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    examined_records);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a313e539df6d2141feee95e34811cb3e2"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a313e539df6d2141feee95e34811cb3e2">foedus::storage::hash::ReserveRecords::key_</a></div><div class="ttdeci">const void *const key_</div><div class="ttdoc">The key of the new record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00097">hash_reserve_impl.hpp:97</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a92629528d23870897ae37aeff4dc4b8b"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a92629528d23870897ae37aeff4dc4b8b">foedus::storage::hash::ReserveRecords::key_length_</a></div><div class="ttdeci">const KeyLength key_length_</div><div class="ttdoc">Byte length of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00104">hash_reserve_impl.hpp:104</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_a19d9cee1d8cd64d33d7645b59b6536fd"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">foedus::storage::hash::HashCombo::hash_</a></div><div class="ttdeci">HashValue hash_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00049">hash_combo.hpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_a7dd89264e53c0c98b32e883ab6800ba1"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">foedus::storage::hash::HashCombo::fingerprint_</a></div><div class="ttdeci">BloomFilterFingerprint fingerprint_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00051">hash_combo.hpp:51</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_a1cb9976c1cdec59a897a4e757fe0a0d4"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a1cb9976c1cdec59a897a4e757fe0a0d4">foedus::storage::hash::ReserveRecords::combo_</a></div><div class="ttdeci">const HashCombo &amp; combo_</div><div class="ttdoc">Hash info of the key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00102">hash_reserve_impl.hpp:102</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_cgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51" title="foedus::storage::hash\l::HashDataPage::get_record_count" alt="" coords="464,195,689,236"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d" title="foedus::storage::hash\l::HashDataPage::header" alt="" coords="238,71,402,112"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="224,5,416,47"/>
<area shape="rect" id="node7" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="239,136,401,177"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32" title="foedus::storage::hash\l::HashDataPage::next_page" alt="" coords="227,253,413,295"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e" title="Search for a physical slot that exactly contains the given key. " alt="" coords="238,355,402,411"/>
<area shape="rect" id="node5" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="492,5,661,47"/>
<area shape="rect" id="node6" href="structfoedus_1_1xct_1_1McsWwBlockData.html#aa6a3e9b495bb234bf4c840a0e43d082e" title="foedus::xct::McsWwBlockData\l::is_valid_relaxed" alt="" coords="737,5,939,47"/>
<area shape="rect" id="node8" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="496,129,657,171"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a4e5601b652daaffbcb9fa81aee6746c6" title="foedus::storage::hash\l::DataPageBloomFilter\l::contains" alt="" coords="500,471,653,527"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a28a11a7b04e04d895b21f29709eacd1f" title="foedus::storage::hash\l::DataPageBloomFilter\l::extract_fingerprint" alt="" coords="500,551,653,607"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac2e82163d7348a6c88fecff711025b08" title="foedus::storage::hash\l::HashDataPage::get_slot" alt="" coords="491,632,662,673"/>
<area shape="rect" id="node14" href="group__HASH.html#ga8c4ca78e36b2188f1feac100ce7df679" title="Calculates hash value for general input. " alt="" coords="503,260,650,301"/>
<area shape="rect" id="node15" href="structfoedus_1_1xct_1_1XctId.html#a41264f4ced33dae443651f57bc09e964" title="foedus::xct::XctId\l::is_moved" alt="" coords="515,325,638,367"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07" title="foedus::storage::hash\l::HashDataPage::record\l_from_offset" alt="" coords="496,391,657,447"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_icgraph" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_a0947f74956ac95cf143ff61f6493dcc4_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad189e0523907caacae334102d9383b15" title="The main loop (well, recursion actually). " alt="" coords="224,5,376,61"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#a7e1a17602380cbf9c736d93591a84f5e" title="Execute the system transaction. " alt="" coords="424,13,575,54"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="acd97205289303877be35fa02b41ca235"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a> foedus::storage::hash::ReserveRecords::aggressive_payload_count_hint_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>When we expand the record or allocate a new record, we might allocate a larger-than-necessary space guided by this hint. </p>
<p>It's useful to avoid future record expansion. </p><dl class="section pre"><dt>Precondition</dt><dd>aggressive_payload_count_hint_ &gt;= payload_count_ </dd></dl>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00113">113</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">append_record_to_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">create_new_record_in_tail_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00139">find_and_lock_spacious_tail()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00031">run()</a>.</p>

</div>
</div>
<a class="anchor" id="a1cb9976c1cdec59a897a4e757fe0a0d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; foedus::storage::hash::ReserveRecords::combo_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hash info of the key. </p>
<p>It's &amp;, so lifetime of the caller's <a class="el" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html" title="A set of information that are used in many places, extracted from the given key. ">HashCombo</a> object must be longer than this sysxct. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00102">102</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">append_record_to_page()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00244">search_within_page()</a>.</p>

</div>
</div>
<a class="anchor" id="aac7ca8e18b21379d89a60450c41fbdb3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* const foedus::storage::hash::ReserveRecords::context_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread context. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00075">75</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00187">create_new_tail_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00139">find_and_lock_spacious_tail()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>.</p>

</div>
</div>
<a class="anchor" id="aa13c8c6d82babdbbd970634b33179bb4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> foedus::storage::hash::ReserveRecords::hint_check_from_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The in-page location from which this sysxct will look for matching records. </p>
<p>The caller is <em>sure</em> that no record before this position can match the slice. Thanks to append-only writes in data pages, the caller can guarantee that the records it observed are final.</p>
<p>In most cases, this is same as key_count after locking, thus completely avoiding the re-check. In some cases, the caller already found a matching key in this index, but even in that case this sysxct must re-search after locking because the record might be now moved. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00124">124</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00031">run()</a>.</p>

</div>
</div>
<a class="anchor" id="a313e539df6d2141feee95e34811cb3e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void* const foedus::storage::hash::ReserveRecords::key_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The key of the new record. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00097">97</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">append_record_to_page()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00244">search_within_page()</a>.</p>

</div>
</div>
<a class="anchor" id="a92629528d23870897ae37aeff4dc4b8b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="group__HASH.html#ga80072e9a1d445f90ee2bd91a16a44267">KeyLength</a> foedus::storage::hash::ReserveRecords::key_length_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Byte length of the key. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00104">104</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">append_record_to_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">create_new_record_in_tail_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00139">find_and_lock_spacious_tail()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00244">search_within_page()</a>.</p>

</div>
</div>
<a class="anchor" id="ad95de6d2f7cbec7e2d08f758d5165166"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* foedus::storage::hash::ReserveRecords::out_page_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>[Out] The page that contains the found/created record. </p>
<p>As far as this sysxct returns kErrorCodeOk, out_page_ is either the target_ itself or some page after target_. </p><dl class="section post"><dt>Postcondition</dt><dd>out_page_ != nullptr </dd></dl>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00140">140</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">create_new_record_in_tail_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>, and <a class="el" href="hash__storage__pimpl_8cpp_source.html#l01074">foedus::storage::hash::HashStoragePimpl::locate_record_reserve_physical()</a>.</p>

</div>
</div>
<a class="anchor" id="ad34d7b80062bae0e2a0cb703109d848c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> foedus::storage::hash::ReserveRecords::out_slot_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>[Out] The slot of the record that is found or created. </p>
<p>As far as this sysxct returns kErrorCodeOk, this guarantees the following. </p><dl class="section post"><dt>Postcondition</dt><dd>out_slot_ != kSlotNotFound </dd>
<dd>
out_page_'s out_slot_ is at least at some point a valid non-moved record of the given key with satisfying max-payload length. </dd></dl>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00133">133</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00208">create_new_record_in_tail_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00101">expand_record()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>, and <a class="el" href="hash__storage__pimpl_8cpp_source.html#l01074">foedus::storage::hash::HashStoragePimpl::locate_record_reserve_physical()</a>.</p>

</div>
</div>
<a class="anchor" id="a972e277f807b48c13caa20aa32d20721"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="group__HASH.html#ga5a9515ea30058385c47f1d22ff400494">PayloadLength</a> foedus::storage::hash::ReserveRecords::payload_count_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Minimal required length of the payload. </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00106">106</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00261">append_record_to_page()</a>, <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00031">run()</a>.</p>

</div>
</div>
<a class="anchor" id="acdbcbeccc292c431d3dc6d76948b597f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* const foedus::storage::hash::ReserveRecords::target_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The data page to install a new physical record. </p>
<p>This might NOT be the head page of the hash bin. The contract here is that the caller must be sure that any pages before this page in the chain must not contain a record of the given key that is not marked as moved. In other words, the caller must have checked that there is no such record before hint_check_from_ of target_.</p>
<ul>
<li>Example 1: the caller found an existing record in target_ that is not moved. hint_check_from_ &lt; target_-&gt;get_key_count(), and target_ might not be the tail of the bin. </li>
<li>Example 2: the caller found no existing non-moved record. hint_check_from_ == target_-&gt;get_key_count(), and target_ is the tail of the bin.</li>
</ul>
<p>Of course, by the time this sysxct takes a lock, other threads might insert more records, some of which might have the key. This sysxct thus needs to resume search from target_ and hint_check_from_ (but, not anywhere before!). </p>

<p>Definition at line <a class="el" href="hash__reserve__impl_8hpp_source.html#l00095">95</a> of file <a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="hash__reserve__impl_8cpp_source.html#l00036">find_or_create_or_expand()</a>, and <a class="el" href="hash__reserve__impl_8cpp_source.html#l00031">run()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/storage/hash/<a class="el" href="hash__reserve__impl_8hpp_source.html">hash_reserve_impl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/storage/hash/<a class="el" href="hash__reserve__impl_8cpp_source.html">hash_reserve_impl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage.html">storage</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html">hash</a></li><li class="navelem"><a class="el" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html">ReserveRecords</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
