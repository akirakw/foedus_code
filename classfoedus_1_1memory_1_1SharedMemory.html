<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::memory::SharedMemory Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1memory_1_1SharedMemory.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classfoedus_1_1memory_1_1SharedMemory-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::memory::SharedMemory Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__MEMORY.html">Memory Manager</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Represents memory shared between processes.  
 <a href="classfoedus_1_1memory_1_1SharedMemory.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Represents memory shared between processes. </p>
<p>This class was initially a part of <a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html" title="Represents one memory block aligned to actual OS/hardware pages. ">AlignedMemory</a>, but we separated it out to reflect the special semantics of this type of memory.</p>
<dl class="section user"><dt>Alloc/dealloc type</dt><dd>As this is a shared memory, there is only one choice unlike <a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html" title="Represents one memory block aligned to actual OS/hardware pages. ">AlignedMemory</a>. We always use shmget() with SHM_HUGETLB and shmat()/shmdt().</dd></dl>
<dl class="section user"><dt>Pros/cons of System-V shmget()</dt><dd>We made this choice of share memory allocation API after trying all available options. The biggest pro of System-V shmget is that it does not need to mount a hugetlbfs for allocating hugepages. The cons are that it can't exceed kernel.shmmax and also we have to do a linux-dependent trick to reliably release the shared memory. For other choices, see the sections below.</dd></dl>
<dl class="section user"><dt>Ownership</dt><dd>Every shared memory is allocated and owned by the master process. Forked/execed child processes, whether they are 'emulated' processes or not, do not have ownership thus should not release them at exit.</dd></dl>
<dl class="section user"><dt>Moveable/Copiable</dt><dd>This object is <em>NOT</em> copiable. This object <em>is</em> moveable (the original object becomes null after the move).</dd></dl>
<dl class="section user"><dt>Why not POSIX shm_open()</dt><dd>It can't use hugepages, period. shm_open is preferable because it's POSIX standard and also allows friendly naming to uniquefy the shared memory unlike shmget()'s integer ID. However, so far it doesn't allow hugepages and also we have to manually delete the file under /dev/shm.</dd></dl>
<dl class="section user"><dt>Why not open() and mmap() with MAP_SHARED</dt><dd>It requires mounting hugetlbfs and also the user has to specify the path of the mounted file system in our configuration. This open/mmap is preferable because it is not affected by kernel.shmmax, which was an 'oversight' and might be corrected later, though. See the LWN article.</dd></dl>
<dl class="section user"><dt>Why not mmap() with MAP_PRIVATE and MAP_SHARED</dt><dd>To allow sharing memory between arbitrary processes, we need non-private shared memory.</dd></dl>
<dl class="section user"><dt>Debugging shared memories</dt><dd>ipcs -m ipcrm, etc etc.</dd></dl>
<dl class="section user"><dt>Valgrind, shmat, and hugepages</dt><dd>Seems like valgrind has a bug on shmat with hugepages. I filed a bug report, not sure how it will be resolved. This causes all valgrind execution to fail on almost all testcases, crap. As a tentative work around, I check whether we are running on valgrind and, if so, get rid of SHM_HUGETLB from shmget call. Just for this reason, we have to include valgrind headers. gggrrrr.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="http://lwn.net/Articles/375096/">http://lwn.net/Articles/375096/</a> </dd>
<dd>
<a href="https://groups.google.com/forum/#!topic/fa.linux.kernel/OKplGDFf3EU">https://groups.google.com/forum/#!topic/fa.linux.kernel/OKplGDFf3EU</a> </dd>
<dd>
<a href="http://www.linuxquestions.org/questions/programming-9/shmctl-ipc_rmid-precludes-further-attachments-574636/">http://www.linuxquestions.org/questions/programming-9/shmctl-ipc_rmid-precludes-further-attachments-574636/</a> </dd>
<dd>
<a href="https://bugs.kde.org/show_bug.cgi?id=338995">https://bugs.kde.org/show_bug.cgi?id=338995</a> </dd></dl>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00092">92</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0ca7f06c5429a0aabac805bd5623d9b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a0ca7f06c5429a0aabac805bd5623d9b2">SharedMemory</a> () noexcept</td></tr>
<tr class="memdesc:a0ca7f06c5429a0aabac805bd5623d9b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Empty constructor which allocates nothing.  <a href="#a0ca7f06c5429a0aabac805bd5623d9b2">More...</a><br /></td></tr>
<tr class="separator:a0ca7f06c5429a0aabac805bd5623d9b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4efec9c14733903d9b3f8322c48653fa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a4efec9c14733903d9b3f8322c48653fa">SharedMemory</a> (const <a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;other)=delete</td></tr>
<tr class="separator:a4efec9c14733903d9b3f8322c48653fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab36c97fb46ab43c7c770221276289378"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#ab36c97fb46ab43c7c770221276289378">operator=</a> (const <a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;other)=delete</td></tr>
<tr class="separator:ab36c97fb46ab43c7c770221276289378"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2a36c9c9ec83ebe1a4239e486e640ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#ac2a36c9c9ec83ebe1a4239e486e640ee">SharedMemory</a> (<a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&amp;other) noexcept</td></tr>
<tr class="memdesc:ac2a36c9c9ec83ebe1a4239e486e640ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move constructor that steals the memory block from other.  <a href="#ac2a36c9c9ec83ebe1a4239e486e640ee">More...</a><br /></td></tr>
<tr class="separator:ac2a36c9c9ec83ebe1a4239e486e640ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afab2d81be8ba9c96b24dcf977cc3b792"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#afab2d81be8ba9c96b24dcf977cc3b792">operator=</a> (<a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&amp;other) noexcept</td></tr>
<tr class="memdesc:afab2d81be8ba9c96b24dcf977cc3b792"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move assignment operator that steals the memory block from other.  <a href="#afab2d81be8ba9c96b24dcf977cc3b792">More...</a><br /></td></tr>
<tr class="separator:afab2d81be8ba9c96b24dcf977cc3b792"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7094d7eaf5f5c149a5d52fd9ce6fadd0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a7094d7eaf5f5c149a5d52fd9ce6fadd0">~SharedMemory</a> ()</td></tr>
<tr class="memdesc:a7094d7eaf5f5c149a5d52fd9ce6fadd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automatically releases the memory.  <a href="#a7094d7eaf5f5c149a5d52fd9ce6fadd0">More...</a><br /></td></tr>
<tr class="separator:a7094d7eaf5f5c149a5d52fd9ce6fadd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4b91eee2dce03e4b3aac612c71b88a0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#ae4b91eee2dce03e4b3aac612c71b88a0">alloc</a> (const std::string &amp;meta_path, uint64_t size, int numa_node, bool use_hugepages)</td></tr>
<tr class="memdesc:ae4b91eee2dce03e4b3aac612c71b88a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Newly allocate a shared memory of given size on given NUMA node.  <a href="#ae4b91eee2dce03e4b3aac612c71b88a0">More...</a><br /></td></tr>
<tr class="separator:ae4b91eee2dce03e4b3aac612c71b88a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a690fd766729121b64adf28994a8a6660"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a690fd766729121b64adf28994a8a6660">attach</a> (const std::string &amp;meta_path, bool use_hugepages)</td></tr>
<tr class="memdesc:a690fd766729121b64adf28994a8a6660"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attach an already-allocated shared memory so that this object points to the memory.  <a href="#a690fd766729121b64adf28994a8a6660">More...</a><br /></td></tr>
<tr class="separator:a690fd766729121b64adf28994a8a6660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac24326b29b0401f44562037b832b3b50"><td class="memItemLeft" align="right" valign="top">const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#ac24326b29b0401f44562037b832b3b50">get_meta_path</a> () const </td></tr>
<tr class="memdesc:ac24326b29b0401f44562037b832b3b50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the path of the meta file.  <a href="#ac24326b29b0401f44562037b832b3b50">More...</a><br /></td></tr>
<tr class="separator:ac24326b29b0401f44562037b832b3b50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a085dfb81511ba8e4c0563b5a72967113"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a085dfb81511ba8e4c0563b5a72967113">get_block</a> () const </td></tr>
<tr class="memdesc:a085dfb81511ba8e4c0563b5a72967113"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the memory block.  <a href="#a085dfb81511ba8e4c0563b5a72967113">More...</a><br /></td></tr>
<tr class="separator:a085dfb81511ba8e4c0563b5a72967113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaec93b4eba6a84195c7a8310bf6acaf4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#aaec93b4eba6a84195c7a8310bf6acaf4">get_shmid</a> () const </td></tr>
<tr class="memdesc:aaec93b4eba6a84195c7a8310bf6acaf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the ID of this shared memory.  <a href="#aaec93b4eba6a84195c7a8310bf6acaf4">More...</a><br /></td></tr>
<tr class="separator:aaec93b4eba6a84195c7a8310bf6acaf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb4a83545d0c98d5def2b8763d3757cd"><td class="memItemLeft" align="right" valign="top">key_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#abb4a83545d0c98d5def2b8763d3757cd">get_shmkey</a> () const </td></tr>
<tr class="memdesc:abb4a83545d0c98d5def2b8763d3757cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the key of this shared memory.  <a href="#abb4a83545d0c98d5def2b8763d3757cd">More...</a><br /></td></tr>
<tr class="separator:abb4a83545d0c98d5def2b8763d3757cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36936f0f3e6544b85ac6c96639ea78f6"><td class="memItemLeft" align="right" valign="top">pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a36936f0f3e6544b85ac6c96639ea78f6">get_owner_pid</a> () const </td></tr>
<tr class="memdesc:a36936f0f3e6544b85ac6c96639ea78f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">If non-zero, it means the ID of the process that allocated the shared memory.  <a href="#a36936f0f3e6544b85ac6c96639ea78f6">More...</a><br /></td></tr>
<tr class="separator:a36936f0f3e6544b85ac6c96639ea78f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbdca7a06f5b1fe14cba7c718c822ac4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#acbdca7a06f5b1fe14cba7c718c822ac4">is_null</a> () const </td></tr>
<tr class="memdesc:acbdca7a06f5b1fe14cba7c718c822ac4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns if this object doesn't hold a valid memory block.  <a href="#acbdca7a06f5b1fe14cba7c718c822ac4">More...</a><br /></td></tr>
<tr class="separator:acbdca7a06f5b1fe14cba7c718c822ac4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83f0c9b29ecfc29550923dd33bc031e7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7">is_owned</a> () const </td></tr>
<tr class="memdesc:a83f0c9b29ecfc29550923dd33bc031e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns if this process owns this memory and is responsible to delete it.  <a href="#a83f0c9b29ecfc29550923dd33bc031e7">More...</a><br /></td></tr>
<tr class="separator:a83f0c9b29ecfc29550923dd33bc031e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab37b24a74d0fd12e840ea3bf4940201"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#aab37b24a74d0fd12e840ea3bf4940201">get_size</a> () const </td></tr>
<tr class="memdesc:aab37b24a74d0fd12e840ea3bf4940201"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the byte size of the memory block.  <a href="#aab37b24a74d0fd12e840ea3bf4940201">More...</a><br /></td></tr>
<tr class="separator:aab37b24a74d0fd12e840ea3bf4940201"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a130260a4506071e814d2c2a531d82913"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a130260a4506071e814d2c2a531d82913">get_numa_node</a> () const </td></tr>
<tr class="memdesc:a130260a4506071e814d2c2a531d82913"><td class="mdescLeft">&#160;</td><td class="mdescRight">Where the physical memory is allocated.  <a href="#a130260a4506071e814d2c2a531d82913">More...</a><br /></td></tr>
<tr class="separator:a130260a4506071e814d2c2a531d82913"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06fa097c286b762b8ae484076592bf0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d">mark_for_release</a> ()</td></tr>
<tr class="memdesc:a06fa097c286b762b8ae484076592bf0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks the shared memory as being removed so that it will be reclaimed when all processes detach it.  <a href="#a06fa097c286b762b8ae484076592bf0d">More...</a><br /></td></tr>
<tr class="separator:a06fa097c286b762b8ae484076592bf0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20f2fb7b7f86ab5c4134452f1267eeb5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">release_block</a> ()</td></tr>
<tr class="memdesc:a20f2fb7b7f86ab5c4134452f1267eeb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases the memory block <b>IF</b> this process has an ownership.  <a href="#a20f2fb7b7f86ab5c4134452f1267eeb5">More...</a><br /></td></tr>
<tr class="separator:a20f2fb7b7f86ab5c4134452f1267eeb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a29955c22e38ba60c6b3c61891592c9c9"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html#a29955c22e38ba60c6b3c61891592c9c9">operator&lt;&lt;</a> (std::ostream &amp;o, const <a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;v)</td></tr>
<tr class="separator:a29955c22e38ba60c6b3c61891592c9c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a0ca7f06c5429a0aabac805bd5623d9b2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::memory::SharedMemory::SharedMemory </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Empty constructor which allocates nothing. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00095">95</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    : size_(0), numa_node_(0), shmid_(0), shmkey_(0), owner_pid_(0), block_(<a class="code" href="group__CXX11.html#ga213f92e16813051c59cdccf6d28baa78">CXX11_NULLPTR</a>) {}</div>
<div class="ttc" id="group__CXX11_html_ga213f92e16813051c59cdccf6d28baa78"><div class="ttname"><a href="group__CXX11.html#ga213f92e16813051c59cdccf6d28baa78">CXX11_NULLPTR</a></div><div class="ttdeci">#define CXX11_NULLPTR</div><div class="ttdoc">Used in public headers in place of "nullptr" of C++11. </div><div class="ttdef"><b>Definition:</b> <a href="cxx11_8hpp_source.html#l00132">cxx11.hpp:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4efec9c14733903d9b3f8322c48653fa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::memory::SharedMemory::SharedMemory </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac2a36c9c9ec83ebe1a4239e486e640ee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::memory::SharedMemory::SharedMemory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Move constructor that steals the memory block from other. </p>

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00047">47</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                        : block_(<span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  *<span class="keyword">this</span> = std::move(other);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7094d7eaf5f5c149a5d52fd9ce6fadd0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::memory::SharedMemory::~SharedMemory </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Automatically releases the memory. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00114">114</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>References <a class="el" href="shared__memory_8cpp_source.html#l00222">release_block()</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{ <a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">release_block</a>(); }</div>
<div class="ttc" id="classfoedus_1_1memory_1_1SharedMemory_html_a20f2fb7b7f86ab5c4134452f1267eeb5"><div class="ttname"><a href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">foedus::memory::SharedMemory::release_block</a></div><div class="ttdeci">void release_block()</div><div class="ttdoc">Releases the memory block IF this process has an ownership. </div><div class="ttdef"><b>Definition:</b> <a href="shared__memory_8cpp_source.html#l00222">shared_memory.cpp:222</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a7094d7eaf5f5c149a5d52fd9ce6fadd0_cgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a7094d7eaf5f5c149a5d52fd9ce6fadd0_cgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a7094d7eaf5f5c149a5d52fd9ce6fadd0_cgraph" id="classfoedus_1_1memory_1_1SharedMemory_a7094d7eaf5f5c149a5d52fd9ce6fadd0_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5" title="Releases the memory block IF this process has an ownership. " alt="" coords="264,104,475,145"/>
<area shape="rect" id="node3" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7" title="Returns if this process owns this memory and is responsible to delete it. " alt="" coords="523,5,733,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d" title="Marks the shared memory as being removed so that it will be reclaimed when all processes detach it..." alt="" coords="523,71,733,112"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="558,136,698,177"/>
<area shape="rect" id="node6" href="group__FILESYSTEM.html#gad1f62b080fa246b5f8c166f44c72134f" title="Deletes a regular file or an empty directory. " alt="" coords="565,202,691,229"/>
<area shape="rect" id="node7" href="structfoedus_1_1fs_1_1FileStatus.html#ac4ab24d4308aab673c8d1606a84367e5" title="foedus::fs::FileStatus\l::exists" alt="" coords="781,129,927,171"/>
<area shape="rect" id="node8" href="structfoedus_1_1fs_1_1FileStatus.html#a76000c37b9fc4c1d9596240409972809" title="foedus::fs::FileStatus\l::is_regular_file" alt="" coords="781,195,927,236"/>
<area shape="rect" id="node9" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="793,261,915,287"/>
<area shape="rect" id="node10" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="975,261,1125,287"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ae4b91eee2dce03e4b3aac612c71b88a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::memory::SharedMemory::alloc </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>meta_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numa_node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>use_hugepages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Newly allocate a shared memory of given size on given NUMA node. </p>
<p>This method should be called only at the master process. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">meta_path</td><td>This method will create a temporary meta file of this path and use it to generate a unique ID via ftok() and also put the size of the memory as content. It must be unique, for example '/tmp/foedus_shm_[master-PID]_vpool_[node-ID]'. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Byte size of the memory block. Actual allocation is at least of this size. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numa_node</td><td>Where the physical memory is allocated. Use for binding via libnuma. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_hugepages</td><td>Whether to use hugepages. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section attention"><dt>Attention</dt><dd>When memory allocation fails for some reason (eg Out-Of-Memory), this method does NOT fail nor throws an exception. Instead, it sets the block_ NULL. So, the caller is responsible for checking it after construction. </dd></dl>

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00067">67</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>

<p>References <a class="el" href="error__stack_8hpp_source.html#l00498">ERROR_STACK_MSG</a>, <a class="el" href="filesystem_8hpp_source.html#l00128">foedus::fs::exists()</a>, <a class="el" href="rdtsc_8hpp_source.html#l00035">foedus::debugging::get_rdtsc()</a>, <a class="el" href="error__code_8hpp_source.html#l00220">foedus::kErrorCodeSocShmAllocFailed</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="assorted__func_8cpp_source.html#l00067">foedus::assorted::os_error()</a>, and <a class="el" href="shared__memory_8cpp_source.html#l00222">release_block()</a>.</p>

<p>Referenced by <a class="el" href="shared__memory__repo_8cpp_source.html#l00096">foedus::soc::SharedMemoryRepo::allocate_shared_memories()</a>.</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                      {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">release_block</a>();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">if</span> (size % (1ULL &lt;&lt; 21) != 0) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    size = ((size &gt;&gt; 21) + 1ULL) &lt;&lt; 21;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// create a meta file. we must first create it then generate key.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// shmkey will change whenever we modify the file.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4">fs::exists</a>(fs::Path(meta_path))) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    std::string msg = std::string(<span class="stringliteral">&quot;Shared memory meta file already exists:&quot;</span>) + meta_path;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a5bbd9f06ed3b0825f9842c555d0f5753">kErrorCodeSocShmAllocFailed</a>, msg.c_str());</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  std::ofstream file(meta_path, std::ofstream::binary);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (!file.is_open()) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    std::string msg = std::string(<span class="stringliteral">&quot;Failed to create shared memory meta file:&quot;</span>) + meta_path;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a5bbd9f06ed3b0825f9842c555d0f5753">kErrorCodeSocShmAllocFailed</a>, msg.c_str());</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// randomly generate shmkey. We initially used ftok(), but it occasionally gives lots of</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">// conflicts for some reason, esp on aarch64. we just need some random number, so here</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">// we use pid and CPU cycle.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  pid_t the_pid = ::getpid();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  uint64_t key64 = <a class="code" href="group__DEBUGGING.html#ga48dd46b3a1382506a34fcb4e6e0941f6">debugging::get_rdtsc</a>() ^ the_pid;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  key_t the_key = (key64 &gt;&gt; 32) ^ key64;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">if</span> (the_key == 0) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// rdtsc and getpid not working??</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    std::string msg = std::string(<span class="stringliteral">&quot;Dubious shmkey&quot;</span>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a5bbd9f06ed3b0825f9842c555d0f5753">kErrorCodeSocShmAllocFailed</a>, msg.c_str());</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// Write out the size/node/shmkey of the shared memory in the meta file</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  file.write(reinterpret_cast&lt;char*&gt;(&amp;size), <span class="keyword">sizeof</span>(size));</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  file.write(reinterpret_cast&lt;char*&gt;(&amp;numa_node), <span class="keyword">sizeof</span>(numa_node));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  file.write(reinterpret_cast&lt;char*&gt;(&amp;the_key), <span class="keyword">sizeof</span>(key_t));</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  file.flush();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  file.close();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  size_ = size;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  numa_node_ = numa_node;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  owner_pid_ = the_pid;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  meta_path_ = meta_path;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  shmkey_ = the_key;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// if this is running under valgrind, we have to avoid using hugepages due to a bug in valgrind.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// When we are running on valgrind, we don&#39;t care performance anyway. So shouldn&#39;t matter.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">if</span> (RUNNING_ON_VALGRIND) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    use_hugepages = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// see https://bugs.kde.org/show_bug.cgi?id=338995</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// Use libnuma&#39;s numa_set_preferred to initialize the NUMA node of the memory.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// This is the only way to control numa allocation for shared memory.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// mbind does nothing for shared memory.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  ScopedNumaPreferred numa_scope(numa_node, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  shmid_ = ::shmget(</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    shmkey_,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    size_,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    IPC_CREAT | IPC_EXCL | S_IRUSR | S_IWUSR | (use_hugepages ? SHM_HUGETLB : 0));</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">if</span> (shmid_ == -1) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    std::string msg = std::string(<span class="stringliteral">&quot;shmget() failed! size=&quot;</span>) + std::to_string(size_)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      + std::string(<span class="stringliteral">&quot;, os_error=&quot;</span>) + <a class="code" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">assorted::os_error</a>() + std::string(<span class="stringliteral">&quot;, meta_path=&quot;</span>) + meta_path;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a5bbd9f06ed3b0825f9842c555d0f5753">kErrorCodeSocShmAllocFailed</a>, msg.c_str());</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  block_ = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(::shmat(shmid_, <span class="keyword">nullptr</span>, 0));</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordflow">if</span> (block_ == reinterpret_cast&lt;void*&gt;(-1)) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    ::shmctl(shmid_, IPC_RMID, <span class="keyword">nullptr</span>);  <span class="comment">// first thing. release it! before everything else.</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    block_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    std::stringstream msg;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    msg &lt;&lt; <span class="stringliteral">&quot;shmat alloc failed!&quot;</span> &lt;&lt; *<span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;, error=&quot;</span> &lt;&lt; <a class="code" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">assorted::os_error</a>();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">release_block</a>();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    std::string str = msg.str();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a5bbd9f06ed3b0825f9842c555d0f5753">kErrorCodeSocShmAllocFailed</a>, str.c_str());</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  std::memset(block_, 0, size_);  <span class="comment">// see class comment for why we do this immediately</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">// This memset takes a very long time due to the issue in linux kernel:</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">// https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=8382d914ebf72092aa15cdc2a5dcedb2daa0209d</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// In linux 3.15 and later, this problem gets resolved and highly parallelizable.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div>
<div class="ttc" id="group__DEBUGGING_html_ga48dd46b3a1382506a34fcb4e6e0941f6"><div class="ttname"><a href="group__DEBUGGING.html#ga48dd46b3a1382506a34fcb4e6e0941f6">foedus::debugging::get_rdtsc</a></div><div class="ttdeci">uint64_t get_rdtsc()</div><div class="ttdoc">Returns the current CPU cycle via x86 RDTSC. </div><div class="ttdef"><b>Definition:</b> <a href="rdtsc_8hpp_source.html#l00035">rdtsc.hpp:35</a></div></div>
<div class="ttc" id="group__FILESYSTEM_html_ga4f8f53901e9c98fce72b6b3c52cf83a4"><div class="ttname"><a href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4">foedus::fs::exists</a></div><div class="ttdeci">bool exists(const Path &amp;p)</div><div class="ttdoc">Returns if the file exists. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8hpp_source.html#l00128">filesystem.hpp:128</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaaa260096daf8620266c2799d1f5a0270"><div class="ttname"><a href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">foedus::assorted::os_error</a></div><div class="ttdeci">std::string os_error()</div><div class="ttdoc">Thread-safe strerror(errno). </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8cpp_source.html#l00067">assorted_func.cpp:67</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gac6707c46c408c0bd492f44d648bf9e10"><div class="ttname"><a href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a></div><div class="ttdeci">#define ERROR_STACK_MSG(e, m)  </div><div class="ttdoc">Overload of ERROR_STACK(e) to receive a custom error message. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00498">error_stack.hpp:498</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a5bbd9f06ed3b0825f9842c555d0f5753"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a5bbd9f06ed3b0825f9842c555d0f5753">foedus::kErrorCodeSocShmAllocFailed</a></div><div class="ttdoc">0x0C01 : "SOC    : Failed to allocate a shared memory. This is usually caused by a misconfigured envi...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00220">error_code.hpp:220</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1SharedMemory_html_a20f2fb7b7f86ab5c4134452f1267eeb5"><div class="ttname"><a href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">foedus::memory::SharedMemory::release_block</a></div><div class="ttdeci">void release_block()</div><div class="ttdoc">Releases the memory block IF this process has an ownership. </div><div class="ttdef"><b>Definition:</b> <a href="shared__memory_8cpp_source.html#l00222">shared_memory.cpp:222</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_cgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_cgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_cgraph" id="classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_cgraph">
<area shape="rect" id="node2" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4" title="Returns if the file exists. " alt="" coords="567,5,689,32"/>
<area shape="rect" id="node6" href="group__DEBUGGING.html#ga48dd46b3a1382506a34fcb4e6e0941f6" title="Returns the current CPU cycle via x86 RDTSC. " alt="" coords="302,181,437,222"/>
<area shape="rect" id="node7" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="558,57,698,98"/>
<area shape="rect" id="node8" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5" title="Releases the memory block IF this process has an ownership. " alt="" coords="264,115,475,157"/>
<area shape="rect" id="node3" href="structfoedus_1_1fs_1_1FileStatus.html#ac4ab24d4308aab673c8d1606a84367e5" title="foedus::fs::FileStatus\l::exists" alt="" coords="781,57,927,98"/>
<area shape="rect" id="node4" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="793,5,915,32"/>
<area shape="rect" id="node5" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="975,5,1125,32"/>
<area shape="rect" id="node9" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7" title="Returns if this process owns this memory and is responsible to delete it. " alt="" coords="523,174,733,215"/>
<area shape="rect" id="node10" href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d" title="Marks the shared memory as being removed so that it will be reclaimed when all processes detach it..." alt="" coords="523,239,733,281"/>
<area shape="rect" id="node11" href="group__FILESYSTEM.html#gad1f62b080fa246b5f8c166f44c72134f" title="Deletes a regular file or an empty directory. " alt="" coords="565,123,691,149"/>
<area shape="rect" id="node12" href="structfoedus_1_1fs_1_1FileStatus.html#a76000c37b9fc4c1d9596240409972809" title="foedus::fs::FileStatus\l::is_regular_file" alt="" coords="781,122,927,163"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_ae4b91eee2dce03e4b3aac612c71b88a0_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa42d7f6cd529569e79e4cfc298adb39b" title="Master process creates shared memories by calling this method. " alt="" coords="264,5,479,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a3dd3a524e5fbb0b8f9cb52dd21689d0a" title="Called as part of initialize_once() if this is a master engine. " alt="" coords="527,5,729,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#aa14e68e8b8e3902f2b139b6388e712d8" title="foedus::soc::SocManagerPimpl\l::initialize_once" alt="" coords="777,5,980,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a690fd766729121b64adf28994a8a6660"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::memory::SharedMemory::attach </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>meta_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>use_hugepages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Attach an already-allocated shared memory so that this object points to the memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">meta_path</td><td>Path of the temporary meta file that contains memory size and shared memory ID. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_hugepages</td><td>Whether to use hugepages. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section attention"><dt>Attention</dt><dd>If binding fails for some reason, this method does NOT fail nor throws an exception. Instead, it sets the block_ NULL. So, the caller is responsible for checking it after construction. </dd></dl>

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00157">157</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>

<p>References <a class="el" href="filesystem_8hpp_source.html#l00128">foedus::fs::exists()</a>, <a class="el" href="assorted__func_8cpp_source.html#l00067">foedus::assorted::os_error()</a>, and <a class="el" href="shared__memory_8cpp_source.html#l00222">release_block()</a>.</p>

<p>Referenced by <a class="el" href="shared__memory__repo_8cpp_source.html#l00165">foedus::soc::SharedMemoryRepo::attach_shared_memories()</a>.</p>
<div class="fragment"><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                                                                        {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">release_block</a>();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4">fs::exists</a>(fs::Path(meta_path))) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Shared memory meta file does not exist:&quot;</span> &lt;&lt; meta_path &lt;&lt; std::endl;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// the meta file contains the size of the shared memory</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  std::ifstream file(meta_path, std::ifstream::binary);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">if</span> (!file.is_open()) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to open shared memory meta file:&quot;</span> &lt;&lt; meta_path &lt;&lt; std::endl;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  uint64_t shared_size = 0;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">int</span> numa_node = 0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  key_t the_key = 0;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  file.read(reinterpret_cast&lt;char*&gt;(&amp;shared_size), <span class="keyword">sizeof</span>(shared_size));</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  file.read(reinterpret_cast&lt;char*&gt;(&amp;numa_node), <span class="keyword">sizeof</span>(numa_node));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  file.read(reinterpret_cast&lt;char*&gt;(&amp;the_key), <span class="keyword">sizeof</span>(key_t));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  file.close();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// we always use hugepages, so it&#39;s at least 2MB</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">if</span> (shared_size &lt; (1ULL &lt;&lt; 21)) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to read size of shared memory from meta file:&quot;</span> &lt;&lt; meta_path</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;. It looks like:&quot;</span> &lt;&lt; shared_size &lt;&lt; std::endl;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> (the_key == 0) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to read shmkey from meta file:&quot;</span> &lt;&lt; meta_path &lt;&lt; std::endl;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  size_ = shared_size;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  numa_node_ = numa_node;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  meta_path_ = meta_path;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  shmkey_ = the_key;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  owner_pid_ = 0;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (RUNNING_ON_VALGRIND) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    use_hugepages = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  shmid_ = ::shmget(shmkey_, size_, use_hugepages ? SHM_HUGETLB : 0);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">if</span> (shmid_ == -1) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;shmget() attach failed! size=&quot;</span> &lt;&lt; size_ &lt;&lt; <span class="stringliteral">&quot;, error=&quot;</span> &lt;&lt; <a class="code" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">assorted::os_error</a>()</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      &lt;&lt; std::endl;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  block_ = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(::shmat(shmid_, <span class="keyword">nullptr</span>, 0));</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">if</span> (block_ == reinterpret_cast&lt;void*&gt;(-1)) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    block_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;shmat attach failed!&quot;</span> &lt;&lt; *<span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;, error=&quot;</span> &lt;&lt; <a class="code" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">assorted::os_error</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">release_block</a>();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;}</div>
<div class="ttc" id="group__FILESYSTEM_html_ga4f8f53901e9c98fce72b6b3c52cf83a4"><div class="ttname"><a href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4">foedus::fs::exists</a></div><div class="ttdeci">bool exists(const Path &amp;p)</div><div class="ttdoc">Returns if the file exists. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8hpp_source.html#l00128">filesystem.hpp:128</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaaa260096daf8620266c2799d1f5a0270"><div class="ttname"><a href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">foedus::assorted::os_error</a></div><div class="ttdeci">std::string os_error()</div><div class="ttdoc">Thread-safe strerror(errno). </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8cpp_source.html#l00067">assorted_func.cpp:67</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1SharedMemory_html_a20f2fb7b7f86ab5c4134452f1267eeb5"><div class="ttname"><a href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">foedus::memory::SharedMemory::release_block</a></div><div class="ttdeci">void release_block()</div><div class="ttdoc">Releases the memory block IF this process has an ownership. </div><div class="ttdef"><b>Definition:</b> <a href="shared__memory_8cpp_source.html#l00222">shared_memory.cpp:222</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_cgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_cgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_cgraph" id="classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_cgraph">
<area shape="rect" id="node2" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4" title="Returns if the file exists. " alt="" coords="567,5,689,32"/>
<area shape="rect" id="node6" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="558,57,698,98"/>
<area shape="rect" id="node7" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5" title="Releases the memory block IF this process has an ownership. " alt="" coords="264,115,475,157"/>
<area shape="rect" id="node3" href="structfoedus_1_1fs_1_1FileStatus.html#ac4ab24d4308aab673c8d1606a84367e5" title="foedus::fs::FileStatus\l::exists" alt="" coords="781,57,927,98"/>
<area shape="rect" id="node4" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="793,5,915,32"/>
<area shape="rect" id="node5" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="975,5,1125,32"/>
<area shape="rect" id="node8" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7" title="Returns if this process owns this memory and is responsible to delete it. " alt="" coords="523,174,733,215"/>
<area shape="rect" id="node9" href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d" title="Marks the shared memory as being removed so that it will be reclaimed when all processes detach it..." alt="" coords="523,239,733,281"/>
<area shape="rect" id="node10" href="group__FILESYSTEM.html#gad1f62b080fa246b5f8c166f44c72134f" title="Deletes a regular file or an empty directory. " alt="" coords="565,123,691,149"/>
<area shape="rect" id="node11" href="structfoedus_1_1fs_1_1FileStatus.html#a76000c37b9fc4c1d9596240409972809" title="foedus::fs::FileStatus\l::is_regular_file" alt="" coords="781,122,927,163"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_a690fd766729121b64adf28994a8a6660_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a4b6032d62764c145607306973945bb8c" title="Child processes (emulated or not) set a reference to shared memory and receive the EngnieOption value..." alt="" coords="264,5,471,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d09b3bd25667fccd9bb831303788401" title="Called as part of initialize_once() if this is a child SOC engine. " alt="" coords="519,5,721,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#aa14e68e8b8e3902f2b139b6388e712d8" title="foedus::soc::SocManagerPimpl\l::initialize_once" alt="" coords="769,5,972,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a085dfb81511ba8e4c0563b5a72967113"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char* foedus::memory::SharedMemory::get_block </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the memory block. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00144">144</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory__repo_8cpp_source.html#l00096">foedus::soc::SharedMemoryRepo::allocate_shared_memories()</a>, <a class="el" href="shared__memory__repo_8cpp_source.html#l00165">foedus::soc::SharedMemoryRepo::attach_shared_memories()</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00513">foedus::soc::SharedMemoryRepo::get_global_memory()</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00520">foedus::soc::SharedMemoryRepo::get_node_memory()</a>, and <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{ <span class="keywordflow">return</span> block_; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a085dfb81511ba8e4c0563b5a72967113_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a085dfb81511ba8e4c0563b5a72967113_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a085dfb81511ba8e4c0563b5a72967113_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_a085dfb81511ba8e4c0563b5a72967113_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa42d7f6cd529569e79e4cfc298adb39b" title="Master process creates shared memories by calling this method. " alt="" coords="264,5,479,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a4b6032d62764c145607306973945bb8c" title="Child processes (emulated or not) set a reference to shared memory and receive the EngnieOption value..." alt="" coords="268,71,475,112"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a8e083b61b71eaf53a3a291d16f7a81ee" title="foedus::soc::SharedMemory\lRepo::get_global_memory" alt="" coords="279,136,464,177"/>
<area shape="rect" id="node9" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aac6d8360313375e55bddacf6fde461e6" title="foedus::soc::SharedMemory\lRepo::get_node_memory" alt="" coords="279,201,464,243"/>
<area shape="rect" id="node10" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="278,267,465,294"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a3dd3a524e5fbb0b8f9cb52dd21689d0a" title="Called as part of initialize_once() if this is a master engine. " alt="" coords="527,5,729,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#aa14e68e8b8e3902f2b139b6388e712d8" title="foedus::soc::SocManagerPimpl\l::initialize_once" alt="" coords="777,39,980,80"/>
<area shape="rect" id="node6" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d09b3bd25667fccd9bb831303788401" title="Called as part of initialize_once() if this is a child SOC engine. " alt="" coords="527,71,729,112"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d435277bd229b7988c3f249c0a0730f" title="foedus::soc::SocManagerPimpl\l::uninitialize_once" alt="" coords="527,136,729,177"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac24326b29b0401f44562037b832b3b50"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::string&amp; foedus::memory::SharedMemory::get_meta_path </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the path of the meta file. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00142">142</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{ <span class="keywordflow">return</span> meta_path_; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_ac24326b29b0401f44562037b832b3b50_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_ac24326b29b0401f44562037b832b3b50_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_ac24326b29b0401f44562037b832b3b50_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_ac24326b29b0401f44562037b832b3b50_icgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="264,13,451,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a130260a4506071e814d2c2a531d82913"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int foedus::memory::SharedMemory::get_numa_node </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Where the physical memory is allocated. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00158">158</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{ <span class="keywordflow">return</span> numa_node_; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a130260a4506071e814d2c2a531d82913_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a130260a4506071e814d2c2a531d82913_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a130260a4506071e814d2c2a531d82913_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_a130260a4506071e814d2c2a531d82913_icgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="264,13,451,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a36936f0f3e6544b85ac6c96639ea78f6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pid_t foedus::memory::SharedMemory::get_owner_pid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If non-zero, it means the ID of the process that allocated the shared memory. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00150">150</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;{ <span class="keywordflow">return</span> owner_pid_; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a36936f0f3e6544b85ac6c96639ea78f6_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a36936f0f3e6544b85ac6c96639ea78f6_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a36936f0f3e6544b85ac6c96639ea78f6_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_a36936f0f3e6544b85ac6c96639ea78f6_icgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="264,13,451,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaec93b4eba6a84195c7a8310bf6acaf4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int foedus::memory::SharedMemory::get_shmid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the ID of this shared memory. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00146">146</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;{ <span class="keywordflow">return</span> shmid_; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_aaec93b4eba6a84195c7a8310bf6acaf4_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_aaec93b4eba6a84195c7a8310bf6acaf4_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_aaec93b4eba6a84195c7a8310bf6acaf4_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_aaec93b4eba6a84195c7a8310bf6acaf4_icgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="264,13,451,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abb4a83545d0c98d5def2b8763d3757cd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">key_t foedus::memory::SharedMemory::get_shmkey </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the key of this shared memory. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00148">148</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{ <span class="keywordflow">return</span> shmkey_; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_abb4a83545d0c98d5def2b8763d3757cd_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_abb4a83545d0c98d5def2b8763d3757cd_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_abb4a83545d0c98d5def2b8763d3757cd_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_abb4a83545d0c98d5def2b8763d3757cd_icgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="264,13,451,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aab37b24a74d0fd12e840ea3bf4940201"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t foedus::memory::SharedMemory::get_size </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the byte size of the memory block. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00156">156</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>.</p>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;{ <span class="keywordflow">return</span> size_; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_aab37b24a74d0fd12e840ea3bf4940201_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_aab37b24a74d0fd12e840ea3bf4940201_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_aab37b24a74d0fd12e840ea3bf4940201_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_aab37b24a74d0fd12e840ea3bf4940201_icgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="264,13,451,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acbdca7a06f5b1fe14cba7c718c822ac4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::memory::SharedMemory::is_null </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns if this object doesn't hold a valid memory block. </p>

<p>Definition at line <a class="el" href="shared__memory_8hpp_source.html#l00152">152</a> of file <a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a>.</p>

<p>References <a class="el" href="cxx11_8hpp_source.html#l00132">CXX11_NULLPTR</a>.</p>

<p>Referenced by <a class="el" href="shared__memory__repo_8cpp_source.html#l00165">foedus::soc::SharedMemoryRepo::attach_shared_memories()</a>, and <a class="el" href="shared__memory__repo_8cpp_source.html#l00223">foedus::soc::SharedMemoryRepo::deallocate_shared_memories()</a>.</p>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;{ <span class="keywordflow">return</span> block_ == <a class="code" href="group__CXX11.html#ga213f92e16813051c59cdccf6d28baa78">CXX11_NULLPTR</a>; }</div>
<div class="ttc" id="group__CXX11_html_ga213f92e16813051c59cdccf6d28baa78"><div class="ttname"><a href="group__CXX11.html#ga213f92e16813051c59cdccf6d28baa78">CXX11_NULLPTR</a></div><div class="ttdeci">#define CXX11_NULLPTR</div><div class="ttdoc">Used in public headers in place of "nullptr" of C++11. </div><div class="ttdef"><b>Definition:</b> <a href="cxx11_8hpp_source.html#l00132">cxx11.hpp:132</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_acbdca7a06f5b1fe14cba7c718c822ac4_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_acbdca7a06f5b1fe14cba7c718c822ac4_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_acbdca7a06f5b1fe14cba7c718c822ac4_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_acbdca7a06f5b1fe14cba7c718c822ac4_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a4b6032d62764c145607306973945bb8c" title="Child processes (emulated or not) set a reference to shared memory and receive the EngnieOption value..." alt="" coords="497,5,704,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa961c615ceddd0dd0d3943629fd1a147" title="Detaches and releases the shared memories. " alt="" coords="264,173,449,229"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d09b3bd25667fccd9bb831303788401" title="Called as part of initialize_once() if this is a child SOC engine. " alt="" coords="1015,77,1217,119"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#aa14e68e8b8e3902f2b139b6388e712d8" title="foedus::soc::SocManagerPimpl\l::initialize_once" alt="" coords="1265,145,1468,187"/>
<area shape="rect" id="node6" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#ae93958bcd01826cc39e3b84333d1c3d9" title="foedus::soc::SharedMemory\lRepo::~SharedMemoryRepo" alt="" coords="507,407,694,448"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa42d7f6cd529569e79e4cfc298adb39b" title="Master process creates shared memories by calling this method. " alt="" coords="752,180,967,221"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a3dd3a524e5fbb0b8f9cb52dd21689d0a" title="Called as part of initialize_once() if this is a master engine. " alt="" coords="1015,213,1217,255"/>
<area shape="rect" id="node9" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d435277bd229b7988c3f249c0a0730f" title="foedus::soc::SocManagerPimpl\l::uninitialize_once" alt="" coords="499,71,702,112"/>
<area shape="rect" id="node10" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a998409bf9e2aff10ec8dfb02f17bb956" title="Wait for child SOCs to start up and at least finish attaching shared memory. " alt="" coords="499,289,702,331"/>
<area shape="rect" id="node12" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#ad9ef70c0b175a6535731e2cf0c2370f1" title="Launch children via fork. " alt="" coords="758,376,961,417"/>
<area shape="rect" id="node13" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a4a9091baae2ba21b2cb888da8d391818" title="Launch children via spawn. " alt="" coords="758,245,961,287"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a77d275f92471e6ac9e0c4bb4c609665f" title="Launch emulated children as threads. " alt="" coords="758,311,961,352"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a83f0c9b29ecfc29550923dd33bc031e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::memory::SharedMemory::is_owned </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns if this process owns this memory and is responsible to delete it. </p>

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00063">63</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00245">foedus::memory::operator&lt;&lt;()</a>, and <a class="el" href="shared__memory_8cpp_source.html#l00222">release_block()</a>.</p>
<div class="fragment"><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                                  {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">return</span> owner_pid_ != 0 &amp;&amp; owner_pid_ == ::getpid();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a83f0c9b29ecfc29550923dd33bc031e7_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a83f0c9b29ecfc29550923dd33bc031e7_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a83f0c9b29ecfc29550923dd33bc031e7_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_a83f0c9b29ecfc29550923dd33bc031e7_icgraph">
<area shape="rect" id="node2" href="namespacefoedus_1_1memory.html#a85010db544108a81b86f189d1319069c" title="foedus::memory::operator\&lt;\&lt;" alt="" coords="276,93,463,119"/>
<area shape="rect" id="node3" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5" title="Releases the memory block IF this process has an ownership. " alt="" coords="264,144,475,185"/>
<area shape="rect" id="node4" href="classfoedus_1_1memory_1_1SharedMemory.html#a7094d7eaf5f5c149a5d52fd9ce6fadd0" title="Automatically releases the memory. " alt="" coords="523,13,733,55"/>
<area shape="rect" id="node5" href="classfoedus_1_1memory_1_1SharedMemory.html#afab2d81be8ba9c96b24dcf977cc3b792" title="Move assignment operator that steals the memory block from other. " alt="" coords="523,79,733,120"/>
<area shape="rect" id="node6" href="classfoedus_1_1memory_1_1SharedMemory.html#ae4b91eee2dce03e4b3aac612c71b88a0" title="Newly allocate a shared memory of given size on given NUMA node. " alt="" coords="523,144,733,185"/>
<area shape="rect" id="node10" href="classfoedus_1_1memory_1_1SharedMemory.html#a690fd766729121b64adf28994a8a6660" title="Attach an already&#45;allocated shared memory so that this object points to the memory. " alt="" coords="523,341,733,383"/>
<area shape="rect" id="node13" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa961c615ceddd0dd0d3943629fd1a147" title="Detaches and releases the shared memories. " alt="" coords="535,210,721,266"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa42d7f6cd529569e79e4cfc298adb39b" title="Master process creates shared memories by calling this method. " alt="" coords="781,5,996,47"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a3dd3a524e5fbb0b8f9cb52dd21689d0a" title="Called as part of initialize_once() if this is a master engine. " alt="" coords="1295,267,1497,308"/>
<area shape="rect" id="node9" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#aa14e68e8b8e3902f2b139b6388e712d8" title="foedus::soc::SocManagerPimpl\l::initialize_once" alt="" coords="1545,315,1748,356"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a4b6032d62764c145607306973945bb8c" title="Child processes (emulated or not) set a reference to shared memory and receive the EngnieOption value..." alt="" coords="785,423,992,464"/>
<area shape="rect" id="node12" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d09b3bd25667fccd9bb831303788401" title="Called as part of initialize_once() if this is a child SOC engine. " alt="" coords="1295,361,1497,403"/>
<area shape="rect" id="node14" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#ae93958bcd01826cc39e3b84333d1c3d9" title="foedus::soc::SharedMemory\lRepo::~SharedMemoryRepo" alt="" coords="795,123,982,164"/>
<area shape="rect" id="node15" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d435277bd229b7988c3f249c0a0730f" title="foedus::soc::SocManagerPimpl\l::uninitialize_once" alt="" coords="787,188,990,229"/>
<area shape="rect" id="node16" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a998409bf9e2aff10ec8dfb02f17bb956" title="Wait for child SOCs to start up and at least finish attaching shared memory. " alt="" coords="787,305,990,347"/>
<area shape="rect" id="node18" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#ad9ef70c0b175a6535731e2cf0c2370f1" title="Launch children via fork. " alt="" coords="1044,364,1247,405"/>
<area shape="rect" id="node19" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a4a9091baae2ba21b2cb888da8d391818" title="Launch children via spawn. " alt="" coords="1044,233,1247,275"/>
<area shape="rect" id="node17" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a77d275f92471e6ac9e0c4bb4c609665f" title="Launch emulated children as threads. " alt="" coords="1044,299,1247,340"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a06fa097c286b762b8ae484076592bf0d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::memory::SharedMemory::mark_for_release </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Marks the shared memory as being removed so that it will be reclaimed when all processes detach it. </p>
<p>This is part of deallocation of shared memory in master process. After calling this method, no process can attach this shared memory. So, do not call this too early. However, on the other hand, do not call this too late. If the master process dies for an unexpected reason, the shared memory remains until next reboot. Call it as soon as child processes ack-ed that they have attached the memory or that there are some issues the master process should exit. This method is idempotent, meaning you can safely call this many times. </p>

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00213">213</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>

<p>Referenced by <a class="el" href="shared__memory__repo_8cpp_source.html#l00214">foedus::soc::SharedMemoryRepo::mark_for_release()</a>, and <a class="el" href="shared__memory_8cpp_source.html#l00222">release_block()</a>.</p>
<div class="fragment"><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                                    {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordflow">if</span> (block_ != <span class="keyword">nullptr</span> &amp;&amp; shmid_ != 0) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// Some material says that Linux allows shmget even after shmctl(IPC_RMID), but it doesn&#39;t.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// It allows shmat() after shmctl(IPC_RMID), but not shmget().</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// So we have to invoke IPC_RMID after all child processes acked.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    ::shmctl(shmid_, IPC_RMID, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a06fa097c286b762b8ae484076592bf0d_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a06fa097c286b762b8ae484076592bf0d_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a06fa097c286b762b8ae484076592bf0d_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_a06fa097c286b762b8ae484076592bf0d_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a78e80ef586cc59284a2c9af365e1f0b6" title="Marks shared memories as being removed so that it will be reclaimed when all processes detach it..." alt="" coords="277,217,462,259"/>
<area shape="rect" id="node15" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5" title="Releases the memory block IF this process has an ownership. " alt="" coords="264,324,475,365"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa961c615ceddd0dd0d3943629fd1a147" title="Detaches and releases the shared memories. " alt="" coords="535,210,721,266"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a998409bf9e2aff10ec8dfb02f17bb956" title="Wait for child SOCs to start up and at least finish attaching shared memory. " alt="" coords="787,5,990,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#ae93958bcd01826cc39e3b84333d1c3d9" title="foedus::soc::SharedMemory\lRepo::~SharedMemoryRepo" alt="" coords="795,188,982,229"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa42d7f6cd529569e79e4cfc298adb39b" title="Master process creates shared memories by calling this method. " alt="" coords="781,356,996,397"/>
<area shape="rect" id="node6" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a3dd3a524e5fbb0b8f9cb52dd21689d0a" title="Called as part of initialize_once() if this is a master engine. " alt="" coords="1295,268,1497,309"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a4b6032d62764c145607306973945bb8c" title="Child processes (emulated or not) set a reference to shared memory and receive the EngnieOption value..." alt="" coords="785,421,992,463"/>
<area shape="rect" id="node10" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d435277bd229b7988c3f249c0a0730f" title="foedus::soc::SocManagerPimpl\l::uninitialize_once" alt="" coords="787,71,990,112"/>
<area shape="rect" id="node13" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#ad9ef70c0b175a6535731e2cf0c2370f1" title="Launch children via fork. " alt="" coords="1044,239,1247,280"/>
<area shape="rect" id="node14" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a4a9091baae2ba21b2cb888da8d391818" title="Launch children via spawn. " alt="" coords="1044,129,1247,171"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#aa14e68e8b8e3902f2b139b6388e712d8" title="foedus::soc::SocManagerPimpl\l::initialize_once" alt="" coords="1545,313,1748,355"/>
<area shape="rect" id="node9" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d09b3bd25667fccd9bb831303788401" title="Called as part of initialize_once() if this is a child SOC engine. " alt="" coords="1295,359,1497,400"/>
<area shape="rect" id="node12" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a77d275f92471e6ac9e0c4bb4c609665f" title="Launch emulated children as threads. " alt="" coords="1044,35,1247,76"/>
<area shape="rect" id="node16" href="classfoedus_1_1memory_1_1SharedMemory.html#a7094d7eaf5f5c149a5d52fd9ce6fadd0" title="Automatically releases the memory. " alt="" coords="523,356,733,397"/>
<area shape="rect" id="node17" href="classfoedus_1_1memory_1_1SharedMemory.html#afab2d81be8ba9c96b24dcf977cc3b792" title="Move assignment operator that steals the memory block from other. " alt="" coords="523,487,733,528"/>
<area shape="rect" id="node18" href="classfoedus_1_1memory_1_1SharedMemory.html#ae4b91eee2dce03e4b3aac612c71b88a0" title="Newly allocate a shared memory of given size on given NUMA node. " alt="" coords="523,291,733,332"/>
<area shape="rect" id="node19" href="classfoedus_1_1memory_1_1SharedMemory.html#a690fd766729121b64adf28994a8a6660" title="Attach an already&#45;allocated shared memory so that this object points to the memory. " alt="" coords="523,421,733,463"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab36c97fb46ab43c7c770221276289378"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a>&amp; foedus::memory::SharedMemory::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="afab2d81be8ba9c96b24dcf977cc3b792"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp; foedus::memory::SharedMemory::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Move assignment operator that steals the memory block from other. </p>

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00050">50</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>

<p>References <a class="el" href="shared__memory_8cpp_source.html#l00222">release_block()</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                                                   {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">release_block</a>();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  meta_path_ = other.meta_path_;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  size_ = other.size_;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  numa_node_ = other.numa_node_;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  shmid_ = other.shmid_;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  shmkey_ = other.shmkey_;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  owner_pid_ = other.owner_pid_;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  block_ = other.block_;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  other.block_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1memory_1_1SharedMemory_html_a20f2fb7b7f86ab5c4134452f1267eeb5"><div class="ttname"><a href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5">foedus::memory::SharedMemory::release_block</a></div><div class="ttdeci">void release_block()</div><div class="ttdoc">Releases the memory block IF this process has an ownership. </div><div class="ttdef"><b>Definition:</b> <a href="shared__memory_8cpp_source.html#l00222">shared_memory.cpp:222</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_afab2d81be8ba9c96b24dcf977cc3b792_cgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_afab2d81be8ba9c96b24dcf977cc3b792_cgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_afab2d81be8ba9c96b24dcf977cc3b792_cgraph" id="classfoedus_1_1memory_1_1SharedMemory_afab2d81be8ba9c96b24dcf977cc3b792_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1SharedMemory.html#a20f2fb7b7f86ab5c4134452f1267eeb5" title="Releases the memory block IF this process has an ownership. " alt="" coords="264,104,475,145"/>
<area shape="rect" id="node3" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7" title="Returns if this process owns this memory and is responsible to delete it. " alt="" coords="523,5,733,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d" title="Marks the shared memory as being removed so that it will be reclaimed when all processes detach it..." alt="" coords="523,71,733,112"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="558,136,698,177"/>
<area shape="rect" id="node6" href="group__FILESYSTEM.html#gad1f62b080fa246b5f8c166f44c72134f" title="Deletes a regular file or an empty directory. " alt="" coords="565,202,691,229"/>
<area shape="rect" id="node7" href="structfoedus_1_1fs_1_1FileStatus.html#ac4ab24d4308aab673c8d1606a84367e5" title="foedus::fs::FileStatus\l::exists" alt="" coords="781,129,927,171"/>
<area shape="rect" id="node8" href="structfoedus_1_1fs_1_1FileStatus.html#a76000c37b9fc4c1d9596240409972809" title="foedus::fs::FileStatus\l::is_regular_file" alt="" coords="781,195,927,236"/>
<area shape="rect" id="node9" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="793,261,915,287"/>
<area shape="rect" id="node10" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="975,261,1125,287"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a20f2fb7b7f86ab5c4134452f1267eeb5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::memory::SharedMemory::release_block </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Releases the memory block <b>IF</b> this process has an ownership. </p>

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00222">222</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>

<p>References <a class="el" href="shared__memory_8cpp_source.html#l00063">is_owned()</a>, <a class="el" href="shared__memory_8cpp_source.html#l00213">mark_for_release()</a>, <a class="el" href="assorted__func_8cpp_source.html#l00067">foedus::assorted::os_error()</a>, and <a class="el" href="filesystem_8cpp_source.html#l00132">foedus::fs::remove()</a>.</p>

<p>Referenced by <a class="el" href="shared__memory_8cpp_source.html#l00067">alloc()</a>, <a class="el" href="shared__memory_8cpp_source.html#l00157">attach()</a>, <a class="el" href="shared__memory__repo_8cpp_source.html#l00223">foedus::soc::SharedMemoryRepo::deallocate_shared_memories()</a>, <a class="el" href="shared__memory_8cpp_source.html#l00050">operator=()</a>, and <a class="el" href="shared__memory_8hpp_source.html#l00114">~SharedMemory()</a>.</p>
<div class="fragment"><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                 {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">if</span> (block_ != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// mark the memory to be reclaimed</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7">is_owned</a>()) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d">mark_for_release</a>();</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// Just detach it. as we already invoked shmctl(IPC_RMID) at beginning, linux will</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">// automatically release it once the reference count reaches zero.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordtype">int</span> dt_ret = ::shmdt(block_);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (dt_ret == -1) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;shmdt() failed.&quot;</span> &lt;&lt; *<span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;, error=&quot;</span> &lt;&lt; <a class="code" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">assorted::os_error</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    block_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// clean up meta file.</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7">is_owned</a>()) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <a class="code" href="group__FILESYSTEM.html#gad1f62b080fa246b5f8c166f44c72134f">std::remove</a>(meta_path_.c_str());</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div>
<div class="ttc" id="group__FILESYSTEM_html_gad1f62b080fa246b5f8c166f44c72134f"><div class="ttname"><a href="group__FILESYSTEM.html#gad1f62b080fa246b5f8c166f44c72134f">foedus::fs::remove</a></div><div class="ttdeci">bool remove(const Path &amp;p)</div><div class="ttdoc">Deletes a regular file or an empty directory. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8cpp_source.html#l00132">filesystem.cpp:132</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1SharedMemory_html_a83f0c9b29ecfc29550923dd33bc031e7"><div class="ttname"><a href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7">foedus::memory::SharedMemory::is_owned</a></div><div class="ttdeci">bool is_owned() const </div><div class="ttdoc">Returns if this process owns this memory and is responsible to delete it. </div><div class="ttdef"><b>Definition:</b> <a href="shared__memory_8cpp_source.html#l00063">shared_memory.cpp:63</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaaa260096daf8620266c2799d1f5a0270"><div class="ttname"><a href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270">foedus::assorted::os_error</a></div><div class="ttdeci">std::string os_error()</div><div class="ttdoc">Thread-safe strerror(errno). </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8cpp_source.html#l00067">assorted_func.cpp:67</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1SharedMemory_html_a06fa097c286b762b8ae484076592bf0d"><div class="ttname"><a href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d">foedus::memory::SharedMemory::mark_for_release</a></div><div class="ttdeci">void mark_for_release()</div><div class="ttdoc">Marks the shared memory as being removed so that it will be reclaimed when all processes detach it...</div><div class="ttdef"><b>Definition:</b> <a href="shared__memory_8cpp_source.html#l00213">shared_memory.cpp:213</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_cgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_cgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_cgraph" id="classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1SharedMemory.html#a83f0c9b29ecfc29550923dd33bc031e7" title="Returns if this process owns this memory and is responsible to delete it. " alt="" coords="264,5,475,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1memory_1_1SharedMemory.html#a06fa097c286b762b8ae484076592bf0d" title="Marks the shared memory as being removed so that it will be reclaimed when all processes detach it..." alt="" coords="264,71,475,112"/>
<area shape="rect" id="node4" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="299,136,439,177"/>
<area shape="rect" id="node5" href="group__FILESYSTEM.html#gad1f62b080fa246b5f8c166f44c72134f" title="Deletes a regular file or an empty directory. " alt="" coords="306,202,433,229"/>
<area shape="rect" id="node6" href="structfoedus_1_1fs_1_1FileStatus.html#ac4ab24d4308aab673c8d1606a84367e5" title="foedus::fs::FileStatus\l::exists" alt="" coords="523,129,668,171"/>
<area shape="rect" id="node7" href="structfoedus_1_1fs_1_1FileStatus.html#a76000c37b9fc4c1d9596240409972809" title="foedus::fs::FileStatus\l::is_regular_file" alt="" coords="523,195,668,236"/>
<area shape="rect" id="node8" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="534,261,657,287"/>
<area shape="rect" id="node9" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="716,261,867,287"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_icgraph.png" border="0" usemap="#classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_icgraph" alt=""/></div>
<map name="classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_icgraph" id="classfoedus_1_1memory_1_1SharedMemory_a20f2fb7b7f86ab5c4134452f1267eeb5_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1SharedMemory.html#ae4b91eee2dce03e4b3aac612c71b88a0" title="Newly allocate a shared memory of given size on given NUMA node. " alt="" coords="264,89,475,131"/>
<area shape="rect" id="node6" href="classfoedus_1_1memory_1_1SharedMemory.html#a690fd766729121b64adf28994a8a6660" title="Attach an already&#45;allocated shared memory so that this object points to the memory. " alt="" coords="264,291,475,332"/>
<area shape="rect" id="node9" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa961c615ceddd0dd0d3943629fd1a147" title="Detaches and releases the shared memories. " alt="" coords="277,210,462,266"/>
<area shape="rect" id="node16" href="classfoedus_1_1memory_1_1SharedMemory.html#afab2d81be8ba9c96b24dcf977cc3b792" title="Move assignment operator that steals the memory block from other. " alt="" coords="264,356,475,397"/>
<area shape="rect" id="node17" href="classfoedus_1_1memory_1_1SharedMemory.html#a7094d7eaf5f5c149a5d52fd9ce6fadd0" title="Automatically releases the memory. " alt="" coords="264,421,475,463"/>
<area shape="rect" id="node3" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#aa42d7f6cd529569e79e4cfc298adb39b" title="Master process creates shared memories by calling this method. " alt="" coords="523,5,737,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a3dd3a524e5fbb0b8f9cb52dd21689d0a" title="Called as part of initialize_once() if this is a master engine. " alt="" coords="1036,267,1239,308"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#aa14e68e8b8e3902f2b139b6388e712d8" title="foedus::soc::SocManagerPimpl\l::initialize_once" alt="" coords="1287,315,1489,356"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a4b6032d62764c145607306973945bb8c" title="Child processes (emulated or not) set a reference to shared memory and receive the EngnieOption value..." alt="" coords="527,423,733,464"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d09b3bd25667fccd9bb831303788401" title="Called as part of initialize_once() if this is a child SOC engine. " alt="" coords="1036,361,1239,403"/>
<area shape="rect" id="node10" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#ae93958bcd01826cc39e3b84333d1c3d9" title="foedus::soc::SharedMemory\lRepo::~SharedMemoryRepo" alt="" coords="537,123,723,164"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a1d435277bd229b7988c3f249c0a0730f" title="foedus::soc::SocManagerPimpl\l::uninitialize_once" alt="" coords="529,188,731,229"/>
<area shape="rect" id="node12" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a998409bf9e2aff10ec8dfb02f17bb956" title="Wait for child SOCs to start up and at least finish attaching shared memory. " alt="" coords="529,305,731,347"/>
<area shape="rect" id="node14" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#ad9ef70c0b175a6535731e2cf0c2370f1" title="Launch children via fork. " alt="" coords="785,364,988,405"/>
<area shape="rect" id="node15" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a4a9091baae2ba21b2cb888da8d391818" title="Launch children via spawn. " alt="" coords="785,233,988,275"/>
<area shape="rect" id="node13" href="classfoedus_1_1soc_1_1SocManagerPimpl.html#a77d275f92471e6ac9e0c4bb4c609665f" title="Launch emulated children as threads. " alt="" coords="785,299,988,340"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a class="anchor" id="a29955c22e38ba60c6b3c61891592c9c9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="shared__memory_8cpp_source.html#l00245">245</a> of file <a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                                             {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;SharedMemory&gt;&quot;</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;meta_path&gt;&quot;</span> &lt;&lt; v.get_meta_path() &lt;&lt; <span class="stringliteral">&quot;&lt;/meta_path&gt;&quot;</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;size&gt;&quot;</span> &lt;&lt; v.get_size() &lt;&lt; <span class="stringliteral">&quot;&lt;/size&gt;&quot;</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;owned&gt;&quot;</span> &lt;&lt; v.is_owned() &lt;&lt; <span class="stringliteral">&quot;&lt;/owned&gt;&quot;</span>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;owner_pid&gt;&quot;</span> &lt;&lt; v.get_owner_pid() &lt;&lt; <span class="stringliteral">&quot;&lt;/owner_pid&gt;&quot;</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;numa_node&gt;&quot;</span> &lt;&lt; v.get_numa_node() &lt;&lt; <span class="stringliteral">&quot;&lt;/numa_node&gt;&quot;</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;shmid&gt;&quot;</span> &lt;&lt; v.get_shmid() &lt;&lt; <span class="stringliteral">&quot;&lt;/shmid&gt;&quot;</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;shmkey&gt;&quot;</span> &lt;&lt; v.get_shmkey() &lt;&lt; <span class="stringliteral">&quot;&lt;/shmkey&gt;&quot;</span>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;address&gt;&quot;</span> &lt;&lt; <span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(v.get_block()) &lt;&lt; <span class="stringliteral">&quot;&lt;/address&gt;&quot;</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  o &lt;&lt; <span class="stringliteral">&quot;&lt;/SharedMemory&gt;&quot;</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">return</span> o;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/memory/<a class="el" href="shared__memory_8hpp_source.html">shared_memory.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/memory/<a class="el" href="shared__memory_8cpp_source.html">shared_memory.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1memory.html">memory</a></li><li class="navelem"><a class="el" href="classfoedus_1_1memory_1_1SharedMemory.html">SharedMemory</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
