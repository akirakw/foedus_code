<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::storage::hash::HashComposeContext Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1storage_1_1hash_1_1HashComposeContext.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfoedus_1_1storage_1_1hash_1_1HashComposeContext-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::storage::hash::HashComposeContext Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashComposer.html" title="Composer for a hash storage. ">HashComposer</a>'s compose() implementation separated from the class itself.  
 <a href="classfoedus_1_1storage_1_1hash_1_1HashComposeContext.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashComposer.html" title="Composer for a hash storage. ">HashComposer</a>'s compose() implementation separated from the class itself. </p>
<p>It's a complicated method, so worth being its own class. This defines all the variables maintained during one compose() call. </p>

<p>Definition at line <a class="el" href="hash__composer__impl_8hpp_source.html#l00142">142</a> of file <a class="el" href="hash__composer__impl_8hpp_source.html">hash_composer_impl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="hash__composer__impl_8hpp_source.html">hash_composer_impl.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad74a8746a4e10c3931ab206db17f0667"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashComposeContext.html#ad74a8746a4e10c3931ab206db17f0667">HashComposeContext</a> (<a class="el" href="classfoedus_1_1Engine.html">Engine</a> *engine, <a class="el" href="classfoedus_1_1snapshot_1_1MergeSort.html">snapshot::MergeSort</a> *merge_sort, <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html">snapshot::SnapshotWriter</a> *snapshot_writer, <a class="el" href="classfoedus_1_1cache_1_1SnapshotFileSet.html">cache::SnapshotFileSet</a> *previous_snapshot_files, <a class="el" href="structfoedus_1_1storage_1_1Page.html">Page</a> *root_info_page)</td></tr>
<tr class="memdesc:ad74a8746a4e10c3931ab206db17f0667"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashComposeContext.html" title="HashComposer&#39;s compose() implementation separated from the class itself. ">HashComposeContext</a> methods.  <a href="#ad74a8746a4e10c3931ab206db17f0667">More...</a><br /></td></tr>
<tr class="separator:ad74a8746a4e10c3931ab206db17f0667"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa55b6ec5e0174d4122bdb9b728cd2088"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashComposeContext.html#aa55b6ec5e0174d4122bdb9b728cd2088">execute</a> ()</td></tr>
<tr class="separator:aa55b6ec5e0174d4122bdb9b728cd2088"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ad74a8746a4e10c3931ab206db17f0667"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">foedus::storage::hash::HashComposeContext::HashComposeContext </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Engine.html">Engine</a> *&#160;</td>
          <td class="paramname"><em>engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1snapshot_1_1MergeSort.html">snapshot::MergeSort</a> *&#160;</td>
          <td class="paramname"><em>merge_sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html">snapshot::SnapshotWriter</a> *&#160;</td>
          <td class="paramname"><em>snapshot_writer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1cache_1_1SnapshotFileSet.html">cache::SnapshotFileSet</a> *&#160;</td>
          <td class="paramname"><em>previous_snapshot_files</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1storage_1_1Page.html">Page</a> *&#160;</td>
          <td class="paramname"><em>root_info_page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashComposeContext.html" title="HashComposer&#39;s compose() implementation separated from the class itself. ">HashComposeContext</a> methods. </p>

<p>Definition at line <a class="el" href="hash__composer__impl_8cpp_source.html#l00436">436</a> of file <a class="el" href="hash__composer__impl_8cpp_source.html">hash_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="aligned__memory_8cpp_source.html#l00113">foedus::memory::AlignedMemory::alloc()</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00168">foedus::memory::AlignedMemory::get_block()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00108">foedus::snapshot::SnapshotWriter::get_intermediate_base()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00111">foedus::snapshot::SnapshotWriter::get_intermediate_size()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00102">foedus::snapshot::SnapshotWriter::get_page_base()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00105">foedus::snapshot::SnapshotWriter::get_page_size()</a>, <a class="el" href="hash__id_8hpp_source.html#l00104">foedus::storage::hash::kHashMaxLevels</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00083">foedus::memory::AlignedMemory::kNumaAllocOnnode</a>, and <a class="el" href="storage__id_8hpp_source.html#l00045">foedus::storage::kPageSize</a>.</p>
<div class="fragment"><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  : engine_(engine),</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    merge_sort_(merge_sort),</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    system_initial_epoch_(engine-&gt;get_savepoint_manager()-&gt;get_initial_durable_epoch()),</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    storage_id_(merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#a0bba4cd6f6ad3912e8814eb1f16eaf3b">get_storage_id</a>()),</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    snapshot_id_(snapshot_writer-&gt;get_snapshot_id()),</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    storage_(engine, storage_id_),</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    snapshot_writer_(snapshot_writer),</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    previous_snapshot_files_(previous_snapshot_files),</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    root_info_page_(reinterpret_cast&lt;HashRootInfoPage*&gt;(root_info_page)),</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    partitionable_(engine_-&gt;<a class="code" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">get_soc_count</a>() &gt; 1U),</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    levels_(storage_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a37d93cdda67dd88454e0237f8a511995">get_levels</a>()),</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    bin_bits_(storage_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#af921bcfaca8b99564cc6b6cefed87e65">get_bin_bits</a>()),</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    bin_shifts_(storage_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a6dc142a2ed0509104e377e10a6d6a034">get_bin_shifts</a>()),</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    root_children_(storage_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a0f94a4a418776e5ac253b6dcccda8cc6">get_root_children</a>()),</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    numa_node_(snapshot_writer-&gt;get_numa_node()),</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    total_bin_count_(storage_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a092465b1ea5688d713e3f73aaf13a23c">get_bin_count</a>()),</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    previous_root_page_pointer_(storage_.<a class="code" href="classfoedus_1_1storage_1_1Storage.html#ae3cca5dd58aa9bbf419cc07986bbc668">get_metadata</a>()-&gt;<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">root_snapshot_page_id_</a>),</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    volatile_resolver_(engine-&gt;get_memory_manager()-&gt;get_global_volatile_page_resolver()) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  cur_path_memory_.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e">alloc</a>(</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a> * <a class="code" href="group__HASH.html#gacb6faca61be6849c9cdb02447cb3edbe">kHashMaxLevels</a>,</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a>,</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    numa_node_);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  cur_path_ = <span class="keyword">reinterpret_cast&lt;</span>HashIntermediatePage*<span class="keyword">&gt;</span>(cur_path_memory_.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1">get_block</a>());</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  cur_path_lowest_level_ = levels_;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  cur_path_valid_range_ = HashBinRange(0, 0);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  cur_bin_ = kCurBinNotOpened;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  cur_intermediate_tail_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  data_page_io_memory_.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e">alloc</a>(</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a>,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a>,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    numa_node_);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  allocated_pages_ = 0;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  allocated_intermediates_ = 0;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  page_base_ = <span class="keyword">reinterpret_cast&lt;</span>HashDataPage*<span class="keyword">&gt;</span>(snapshot_writer_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a4f72263ae71f34fad0130151328d6720">get_page_base</a>());</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  max_pages_ = snapshot_writer_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ab547f0a3936d5cb0c0ee827ea77edd09">get_page_size</a>();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  intermediate_base_</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    = <span class="keyword">reinterpret_cast&lt;</span>HashComposedBinsPage*<span class="keyword">&gt;</span>(snapshot_writer_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a340a320860a56dd850c5f8e02a44278b">get_intermediate_base</a>());</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  max_intermediates_ = snapshot_writer_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#adb899ef232610546cd5a017a817fba45">get_intermediate_size</a>();</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">foedus::memory::AlignedMemory::kNumaAllocOnnode</a></div><div class="ttdoc">numa_alloc_onnode() and numa_free(). </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8hpp_source.html#l00083">aligned_memory.hpp:83</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStorage_html_a37d93cdda67dd88454e0237f8a511995"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a37d93cdda67dd88454e0237f8a511995">foedus::storage::hash::HashStorage::get_levels</a></div><div class="ttdeci">uint8_t get_levels() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage_8cpp_source.html#l00059">hash_storage.cpp:59</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotWriter_html_ab547f0a3936d5cb0c0ee827ea77edd09"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ab547f0a3936d5cb0c0ee827ea77edd09">foedus::snapshot::SnapshotWriter::get_page_size</a></div><div class="ttdeci">memory::PagePoolOffset get_page_size() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__writer__impl_8hpp_source.html#l00105">snapshot_writer_impl.hpp:105</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_a5166bae2fdad9ffa0d5c279edfd3307e"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e">foedus::memory::AlignedMemory::alloc</a></div><div class="ttdeci">void alloc(uint64_t size, uint64_t alignment, AllocType alloc_type, int numa_node) noexcept</div><div class="ttdoc">Allocate a memory, releasing the current memory if exists. </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8cpp_source.html#l00113">aligned_memory.cpp:113</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1Storage_html_ae3cca5dd58aa9bbf419cc07986bbc668"><div class="ttname"><a href="classfoedus_1_1storage_1_1Storage.html#ae3cca5dd58aa9bbf419cc07986bbc668">foedus::storage::Storage::get_metadata</a></div><div class="ttdeci">const Metadata * get_metadata() const </div><div class="ttdoc">Returns the metadata of this storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00162">storage.hpp:162</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_af0ac9dbae9481b295a8492c6d9f6c1d5"><div class="ttname"><a href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">foedus::Engine::get_soc_count</a></div><div class="ttdeci">soc::SocId get_soc_count() const </div><div class="ttdoc">Shorthand for get_options().thread_.group_count_. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00074">engine.cpp:74</a></div></div>
<div class="ttc" id="group__HASH_html_gacb6faca61be6849c9cdb02447cb3edbe"><div class="ttname"><a href="group__HASH.html#gacb6faca61be6849c9cdb02447cb3edbe">foedus::storage::hash::kHashMaxLevels</a></div><div class="ttdeci">const uint8_t kHashMaxLevels</div><div class="ttdoc">Max level of intermediate pages. </div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00104">hash_id.hpp:104</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStorage_html_af921bcfaca8b99564cc6b6cefed87e65"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#af921bcfaca8b99564cc6b6cefed87e65">foedus::storage::hash::HashStorage::get_bin_bits</a></div><div class="ttdeci">uint8_t get_bin_bits() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage_8cpp_source.html#l00061">hash_storage.cpp:61</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotWriter_html_adb899ef232610546cd5a017a817fba45"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#adb899ef232610546cd5a017a817fba45">foedus::snapshot::SnapshotWriter::get_intermediate_size</a></div><div class="ttdeci">memory::PagePoolOffset get_intermediate_size() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__writer__impl_8hpp_source.html#l00111">snapshot_writer_impl.hpp:111</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotWriter_html_a4f72263ae71f34fad0130151328d6720"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a4f72263ae71f34fad0130151328d6720">foedus::snapshot::SnapshotWriter::get_page_base</a></div><div class="ttdeci">storage::Page * get_page_base() __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__writer__impl_8hpp_source.html#l00102">snapshot_writer_impl.hpp:102</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_af306ba60622e2a87f75ae93dc6c597b1"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1">foedus::memory::AlignedMemory::get_block</a></div><div class="ttdeci">void * get_block() const </div><div class="ttdoc">Returns the memory block. </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8hpp_source.html#l00168">aligned_memory.hpp:168</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStorage_html_a092465b1ea5688d713e3f73aaf13a23c"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a092465b1ea5688d713e3f73aaf13a23c">foedus::storage::hash::HashStorage::get_bin_count</a></div><div class="ttdeci">HashBin get_bin_count() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage_8cpp_source.html#l00060">hash_storage.cpp:60</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStorage_html_a6dc142a2ed0509104e377e10a6d6a034"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a6dc142a2ed0509104e377e10a6d6a034">foedus::storage::hash::HashStorage::get_bin_shifts</a></div><div class="ttdeci">uint8_t get_bin_shifts() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage_8cpp_source.html#l00062">hash_storage.cpp:62</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotWriter_html_a340a320860a56dd850c5f8e02a44278b"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a340a320860a56dd850c5f8e02a44278b">foedus::snapshot::SnapshotWriter::get_intermediate_base</a></div><div class="ttdeci">storage::Page * get_intermediate_base() __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__writer__impl_8hpp_source.html#l00108">snapshot_writer_impl.hpp:108</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_a0bba4cd6f6ad3912e8814eb1f16eaf3b"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#a0bba4cd6f6ad3912e8814eb1f16eaf3b">foedus::snapshot::MergeSort::get_storage_id</a></div><div class="ttdeci">storage::StorageId get_storage_id() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00367">merge_sort.hpp:367</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga1a3c05fe1d44455fc3e761947c6e21e6"><div class="ttname"><a href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">foedus::storage::kPageSize</a></div><div class="ttdeci">const uint16_t kPageSize</div><div class="ttdoc">A constant defining the page size (in bytes) of both snapshot pages and volatile pages. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00045">storage_id.hpp:45</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStorage_html_a0f94a4a418776e5ac253b6dcccda8cc6"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a0f94a4a418776e5ac253b6dcccda8cc6">foedus::storage::hash::HashStorage::get_root_children</a></div><div class="ttdeci">uint16_t get_root_children() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage_8cpp_source.html#l00063">hash_storage.cpp:63</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Metadata_html_ab9d6a766410a36959158818af739df34"><div class="ttname"><a href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">foedus::storage::Metadata::root_snapshot_page_id_</a></div><div class="ttdeci">SnapshotPagePointer root_snapshot_page_id_</div><div class="ttdoc">Pointer to a snapshotted page this storage is rooted at. </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8hpp_source.html#l00112">metadata.hpp:112</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1hash_1_1HashComposeContext_ad74a8746a4e10c3931ab206db17f0667_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1hash_1_1HashComposeContext_ad74a8746a4e10c3931ab206db17f0667_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1hash_1_1HashComposeContext_ad74a8746a4e10c3931ab206db17f0667_cgraph" id="classfoedus_1_1storage_1_1hash_1_1HashComposeContext_ad74a8746a4e10c3931ab206db17f0667_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="213,257,427,298"/>
<area shape="rect" id="node15" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="475,509,688,550"/>
<area shape="rect" id="node16" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a340a320860a56dd850c5f8e02a44278b" title="foedus::snapshot::Snapshot\lWriter::get_intermediate_base" alt="" coords="222,475,418,517"/>
<area shape="rect" id="node17" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#adb899ef232610546cd5a017a817fba45" title="foedus::snapshot::Snapshot\lWriter::get_intermediate_size" alt="" coords="224,606,416,647"/>
<area shape="rect" id="node19" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a4f72263ae71f34fad0130151328d6720" title="foedus::snapshot::Snapshot\lWriter::get_page_base" alt="" coords="228,541,412,582"/>
<area shape="rect" id="node20" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ab547f0a3936d5cb0c0ee827ea77edd09" title="foedus::snapshot::Snapshot\lWriter::get_page_size" alt="" coords="228,671,412,713"/>
<area shape="rect" id="node3" href="namespacefoedus_1_1memory.html#ac2422aa4fe378da8a9594901762e17df" title="foedus::memory::alloc_mmap" alt="" coords="736,107,929,133"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="990,223,1130,265"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1memory.html#ae51e4a90f52316ba9dce8ff783f30d84" title="foedus::memory::alloc\l_mmap_1gb_pages" alt="" coords="506,107,657,149"/>
<area shape="rect" id="node7" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="752,223,913,265"/>
<area shape="rect" id="node8" href="group__ASSORTED.html#gab3d1892edaa7db4b02029567b7993f37" title="In order to run even on a non&#45;numa machine or a machine with fewer sockets, we allow specifying arbit..." alt="" coords="506,391,657,433"/>
<area shape="rect" id="node9" href="numa_8h.html#a413cadd87796fff247c83d9ad817cc7e" title="numa_available" alt="" coords="777,340,888,367"/>
<area shape="rect" id="node11" href="numa_8h.html#aba49c14c68d23dc05d046db02766b928" title="numa_preferred" alt="" coords="526,457,637,484"/>
<area shape="rect" id="node12" href="numa_8h.html#a56f33968932f6550e5e5eb4d1acc67b3" title="numa_set_preferred" alt="" coords="513,5,649,32"/>
<area shape="rect" id="node13" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="514,173,649,214"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1memory.html#af6145d9296231995c84badafb6a2a0a9" title="Returns if 1GB hugepages were enabled. " alt="" coords="977,99,1143,141"/>
<area shape="rect" id="node10" href="numa_8h.html#a22585176d6e08c221de8377637bd72a7" title="numa_num_configured\l_nodes" alt="" coords="757,391,909,433"/>
<area shape="rect" id="node14" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="765,158,900,199"/>
<area shape="rect" id="node18" href="classfoedus_1_1memory_1_1AlignedMemory.html#a8db2e188293eaeebdf36cf39920efedd" title="Returns the byte size of the memory block. " alt="" coords="475,638,688,679"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aa55b6ec5e0174d4122bdb9b728cd2088"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::storage::hash::HashComposeContext::execute </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="hash__composer__impl_8cpp_source.html#l00487">487</a> of file <a class="el" href="hash__composer__impl_8cpp_source.html">hash_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="hash__tmpbin_8cpp_source.html#l00074">foedus::storage::hash::HashTmpBin::clean()</a>, <a class="el" href="hash__tmpbin_8cpp_source.html#l00036">foedus::storage::hash::HashTmpBin::create_memory()</a>, <a class="el" href="hash__storage_8cpp_source.html#l00060">foedus::storage::hash::HashStorage::get_bin_count()</a>, <a class="el" href="merge__sort_8hpp_source.html#l00369">foedus::snapshot::MergeSort::get_current_count()</a>, <a class="el" href="merge__sort_8hpp_source.html#l00132">foedus::snapshot::MergeSort::SortEntry::get_key()</a>, <a class="el" href="merge__sort_8hpp_source.html#l00378">foedus::snapshot::MergeSort::get_sort_entries()</a>, <a class="el" href="hash__page__impl_8hpp_source.html#l00070">foedus::storage::hash::HashIntermediatePage::header()</a>, <a class="el" href="merge__sort_8hpp_source.html#l00358">foedus::snapshot::MergeSort::is_ended_all()</a>, <a class="el" href="storage__id_8hpp_source.html#l00045">foedus::storage::kPageSize</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="compiler_8hpp_source.html#l00103">LIKELY</a>, <a class="el" href="merge__sort_8cpp_source.html#l00143">foedus::snapshot::MergeSort::next_batch()</a>, <a class="el" href="page_8hpp_source.html#l00196">foedus::storage::PageHeader::storage_id_</a>, <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>, and <a class="el" href="error__stack_8hpp_source.html#l00533">WRAP_ERROR_CODE</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                       {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">// Initializations</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  std::memset(root_info_page_, 0, <a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a>);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  root_info_page_-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a4a8c3c363862348530e4ea0be879f694">storage_id_</a> = storage_id_;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(init_intermediates());</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(init_cur_path());</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(cur_bin_table_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashTmpBin.html#a44b5b127711bdcde112b8950c0777f01">create_memory</a>(numa_node_));  <span class="comment">// TASK(Hideaki) reuse memory</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  cur_bin_table_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashTmpBin.html#a8e54f04414874188fa9d656aa0eba85c">clean</a>();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  VLOG(0) &lt;&lt; <span class="stringliteral">&quot;HashComposer-&quot;</span> &lt;&lt; storage_id_ &lt;&lt; <span class="stringliteral">&quot; initialization done. processing...&quot;</span>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordtype">bool</span> processed_any = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  cur_bin_ = kCurBinNotOpened;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#ab989687173572526626ef863e2e9f449">next_batch</a>());</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    uint64_t count = merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#a12d87bc8cb8a03bde15e79270d37c871">get_current_count</a>();</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">if</span> (count == 0 &amp;&amp; merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#a96cbfd2df2dcd759db60e3c17285d3a9">is_ended_all</a>()) {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    processed_any = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keyword">const</span> snapshot::MergeSort::SortEntry* sort_entries = merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#af390efb0135d70f665a673f8fa55c159">get_sort_entries</a>();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    uint64_t cur = 0;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">while</span> (cur &lt; count) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <a class="code" href="group__HASH.html#gacb9a1ea596bf0db3f6ded1710ab3b3d6">HashBin</a> head_bin = sort_entries[cur].get_key();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(head_bin &lt; storage_.<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a092465b1ea5688d713e3f73aaf13a23c">get_bin_count</a>());</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">if</span> (cur_bin_ != head_bin) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="comment">// now we have to finalize the previous bin and switch to a new bin!</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_bin_ == kCurBinNotOpened || cur_bin_ &lt; head_bin);  <span class="comment">// sorted by bins</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(close_cur_bin());</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_bin_ == kCurBinNotOpened);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(open_cur_bin(head_bin));</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_bin_ == head_bin);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">// grab a range of logs that are in the same bin.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      uint64_t next;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">for</span> (next = cur + 1U; <a class="code" href="group__COMPILER.html#gad10e2a9bf230cc6fdd98a6c70958ef81">LIKELY</a>(next &lt; count); ++next) {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="comment">// this check uses sort_entries which are nicely contiguous.</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <a class="code" href="group__HASH.html#gacb9a1ea596bf0db3f6ded1710ab3b3d6">HashBin</a> bin = sort_entries[next].get_key();</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin &gt;= head_bin);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(bin != head_bin)) {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(apply_batch(cur, next));</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      cur = next;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur == count);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordflow">if</span> (!processed_any) {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;wtf? no logs? storage-&quot;</span> &lt;&lt; storage_id_;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(finalize());</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_a96cbfd2df2dcd759db60e3c17285d3a9"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#a96cbfd2df2dcd759db60e3c17285d3a9">foedus::snapshot::MergeSort::is_ended_all</a></div><div class="ttdeci">bool is_ended_all() const </div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00358">merge_sort.hpp:358</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_af390efb0135d70f665a673f8fa55c159"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#af390efb0135d70f665a673f8fa55c159">foedus::snapshot::MergeSort::get_sort_entries</a></div><div class="ttdeci">const SortEntry * get_sort_entries() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00378">merge_sort.hpp:378</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashTmpBin_html_a44b5b127711bdcde112b8950c0777f01"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashTmpBin.html#a44b5b127711bdcde112b8950c0777f01">foedus::storage::hash::HashTmpBin::create_memory</a></div><div class="ttdeci">ErrorCode create_memory(uint16_t numa_node, uint64_t initial_size=kDefaultInitialSize)</div><div class="ttdoc">Allocates the memory to use by this object. </div><div class="ttdef"><b>Definition:</b> <a href="hash__tmpbin_8cpp_source.html#l00036">hash_tmpbin.cpp:36</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_a134e444d2b945700fe14d0d6d3dd11f0"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">foedus::storage::hash::HashIntermediatePage::header</a></div><div class="ttdeci">PageHeader &amp; header()</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00070">hash_page_impl.hpp:70</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashTmpBin_html_a8e54f04414874188fa9d656aa0eba85c"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashTmpBin.html#a8e54f04414874188fa9d656aa0eba85c">foedus::storage::hash::HashTmpBin::clean</a></div><div class="ttdeci">void clean()</div><div class="ttdoc">Removes all tuple data for the current bin. </div><div class="ttdef"><b>Definition:</b> <a href="hash__tmpbin_8cpp_source.html#l00074">hash_tmpbin.cpp:74</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_a4a8c3c363862348530e4ea0be879f694"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#a4a8c3c363862348530e4ea0be879f694">foedus::storage::PageHeader::storage_id_</a></div><div class="ttdeci">StorageId storage_id_</div><div class="ttdoc">ID of the storage this page belongs to. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00196">page.hpp:196</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_ab989687173572526626ef863e2e9f449"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#ab989687173572526626ef863e2e9f449">foedus::snapshot::MergeSort::next_batch</a></div><div class="ttdeci">ErrorStack next_batch()</div><div class="ttdoc">Executes merge-sort on several thousands of logs and provides the result as a batch. </div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8cpp_source.html#l00143">merge_sort.cpp:143</a></div></div>
<div class="ttc" id="group__COMPILER_html_gad10e2a9bf230cc6fdd98a6c70958ef81"><div class="ttname"><a href="group__COMPILER.html#gad10e2a9bf230cc6fdd98a6c70958ef81">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)        </div><div class="ttdoc">Hints that x is highly likely true. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00103">compiler.hpp:103</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_a12d87bc8cb8a03bde15e79270d37c871"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#a12d87bc8cb8a03bde15e79270d37c871">foedus::snapshot::MergeSort::get_current_count</a></div><div class="ttdeci">MergedPosition get_current_count() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00369">merge_sort.hpp:369</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStorage_html_a092465b1ea5688d713e3f73aaf13a23c"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a092465b1ea5688d713e3f73aaf13a23c">foedus::storage::hash::HashStorage::get_bin_count</a></div><div class="ttdeci">HashBin get_bin_count() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage_8cpp_source.html#l00060">hash_storage.cpp:60</a></div></div>
<div class="ttc" id="group__HASH_html_gacb9a1ea596bf0db3f6ded1710ab3b3d6"><div class="ttname"><a href="group__HASH.html#gacb9a1ea596bf0db3f6ded1710ab3b3d6">foedus::storage::hash::HashBin</a></div><div class="ttdeci">uint64_t HashBin</div><div class="ttdoc">Represents a bin of a hash value. </div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00142">hash_id.hpp:142</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga952ce4f5f860d7b28a70095b450d3f4d"><div class="ttname"><a href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a></div><div class="ttdeci">#define WRAP_ERROR_CODE(x)</div><div class="ttdoc">Same as CHECK_ERROR(x) except it receives only an error code, thus more efficient. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00533">error_stack.hpp:533</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga1a3c05fe1d44455fc3e761947c6e21e6"><div class="ttname"><a href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">foedus::storage::kPageSize</a></div><div class="ttdeci">const uint16_t kPageSize</div><div class="ttdoc">A constant defining the page size (in bytes) of both snapshot pages and volatile pages. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00045">storage_id.hpp:45</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1hash_1_1HashComposeContext_aa55b6ec5e0174d4122bdb9b728cd2088_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1hash_1_1HashComposeContext_aa55b6ec5e0174d4122bdb9b728cd2088_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1hash_1_1HashComposeContext_aa55b6ec5e0174d4122bdb9b728cd2088_cgraph" id="classfoedus_1_1storage_1_1hash_1_1HashComposeContext_aa55b6ec5e0174d4122bdb9b728cd2088_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1hash_1_1HashTmpBin.html#a8e54f04414874188fa9d656aa0eba85c" title="Removes all tuple data for the current bin. " alt="" coords="489,105,636,146"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1hash_1_1HashTmpBin.html#a44b5b127711bdcde112b8950c0777f01" title="Allocates the memory to use by this object. " alt="" coords="237,163,385,219"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a092465b1ea5688d713e3f73aaf13a23c" title="foedus::storage::hash\l::HashStorage::get_bin_count" alt="" coords="213,243,408,285"/>
<area shape="rect" id="node19" href="classfoedus_1_1snapshot_1_1MergeSort.html#a12d87bc8cb8a03bde15e79270d37c871" title="foedus::snapshot::MergeSort\l::get_current_count" alt="" coords="216,309,405,350"/>
<area shape="rect" id="node20" href="structfoedus_1_1snapshot_1_1MergeSort_1_1SortEntry.html#ac07022134acca1a0cbf62a543e5f714d" title="foedus::snapshot::MergeSort\l::SortEntry::get_key" alt="" coords="216,374,405,415"/>
<area shape="rect" id="node21" href="classfoedus_1_1snapshot_1_1MergeSort.html#af390efb0135d70f665a673f8fa55c159" title="foedus::snapshot::MergeSort\l::get_sort_entries" alt="" coords="216,439,405,481"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0" title="foedus::storage::hash\l::HashIntermediatePage\l::header" alt="" coords="230,505,391,561"/>
<area shape="rect" id="node23" href="classfoedus_1_1snapshot_1_1MergeSort.html#a96cbfd2df2dcd759db60e3c17285d3a9" title="foedus::snapshot::MergeSort\l::is_ended_all" alt="" coords="468,575,657,617"/>
<area shape="rect" id="node24" href="classfoedus_1_1snapshot_1_1MergeSort.html#ab989687173572526626ef863e2e9f449" title="Executes merge&#45;sort on several thousands of logs and provides the result as a batch. " alt="" coords="216,638,405,679"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1hash_1_1HashTmpBin.html#a766152ddf547a633d9d2bf39c6d324e2" title="foedus::storage::hash\l::HashTmpBin::get_first\l_record" alt="" coords="717,5,876,61"/>
<area shape="rect" id="node5" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="456,287,669,329"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1memory.html#ac2422aa4fe378da8a9594901762e17df" title="foedus::memory::alloc_mmap" alt="" coords="924,137,1117,164"/>
<area shape="rect" id="node8" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="1178,254,1318,295"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1memory.html#ae51e4a90f52316ba9dce8ff783f30d84" title="foedus::memory::alloc\l_mmap_1gb_pages" alt="" coords="721,86,872,127"/>
<area shape="rect" id="node10" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="940,254,1101,295"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gab3d1892edaa7db4b02029567b7993f37" title="In order to run even on a non&#45;numa machine or a machine with fewer sockets, we allow specifying arbit..." alt="" coords="721,422,872,463"/>
<area shape="rect" id="node12" href="numa_8h.html#a413cadd87796fff247c83d9ad817cc7e" title="numa_available" alt="" coords="965,371,1076,397"/>
<area shape="rect" id="node14" href="numa_8h.html#aba49c14c68d23dc05d046db02766b928" title="numa_preferred" alt="" coords="741,488,852,515"/>
<area shape="rect" id="node15" href="numa_8h.html#a56f33968932f6550e5e5eb4d1acc67b3" title="numa_set_preferred" alt="" coords="729,539,865,565"/>
<area shape="rect" id="node16" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="729,203,864,245"/>
<area shape="rect" id="node7" href="namespacefoedus_1_1memory.html#af6145d9296231995c84badafb6a2a0a9" title="Returns if 1GB hugepages were enabled. " alt="" coords="1165,130,1331,171"/>
<area shape="rect" id="node13" href="numa_8h.html#a22585176d6e08c221de8377637bd72a7" title="numa_num_configured\l_nodes" alt="" coords="945,422,1097,463"/>
<area shape="rect" id="node17" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="953,189,1088,230"/>
<area shape="rect" id="node25" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="477,706,649,747"/>
<area shape="rect" id="node26" href="classfoedus_1_1snapshot_1_1MergeSort.html#a87778e11ef6dbb58f65c8669d06f75c9" title="foedus::snapshot::MergeSort\l::is_no_merging" alt="" coords="468,641,657,682"/>
</map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/storage/hash/<a class="el" href="hash__composer__impl_8hpp_source.html">hash_composer_impl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/storage/hash/<a class="el" href="hash__composer__impl_8cpp_source.html">hash_composer_impl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage.html">storage</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage_1_1hash.html">hash</a></li><li class="navelem"><a class="el" href="classfoedus_1_1storage_1_1hash_1_1HashComposeContext.html">HashComposeContext</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
