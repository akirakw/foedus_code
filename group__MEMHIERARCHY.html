<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: Memory Hierarchy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__MEMHIERARCHY.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">Memory Hierarchy<div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__MEMORY.html">Memory Manager</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>NUMA-Aware <b>Memory</b> <b>Hierarchy</b> in libfoedus-core.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>NUMA-Aware <b>Memory</b> <b>Hierarchy</b> in libfoedus-core. </p>
<dl class="section user"><dt>Overview</dt><dd>We have a memory hierarchy of three levels in libfoedus, resembling the memory hiearchy in NUMA architecture: <ul>
<li>Memories shared engine-wide (EngineMemory) </li>
<li>Memories shared NUMA-Node-wide (NumaNodeMemory) </li>
<li>Private Memories in each core (NumaCoreMemory)</li>
</ul>
The resemblance is intentinal to achieve the best performance of memory allocation/deallocation/sharing in NUMA setting.</dd></dl>
<dl class="section user"><dt>Absolutely no global nor truly TLS variables</dt><dd>You might notice that the top level of the hierarchy is <em>engine-wide</em>, not <em>global</em>. libfoedus uses absolutely no global nor static variables except const primitive types. This simplifies the design of memory management in the library and allows running multiple instances (engines) of our library even in one process. What we have in Engine object is everything. When Engine's uninitialize() is invoked, everything the Engine acquired is released, separately from other Engine's. This also means that memory-leak checkers like valgrind can easily check for potential errors.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Unfortunately, there is one exception to this rule; google-logging. google::InitGoogleLogging() and ShutdownGoogleLogging() must be called exactly once in the process. So, we do them in Engine's initialize()/uninitialize() with a process-global atomic counter to make sure we call them only once.</dd></dl>
<dl class="section user"><dt>Memories shared engine-wide (EngineMemory)</dt><dd></dd></dl>
<dl class="section user"><dt>Overview</dt><dd>This is the top-level memory repository in our engine. All other memory types are contained in this object.</dd></dl>
<dl class="section user"><dt>List of engine-wide memories</dt><dd><ul>
<li>List of NumaNodeMemory, one for each NUMA socket in the machine. </li>
<li>Page pool for volatile read/write store (VolatilePage) and the read-only bufferpool (SnapshotPage).</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Memories shared NUMA-Node-wide (NumaNodeMemory)</dt><dd>One NumaNodeMemory corresponds to one <a class="el" href="classfoedus_1_1thread_1_1ThreadGroup.html" title="Represents a group of pre-allocated threads running in one NUMA node. ">foedus::thread::ThreadGroup</a>. All threads in the thread group belong to the NUMA node, thus sharing memories between them must be efficient. So, all memories here are allocated/freed via <a class="el" href="numa_8h.html#a751dfa7ea95405372b4f30cfde9aa550">numa_alloc_interleaved()</a>, <a class="el" href="numa_8h.html#a0c2d1ca7771933df34f77c175082294f">numa_alloc_onnode()</a>, and <a class="el" href="numa_8h.html#a75ff6cd426469e8afb447fbb61d7dfe8">numa_free()</a> (except the user specifies to not use them).</dd></dl>
<dl class="section user"><dt>Private Memories in each core (NumaCoreMemory)</dt><dd>One NumaCoreMemory corresponds to one <a class="el" href="classfoedus_1_1thread_1_1Thread.html" title="Represents one thread running on one NUMA core. ">foedus::thread::Thread</a>. Each Thread exclusively access its NumaCoreMemory so that it needs no synchronization nor causes cache misses/cache-line ping-pongs. All memories here are allocated/freed via <a class="el" href="numa_8h.html#a751dfa7ea95405372b4f30cfde9aa550">numa_alloc_interleaved()</a>, <a class="el" href="numa_8h.html#a0c2d1ca7771933df34f77c175082294f">numa_alloc_onnode()</a>, and <a class="el" href="numa_8h.html#a75ff6cd426469e8afb447fbb61d7dfe8">numa_free()</a> (except the user specifies to not use them). </dd></dl>
<div class="dynheader">
Collaboration diagram for Memory Hierarchy:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__MEMHIERARCHY.png" border="0" alt="" usemap="#group____MEMHIERARCHY"/>
<map name="group____MEMHIERARCHY" id="group____MEMHIERARCHY">
<area shape="rect" id="node1" href="group__ENGINE.html" title="Database Engine, the top&#45;level component of foedus. " alt="" coords="410,17,531,44"/>
<area shape="rect" id="node3" href="group__THREAD.html" title="Thread and Thread&#45;Group, which abstracts NUMA&#45;core/node and provides API to attach/detach tasks to po..." alt="" coords="387,180,555,207"/>
<area shape="rect" id="node4" href="group__MEMORY.html" title="Memory Manager, which controls memory allocations, deallocations, and sharing. " alt="" coords="409,261,532,288"/>
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1EngineMemory.html">foedus::memory::EngineMemory</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Repository of all memories dynamically acquired and shared within one database engine.  <a href="classfoedus_1_1memory_1_1EngineMemory.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1memory_1_1ScopedNumaPreferred.html">foedus::memory::ScopedNumaPreferred</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automatically sets and resets <a class="el" href="numa_8h.html#a56f33968932f6550e5e5eb4d1acc67b3">numa_set_preferred()</a>.  <a href="structfoedus_1_1memory_1_1ScopedNumaPreferred.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfoedus_1_1memory_1_1NumaCoreMemory_1_1SmallThreadLocalMemoryPieces"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__MEMHIERARCHY.html#structfoedus_1_1memory_1_1NumaCoreMemory_1_1SmallThreadLocalMemoryPieces">foedus::memory::NumaCoreMemory::SmallThreadLocalMemoryPieces</a></td></tr>
<tr class="memdesc:structfoedus_1_1memory_1_1NumaCoreMemory_1_1SmallThreadLocalMemoryPieces"><td class="mdescLeft">&#160;</td><td class="mdescRight">Packs pointers to pieces of small_thread_local_memory_.  <a href="group__MEMHIERARCHY.html#structfoedus_1_1memory_1_1NumaCoreMemory_1_1SmallThreadLocalMemoryPieces">More...</a><br /></td></tr>
<tr class="separator:structfoedus_1_1memory_1_1NumaCoreMemory_1_1SmallThreadLocalMemoryPieces"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1NumaCoreMemory.html">foedus::memory::NumaCoreMemory</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Repository of memories dynamically acquired within one CPU core (thread).  <a href="classfoedus_1_1memory_1_1NumaCoreMemory.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1NumaNodeMemory.html">foedus::memory::NumaNodeMemory</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Repository of memories dynamically acquired and shared within one NUMA node (socket).  <a href="classfoedus_1_1memory_1_1NumaNodeMemory.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html">foedus::memory::NumaNodeMemoryRef</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A view of <a class="el" href="classfoedus_1_1memory_1_1NumaNodeMemory.html" title="Repository of memories dynamically acquired and shared within one NUMA node (socket). ">NumaNodeMemory</a> for other SOCs and master engine.  <a href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1thread_1_1NumaThreadScope.html">foedus::thread::NumaThreadScope</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pin the current thread to the given NUMA node in this object's scope.  <a href="structfoedus_1_1thread_1_1NumaThreadScope.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<hr/><h2 class="groupheader">Class Documentation</h2>
<a name="structfoedus_1_1memory_1_1NumaCoreMemory_1_1SmallThreadLocalMemoryPieces" id="structfoedus_1_1memory_1_1NumaCoreMemory_1_1SmallThreadLocalMemoryPieces"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct foedus::memory::NumaCoreMemory::SmallThreadLocalMemoryPieces</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Packs pointers to pieces of small_thread_local_memory_. </p>

<p>Definition at line <a class="el" href="numa__core__memory_8hpp_source.html#l00049">49</a> of file <a class="el" href="numa__core__memory_8hpp_source.html">numa_core_memory.hpp</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Class Members</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a3c7ea7789c0989c9ac59a9fb532d7e69"></a>char *</td>
<td class="fieldname">
sysxct_workspace_memory_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a5f8036024a45def08da764ed1d5cffb1"></a>char *</td>
<td class="fieldname">
xct_lock_free_read_access_memory_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="aca2509b57d08a0a9614750c1a69c3622"></a>char *</td>
<td class="fieldname">
xct_lock_free_write_access_memory_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="af61d2286d9766ed31244e5ebce1fcfd4"></a>char *</td>
<td class="fieldname">
xct_page_version_memory_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a831aaa8b02b924b748d999072a549659"></a>char *</td>
<td class="fieldname">
xct_pointer_access_memory_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a43d882917b1f12481ebce4a45934dd5a"></a>char *</td>
<td class="fieldname">
xct_read_access_memory_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a97637e9469b9d93d4df4f7a8c78c8269"></a>char *</td>
<td class="fieldname">
xct_write_access_memory_</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
