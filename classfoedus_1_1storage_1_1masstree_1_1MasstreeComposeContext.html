<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::storage::masstree::MasstreeComposeContext Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::storage::masstree::MasstreeComposeContext Class Reference<div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__STORAGE.html">Storage Manager</a> &raquo; <a class="el" href="group__MASSTREE.html">Masstree Storage</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposer.html" title="Composer for an masstree storage. ">MasstreeComposer</a>'s compose() implementation separated from the class itself.  
 <a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposer.html" title="Composer for an masstree storage. ">MasstreeComposer</a>'s compose() implementation separated from the class itself. </p>
<p>It's a complicated method, so worth being its own class. This defines all the variables maintained during one compose() call.</p>
<dl class="section user"><dt>Algorithm Overview</dt><dd>As described above, the biggest advantage to separate composer from transaction execution is that it simplifies the logic to construct a page. The sorted log stream provides log entries in key order. This class follows the same order when it constructs a pages. For every key, we do: <ul>
<li>Make sure this object maintains pages in the path from root to the page that contains the key. </li>
<li>Each maintained page is initialized by previous snapshot page, empty if not exists. </li>
<li>The way we initialize with snapshot page is a bit special. We keep the image of the snapshot page as <em>original</em> page and append them to the maintained page up to the current key. The original page is stored in work memory (because we will not write them out), and <a class="el" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PathLevel.html" title="One level in the path. ">PathLevel</a> points to it. More details below (Original page pointer). </li>
<li>Assuming the original page trick, each maintained page always appends a new record to the end or update the record in the end, thus it's trivial to achieve 100% fill factor without any record movement. </li>
<li>Each maintained page might have a next-page pointer in foster_twin[1], which is filled when the page becomes full (note: because keys are ordered, we never have to do the split with records. it just puts a next-page pointer).</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Page path and open/close</dt><dd>We maintain one path of pages (route) from the root to a border page that contains the current key. Each level consists of exactly one page with optional next page chain and original page. As far as we keep appending a key in the page of last level, we keep the same path forever upto the end of logs. The following cases trigger a change in the path. <ul>
<li>Creation of next layer. We just deepen the path for one level. This is the easiest change. </li>
<li>Nexy key is beyond high-fence of the page of last level. We then <em>close</em> the last level, insert to the parent, repeat until the ancestor that logically contains the key (potentially root of the first layer), then <em>open</em> the path for next key. </li>
<li>Full page buffer. When we can't add any more page in writer's buffer, we flush out the last level page chain upto the tail page (the tail page is kept because it's currently modified). This keeps the current path except that last level's head/low-fence are moved forward.</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Original page pointer</dt><dd>The <em>active</em> page in each level has a non-null pointer with kOriginalPage flag in foster_twin[0] so that we can append remaining records/links when next key is same or above the keys. The original page image is created when the page in the path is opened, and kept until it's closed. Thus, there are at most #-of-levels original pages, which should be pretty small. </dd></dl>

<p>Definition at line <a class="el" href="masstree__composer__impl_8hpp_source.html#l00161">161</a> of file <a class="el" href="masstree__composer__impl_8hpp_source.html">masstree_composer_impl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="masstree__composer__impl_8hpp_source.html">masstree_composer_impl.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1FenceAndPointer"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__MASSTREE.html#structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1FenceAndPointer">FenceAndPointer</a></td></tr>
<tr class="separator:structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1FenceAndPointer"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PageBoundaryInfo.html">PageBoundaryInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents a minimal information to install a new snapshot page pointer.  <a href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PageBoundaryInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PageBoundarySort.html">PageBoundarySort</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Points to <a class="el" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PageBoundaryInfo.html" title="Represents a minimal information to install a new snapshot page pointer. ">PageBoundaryInfo</a> with a sorting information.  <a href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PageBoundarySort.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PathLevel.html">PathLevel</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">One level in the path.  <a href="structfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_1_1PathLevel.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ad9e37c0eca7fb90f69f90588948234a9"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9">Constants</a> { <a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a5b7595b9f53e5f4284a62047395df12a">kMaxLevels</a> = 32, 
<a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a2783f17bc5b1a286d90cda47ff1600d5">kMaxLayers</a> = 16, 
<a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355">kMaxLogGroupSize</a> = 1 &lt;&lt; 14, 
<a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a9a48440ea1fb2fb493beb753cf5e3b16">kTmpBoundaryArraySize</a> = kMaxLogGroupSize
 }<tr class="separator:ad9e37c0eca7fb90f69f90588948234a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a6f661b87d63bc26620c7317b289b7f34"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#a6f661b87d63bc26620c7317b289b7f34">MasstreeComposeContext</a> (<a class="el" href="classfoedus_1_1Engine.html">Engine</a> *engine, <a class="el" href="classfoedus_1_1snapshot_1_1MergeSort.html">snapshot::MergeSort</a> *merge_sort, const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">Composer::ComposeArguments</a> &amp;args)</td></tr>
<tr class="memdesc:a6f661b87d63bc26620c7317b289b7f34"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html" title="MasstreeComposer&#39;s compose() implementation separated from the class itself. ">MasstreeComposeContext</a> methods.  <a href="#a6f661b87d63bc26620c7317b289b7f34">More...</a><br /></td></tr>
<tr class="separator:a6f661b87d63bc26620c7317b289b7f34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d9ff2d2af85b6d09ecb6e310bae6888"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#a1d9ff2d2af85b6d09ecb6e310bae6888">execute</a> ()</td></tr>
<tr class="memdesc:a1d9ff2d2af85b6d09ecb6e310bae6888"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#a1d9ff2d2af85b6d09ecb6e310bae6888" title="MasstreeComposeContext::execute() and subroutines for log groups. ">MasstreeComposeContext::execute()</a> and subroutines for log groups.  <a href="#a1d9ff2d2af85b6d09ecb6e310bae6888">More...</a><br /></td></tr>
<tr class="separator:a1d9ff2d2af85b6d09ecb6e310bae6888"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="ad9e37c0eca7fb90f69f90588948234a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9">foedus::storage::masstree::MasstreeComposeContext::Constants</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="ad9e37c0eca7fb90f69f90588948234a9a5b7595b9f53e5f4284a62047395df12a"></a>kMaxLevels&#160;</td><td class="fielddoc">
<p>We assume the path wouldn't be this deep. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="ad9e37c0eca7fb90f69f90588948234a9a2783f17bc5b1a286d90cda47ff1600d5"></a>kMaxLayers&#160;</td><td class="fielddoc">
<p>We assume B-trie depth is at most this (prefix is at most 8*this value) </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355"></a>kMaxLogGroupSize&#160;</td><td class="fielddoc">
<p>Maximum number of logs execute_xxx_group methods process in one shot. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="ad9e37c0eca7fb90f69f90588948234a9a9a48440ea1fb2fb493beb753cf5e3b16"></a>kTmpBoundaryArraySize&#160;</td><td class="fielddoc">
<p>Size of the tmp_boundary_array_. </p>
<p>Most likely we don't need this much, but this memory consumtion is negligible anyways. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="masstree__composer__impl_8hpp_source.html#l00163">163</a> of file <a class="el" href="masstree__composer__impl_8hpp_source.html">masstree_composer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                 {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a5b7595b9f53e5f4284a62047395df12a">kMaxLevels</a> = 32,</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a2783f17bc5b1a286d90cda47ff1600d5">kMaxLayers</a> = 16,</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355">kMaxLogGroupSize</a> = 1 &lt;&lt; 14,</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a9a48440ea1fb2fb493beb753cf5e3b16">kTmpBoundaryArraySize</a> = <a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355">kMaxLogGroupSize</a>,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  };</div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_html_ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355">foedus::storage::masstree::MasstreeComposeContext::kMaxLogGroupSize</a></div><div class="ttdoc">Maximum number of logs execute_xxx_group methods process in one shot. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__composer__impl_8hpp_source.html#l00169">masstree_composer_impl.hpp:169</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_html_ad9e37c0eca7fb90f69f90588948234a9a5b7595b9f53e5f4284a62047395df12a"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a5b7595b9f53e5f4284a62047395df12a">foedus::storage::masstree::MasstreeComposeContext::kMaxLevels</a></div><div class="ttdoc">We assume the path wouldn&#39;t be this deep. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__composer__impl_8hpp_source.html#l00165">masstree_composer_impl.hpp:165</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_html_ad9e37c0eca7fb90f69f90588948234a9a9a48440ea1fb2fb493beb753cf5e3b16"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a9a48440ea1fb2fb493beb753cf5e3b16">foedus::storage::masstree::MasstreeComposeContext::kTmpBoundaryArraySize</a></div><div class="ttdoc">Size of the tmp_boundary_array_. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__composer__impl_8hpp_source.html#l00174">masstree_composer_impl.hpp:174</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_html_ad9e37c0eca7fb90f69f90588948234a9a2783f17bc5b1a286d90cda47ff1600d5"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9a2783f17bc5b1a286d90cda47ff1600d5">foedus::storage::masstree::MasstreeComposeContext::kMaxLayers</a></div><div class="ttdoc">We assume B-trie depth is at most this (prefix is at most 8*this value) </div><div class="ttdef"><b>Definition:</b> <a href="masstree__composer__impl_8hpp_source.html#l00167">masstree_composer_impl.hpp:167</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a6f661b87d63bc26620c7317b289b7f34"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">foedus::storage::masstree::MasstreeComposeContext::MasstreeComposeContext </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Engine.html">Engine</a> *&#160;</td>
          <td class="paramname"><em>engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1snapshot_1_1MergeSort.html">snapshot::MergeSort</a> *&#160;</td>
          <td class="paramname"><em>merge_sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">Composer::ComposeArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html" title="MasstreeComposer&#39;s compose() implementation separated from the class itself. ">MasstreeComposeContext</a> methods. </p>

<p>Definition at line <a class="el" href="masstree__composer__impl_8cpp_source.html#l00291">291</a> of file <a class="el" href="masstree__composer__impl_8cpp_source.html">masstree_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00115">foedus::snapshot::SnapshotWriter::get_next_page_id()</a>.</p>
<div class="fragment"><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  : engine_(engine),</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    merge_sort_(merge_sort),</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    id_(merge_sort-&gt;get_storage_id()),</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    storage_(engine, id_),</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    args_(args),</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    snapshot_id_(args.snapshot_writer_-&gt;get_snapshot_id()),</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    numa_node_(get_writer()-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a31e0233463f813ec7a645e970bbe499c">get_numa_node</a>()),</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    max_pages_(get_writer()-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ab547f0a3936d5cb0c0ee827ea77edd09">get_page_size</a>()),</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    root_(reinterpret_cast&lt;MasstreeIntermediatePage*&gt;(args.root_info_page_)),</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    page_base_(reinterpret_cast&lt;Page*&gt;(get_writer()-&gt;get_page_base())),</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    original_base_(merge_sort-&gt;get_original_pages()) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  page_id_base_ = get_writer()-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#af9bcb8a605aecbbc3eabdc6664f6b163">get_next_page_id</a>();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  refresh_page_boundary_info_variables();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  root_index_ = 0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  root_index_mini_ = 0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  allocated_pages_ = 0;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  cur_path_levels_ = 0;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  page_boundary_info_cur_pos_ = 0;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  page_boundary_elements_ = 0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  std::memset(cur_path_, 0, <span class="keyword">sizeof</span>(cur_path_));</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  std::memset(cur_prefix_be_, 0, <span class="keyword">sizeof</span>(cur_prefix_be_));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  std::memset(cur_prefix_slices_, 0, <span class="keyword">sizeof</span>(cur_prefix_slices_));</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  std::memset(tmp_boundary_array_, 0, <span class="keyword">sizeof</span>(tmp_boundary_array_));</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotWriter_html_ab547f0a3936d5cb0c0ee827ea77edd09"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ab547f0a3936d5cb0c0ee827ea77edd09">foedus::snapshot::SnapshotWriter::get_page_size</a></div><div class="ttdeci">memory::PagePoolOffset get_page_size() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__writer__impl_8hpp_source.html#l00105">snapshot_writer_impl.hpp:105</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotWriter_html_a31e0233463f813ec7a645e970bbe499c"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a31e0233463f813ec7a645e970bbe499c">foedus::snapshot::SnapshotWriter::get_numa_node</a></div><div class="ttdeci">uint16_t get_numa_node() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__writer__impl_8hpp_source.html#l00101">snapshot_writer_impl.hpp:101</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotWriter_html_af9bcb8a605aecbbc3eabdc6664f6b163"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#af9bcb8a605aecbbc3eabdc6664f6b163">foedus::snapshot::SnapshotWriter::get_next_page_id</a></div><div class="ttdeci">storage::SnapshotPagePointer get_next_page_id() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__writer__impl_8hpp_source.html#l00115">snapshot_writer_impl.hpp:115</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a6f661b87d63bc26620c7317b289b7f34_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a6f661b87d63bc26620c7317b289b7f34_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a6f661b87d63bc26620c7317b289b7f34_cgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a6f661b87d63bc26620c7317b289b7f34_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#af9bcb8a605aecbbc3eabdc6664f6b163" title="foedus::snapshot::Snapshot\lWriter::get_next_page_id" alt="" coords="237,13,421,54"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a1d9ff2d2af85b6d09ecb6e310bae6888"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::storage::masstree::MasstreeComposeContext::execute </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#a1d9ff2d2af85b6d09ecb6e310bae6888" title="MasstreeComposeContext::execute() and subroutines for log groups. ">MasstreeComposeContext::execute()</a> and subroutines for log groups. </p>

<p>Definition at line <a class="el" href="masstree__composer__impl_8cpp_source.html#l00371">371</a> of file <a class="el" href="masstree__composer__impl_8cpp_source.html">masstree_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="merge__sort_8hpp_source.html#l00288">foedus::snapshot::MergeSort::GroupifyResult::count_</a>, <a class="el" href="merge__sort_8hpp_source.html#l00369">foedus::snapshot::MergeSort::get_current_count()</a>, <a class="el" href="masstree__log__types_8hpp_source.html#l00104">foedus::storage::masstree::MasstreeCommonLogType::get_key()</a>, <a class="el" href="merge__sort_8hpp_source.html#l00292">foedus::snapshot::MergeSort::GroupifyResult::get_log_type()</a>, <a class="el" href="merge__sort_8hpp_source.html#l00534">foedus::snapshot::MergeSort::groupify()</a>, <a class="el" href="merge__sort_8hpp_source.html#l00289">foedus::snapshot::MergeSort::GroupifyResult::has_common_key_</a>, <a class="el" href="merge__sort_8hpp_source.html#l00290">foedus::snapshot::MergeSort::GroupifyResult::has_common_log_code_</a>, <a class="el" href="merge__sort_8hpp_source.html#l00358">foedus::snapshot::MergeSort::is_ended_all()</a>, <a class="el" href="masstree__log__types_8hpp_source.html#l00088">foedus::storage::masstree::MasstreeCommonLogType::key_length_</a>, <a class="el" href="log__type_8hpp_source.html#l00128">foedus::log::kLogCodeMasstreeDelete</a>, <a class="el" href="log__type_8hpp_source.html#l00127">foedus::log::kLogCodeMasstreeInsert</a>, <a class="el" href="log__type_8hpp_source.html#l00126">foedus::log::kLogCodeMasstreeOverwrite</a>, <a class="el" href="log__type_8hpp_source.html#l00129">foedus::log::kLogCodeMasstreeUpdate</a>, <a class="el" href="masstree__composer__impl_8hpp_source.html#l00169">kMaxLogGroupSize</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="compiler_8hpp_source.html#l00103">LIKELY</a>, <a class="el" href="merge__sort_8cpp_source.html#l00143">foedus::snapshot::MergeSort::next_batch()</a>, and <a class="el" href="merge__sort_8hpp_source.html#l00384">foedus::snapshot::MergeSort::resolve_sort_position()</a>.</p>
<div class="fragment"><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                           {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  write_dummy_page_zero();</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(init_root());</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordtype">char</span> debug_prev[8192];</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  uint16_t debug_prev_length = 0;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  uint64_t processed = 0;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#ab989687173572526626ef863e2e9f449">next_batch</a>());</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    uint64_t count = merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#a12d87bc8cb8a03bde15e79270d37c871">get_current_count</a>();</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (count == 0 &amp;&amp; merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#a96cbfd2df2dcd759db60e3c17285d3a9">is_ended_all</a>()) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">// confirm that it&#39;s fully sorted</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">for</span> (uint64_t i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keyword">const</span> MasstreeCommonLogType* entry =</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>MasstreeCommonLogType*<span class="keyword">&gt;</span>(merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#aa4d791bfc9f892322123a334757b53f1">resolve_sort_position</a>(i));</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* key = entry-&gt;get_key();</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <a class="code" href="group__MASSTREE.html#gaa0c469cd4f863aa64e07fcea90b72859">KeyLength</a> key_length = entry-&gt;key_length_;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(key_length &gt; 0);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordflow">if</span> (key_length &lt; debug_prev_length) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(std::memcmp(debug_prev, key, key_length) &lt;= 0);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(std::memcmp(debug_prev, key, debug_prev_length) &lt;= 0);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      std::memcpy(debug_prev, key, key_length);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      debug_prev_length = key_length;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">// within the batch, we further split them into &quot;groups&quot; that share the same key or log types</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">// so that we can process a number of logs in a tight loop.</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    uint64_t cur = 0;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    uint32_t group_count = 0;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">while</span> (cur &lt; count) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      snapshot::MergeSort::GroupifyResult group = merge_sort_-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MergeSort.html#ad9dbb6f5e13662a996e70c79bfb1b7fd">groupify</a>(cur, <a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355">kMaxLogGroupSize</a>);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(group.count_ &lt;= <a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355">kMaxLogGroupSize</a>);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#gad10e2a9bf230cc6fdd98a6c70958ef81">LIKELY</a>(group.count_ == 1U)) {  <span class="comment">// misprediction is amortized by group, so LIKELY is better</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="comment">// no grouping. slowest case. has to be reasonably fast even in this case.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!group.has_common_key_);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!group.has_common_log_code_);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(execute_a_log(cur));</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (group.has_common_key_) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(execute_same_key_group(cur, cur + group.count_));</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(group.has_common_log_code_);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <a class="code" href="group__LOGTYPE.html#gafeea30298c4f7a9586bddec3663fc4f3">log::LogCode</a> log_type = group.get_log_type();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">if</span> (log_type == <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3ad1dfa8a154a5ac67fe06f0ecefadda6a">log::kLogCodeMasstreeInsert</a>) {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;          <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(execute_insert_group(cur, cur + group.count_));</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (log_type == <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3abb140a328897a4bf18aea0170adbb235">log::kLogCodeMasstreeDelete</a>) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;          <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(execute_delete_group(cur, cur + group.count_));</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (log_type == <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3ac2062f25de0409e94e8a9c2486ae89cd">log::kLogCodeMasstreeUpdate</a>) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(execute_update_group(cur, cur + group.count_));</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;          <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(log_type == <a class="code" href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3a0cae9d20d4db5d08b6adbc1b8b318ef9">log::kLogCodeMasstreeOverwrite</a>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(execute_overwrite_group(cur, cur + group.count_));</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      cur += group.count_;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      processed += group.count_;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      ++group_count;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur == count);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    VLOG(1) &lt;&lt; storage_ &lt;&lt; <span class="stringliteral">&quot; processed a batch of &quot;</span> &lt;&lt; cur &lt;&lt; <span class="stringliteral">&quot; logs that has &quot;</span> &lt;&lt; group_count</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; groups&quot;</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  VLOG(0) &lt;&lt; storage_ &lt;&lt; <span class="stringliteral">&quot; processed &quot;</span> &lt;&lt; processed &lt;&lt; <span class="stringliteral">&quot; logs. now pages=&quot;</span> &lt;&lt; allocated_pages_;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(flush_buffer());</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="comment">// at the end, install pointers to the created snapshot pages except root page.</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  uint64_t installed_count = 0;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(install_snapshot_pointers(&amp;installed_count));</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div>
<div class="ttc" id="group__LOGTYPE_html_gafeea30298c4f7a9586bddec3663fc4f3"><div class="ttname"><a href="group__LOGTYPE.html#gafeea30298c4f7a9586bddec3663fc4f3">foedus::log::LogCode</a></div><div class="ttdeci">LogCode</div><div class="ttdoc">A unique identifier of all log types. </div><div class="ttdef"><b>Definition:</b> <a href="log__type_8hpp_source.html#l00087">log_type.hpp:87</a></div></div>
<div class="ttc" id="namespacefoedus_1_1log_html_gafeea30298c4f7a9586bddec3663fc4f3ad1dfa8a154a5ac67fe06f0ecefadda6a"><div class="ttname"><a href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3ad1dfa8a154a5ac67fe06f0ecefadda6a">foedus::log::kLogCodeMasstreeInsert</a></div><div class="ttdoc">0x0033 : foedus::storage::masstree::MasstreeInsertLogType . </div><div class="ttdef"><b>Definition:</b> <a href="log__type_8hpp_source.html#l00127">log_type.hpp:127</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_a96cbfd2df2dcd759db60e3c17285d3a9"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#a96cbfd2df2dcd759db60e3c17285d3a9">foedus::snapshot::MergeSort::is_ended_all</a></div><div class="ttdeci">bool is_ended_all() const </div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00358">merge_sort.hpp:358</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_aa4d791bfc9f892322123a334757b53f1"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#aa4d791bfc9f892322123a334757b53f1">foedus::snapshot::MergeSort::resolve_sort_position</a></div><div class="ttdeci">const log::RecordLogType * resolve_sort_position(uint32_t sort_pos) const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00384">merge_sort.hpp:384</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_ab989687173572526626ef863e2e9f449"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#ab989687173572526626ef863e2e9f449">foedus::snapshot::MergeSort::next_batch</a></div><div class="ttdeci">ErrorStack next_batch()</div><div class="ttdoc">Executes merge-sort on several thousands of logs and provides the result as a batch. </div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8cpp_source.html#l00143">merge_sort.cpp:143</a></div></div>
<div class="ttc" id="group__MASSTREE_html_gaa0c469cd4f863aa64e07fcea90b72859"><div class="ttname"><a href="group__MASSTREE.html#gaa0c469cd4f863aa64e07fcea90b72859">foedus::storage::masstree::KeyLength</a></div><div class="ttdeci">uint16_t KeyLength</div><div class="ttdoc">Represents a byte-length of a key in this package. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__id_8hpp_source.html#l00069">masstree_id.hpp:69</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_html_ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html#ad9e37c0eca7fb90f69f90588948234a9acd65425ae6a32f11ca6a6761c3964355">foedus::storage::masstree::MasstreeComposeContext::kMaxLogGroupSize</a></div><div class="ttdoc">Maximum number of logs execute_xxx_group methods process in one shot. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__composer__impl_8hpp_source.html#l00169">masstree_composer_impl.hpp:169</a></div></div>
<div class="ttc" id="group__COMPILER_html_gad10e2a9bf230cc6fdd98a6c70958ef81"><div class="ttname"><a href="group__COMPILER.html#gad10e2a9bf230cc6fdd98a6c70958ef81">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)        </div><div class="ttdoc">Hints that x is highly likely true. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00103">compiler.hpp:103</a></div></div>
<div class="ttc" id="namespacefoedus_1_1log_html_gafeea30298c4f7a9586bddec3663fc4f3a0cae9d20d4db5d08b6adbc1b8b318ef9"><div class="ttname"><a href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3a0cae9d20d4db5d08b6adbc1b8b318ef9">foedus::log::kLogCodeMasstreeOverwrite</a></div><div class="ttdoc">0x0032 : foedus::storage::masstree::MasstreeOverwriteLogType . </div><div class="ttdef"><b>Definition:</b> <a href="log__type_8hpp_source.html#l00126">log_type.hpp:126</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_a12d87bc8cb8a03bde15e79270d37c871"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#a12d87bc8cb8a03bde15e79270d37c871">foedus::snapshot::MergeSort::get_current_count</a></div><div class="ttdeci">MergedPosition get_current_count() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00369">merge_sort.hpp:369</a></div></div>
<div class="ttc" id="namespacefoedus_1_1log_html_gafeea30298c4f7a9586bddec3663fc4f3abb140a328897a4bf18aea0170adbb235"><div class="ttname"><a href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3abb140a328897a4bf18aea0170adbb235">foedus::log::kLogCodeMasstreeDelete</a></div><div class="ttdoc">0x0034 : foedus::storage::masstree::MasstreeDeleteLogType . </div><div class="ttdef"><b>Definition:</b> <a href="log__type_8hpp_source.html#l00128">log_type.hpp:128</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="namespacefoedus_1_1log_html_gafeea30298c4f7a9586bddec3663fc4f3ac2062f25de0409e94e8a9c2486ae89cd"><div class="ttname"><a href="namespacefoedus_1_1log.html#gafeea30298c4f7a9586bddec3663fc4f3ac2062f25de0409e94e8a9c2486ae89cd">foedus::log::kLogCodeMasstreeUpdate</a></div><div class="ttdoc">0x0035 : foedus::storage::masstree::MasstreeUpdateLogType . </div><div class="ttdef"><b>Definition:</b> <a href="log__type_8hpp_source.html#l00129">log_type.hpp:129</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MergeSort_html_ad9dbb6f5e13662a996e70c79bfb1b7fd"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MergeSort.html#ad9dbb6f5e13662a996e70c79bfb1b7fd">foedus::snapshot::MergeSort::groupify</a></div><div class="ttdeci">GroupifyResult groupify(uint32_t begin, uint32_t limit=0) const __attribute__((always_inline))</div><div class="ttdoc">Find a group of consecutive logs from the given position that have either a common log type or a comm...</div><div class="ttdef"><b>Definition:</b> <a href="merge__sort_8hpp_source.html#l00534">merge_sort.hpp:534</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a1d9ff2d2af85b6d09ecb6e310bae6888_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a1d9ff2d2af85b6d09ecb6e310bae6888_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a1d9ff2d2af85b6d09ecb6e310bae6888_cgraph" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext_a1d9ff2d2af85b6d09ecb6e310bae6888_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1MergeSort.html#a12d87bc8cb8a03bde15e79270d37c871" title="foedus::snapshot::MergeSort\l::get_current_count" alt="" coords="241,5,431,47"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeCommonLogType.html#aee0dcbac82c0486cd1d527f408b65c37" title="foedus::storage::masstree\l::MasstreeCommonLogType\l::get_key" alt="" coords="244,71,428,127"/>
<area shape="rect" id="node4" href="structfoedus_1_1snapshot_1_1MergeSort_1_1GroupifyResult.html#a9fc2bb11b9447260a7ed9aad44436286" title="foedus::snapshot::MergeSort\l::GroupifyResult::get_log_type" alt="" coords="237,152,435,193"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1MergeSort.html#ad9dbb6f5e13662a996e70c79bfb1b7fd" title="Find a group of consecutive logs from the given position that have either a common log type or a comm..." alt="" coords="241,335,431,376"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1MergeSort.html#a96cbfd2df2dcd759db60e3c17285d3a9" title="foedus::snapshot::MergeSort\l::is_ended_all" alt="" coords="483,204,672,245"/>
<area shape="rect" id="node8" href="classfoedus_1_1snapshot_1_1MergeSort.html#ab989687173572526626ef863e2e9f449" title="Executes merge&#45;sort on several thousands of logs and provides the result as a batch. " alt="" coords="241,269,431,311"/>
<area shape="rect" id="node11" href="classfoedus_1_1snapshot_1_1MergeSort.html#aa4d791bfc9f892322123a334757b53f1" title="foedus::snapshot::MergeSort\l::resolve_sort_position" alt="" coords="241,400,431,441"/>
<area shape="rect" id="node6" href="structfoedus_1_1snapshot_1_1MergeSort_1_1SortEntry.html#a06c43522d72ce417cee4f65a39bbd06a" title="foedus::snapshot::MergeSort\l::SortEntry::get_position" alt="" coords="483,400,672,441"/>
<area shape="rect" id="node9" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="491,335,663,376"/>
<area shape="rect" id="node10" href="classfoedus_1_1snapshot_1_1MergeSort.html#a87778e11ef6dbb58f65c8669d06f75c9" title="foedus::snapshot::MergeSort\l::is_no_merging" alt="" coords="483,269,672,311"/>
<area shape="rect" id="node12" href="classfoedus_1_1snapshot_1_1MergeSort.html#ac5b40173dd8850ab1b926744a2081d9b" title="foedus::snapshot::MergeSort\l::resolve_merged_position" alt="" coords="483,465,672,507"/>
<area shape="rect" id="node13" href="structfoedus_1_1snapshot_1_1MergeSort_1_1InputStatus.html#a8acd43e9fab8cc63c74cbf8e52cc6f43" title="foedus::snapshot::MergeSort\l::InputStatus::from_compact_pos" alt="" coords="720,465,935,507"/>
<area shape="rect" id="node14" href="structfoedus_1_1snapshot_1_1MergeSort_1_1InputStatus.html#a9003eeeddcb3213f0cc42116345feb8d" title="foedus::snapshot::MergeSort\l::InputStatus::assert_consistent" alt="" coords="983,465,1189,507"/>
</map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/storage/masstree/<a class="el" href="masstree__composer__impl_8hpp_source.html">masstree_composer_impl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/storage/masstree/<a class="el" href="masstree__composer__impl_8cpp_source.html">masstree_composer_impl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage.html">storage</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage_1_1masstree.html">masstree</a></li><li class="navelem"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposeContext.html">MasstreeComposeContext</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
