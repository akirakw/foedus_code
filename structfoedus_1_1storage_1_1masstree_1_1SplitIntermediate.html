<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::storage::masstree::SplitIntermediate Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::storage::masstree::SplitIntermediate Struct Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__STORAGE.html">Storage Manager</a> &raquo; <a class="el" href="group__MASSTREE.html">Masstree Storage</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A system transaction to split an intermediate page in Master-Tree.  
 <a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A system transaction to split an intermediate page in Master-Tree. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__SYSXCT.html">Physical-only, short-living system transactions.</a></dd></dl>
<p>Same as border page split.</p>
<p>This does nothing and returns kErrorCodeOk in the following cases: </p><ul>
<li>The page turns out to be already split. </li>
<li>piggyback_adopt_child_ turns out to be already retired (meaning already adopted)</li>
</ul>
<p>Locks taken in this sysxct (in order of taking): </p><ul>
<li>Page-lock of the target page, and piggyback_adopt_child_ if piggyback_adopt_child_ is non-null. We lock target/piggyback_adopt_child_ in canonical order.</li>
</ul>
<p>Obviously no chance of deadlocks or even any conditional locks after releasing enclosing user transaction's locks. max_retries=2 should be enough in run_nested_sysxct(). </p>

<p>Definition at line <a class="el" href="masstree__split__impl_8hpp_source.html#l00158">158</a> of file <a class="el" href="masstree__split__impl_8hpp_source.html">masstree_split_impl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="masstree__split__impl_8hpp_source.html">masstree_split_impl.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for foedus::storage::masstree::SplitIntermediate:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate__inherit__graph.png" border="0" usemap="#foedus_1_1storage_1_1masstree_1_1SplitIntermediate_inherit__map" alt="Inheritance graph"/></div>
<map name="foedus_1_1storage_1_1masstree_1_1SplitIntermediate_inherit__map" id="foedus_1_1storage_1_1masstree_1_1SplitIntermediate_inherit__map">
<area shape="rect" id="node2" href="structfoedus_1_1xct_1_1SysxctFunctor.html" title="A functor representing the logic in a system transaction via virtual&#45;function. " alt="" coords="5,5,184,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for foedus::storage::masstree::SplitIntermediate:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate__coll__graph.png" border="0" usemap="#foedus_1_1storage_1_1masstree_1_1SplitIntermediate_coll__map" alt="Collaboration graph"/></div>
<map name="foedus_1_1storage_1_1masstree_1_1SplitIntermediate_coll__map" id="foedus_1_1storage_1_1masstree_1_1SplitIntermediate_coll__map">
<area shape="rect" id="node2" href="structfoedus_1_1xct_1_1SysxctFunctor.html" title="A functor representing the logic in a system transaction via virtual&#45;function. " alt="" coords="1443,5,1622,32"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html" title="Common base of MasstreeIntermediatePage and MasstreeBorderPage. " alt="" coords="1217,67,1391,109"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html" title="Represents one intermediate page in Masstree Storage. " alt="" coords="1440,119,1625,161"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1PageHeader.html" title="Just a marker to denote that a memory region represents a data page. " alt="" coords="905,39,1096,65"/>
<area shape="rect" id="node5" href="structfoedus_1_1assorted_1_1ProbCounter.html" title="Implements a probabilistic counter [Morris 1978]. " alt="" coords="572,16,771,43"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1PageVersion.html" title="Just a synonym of XctId to be used as a page lock mechanism. " alt="" coords="575,67,767,93"/>
<area shape="rect" id="node7" href="structfoedus_1_1storage_1_1PageVersionStatus.html" title="foedus::storage::PageVersion\lStatus" alt="" coords="284,37,476,78"/>
<area shape="rect" id="node8" href="structfoedus_1_1xct_1_1McsWwLock.html" title="An exclusive&#45;only (WW) MCS lock data structure. " alt="" coords="295,103,465,129"/>
<area shape="rect" id="node9" href="structfoedus_1_1xct_1_1McsWwBlockData.html" title="Exclusive&#45;only (WW) MCS lock classes. " alt="" coords="5,103,207,129"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1VolatilePagePointer.html" title="Represents a pointer to a volatile page with modification count for preventing ABA. " alt="" coords="920,90,1081,131"/>
<area shape="rect" id="node11" href="classfoedus_1_1thread_1_1Thread.html" title="Represents one thread running on one NUMA core. " alt="" coords="1457,185,1608,212"/>
<area shape="rect" id="node12" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="1238,185,1370,212"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__MASSTREE.html#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy">SplitStrategy</a></td></tr>
<tr class="memdesc:structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructed by hierarchically reading all separators and pointers in old page.  <a href="group__MASSTREE.html#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy">More...</a><br /></td></tr>
<tr class="separator:structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acc02ab84a08c7721f54c0242b115160e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#acc02ab84a08c7721f54c0242b115160e">SplitIntermediate</a> (<a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *context, <a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html">MasstreeIntermediatePage</a> *target, <a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html">MasstreePage</a> *piggyback_adopt_child=nullptr)</td></tr>
<tr class="separator:acc02ab84a08c7721f54c0242b115160e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa656a627e949f49b8903908d2ea1204f"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f">run</a> (<a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *sysxct_workspace) override</td></tr>
<tr class="memdesc:aa656a627e949f49b8903908d2ea1204f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interior node's Split.  <a href="#aa656a627e949f49b8903908d2ea1204f">More...</a><br /></td></tr>
<tr class="separator:aa656a627e949f49b8903908d2ea1204f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96de88f03cf5683529e00d2c209a07e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9">split_impl_no_error</a> (<a class="el" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html">thread::GrabFreeVolatilePagesScope</a> *free_pages)</td></tr>
<tr class="memdesc:a96de88f03cf5683529e00d2c209a07e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The core implementation after locking relevant pages and acquiring free page resource.  <a href="#a96de88f03cf5683529e00d2c209a07e9">More...</a><br /></td></tr>
<tr class="separator:a96de88f03cf5683529e00d2c209a07e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca3a58f3f123782aa1b769447d93fb44"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aca3a58f3f123782aa1b769447d93fb44">decide_strategy</a> (<a class="el" href="group__MASSTREE.html#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy">SplitStrategy</a> *out) const </td></tr>
<tr class="memdesc:aca3a58f3f123782aa1b769447d93fb44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine to decide how we will split this page.  <a href="#aca3a58f3f123782aa1b769447d93fb44">More...</a><br /></td></tr>
<tr class="separator:aca3a58f3f123782aa1b769447d93fb44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac45b3f7f6e3c14faa8a9662396d44e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aac45b3f7f6e3c14faa8a9662396d44e1">migrate_pointers</a> (const <a class="el" href="group__MASSTREE.html#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy">SplitStrategy</a> &amp;strategy, uint16_t from, uint16_t to, <a class="el" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a> expected_last_separator, <a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html">MasstreeIntermediatePage</a> *dest) const </td></tr>
<tr class="memdesc:aac45b3f7f6e3c14faa8a9662396d44e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine to construct a new page.  <a href="#aac45b3f7f6e3c14faa8a9662396d44e1">More...</a><br /></td></tr>
<tr class="separator:aac45b3f7f6e3c14faa8a9662396d44e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ad699def54b053fca6b3d847ae99e542a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a></td></tr>
<tr class="memdesc:ad699def54b053fca6b3d847ae99e542a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread context.  <a href="#ad699def54b053fca6b3d847ae99e542a">More...</a><br /></td></tr>
<tr class="separator:ad699def54b053fca6b3d847ae99e542a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55d67791a9a41f250cfaf77d599bd6a2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html">MasstreeIntermediatePage</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a></td></tr>
<tr class="memdesc:a55d67791a9a41f250cfaf77d599bd6a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">The page to split.  <a href="#a55d67791a9a41f250cfaf77d599bd6a2">More...</a><br /></td></tr>
<tr class="separator:a55d67791a9a41f250cfaf77d599bd6a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b972147ca931de586353fda0c6992cd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html">MasstreePage</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a></td></tr>
<tr class="memdesc:a1b972147ca931de586353fda0c6992cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">An optimization for the common case: splitting the parent page to adopt foster twins of a child page.  <a href="#a1b972147ca931de586353fda0c6992cd">More...</a><br /></td></tr>
<tr class="separator:a1b972147ca931de586353fda0c6992cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="acc02ab84a08c7721f54c0242b115160e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::storage::masstree::SplitIntermediate::SplitIntermediate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html">MasstreeIntermediatePage</a> *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html">MasstreePage</a> *&#160;</td>
          <td class="paramname"><em>piggyback_adopt_child</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="masstree__split__impl_8hpp_source.html#l00179">179</a> of file <a class="el" href="masstree__split__impl_8hpp_source.html">masstree_split_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    : xct::SysxctFunctor(),</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a>(context),</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>(target),</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>(piggyback_adopt_child) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a55d67791a9a41f250cfaf77d599bd6a2"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">foedus::storage::masstree::SplitIntermediate::target_</a></div><div class="ttdeci">MasstreeIntermediatePage *const target_</div><div class="ttdoc">The page to split. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00165">masstree_split_impl.hpp:165</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a1b972147ca931de586353fda0c6992cd"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">foedus::storage::masstree::SplitIntermediate::piggyback_adopt_child_</a></div><div class="ttdeci">MasstreePage *const piggyback_adopt_child_</div><div class="ttdoc">An optimization for the common case: splitting the parent page to adopt foster twins of a child page...</div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00177">masstree_split_impl.hpp:177</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_ad699def54b053fca6b3d847ae99e542a"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">foedus::storage::masstree::SplitIntermediate::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00160">masstree_split_impl.hpp:160</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aca3a58f3f123782aa1b769447d93fb44"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::storage::masstree::SplitIntermediate::decide_strategy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__MASSTREE.html#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy">SplitIntermediate::SplitStrategy</a> *&#160;</td>
          <td class="paramname"><em>out</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine to decide how we will split this page. </p>

<p>Definition at line <a class="el" href="masstree__split__impl_8cpp_source.html#l00552">552</a> of file <a class="el" href="masstree__split__impl_8cpp_source.html">masstree_split_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00226">foedus::storage::masstree::SplitIntermediate::SplitStrategy::compact_adopt_</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00109">foedus::storage::masstree::MasstreePage::get_foster_fence()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00113">foedus::storage::masstree::MasstreePage::get_foster_major()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00112">foedus::storage::masstree::MasstreePage::get_foster_minor()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00099">foedus::storage::masstree::MasstreePage::get_high_fence()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00098">foedus::storage::masstree::MasstreePage::get_low_fence()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00073">foedus::storage::masstree::MasstreePage::header()</a>, <a class="el" href="storage__id_8hpp_source.html#l00215">foedus::storage::VolatilePagePointer::is_equivalent()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00168">foedus::storage::masstree::MasstreePage::is_locked()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00169">foedus::storage::masstree::MasstreePage::is_moved()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l01067">foedus::storage::masstree::MasstreeIntermediatePointerIterator::is_valid()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00251">foedus::storage::masstree::kMaxIntermediatePointers</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00219">foedus::storage::masstree::SplitIntermediate::SplitStrategy::mid_index_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00217">foedus::storage::masstree::SplitIntermediate::SplitStrategy::mid_separator_</a>, <a class="el" href="page_8hpp_source.html#l00191">foedus::storage::PageHeader::page_id_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00177">piggyback_adopt_child_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00216">foedus::storage::masstree::SplitIntermediate::SplitStrategy::pointers_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00215">foedus::storage::masstree::SplitIntermediate::SplitStrategy::separators_</a>, <a class="el" href="storage__id_8hpp_source.html#l00307">foedus::storage::DualPagePointer::snapshot_pointer_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00165">target_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00218">foedus::storage::masstree::SplitIntermediate::SplitStrategy::total_separator_count_</a>, and <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>.</p>

<p>Referenced by <a class="el" href="masstree__split__impl_8cpp_source.html#l00476">split_impl_no_error()</a>.</p>
<div class="fragment"><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                                                                 {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a16a2c06a304514be7b99fb6c884e7e9b">is_locked</a>());</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  out-&gt;compact_adopt_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  out-&gt;total_separator_count_ = 0;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="comment">// While collecting pointers from the old page, we look for the piggyback_adopt_child_</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="comment">// and replace it with new pointers (so, this increases the total # of separators).</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a> old_separator = 0;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a> new_separator = 0;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  VolatilePagePointer old_pointer;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35">is_moved</a>());</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    old_separator = <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a30f922c414bf3a2faaf7e879b2277f0b">get_low_fence</a>();</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    new_separator = <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a44cc8d18dc9077ae2310667e88ed5b7c">get_foster_fence</a>();</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    old_pointer = VolatilePagePointer(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a59128590fdc568e894a8973a319a0154">page_id_</a>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordtype">bool</span> found_old = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">for</span> (MasstreeIntermediatePointerIterator iter(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>); iter.is_valid(); iter.next()) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keyword">const</span> <a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a> low = iter.get_low_key();</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keyword">const</span> <a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a> high = iter.get_high_key();</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keyword">const</span> DualPagePointer&amp; pointer = iter.get_pointer();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a> &amp;&amp; low == old_separator) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="comment">// Found the existing pointer to replace with foster-minor</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(pointer.volatile_pointer_.is_equivalent(old_pointer));</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(high == <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abb6557473edd899373ed9399b455be20">get_high_fence</a>());</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      out-&gt;separators_[out-&gt;total_separator_count_] = new_separator;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      out-&gt;pointers_[out-&gt;total_separator_count_].volatile_pointer_</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        = <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a32653a16ddca213c94560652e9388dd5">get_foster_minor</a>();</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      out-&gt;pointers_[out-&gt;total_separator_count_].snapshot_pointer_ = 0;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      ++(out-&gt;total_separator_count_);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="comment">// Also add foster-major as a new entry</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      out-&gt;separators_[out-&gt;total_separator_count_] = high;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      out-&gt;pointers_[out-&gt;total_separator_count_].volatile_pointer_</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        = <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a27d301fad7d4d340cd2d6255dc330607">get_foster_major</a>();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      out-&gt;pointers_[out-&gt;total_separator_count_].snapshot_pointer_ = 0;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      ++(out-&gt;total_separator_count_);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      found_old = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      out-&gt;separators_[out-&gt;total_separator_count_] = high;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      out-&gt;pointers_[out-&gt;total_separator_count_] = pointer;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      ++(out-&gt;total_separator_count_);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a> == <span class="keyword">nullptr</span> || low &lt; old_separator || found_old);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a> == <span class="keyword">nullptr</span> || found_old);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(out-&gt;total_separator_count_ &gt;= 2U);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(out-&gt;total_separator_count_ &lt;= <a class="code" href="group__MASSTREE.html#ga6b0f46dbd051897bd6dae9bbd3eb446e">kMaxIntermediatePointers</a> + 1U);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordflow">if</span> (out-&gt;total_separator_count_ &lt;= <a class="code" href="group__MASSTREE.html#ga6b0f46dbd051897bd6dae9bbd3eb446e">kMaxIntermediatePointers</a>) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">// Then, compact_adopt:</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// we create a dummy foster with empty</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">// range on right side, and just re-structures target page onto left foster twin.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">// In other words, this is compaction/restructure that is done in another page in RCU fashion.</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    out-&gt;compact_adopt_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    out-&gt;mid_index_ = out-&gt;total_separator_count_ - 1U;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    out-&gt;mid_separator_ = <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abb6557473edd899373ed9399b455be20">get_high_fence</a>();</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    &amp;&amp; <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a27d301fad7d4d340cd2d6255dc330607">get_foster_major</a>()</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        == out-&gt;pointers_[out-&gt;total_separator_count_ - 1].volatile_pointer_) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    DVLOG(0) &lt;&lt; <span class="stringliteral">&quot;Seems like a sequential insert. let&#39;s do no-record split&quot;</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    out-&gt;mid_index_ = out-&gt;total_separator_count_ - 2U;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    out-&gt;mid_separator_ = out-&gt;separators_[out-&gt;mid_index_];</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">// Usual: otherwise, we split them into 50-50 distribution.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    out-&gt;mid_index_ = (out-&gt;total_separator_count_ - 1U) / 2;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    out-&gt;mid_separator_ = out-&gt;separators_[out-&gt;mid_index_];</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a55d67791a9a41f250cfaf77d599bd6a2"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">foedus::storage::masstree::SplitIntermediate::target_</a></div><div class="ttdeci">MasstreeIntermediatePage *const target_</div><div class="ttdoc">The page to split. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00165">masstree_split_impl.hpp:165</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a16a2c06a304514be7b99fb6c884e7e9b"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a16a2c06a304514be7b99fb6c884e7e9b">foedus::storage::masstree::MasstreePage::is_locked</a></div><div class="ttdeci">bool is_locked() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00168">masstree_page_impl.hpp:168</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_adc22d21883e15b87cd5ff6b6ec513c35"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35">foedus::storage::masstree::MasstreePage::is_moved</a></div><div class="ttdeci">bool is_moved() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00169">masstree_page_impl.hpp:169</a></div></div>
<div class="ttc" id="group__MASSTREE_html_ga556e8f0d5e02e78f3ddecd8f5b022bf6"><div class="ttname"><a href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">foedus::storage::masstree::KeySlice</a></div><div class="ttdeci">uint64_t KeySlice</div><div class="ttdoc">Each key slice is an 8-byte integer. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__id_8hpp_source.html#l00126">masstree_id.hpp:126</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a32653a16ddca213c94560652e9388dd5"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a32653a16ddca213c94560652e9388dd5">foedus::storage::masstree::MasstreePage::get_foster_minor</a></div><div class="ttdeci">VolatilePagePointer get_foster_minor() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00112">masstree_page_impl.hpp:112</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a27d301fad7d4d340cd2d6255dc330607"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a27d301fad7d4d340cd2d6255dc330607">foedus::storage::masstree::MasstreePage::get_foster_major</a></div><div class="ttdeci">VolatilePagePointer get_foster_major() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00113">masstree_page_impl.hpp:113</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a1b972147ca931de586353fda0c6992cd"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">foedus::storage::masstree::SplitIntermediate::piggyback_adopt_child_</a></div><div class="ttdeci">MasstreePage *const piggyback_adopt_child_</div><div class="ttdoc">An optimization for the common case: splitting the parent page to adopt foster twins of a child page...</div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00177">masstree_split_impl.hpp:177</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_abb6557473edd899373ed9399b455be20"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abb6557473edd899373ed9399b455be20">foedus::storage::masstree::MasstreePage::get_high_fence</a></div><div class="ttdeci">KeySlice get_high_fence() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00099">masstree_page_impl.hpp:99</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a30f922c414bf3a2faaf7e879b2277f0b"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a30f922c414bf3a2faaf7e879b2277f0b">foedus::storage::masstree::MasstreePage::get_low_fence</a></div><div class="ttdeci">KeySlice get_low_fence() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00098">masstree_page_impl.hpp:98</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a44cc8d18dc9077ae2310667e88ed5b7c"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a44cc8d18dc9077ae2310667e88ed5b7c">foedus::storage::masstree::MasstreePage::get_foster_fence</a></div><div class="ttdeci">KeySlice get_foster_fence() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00109">masstree_page_impl.hpp:109</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_ab5ab7bbce35893143d2aac437e526d0e"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e">foedus::storage::masstree::MasstreePage::header</a></div><div class="ttdeci">PageHeader &amp; header()</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00073">masstree_page_impl.hpp:73</a></div></div>
<div class="ttc" id="group__MASSTREE_html_ga6b0f46dbd051897bd6dae9bbd3eb446e"><div class="ttname"><a href="group__MASSTREE.html#ga6b0f46dbd051897bd6dae9bbd3eb446e">foedus::storage::masstree::kMaxIntermediatePointers</a></div><div class="ttdeci">const uint32_t kMaxIntermediatePointers</div><div class="ttdoc">Max number of pointers (if completely filled) stored in an intermediate pages. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00251">masstree_page_impl.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_a59128590fdc568e894a8973a319a0154"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#a59128590fdc568e894a8973a319a0154">foedus::storage::PageHeader::page_id_</a></div><div class="ttdeci">uint64_t page_id_</div><div class="ttdoc">Page ID of this page. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00191">page.hpp:191</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_cgraph" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a44cc8d18dc9077ae2310667e88ed5b7c" title="foedus::storage::masstree\l::MasstreePage::get_foster_fence" alt="" coords="236,5,453,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a27d301fad7d4d340cd2d6255dc330607" title="foedus::storage::masstree\l::MasstreePage::get_foster_major" alt="" coords="235,71,454,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a32653a16ddca213c94560652e9388dd5" title="foedus::storage::masstree\l::MasstreePage::get_foster_minor" alt="" coords="235,136,454,177"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abb6557473edd899373ed9399b455be20" title="foedus::storage::masstree\l::MasstreePage::get_high_fence" alt="" coords="240,201,449,243"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a30f922c414bf3a2faaf7e879b2277f0b" title="foedus::storage::masstree\l::MasstreePage::get_low_fence" alt="" coords="243,267,447,308"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e" title="foedus::storage::masstree\l::MasstreePage::header" alt="" coords="258,332,431,373"/>
<area shape="rect" id="node8" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a56b5ea2f52ce2767ac205f624ce156e6" title="foedus::storage::Volatile\lPagePointer::is_equivalent" alt="" coords="257,397,432,439"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a16a2c06a304514be7b99fb6c884e7e9b" title="foedus::storage::masstree\l::MasstreePage::is_locked" alt="" coords="256,463,433,504"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35" title="foedus::storage::masstree\l::MasstreePage::is_moved" alt="" coords="257,528,433,569"/>
<area shape="rect" id="node16" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePointerIterator.html#acd0b166a127ed5fbadecd838f8e32be5" title="foedus::storage::masstree\l::MasstreeIntermediatePointerIterator\l::is_valid" alt="" coords="227,594,463,650"/>
<area shape="rect" id="node10" href="structfoedus_1_1storage_1_1PageVersion.html#a301cba19b01cf82d7b576a04180b56e2" title="foedus::storage::PageVersion\l::is_locked" alt="" coords="518,463,710,504"/>
<area shape="rect" id="node11" href="structfoedus_1_1xct_1_1McsWwLock.html#abe15a0d250a2186ac534fc5d2d0b7f8e" title="This is a &quot;relaxed&quot; check. " alt="" coords="777,463,946,504"/>
<area shape="rect" id="node12" href="structfoedus_1_1xct_1_1McsWwBlockData.html#aa6a3e9b495bb234bf4c840a0e43d082e" title="foedus::xct::McsWwBlockData\l::is_valid_relaxed" alt="" coords="1005,463,1207,504"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1PageVersion.html#a2b63daa9a7f39c8c85bf2d43f4c18d78" title="foedus::storage::PageVersion\l::is_moved" alt="" coords="518,528,710,569"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac3214863fa74628187ce46b2879994ae" title="foedus::storage::PageVersion\lStatus::is_moved" alt="" coords="765,528,957,569"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec" title="physical key count (those keys might be deleted) in this page. " alt="" coords="511,597,717,639"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a1cb83de15afc0a903046937276b0ed31" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::get_minipage" alt="" coords="521,663,707,719"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_icgraph" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aca3a58f3f123782aa1b769447d93fb44_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="227,5,400,61"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="448,13,621,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aac45b3f7f6e3c14faa8a9662396d44e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::storage::masstree::SplitIntermediate::migrate_pointers </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__MASSTREE.html#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_1_1SplitStrategy">SplitStrategy</a> &amp;&#160;</td>
          <td class="paramname"><em>strategy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a>&#160;</td>
          <td class="paramname"><em>expected_last_separator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html">MasstreeIntermediatePage</a> *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine to construct a new page. </p>

<p>Definition at line <a class="el" href="masstree__split__impl_8cpp_source.html#l00624">624</a> of file <a class="el" href="masstree__split__impl_8cpp_source.html">masstree_split_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00148">foedus::storage::masstree::MasstreePage::get_key_count()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00322">foedus::storage::masstree::MasstreeIntermediatePage::get_minipage()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00194">foedus::storage::masstree::MasstreePage::header_</a>, <a class="el" href="storage__id_8hpp_source.html#l00303">foedus::storage::DualPagePointer::is_both_null()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00244">foedus::storage::masstree::kMaxIntermediateMiniSeparators</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00237">foedus::storage::masstree::kMaxIntermediateSeparators</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00216">foedus::storage::masstree::SplitIntermediate::SplitStrategy::pointers_</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00278">foedus::storage::masstree::MasstreeIntermediatePage::MiniPage::pointers_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00215">foedus::storage::masstree::SplitIntermediate::SplitStrategy::separators_</a>, <a class="el" href="page_8hpp_source.html#l00319">foedus::storage::PageHeader::set_key_count()</a>, and <a class="el" href="masstree__page__impl_8cpp_source.html#l00475">foedus::storage::masstree::MasstreeIntermediatePage::verify_separators()</a>.</p>

<p>Referenced by <a class="el" href="masstree__split__impl_8cpp_source.html#l00476">split_impl_no_error()</a>.</p>
<div class="fragment"><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                        {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// construct dest page. copy the separators and pointers.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// we distribute them as much as possible in first level. if mini pages have little</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// entries to start with, following adoption would be only local.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordtype">float</span> entries_per_mini = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(to - from) / (<a class="code" href="group__MASSTREE.html#ga2ce564bb661a338ce070653e1ca48efa">kMaxIntermediateSeparators</a> + 1);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(to &gt; from);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keyword">const</span> uint16_t move_count = to - from;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">// it looks a bit complicated because each separator is &quot;one-off&quot; due to first-level separator.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// so we buffer one separator.</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordtype">float</span> next_mini_threshold = entries_per_mini;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  uint8_t cur_mini = 0;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  uint8_t cur_mini_separators = 0;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keyword">auto</span>* cur_mini_page = &amp;dest-&gt;get_minipage(0);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  cur_mini_page-&gt;pointers_[0] = strategy.pointers_[from];</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!strategy.pointers_[from].is_both_null());</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a> next_separator = strategy.separators_[from];</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">for</span> (uint16_t i = 1; i &lt; move_count; ++i) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    uint16_t original_index = i + from;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!strategy.pointers_[original_index].is_both_null());</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">if</span> (i &gt;= next_mini_threshold &amp;&amp; cur_mini &lt; <a class="code" href="group__MASSTREE.html#ga2ce564bb661a338ce070653e1ca48efa">kMaxIntermediateSeparators</a>) {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="comment">// switch to next mini page. so, the separator goes to the first level</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();  <span class="comment">// set key count after all</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      cur_mini_page-&gt;key_count_ = cur_mini_separators;  <span class="comment">// close the current</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_mini_page-&gt;key_count_ &lt;= <a class="code" href="group__MASSTREE.html#gaaa62799e432e5c5b145851eed621d33d">kMaxIntermediateMiniSeparators</a>);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      dest-&gt;separators_[cur_mini] = next_separator;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      next_mini_threshold += entries_per_mini;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      cur_mini_separators = 0;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      ++cur_mini;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      cur_mini_page = &amp;dest-&gt;get_minipage(cur_mini);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      cur_mini_page-&gt;pointers_[0] = strategy.pointers_[original_index];</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="comment">// still the same mini page. so, the separator goes to the second level</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      cur_mini_page-&gt;separators_[cur_mini_separators] = next_separator;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      ++cur_mini_separators;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_mini_separators &lt;= <a class="code" href="group__MASSTREE.html#gaaa62799e432e5c5b145851eed621d33d">kMaxIntermediateMiniSeparators</a>);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      cur_mini_page-&gt;pointers_[cur_mini_separators] = strategy.pointers_[original_index];</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    next_separator = strategy.separators_[original_index];</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  cur_mini_page-&gt;key_count_ = cur_mini_separators;  <span class="comment">// close the last one</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_mini_page-&gt;key_count_ &lt;= <a class="code" href="group__MASSTREE.html#gaaa62799e432e5c5b145851eed621d33d">kMaxIntermediateMiniSeparators</a>);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  dest-&gt;header_.set_key_count(cur_mini);  <span class="comment">// set key count after all</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(dest-&gt;get_key_count() &lt;= <a class="code" href="group__MASSTREE.html#ga2ce564bb661a338ce070653e1ca48efa">kMaxIntermediateSeparators</a>);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// the last separator is ignored because it&#39;s foster-fence/high-fence.</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(next_separator == expected_last_separator);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  dest-&gt;verify_separators();</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;}</div>
<div class="ttc" id="group__MASSTREE_html_ga556e8f0d5e02e78f3ddecd8f5b022bf6"><div class="ttname"><a href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">foedus::storage::masstree::KeySlice</a></div><div class="ttdeci">uint64_t KeySlice</div><div class="ttdoc">Each key slice is an 8-byte integer. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__id_8hpp_source.html#l00126">masstree_id.hpp:126</a></div></div>
<div class="ttc" id="group__MASSTREE_html_gaaa62799e432e5c5b145851eed621d33d"><div class="ttname"><a href="group__MASSTREE.html#gaaa62799e432e5c5b145851eed621d33d">foedus::storage::masstree::kMaxIntermediateMiniSeparators</a></div><div class="ttdeci">const uint16_t kMaxIntermediateMiniSeparators</div><div class="ttdoc">Max number of separators stored in the second level of intermediate pages. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00244">masstree_page_impl.hpp:244</a></div></div>
<div class="ttc" id="group__MASSTREE_html_ga2ce564bb661a338ce070653e1ca48efa"><div class="ttname"><a href="group__MASSTREE.html#ga2ce564bb661a338ce070653e1ca48efa">foedus::storage::masstree::kMaxIntermediateSeparators</a></div><div class="ttdeci">const uint16_t kMaxIntermediateSeparators</div><div class="ttdoc">Max number of separators stored in the first level of intermediate pages. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00237">masstree_page_impl.hpp:237</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_cgraph" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec" title="physical key count (those keys might be deleted) in this page. " alt="" coords="475,5,681,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a1cb83de15afc0a903046937276b0ed31" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::get_minipage" alt="" coords="485,71,671,127"/>
<area shape="rect" id="node4" href="structfoedus_1_1storage_1_1DualPagePointer.html#aedde91e76a6e345f6d19539942f13a43" title="foedus::storage::DualPage\lPointer::is_both_null" alt="" coords="491,283,665,324"/>
<area shape="rect" id="node7" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="241,273,414,315"/>
<area shape="rect" id="node8" href="structfoedus_1_1storage_1_1PageHeader.html#a407bbd604662534963c7fc8f08acc898" title="foedus::storage::PageHeader\l::set_key_count" alt="" coords="232,339,423,380"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a7216fe075ea3db89bbba06f5a156ce81" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::verify_separators" alt="" coords="235,142,420,198"/>
<area shape="rect" id="node5" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="749,283,910,324"/>
<area shape="rect" id="node6" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="989,283,1150,324"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a14cdcef87b3c0a6ef431df9d06a1a663" title="An empty&#45;range page, either intermediate or border, never has any entries. " alt="" coords="471,217,685,259"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35" title="foedus::storage::masstree\l::MasstreePage::is_moved" alt="" coords="490,152,666,193"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1PageVersion.html#a2b63daa9a7f39c8c85bf2d43f4c18d78" title="foedus::storage::PageVersion\l::is_moved" alt="" coords="733,152,925,193"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac3214863fa74628187ce46b2879994ae" title="foedus::storage::PageVersion\lStatus::is_moved" alt="" coords="973,152,1165,193"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_icgraph" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aac45b3f7f6e3c14faa8a9662396d44e1_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="232,5,405,61"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="453,13,627,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa656a627e949f49b8903908d2ea1204f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::storage::masstree::SplitIntermediate::run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1xct_1_1SysxctWorkspace.html">xct::SysxctWorkspace</a> *&#160;</td>
          <td class="paramname"><em>sysxct_workspace</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Interior node's Split. </p>

<p>Implements <a class="el" href="structfoedus_1_1xct_1_1SysxctFunctor.html#a383a9cfd5d8fa5caf45c7ffb6dc05535">foedus::xct::SysxctFunctor</a>.</p>

<p>Definition at line <a class="el" href="masstree__split__impl_8cpp_source.html#l00443">443</a> of file <a class="el" href="masstree__split__impl_8cpp_source.html">masstree_split_impl.cpp</a>.</p>

<p>References <a class="el" href="error__code_8hpp_source.html#l00155">CHECK_ERROR_CODE</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00160">context_</a>, <a class="el" href="thread_8cpp_source.html#l00147">foedus::thread::GrabFreeVolatilePagesScope::grab()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00139">foedus::storage::masstree::MasstreePage::has_foster_child()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00170">foedus::storage::masstree::MasstreePage::is_retired()</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00177">piggyback_adopt_child_</a>, <a class="el" href="masstree__split__impl_8cpp_source.html#l00476">split_impl_no_error()</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00971">foedus::thread::Thread::sysxct_batch_page_locks()</a>, <a class="el" href="thread__pimpl_8cpp_source.html#l00968">foedus::thread::Thread::sysxct_page_lock()</a>, and <a class="el" href="masstree__split__impl_8hpp_source.html#l00165">target_</a>.</p>
<div class="fragment"><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                                                     {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  DVLOG(1) &lt;&lt; <span class="stringliteral">&quot;Preparing to split an intermediate page... &quot;</span>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="comment">// First, lock the page(s)</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  Page* target_page = <span class="keyword">reinterpret_cast&lt;</span>Page*<span class="keyword">&gt;</span>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    Page* pages[2];</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    pages[0] = target_page;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    pages[1] = <span class="keyword">reinterpret_cast&lt;</span>Page*<span class="keyword">&gt;</span>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">// lock target_ and piggyback_adopt_child_ in batched mode to avoid deadlock.</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a2573902a53ca92a0cf7e19113d5b5979">sysxct_batch_page_locks</a>(sysxct_workspace, 2, pages));</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255">sysxct_page_lock</a>(sysxct_workspace, target_page));</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="comment">// The lock involves atomic operation, so now all we see are finalized.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abfe53cdc69964e52901556b1e8d9de9e">has_foster_child</a>()) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    DVLOG(0) &lt;&lt; <span class="stringliteral">&quot;Interesting. the page has been already split&quot;</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a> &amp;&amp; <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#aec1302bec7fe39ef71cf9ac0ab6b364a">is_retired</a>()) {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Interesting. this child is now retired, so someone else has already adopted.&quot;</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;  <span class="comment">// fine. the goal is already achieved</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// 3 free volatile pages needed.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">// foster-minor/major (will be placed in successful case), and SplitStrategy (will be discarded)</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a> offsets[2];</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  thread::GrabFreeVolatilePagesScope free_pages_scope(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a>, offsets);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(free_pages_scope.grab(2));</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9">split_impl_no_error</a>(&amp;free_pages_scope);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a55d67791a9a41f250cfaf77d599bd6a2"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">foedus::storage::masstree::SplitIntermediate::target_</a></div><div class="ttdeci">MasstreeIntermediatePage *const target_</div><div class="ttdoc">The page to split. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00165">masstree_split_impl.hpp:165</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a2573902a53ca92a0cf7e19113d5b5979"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a2573902a53ca92a0cf7e19113d5b5979">foedus::thread::Thread::sysxct_batch_page_locks</a></div><div class="ttdeci">ErrorCode sysxct_batch_page_locks(xct::SysxctWorkspace *sysxct_workspace, uint32_t lock_count, storage::Page **pages)</div><div class="ttdoc">Takes a bunch of page locks for a sysxct running under this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread__pimpl_8cpp_source.html#l00971">thread_pimpl.cpp:971</a></div></div>
<div class="ttc" id="group__MEMORY_html_gaf7ed7c23d184b14ce978b1775a86dfae"><div class="ttname"><a href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">foedus::memory::PagePoolOffset</a></div><div class="ttdeci">uint32_t PagePoolOffset</div><div class="ttdoc">Offset in PagePool that compactly represents the page address (unlike 8 bytes pointer). </div><div class="ttdef"><b>Definition:</b> <a href="memory__id_8hpp_source.html#l00044">memory_id.hpp:44</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_aec1302bec7fe39ef71cf9ac0ab6b364a"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#aec1302bec7fe39ef71cf9ac0ab6b364a">foedus::storage::masstree::MasstreePage::is_retired</a></div><div class="ttdeci">bool is_retired() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00170">masstree_page_impl.hpp:170</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a7ac249b3b032751e9bf0903ad7e45255"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255">foedus::thread::Thread::sysxct_page_lock</a></div><div class="ttdeci">ErrorCode sysxct_page_lock(xct::SysxctWorkspace *sysxct_workspace, storage::Page *page)</div><div class="ttdoc">Takes a page lock in the same page for a sysxct running under this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread__pimpl_8cpp_source.html#l00968">thread_pimpl.cpp:968</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a1b972147ca931de586353fda0c6992cd"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">foedus::storage::masstree::SplitIntermediate::piggyback_adopt_child_</a></div><div class="ttdeci">MasstreePage *const piggyback_adopt_child_</div><div class="ttdoc">An optimization for the common case: splitting the parent page to adopt foster twins of a child page...</div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00177">masstree_split_impl.hpp:177</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a96de88f03cf5683529e00d2c209a07e9"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9">foedus::storage::masstree::SplitIntermediate::split_impl_no_error</a></div><div class="ttdeci">void split_impl_no_error(thread::GrabFreeVolatilePagesScope *free_pages)</div><div class="ttdoc">The core implementation after locking relevant pages and acquiring free page resource. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8cpp_source.html#l00476">masstree_split_impl.cpp:476</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_abfe53cdc69964e52901556b1e8d9de9e"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abfe53cdc69964e52901556b1e8d9de9e">foedus::storage::masstree::MasstreePage::has_foster_child</a></div><div class="ttdeci">bool has_foster_child() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00139">masstree_page_impl.hpp:139</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa3832e1d1faf1540161d389edf2a9c17"><div class="ttname"><a href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a></div><div class="ttdeci">#define CHECK_ERROR_CODE(x)</div><div class="ttdoc">This macro calls x and checks its returned error code. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00155">error_code.hpp:155</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_ad699def54b053fca6b3d847ae99e542a"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">foedus::storage::masstree::SplitIntermediate::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00160">masstree_split_impl.hpp:160</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aa656a627e949f49b8903908d2ea1204f_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aa656a627e949f49b8903908d2ea1204f_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aa656a627e949f49b8903908d2ea1204f_cgraph" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_aa656a627e949f49b8903908d2ea1204f_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html#a51fde507b10c15c4c39e6de2de3c6deb" title="If this thread doesn&#39;t have enough free pages, no page is obtained, returning kErrorCodeMemoryNoFreeP..." alt="" coords="249,142,420,183"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abfe53cdc69964e52901556b1e8d9de9e" title="foedus::storage::masstree\l::MasstreePage::has_foster_child" alt="" coords="227,1883,443,1925"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#aec1302bec7fe39ef71cf9ac0ab6b364a" title="foedus::storage::masstree\l::MasstreePage::is_retired" alt="" coords="247,1949,422,1990"/>
<area shape="rect" id="node17" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a96de88f03cf5683529e00d2c209a07e9" title="The core implementation after locking relevant pages and acquiring free page resource. " alt="" coords="248,911,421,967"/>
<area shape="rect" id="node47" href="classfoedus_1_1thread_1_1Thread.html#a2573902a53ca92a0cf7e19113d5b5979" title="Takes a bunch of page locks for a sysxct running under this thread. " alt="" coords="244,2014,425,2055"/>
<area shape="rect" id="node49" href="classfoedus_1_1thread_1_1Thread.html#a7ac249b3b032751e9bf0903ad7e45255" title="Takes a page lock in the same page for a sysxct running under this thread. " alt="" coords="259,2079,410,2121"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html#acbf8a6e96a43f097a20b2d3bcb460d26" title="Idempotent. " alt="" coords="502,142,690,183"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e" title="Returns the private memory repository of this thread. " alt="" coords="788,165,939,206"/>
<area shape="rect" id="node5" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#a6c9bf7d6b21ac33a61d6f7176023ea3a" title="Returns one free volatile page to local page pool. " alt="" coords="749,94,977,135"/>
<area shape="rect" id="node8" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#ad09e335bbca636246cf2c3d60ec22570" title="Acquires one free volatile page from local page pool. " alt="" coords="491,25,701,66"/>
<area shape="rect" id="node6" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ace44cb03e7da84d29f3a02a790c69191" title="foedus::memory::PagePool\lOffsetChunk::full" alt="" coords="1295,122,1473,163"/>
<area shape="rect" id="node7" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#a6f558bb023b2c5c7dd9bf7ab9d054ef0" title="foedus::memory::PagePool\lOffsetChunk::push_back" alt="" coords="1043,93,1222,134"/>
<area shape="rect" id="node9" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ac661b8baf462a1e969a8a1c7e619858b" title="foedus::memory::PagePool\lOffsetChunk::empty" alt="" coords="1043,26,1222,67"/>
<area shape="rect" id="node10" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#af897b38ac1ef4217ff99018436c0112e" title="foedus::memory::PagePool\lOffsetChunk::pop_back" alt="" coords="774,26,953,67"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1PageVersion.html#a2b63daa9a7f39c8c85bf2d43f4c18d78" title="foedus::storage::PageVersion\l::is_moved" alt="" coords="1288,1701,1480,1742"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ac3214863fa74628187ce46b2879994ae" title="foedus::storage::PageVersion\lStatus::is_moved" alt="" coords="1528,1701,1720,1742"/>
<area shape="rect" id="node15" href="structfoedus_1_1storage_1_1PageVersion.html#a61318d7aab5c4ca7334ec05f8de168ca" title="foedus::storage::PageVersion\l::is_retired" alt="" coords="500,1949,692,1990"/>
<area shape="rect" id="node16" href="structfoedus_1_1storage_1_1PageVersionStatus.html#ab07c3c3d030fab04f79b59dee83ecd2e" title="foedus::storage::PageVersion\lStatus::is_retired" alt="" coords="767,1949,959,1990"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e" title="foedus::storage::masstree\l::MasstreePage::header" alt="" coords="777,1453,950,1494"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a14cdcef87b3c0a6ef431df9d06a1a663" title="An empty&#45;range page, either intermediate or border, never has any entries. " alt="" coords="1025,665,1240,706"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec" title="physical key count (those keys might be deleted) in this page. " alt="" coords="1029,877,1236,918"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a7216fe075ea3db89bbba06f5a156ce81" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::verify_separators" alt="" coords="771,489,956,545"/>
<area shape="rect" id="node25" href="classfoedus_1_1thread_1_1Thread.html#ac8953b86c90ec5ee1730b05397a259da" title="Returns page resolver to convert only local page ID to page pointer. " alt="" coords="515,491,677,547"/>
<area shape="rect" id="node26" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aca3a58f3f123782aa1b769447d93fb44" title="Subroutine to decide how we will split this page. " alt="" coords="509,1599,683,1655"/>
<area shape="rect" id="node32" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html#a9fb6eff1b54f1dbdb7e30688aa6bf31f" title="foedus::thread::GrabFree\lVolatilePagesScope::get" alt="" coords="513,571,679,613"/>
<area shape="rect" id="node33" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a273a4c4f51c06ebc91663329742e1c69" title="foedus::storage::Volatile\lPagePointer::set" alt="" coords="515,637,677,678"/>
<area shape="rect" id="node34" href="classfoedus_1_1thread_1_1Thread.html#aa07f33f2b78aa6e6c66a2149b1db52e8" title="foedus::thread::Thread\l::get_numa_node" alt="" coords="521,702,671,743"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#ab25cb34a8304c744bf309cc02b515e72" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::initialize_volatile_page" alt="" coords="771,241,956,297"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a0b54c43dec6f8ba15472a25760a3ed07" title="Layer&#45;0 stores the first 8 byte slice, Layer&#45;1 next 8 byte... " alt="" coords="509,767,683,809"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab55e48873dcf5700871a035c65bfa588" title="used only in masstree. " alt="" coords="492,885,700,926"/>
<area shape="rect" id="node38" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aac45b3f7f6e3c14faa8a9662396d44e1" title="Subroutine to construct a new page. " alt="" coords="507,360,685,416"/>
<area shape="rect" id="node39" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="777,322,950,363"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3fb331a72c86d72deb59c415e6b9b79c" title="foedus::storage::masstree\l::MasstreePage::set_key_count" alt="" coords="493,950,699,991"/>
<area shape="rect" id="node41" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a9c32af21fe03698567d80feab20a353b" title="foedus::storage::masstree\l::MasstreePage::install\l_foster_twin" alt="" coords="509,1016,683,1072"/>
<area shape="rect" id="node42" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html#a006eb94236de0777e5ac139beb6176b2" title="Call this when the page is placed somewhere. " alt="" coords="499,1097,693,1138"/>
<area shape="rect" id="node43" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad3171dd821766bcffba70946a4e44856" title="foedus::storage::masstree\l::MasstreePage::set_moved" alt="" coords="504,1162,688,1203"/>
<area shape="rect" id="node44" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad5263d631cad896c0494597018d72a8f" title="foedus::storage::masstree\l::MasstreePage::set_retired" alt="" coords="505,1227,687,1269"/>
<area shape="rect" id="node45" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="500,1293,692,1334"/>
<area shape="rect" id="node46" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a8f8883172f7ee3c48a1609df044c3964" title="foedus::storage::masstree\l::MasstreePage::get_volatile\l_page_id" alt="" coords="503,1359,689,1415"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a1cb83de15afc0a903046937276b0ed31" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::get_minipage" alt="" coords="1040,373,1225,429"/>
<area shape="rect" id="node23" href="structfoedus_1_1storage_1_1DualPagePointer.html#aedde91e76a6e345f6d19539942f13a43" title="foedus::storage::DualPage\lPointer::is_both_null" alt="" coords="1045,475,1220,517"/>
<area shape="rect" id="node24" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35" title="foedus::storage::masstree\l::MasstreePage::is_moved" alt="" coords="1045,1511,1221,1553"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a44cc8d18dc9077ae2310667e88ed5b7c" title="foedus::storage::masstree\l::MasstreePage::get_foster_fence" alt="" coords="755,1831,972,1873"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a27d301fad7d4d340cd2d6255dc330607" title="foedus::storage::masstree\l::MasstreePage::get_foster_major" alt="" coords="754,1570,973,1611"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a32653a16ddca213c94560652e9388dd5" title="foedus::storage::masstree\l::MasstreePage::get_foster_minor" alt="" coords="754,1635,973,1677"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abb6557473edd899373ed9399b455be20" title="foedus::storage::masstree\l::MasstreePage::get_high_fence" alt="" coords="759,1701,968,1742"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a30f922c414bf3a2faaf7e879b2277f0b" title="foedus::storage::masstree\l::MasstreePage::get_low_fence" alt="" coords="761,1766,965,1807"/>
<area shape="rect" id="node48" href="classfoedus_1_1thread_1_1ThreadPimpl.html#ac779ce5587967f00b09325337578dd24" title="foedus::thread::ThreadPimpl\l::sysxct_batch_page_locks" alt="" coords="504,2014,688,2055"/>
<area shape="rect" id="node50" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a2cd3cb727c6e211c8e6a72ccb00f3854" title="foedus::thread::ThreadPimpl\l::sysxct_page_lock" alt="" coords="504,2079,688,2121"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a96de88f03cf5683529e00d2c209a07e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::storage::masstree::SplitIntermediate::split_impl_no_error </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html">thread::GrabFreeVolatilePagesScope</a> *&#160;</td>
          <td class="paramname"><em>free_pages</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The core implementation after locking relevant pages and acquiring free page resource. </p>
<p>This method never fails because all lock/resource are already taken. </p><dl class="section pre"><dt>Precondition</dt><dd>target_-&gt;is_locked() </dd>
<dd>
free_pages-&gt;get_count() &gt;= 2 </dd>
<dd>
piggyback_adopt_child_ == nullptr || piggyback_adopt_child_-&gt;is_locked() </dd>
<dd>
target_-&gt;has_foster_child()) : should be checked after locking before calling </dd>
<dd>
piggyback_adopt_child_ == nullptr || !piggyback_adopt_child_-&gt;is_retired(): same above </dd></dl>

<p>Definition at line <a class="el" href="masstree__split__impl_8cpp_source.html#l00476">476</a> of file <a class="el" href="masstree__split__impl_8cpp_source.html">masstree_split_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="thread_8cpp_source.html#l00113">foedus::thread::Thread::collect_retired_volatile_page()</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00226">foedus::storage::masstree::SplitIntermediate::SplitStrategy::compact_adopt_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00160">context_</a>, <a class="el" href="masstree__split__impl_8cpp_source.html#l00552">decide_strategy()</a>, <a class="el" href="thread_8hpp_source.html#l00409">foedus::thread::GrabFreeVolatilePagesScope::dispatch()</a>, <a class="el" href="thread_8hpp_source.html#l00413">foedus::thread::GrabFreeVolatilePagesScope::get()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00146">foedus::storage::masstree::MasstreePage::get_btree_level()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00148">foedus::storage::masstree::MasstreePage::get_key_count()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00144">foedus::storage::masstree::MasstreePage::get_layer()</a>, <a class="el" href="thread_8cpp_source.html#l00080">foedus::thread::Thread::get_local_volatile_page_resolver()</a>, <a class="el" href="thread_8hpp_source.html#l00066">foedus::thread::Thread::get_numa_node()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00075">foedus::storage::masstree::MasstreePage::get_volatile_page_id()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00073">foedus::storage::masstree::MasstreePage::header()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00199">foedus::storage::masstree::MasstreePage::high_fence_</a>, <a class="el" href="masstree__page__impl_8cpp_source.html#l00088">foedus::storage::masstree::MasstreeIntermediatePage::initialize_volatile_page()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00118">foedus::storage::masstree::MasstreePage::install_foster_twin()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00097">foedus::storage::masstree::MasstreePage::is_empty_range()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00197">foedus::storage::masstree::MasstreePage::low_fence_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00219">foedus::storage::masstree::SplitIntermediate::SplitStrategy::mid_index_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00217">foedus::storage::masstree::SplitIntermediate::SplitStrategy::mid_separator_</a>, <a class="el" href="masstree__split__impl_8cpp_source.html#l00624">migrate_pointers()</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00177">piggyback_adopt_child_</a>, <a class="el" href="storage__id_8hpp_source.html#l00212">foedus::storage::VolatilePagePointer::set()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00149">foedus::storage::masstree::MasstreePage::set_key_count()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00171">foedus::storage::masstree::MasstreePage::set_moved()</a>, <a class="el" href="masstree__page__impl_8hpp_source.html#l00172">foedus::storage::masstree::MasstreePage::set_retired()</a>, <a class="el" href="page_8hpp_source.html#l00211">foedus::storage::PageHeader::snapshot_</a>, <a class="el" href="page_8hpp_source.html#l00196">foedus::storage::PageHeader::storage_id_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00165">target_</a>, <a class="el" href="masstree__split__impl_8hpp_source.html#l00218">foedus::storage::masstree::SplitIntermediate::SplitStrategy::total_separator_count_</a>, and <a class="el" href="masstree__page__impl_8cpp_source.html#l00475">foedus::storage::masstree::MasstreeIntermediatePage::verify_separators()</a>.</p>

<p>Referenced by <a class="el" href="masstree__split__impl_8cpp_source.html#l00443">run()</a>.</p>
<div class="fragment"><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                                                                                        {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">// similar to border page&#39;s split, but simpler in a few places because</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="comment">// 1) intermediate page doesn&#39;t have owner_id for each pointer (no lock concerns).</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="comment">// 2) intermediate page is already completely sorted.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// thus, this is just a physical operation without any transactional behavior.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// even not a system transaction</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a14cdcef87b3c0a6ef431df9d06a1a663">is_empty_range</a>());</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  debugging::RdtscWatch watch;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  DVLOG(1) &lt;&lt; <span class="stringliteral">&quot;Splitting an intermediate page... &quot;</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keyword">const</span> uint8_t key_count = <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec">get_key_count</a>();</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a7216fe075ea3db89bbba06f5a156ce81">verify_separators</a>();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">// 2 free volatile pages needed.</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="comment">// foster-minor/major (will be placed in successful case)</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; resolver = <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ac8953b86c90ec5ee1730b05397a259da">get_local_volatile_page_resolver</a>();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">// SplitStrategy on heap. 4kb is not too large on heap</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  SplitStrategy strategy;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aca3a58f3f123782aa1b769447d93fb44">decide_strategy</a>(&amp;strategy);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keyword">const</span> <a class="code" href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">KeySlice</a> new_foster_fence = strategy.mid_separator_;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  MasstreeIntermediatePage* twin[2];</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  VolatilePagePointer new_pointers[2];</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    twin[i]</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      = <span class="keyword">reinterpret_cast&lt;</span>MasstreeIntermediatePage*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;          resolver.resolve_offset_newpage(free_pages-&gt;get(i)));</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    new_pointers[i].set(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#aa07f33f2b78aa6e6c66a2149b1db52e8">get_numa_node</a>(), free_pages-&gt;get(i));</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    twin[i]-&gt;initialize_volatile_page(</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a4a8c3c363862348530e4ea0be879f694">storage_id_</a>,</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      new_pointers[i],</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a0b54c43dec6f8ba15472a25760a3ed07">get_layer</a>(),</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab55e48873dcf5700871a035c65bfa588">get_btree_level</a>(),  <span class="comment">// foster child has the same level as foster-parent</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      i == 0 ? <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a409bd08120ef1f54839bbdefd521dd8a">low_fence_</a> : new_foster_fence,</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      i == 0 ? new_foster_fence : <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#aa50900a4544302f5056f62360f8d861e">high_fence_</a>);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aac45b3f7f6e3c14faa8a9662396d44e1">migrate_pointers</a>(strategy, 0, strategy.mid_index_ + 1, new_foster_fence, twin[0]);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordflow">if</span> (strategy.compact_adopt_) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    twin[1]-&gt;set_key_count(0);  <span class="comment">// right is empty-range</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aac45b3f7f6e3c14faa8a9662396d44e1">migrate_pointers</a>(</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      strategy,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      strategy.mid_index_ + 1,</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      strategy.total_separator_count_,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#aa50900a4544302f5056f62360f8d861e">high_fence_</a>,</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      twin[1]);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">// Now we will install the new pages. **From now on no error-return allowed**</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">// We install pointers to the pages AFTER we initialize the pages.</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a9c32af21fe03698567d80feab20a353b">install_foster_twin</a>(new_pointers[0], new_pointers[1], new_foster_fence);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  free_pages-&gt;dispatch(0);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  free_pages-&gt;dispatch(1);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="comment">// invoking set_moved is the point we announce all of these changes. take fence to make it right</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad3171dd821766bcffba70946a4e44856">set_moved</a>();</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>) {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// piggyback_adopt_child_ is adopted and retired.</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad5263d631cad896c0494597018d72a8f">set_retired</a>();</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">context_</a>-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037">collect_retired_volatile_page</a>(<a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">piggyback_adopt_child_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a8f8883172f7ee3c48a1609df044c3964">get_volatile_page_id</a>());</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  watch.stop();</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  DVLOG(1) &lt;&lt; <span class="stringliteral">&quot;Costed &quot;</span> &lt;&lt; watch.elapsed() &lt;&lt; <span class="stringliteral">&quot; cycles to split a node. original node&quot;</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; key count: &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(key_count);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">target_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a7216fe075ea3db89bbba06f5a156ce81">verify_separators</a>();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_aac45b3f7f6e3c14faa8a9662396d44e1"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aac45b3f7f6e3c14faa8a9662396d44e1">foedus::storage::masstree::SplitIntermediate::migrate_pointers</a></div><div class="ttdeci">void migrate_pointers(const SplitStrategy &amp;strategy, uint16_t from, uint16_t to, KeySlice expected_last_separator, MasstreeIntermediatePage *dest) const </div><div class="ttdoc">Subroutine to construct a new page. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8cpp_source.html#l00624">masstree_split_impl.cpp:624</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_aa50900a4544302f5056f62360f8d861e"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#aa50900a4544302f5056f62360f8d861e">foedus::storage::masstree::MasstreePage::high_fence_</a></div><div class="ttdeci">KeySlice high_fence_</div><div class="ttdoc">Inclusive high fence of this page. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00199">masstree_page_impl.hpp:199</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a3ab3ec4aa9b6e43a606e1555c5c74cec"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec">foedus::storage::masstree::MasstreePage::get_key_count</a></div><div class="ttdeci">SlotIndex get_key_count() const __attribute__((always_inline))</div><div class="ttdoc">physical key count (those keys might be deleted) in this page. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00148">masstree_page_impl.hpp:148</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a14cdcef87b3c0a6ef431df9d06a1a663"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a14cdcef87b3c0a6ef431df9d06a1a663">foedus::storage::masstree::MasstreePage::is_empty_range</a></div><div class="ttdeci">bool is_empty_range() const __attribute__((always_inline))</div><div class="ttdoc">An empty-range page, either intermediate or border, never has any entries. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00097">masstree_page_impl.hpp:97</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a55d67791a9a41f250cfaf77d599bd6a2"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a55d67791a9a41f250cfaf77d599bd6a2">foedus::storage::masstree::SplitIntermediate::target_</a></div><div class="ttdeci">MasstreeIntermediatePage *const target_</div><div class="ttdoc">The page to split. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00165">masstree_split_impl.hpp:165</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a409bd08120ef1f54839bbdefd521dd8a"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a409bd08120ef1f54839bbdefd521dd8a">foedus::storage::masstree::MasstreePage::low_fence_</a></div><div class="ttdeci">KeySlice low_fence_</div><div class="ttdoc">Inclusive low fence of this page. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00197">masstree_page_impl.hpp:197</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_ab41d50498e6830c6aedc20c93b495037"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037">foedus::thread::Thread::collect_retired_volatile_page</a></div><div class="ttdeci">void collect_retired_volatile_page(storage::VolatilePagePointer ptr)</div><div class="ttdoc">Keeps the specified volatile page as retired as of the current epoch. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00113">thread.cpp:113</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_a4a8c3c363862348530e4ea0be879f694"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#a4a8c3c363862348530e4ea0be879f694">foedus::storage::PageHeader::storage_id_</a></div><div class="ttdeci">StorageId storage_id_</div><div class="ttdoc">ID of the storage this page belongs to. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00196">page.hpp:196</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_ad3171dd821766bcffba70946a4e44856"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad3171dd821766bcffba70946a4e44856">foedus::storage::masstree::MasstreePage::set_moved</a></div><div class="ttdeci">void set_moved() __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00171">masstree_page_impl.hpp:171</a></div></div>
<div class="ttc" id="group__MASSTREE_html_ga556e8f0d5e02e78f3ddecd8f5b022bf6"><div class="ttname"><a href="group__MASSTREE.html#ga556e8f0d5e02e78f3ddecd8f5b022bf6">foedus::storage::masstree::KeySlice</a></div><div class="ttdeci">uint64_t KeySlice</div><div class="ttdoc">Each key slice is an 8-byte integer. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__id_8hpp_source.html#l00126">masstree_id.hpp:126</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a9c32af21fe03698567d80feab20a353b"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a9c32af21fe03698567d80feab20a353b">foedus::storage::masstree::MasstreePage::install_foster_twin</a></div><div class="ttdeci">void install_foster_twin(VolatilePagePointer minor, VolatilePagePointer major, KeySlice foster_fence)</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00118">masstree_page_impl.hpp:118</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_ab55e48873dcf5700871a035c65bfa588"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab55e48873dcf5700871a035c65bfa588">foedus::storage::masstree::MasstreePage::get_btree_level</a></div><div class="ttdeci">uint8_t get_btree_level() const __attribute__((always_inline))</div><div class="ttdoc">used only in masstree. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00146">masstree_page_impl.hpp:146</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_a1b972147ca931de586353fda0c6992cd"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#a1b972147ca931de586353fda0c6992cd">foedus::storage::masstree::SplitIntermediate::piggyback_adopt_child_</a></div><div class="ttdeci">MasstreePage *const piggyback_adopt_child_</div><div class="ttdoc">An optimization for the common case: splitting the parent page to adopt foster twins of a child page...</div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00177">masstree_split_impl.hpp:177</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a0b54c43dec6f8ba15472a25760a3ed07"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a0b54c43dec6f8ba15472a25760a3ed07">foedus::storage::masstree::MasstreePage::get_layer</a></div><div class="ttdeci">uint8_t get_layer() const __attribute__((always_inline))</div><div class="ttdoc">Layer-0 stores the first 8 byte slice, Layer-1 next 8 byte... </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00144">masstree_page_impl.hpp:144</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_ad5263d631cad896c0494597018d72a8f"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad5263d631cad896c0494597018d72a8f">foedus::storage::masstree::MasstreePage::set_retired</a></div><div class="ttdeci">void set_retired() __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00172">masstree_page_impl.hpp:172</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_ac8953b86c90ec5ee1730b05397a259da"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#ac8953b86c90ec5ee1730b05397a259da">foedus::thread::Thread::get_local_volatile_page_resolver</a></div><div class="ttdeci">const memory::LocalPageResolver &amp; get_local_volatile_page_resolver() const </div><div class="ttdoc">Returns page resolver to convert only local page ID to page pointer. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00080">thread.cpp:80</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_a8f8883172f7ee3c48a1609df044c3964"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a8f8883172f7ee3c48a1609df044c3964">foedus::storage::masstree::MasstreePage::get_volatile_page_id</a></div><div class="ttdeci">VolatilePagePointer get_volatile_page_id() const </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00075">masstree_page_impl.hpp:75</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreePage_html_ab5ab7bbce35893143d2aac437e526d0e"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e">foedus::storage::masstree::MasstreePage::header</a></div><div class="ttdeci">PageHeader &amp; header()</div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8hpp_source.html#l00073">masstree_page_impl.hpp:73</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_aa07f33f2b78aa6e6c66a2149b1db52e8"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#aa07f33f2b78aa6e6c66a2149b1db52e8">foedus::thread::Thread::get_numa_node</a></div><div class="ttdeci">ThreadGroupId get_numa_node() const </div><div class="ttdef"><b>Definition:</b> <a href="thread_8hpp_source.html#l00066">thread.hpp:66</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_ad699def54b053fca6b3d847ae99e542a"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#ad699def54b053fca6b3d847ae99e542a">foedus::storage::masstree::SplitIntermediate::context_</a></div><div class="ttdeci">thread::Thread *const context_</div><div class="ttdoc">Thread context. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8hpp_source.html#l00160">masstree_split_impl.hpp:160</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage_html_a7216fe075ea3db89bbba06f5a156ce81"><div class="ttname"><a href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a7216fe075ea3db89bbba06f5a156ce81">foedus::storage::masstree::MasstreeIntermediatePage::verify_separators</a></div><div class="ttdeci">void verify_separators() const </div><div class="ttdef"><b>Definition:</b> <a href="masstree__page__impl_8cpp_source.html#l00475">masstree_page_impl.cpp:475</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_ac0baf9ee636d13c02d334ce779cc6a8f"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">foedus::storage::PageHeader::snapshot_</a></div><div class="ttdeci">bool snapshot_</div><div class="ttdoc">Whether this page image is of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00211">page.hpp:211</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_html_aca3a58f3f123782aa1b769447d93fb44"><div class="ttname"><a href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aca3a58f3f123782aa1b769447d93fb44">foedus::storage::masstree::SplitIntermediate::decide_strategy</a></div><div class="ttdeci">void decide_strategy(SplitStrategy *out) const </div><div class="ttdoc">Subroutine to decide how we will split this page. </div><div class="ttdef"><b>Definition:</b> <a href="masstree__split__impl_8cpp_source.html#l00552">masstree_split_impl.cpp:552</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_cgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_cgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_cgraph" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1Thread.html#ab41d50498e6830c6aedc20c93b495037" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="235,392,427,433"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aca3a58f3f123782aa1b769447d93fb44" title="Subroutine to decide how we will split this page. " alt="" coords="244,610,417,666"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab5ab7bbce35893143d2aac437e526d0e" title="foedus::storage::masstree\l::MasstreePage::header" alt="" coords="514,895,687,936"/>
<area shape="rect" id="node24" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3ab3ec4aa9b6e43a606e1555c5c74cec" title="physical key count (those keys might be deleted) in this page. " alt="" coords="775,1019,982,1060"/>
<area shape="rect" id="node26" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html#a006eb94236de0777e5ac139beb6176b2" title="Call this when the page is placed somewhere. " alt="" coords="233,1539,428,1580"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1GrabFreeVolatilePagesScope.html#a9fb6eff1b54f1dbdb7e30688aa6bf31f" title="foedus::thread::GrabFree\lVolatilePagesScope::get" alt="" coords="247,1604,414,1645"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ab55e48873dcf5700871a035c65bfa588" title="used only in masstree. " alt="" coords="227,1669,435,1711"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a0b54c43dec6f8ba15472a25760a3ed07" title="Layer&#45;0 stores the first 8 byte slice, Layer&#45;1 next 8 byte... " alt="" coords="243,1735,418,1776"/>
<area shape="rect" id="node30" href="classfoedus_1_1thread_1_1Thread.html#ac8953b86c90ec5ee1730b05397a259da" title="Returns page resolver to convert only local page ID to page pointer. " alt="" coords="249,1801,412,1857"/>
<area shape="rect" id="node31" href="classfoedus_1_1thread_1_1Thread.html#aa07f33f2b78aa6e6c66a2149b1db52e8" title="foedus::thread::Thread\l::get_numa_node" alt="" coords="255,1881,406,1923"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a8f8883172f7ee3c48a1609df044c3964" title="foedus::storage::masstree\l::MasstreePage::get_volatile\l_page_id" alt="" coords="237,1947,424,2003"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#ab25cb34a8304c744bf309cc02b515e72" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::initialize_volatile_page" alt="" coords="238,1077,423,1133"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a9c32af21fe03698567d80feab20a353b" title="foedus::storage::masstree\l::MasstreePage::install\l_foster_twin" alt="" coords="244,2027,417,2083"/>
<area shape="rect" id="node39" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a14cdcef87b3c0a6ef431df9d06a1a663" title="An empty&#45;range page, either intermediate or border, never has any entries. " alt="" coords="771,1392,986,1433"/>
<area shape="rect" id="node40" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="514,1375,687,1416"/>
<area shape="rect" id="node41" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aac45b3f7f6e3c14faa8a9662396d44e1" title="Subroutine to construct a new page. " alt="" coords="241,1290,420,1346"/>
<area shape="rect" id="node44" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a7216fe075ea3db89bbba06f5a156ce81" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::verify_separators" alt="" coords="508,1193,693,1249"/>
<area shape="rect" id="node45" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a273a4c4f51c06ebc91663329742e1c69" title="foedus::storage::Volatile\lPagePointer::set" alt="" coords="250,2108,411,2149"/>
<area shape="rect" id="node46" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a3fb331a72c86d72deb59c415e6b9b79c" title="foedus::storage::masstree\l::MasstreePage::set_key_count" alt="" coords="227,1421,434,1463"/>
<area shape="rect" id="node47" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad3171dd821766bcffba70946a4e44856" title="foedus::storage::masstree\l::MasstreePage::set_moved" alt="" coords="239,2173,423,2215"/>
<area shape="rect" id="node49" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#ad5263d631cad896c0494597018d72a8f" title="foedus::storage::masstree\l::MasstreePage::set_retired" alt="" coords="239,2239,422,2280"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a674a8a8e613dc4e19a626da490c883fc" title="Keeps the specified volatile page as retired as of the current epoch. " alt="" coords="505,239,697,280"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a28d4f2f16808e20d2d174f12ff1c7317" title="Subroutine of collect_retired_volatile_page() just for assertion. " alt="" coords="787,377,971,419"/>
<area shape="rect" id="node5" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077" title="foedus::storage::Volatile\lPagePointer::get_numa_node" alt="" coords="782,443,975,484"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#a48d5e1f7ce2f70161c253f650c75ed95" title="See Transaction Manager. " alt="" coords="1061,279,1195,320"/>
<area shape="rect" id="node7" href="classfoedus_1_1xct_1_1XctManager.html#a4578dd6dab7925b95d7810335ae5cec0" title="foedus::xct::XctManager\l::get_current_global_epoch_weak" alt="" coords="771,115,986,156"/>
<area shape="rect" id="node8" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="793,181,964,207"/>
<area shape="rect" id="node9" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#ad0624fe34e52c0904ee449c97f0325c5" title="foedus::memory::NumaCore\lMemory::get_retired_volatile\l_pool_chunk" alt="" coords="787,231,971,287"/>
<area shape="rect" id="node10" href="classfoedus_1_1memory_1_1PagePoolOffsetAndEpochChunk.html#acac2755ecb22d4539c3d6bb44538240d" title="foedus::memory::PagePool\lOffsetAndEpochChunk::full" alt="" coords="1039,20,1217,61"/>
<area shape="rect" id="node11" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a694a2aaa7515ab45a8c9fa12b709defb" title="Subroutine of collect_retired_volatile_page() in case the chunk becomes full. " alt="" coords="787,49,971,91"/>
<area shape="rect" id="node12" href="classfoedus_1_1memory_1_1PagePoolOffsetAndEpochChunk.html#aae530fb2917cf0f6329ac323f1da7c8c" title="foedus::memory::PagePool\lOffsetAndEpochChunk::push_back" alt="" coords="767,312,991,353"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a44cc8d18dc9077ae2310667e88ed5b7c" title="foedus::storage::masstree\l::MasstreePage::get_foster_fence" alt="" coords="492,617,709,659"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a27d301fad7d4d340cd2d6255dc330607" title="foedus::storage::masstree\l::MasstreePage::get_foster_major" alt="" coords="491,683,710,724"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a32653a16ddca213c94560652e9388dd5" title="foedus::storage::masstree\l::MasstreePage::get_foster_minor" alt="" coords="491,748,710,789"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#abb6557473edd899373ed9399b455be20" title="foedus::storage::masstree\l::MasstreePage::get_high_fence" alt="" coords="496,304,705,345"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a30f922c414bf3a2faaf7e879b2277f0b" title="foedus::storage::masstree\l::MasstreePage::get_low_fence" alt="" coords="499,369,703,411"/>
<area shape="rect" id="node20" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a56b5ea2f52ce2767ac205f624ce156e6" title="foedus::storage::Volatile\lPagePointer::is_equivalent" alt="" coords="513,435,688,476"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a16a2c06a304514be7b99fb6c884e7e9b" title="foedus::storage::masstree\l::MasstreePage::is_locked" alt="" coords="512,500,689,541"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#adc22d21883e15b87cd5ff6b6ec513c35" title="foedus::storage::masstree\l::MasstreePage::is_moved" alt="" coords="791,756,967,797"/>
<area shape="rect" id="node23" href="structfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePointerIterator.html#acd0b166a127ed5fbadecd838f8e32be5" title="foedus::storage::masstree\l::MasstreeIntermediatePointerIterator\l::is_valid" alt="" coords="483,814,719,870"/>
<area shape="rect" id="node25" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html#a1cb83de15afc0a903046937276b0ed31" title="foedus::storage::masstree\l::MasstreeIntermediatePage\l::get_minipage" alt="" coords="786,1139,971,1195"/>
<area shape="rect" id="node32" href="group__THREAD.html#ga1622c6d8c64ca80f51c1bef5190ec4fa" title="Extracts NUMA node ID from the given globally unique ID of Thread (core). " alt="" coords="511,1849,690,1891"/>
<area shape="rect" id="node33" href="classfoedus_1_1thread_1_1Thread.html#af98ed86adde3f5e39c9cab39440f38da" title="foedus::thread::Thread\l::get_thread_id" alt="" coords="525,1915,676,1956"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#aa95b56b38e523e345e5fb0283e43d65e" title="foedus::storage::masstree\l::MasstreePage::initialize\l_volatile_common" alt="" coords="514,1011,687,1067"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html#a38e3cb12f6db6351ac0fc89369868fb9" title="foedus::storage::masstree\l::MasstreePage::set_foster_twin" alt="" coords="496,2035,705,2076"/>
<area shape="rect" id="node42" href="structfoedus_1_1storage_1_1DualPagePointer.html#aedde91e76a6e345f6d19539942f13a43" title="foedus::storage::DualPage\lPointer::is_both_null" alt="" coords="791,1268,966,1309"/>
<area shape="rect" id="node43" href="structfoedus_1_1storage_1_1PageHeader.html#a407bbd604662534963c7fc8f08acc898" title="foedus::storage::PageHeader\l::set_key_count" alt="" coords="505,1440,696,1481"/>
<area shape="rect" id="node48" href="structfoedus_1_1storage_1_1PageVersion.html#a100c23d40bf8e14fe08f59599c81cd26" title="foedus::storage::PageVersion\l::set_moved" alt="" coords="505,2173,697,2215"/>
<area shape="rect" id="node50" href="structfoedus_1_1storage_1_1PageVersion.html#a018b79a89f8e665d8f0bb22023f3dad7" title="foedus::storage::PageVersion\l::set_retired" alt="" coords="505,2239,697,2280"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_icgraph.png" border="0" usemap="#structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_icgraph" alt=""/></div>
<map name="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_icgraph" id="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate_a96de88f03cf5683529e00d2c209a07e9_icgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html#aa656a627e949f49b8903908d2ea1204f" title="Interior node&#39;s Split. " alt="" coords="227,13,400,54"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="ad699def54b053fca6b3d847ae99e542a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* const foedus::storage::masstree::SplitIntermediate::context_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread context. </p>

<p>Definition at line <a class="el" href="masstree__split__impl_8hpp_source.html#l00160">160</a> of file <a class="el" href="masstree__split__impl_8hpp_source.html">masstree_split_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="masstree__split__impl_8cpp_source.html#l00443">run()</a>, and <a class="el" href="masstree__split__impl_8cpp_source.html#l00476">split_impl_no_error()</a>.</p>

</div>
</div>
<a class="anchor" id="a1b972147ca931de586353fda0c6992cd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreePage.html">MasstreePage</a>* const foedus::storage::masstree::SplitIntermediate::piggyback_adopt_child_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>An optimization for the common case: splitting the parent page to adopt foster twins of a child page. </p>
<p>The child page whose foster-twins will be adopted in the course of this split. Without this optimization, we need two Sysxct invocation, split and adopt. This also gives a hint whether it might be no-record-split (NRS). null if no such piggy-back adoption (in that case ignores the possibility of NRS). </p><dl class="section pre"><dt>Precondition</dt><dd>piggyback_adopt_child_ == nullptr || piggyback_adopt_child_-&gt;has_foster_child() </dd></dl>

<p>Definition at line <a class="el" href="masstree__split__impl_8hpp_source.html#l00177">177</a> of file <a class="el" href="masstree__split__impl_8hpp_source.html">masstree_split_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="masstree__split__impl_8cpp_source.html#l00552">decide_strategy()</a>, <a class="el" href="masstree__split__impl_8cpp_source.html#l00443">run()</a>, and <a class="el" href="masstree__split__impl_8cpp_source.html#l00476">split_impl_no_error()</a>.</p>

</div>
</div>
<a class="anchor" id="a55d67791a9a41f250cfaf77d599bd6a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeIntermediatePage.html">MasstreeIntermediatePage</a>* const foedus::storage::masstree::SplitIntermediate::target_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The page to split. </p>
<dl class="section pre"><dt>Precondition</dt><dd>!target_-&gt;header_.snapshot_ (split happens to only volatile pages) </dd></dl>

<p>Definition at line <a class="el" href="masstree__split__impl_8hpp_source.html#l00165">165</a> of file <a class="el" href="masstree__split__impl_8hpp_source.html">masstree_split_impl.hpp</a>.</p>

<p>Referenced by <a class="el" href="masstree__split__impl_8cpp_source.html#l00552">decide_strategy()</a>, <a class="el" href="masstree__split__impl_8cpp_source.html#l00443">run()</a>, and <a class="el" href="masstree__split__impl_8cpp_source.html#l00476">split_impl_no_error()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/storage/masstree/<a class="el" href="masstree__split__impl_8hpp_source.html">masstree_split_impl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/storage/masstree/<a class="el" href="masstree__split__impl_8cpp_source.html">masstree_split_impl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage.html">storage</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage_1_1masstree.html">masstree</a></li><li class="navelem"><a class="el" href="structfoedus_1_1storage_1_1masstree_1_1SplitIntermediate.html">SplitIntermediate</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
