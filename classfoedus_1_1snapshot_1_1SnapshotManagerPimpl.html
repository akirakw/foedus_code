<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::snapshot::SnapshotManagerPimpl Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::snapshot::SnapshotManagerPimpl Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__SNAPSHOT.html">Snapshot Manager</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Pimpl object of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManager.html" title="Snapshot manager that atomically and durably writes out a snapshot file. ">SnapshotManager</a>.  
 <a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Pimpl object of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManager.html" title="Snapshot manager that atomically and durably writes out a snapshot file. ">SnapshotManager</a>. </p>
<p>A private pimpl object for <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManager.html" title="Snapshot manager that atomically and durably writes out a snapshot file. ">SnapshotManager</a>. Do not include this header from a client program unless you know what you are doing. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00204">204</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for foedus::snapshot::SnapshotManagerPimpl:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl__inherit__graph.png" border="0" usemap="#foedus_1_1snapshot_1_1SnapshotManagerPimpl_inherit__map" alt="Inheritance graph"/></div>
<map name="foedus_1_1snapshot_1_1SnapshotManagerPimpl_inherit__map" id="foedus_1_1snapshot_1_1SnapshotManagerPimpl_inherit__map">
<area shape="rect" id="node2" href="classfoedus_1_1DefaultInitializable.html" title="Typical implementation of Initializable as a skeleton base class. " alt="" coords="11,80,183,107"/>
<area shape="rect" id="node3" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="31,5,163,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for foedus::snapshot::SnapshotManagerPimpl:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl__coll__graph.png" border="0" usemap="#foedus_1_1snapshot_1_1SnapshotManagerPimpl_coll__map" alt="Collaboration graph"/></div>
<map name="foedus_1_1snapshot_1_1SnapshotManagerPimpl_coll__map" id="foedus_1_1snapshot_1_1SnapshotManagerPimpl_coll__map">
<area shape="rect" id="node2" href="classfoedus_1_1DefaultInitializable.html" title="Typical implementation of Initializable as a skeleton base class. " alt="" coords="1376,5,1548,32"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1MapReduceBase.html" title="Base class for LogMapper and LogReducer to share common code. " alt="" coords="1727,89,1955,116"/>
<area shape="rect" id="node3" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="294,40,426,67"/>
<area shape="rect" id="node11" href="classfoedus_1_1Engine.html" title="Database engine object that holds all resources and provides APIs. " alt="" coords="633,171,741,197"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1LogReducer.html" title="A log reducer, which receives log entries sent from mappers and applies them to construct new snapsho..." alt="" coords="2356,65,2555,92"/>
<area shape="rect" id="node16" href="classfoedus_1_1snapshot_1_1LogMapper.html" title="A log mapper, which reads log files from one logger and sends them to corresponding log reducers..." alt="" coords="2129,127,2323,153"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1LogGleanerRef.html" title="A remote view of LogGleaner from all engines. " alt="" coords="1355,123,1569,149"/>
<area shape="rect" id="node7" href="classfoedus_1_1Attachable.html" title="foedus::Attachable\l\&lt; LogGleanerControlBlock \&gt;" alt="" coords="991,289,1177,330"/>
<area shape="rect" id="node8" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html" title="Shared data for LogGleaner. " alt="" coords="589,351,784,393"/>
<area shape="rect" id="node22" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html" title="Shared data in SnapshotManagerPimpl. " alt="" coords="992,355,1176,397"/>
<area shape="rect" id="node9" href="structfoedus_1_1snapshot_1_1Snapshot.html" title="Represents one snapshot that converts all logs from base epoch to valid_until epoch into snapshot fil..." alt="" coords="268,391,452,417"/>
<area shape="rect" id="node10" href="classfoedus_1_1Epoch.html" title="Represents a time epoch. " alt="" coords="5,391,111,417"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1PartitionerMetadata.html" title="Tiny metadata of partitioner for every storage used while log gleaning. " alt="" coords="995,31,1173,73"/>
<area shape="rect" id="node13" href="classfoedus_1_1soc_1_1SharedMutex.html" title="A mutex that can be placed in shared memory and used from multiple processes. " alt="" coords="599,39,774,65"/>
<area shape="rect" id="node14" title="STL class. " alt="" coords="1420,179,1504,205"/>
<area shape="rect" id="node18" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html" title="Local resource for the log gleaner, which runs only in the master node. " alt="" coords="2579,361,2773,402"/>
<area shape="rect" id="node20" href="structfoedus_1_1snapshot_1_1LogGleanerResource_1_1PerNodeResource.html" title="These buffers are used to read intermediate results from each reducer to compose the root page or oth..." alt="" coords="1743,365,1938,406"/>
<area shape="rect" id="node21" href="classfoedus_1_1memory_1_1AlignedMemory.html" title="Represents one memory block aligned to actual OS/hardware pages. " alt="" coords="1355,445,1569,472"/>
<area shape="rect" id="node23" href="classfoedus_1_1soc_1_1SharedPolling.html" title="A polling&#45;wait mechanism that can be placed in shared memory and used from multiple processes..." alt="" coords="598,504,775,531"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8231d8152b07a15c465c881fa686aea6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a8231d8152b07a15c465c881fa686aea6">SnapshotManagerPimpl</a> ()=delete</td></tr>
<tr class="separator:a8231d8152b07a15c465c881fa686aea6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7c2568bf6e872b574c2bfc2aafc7ce5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ac7c2568bf6e872b574c2bfc2aafc7ce5">SnapshotManagerPimpl</a> (<a class="el" href="classfoedus_1_1Engine.html">Engine</a> *engine)</td></tr>
<tr class="separator:ac7c2568bf6e872b574c2bfc2aafc7ce5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a632a4da7b3c67dd687f7eba4f6ec1d76"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76">initialize_once</a> () override</td></tr>
<tr class="separator:a632a4da7b3c67dd687f7eba4f6ec1d76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fd4f82797b7ce89da73feca6570f581"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4fd4f82797b7ce89da73feca6570f581">uninitialize_once</a> () override</td></tr>
<tr class="separator:a4fd4f82797b7ce89da73feca6570f581"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a058c0e139d36b76aaeb1e8b9a62dd600"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structfoedus_1_1snapshot_1_1SnapshotOptions.html">SnapshotOptions</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600">get_option</a> () const </td></tr>
<tr class="memdesc:a058c0e139d36b76aaeb1e8b9a62dd600"><td class="mdescLeft">&#160;</td><td class="mdescRight">shorthand for engine_-&gt;get_options().snapshot_.  <a href="#a058c0e139d36b76aaeb1e8b9a62dd600">More...</a><br /></td></tr>
<tr class="separator:a058c0e139d36b76aaeb1e8b9a62dd600"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f1c4ffd479bb976c32d4ddb38517a3b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a> () const </td></tr>
<tr class="separator:a2f1c4ffd479bb976c32d4ddb38517a3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf69db8a860cc752f39c69940b9f3d6e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaf69db8a860cc752f39c69940b9f3d6e">get_snapshot_epoch_weak</a> () const </td></tr>
<tr class="separator:aaf69db8a860cc752f39c69940b9f3d6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4304c74f47b7ec19d5e126dd161ca664"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4304c74f47b7ec19d5e126dd161ca664">get_previous_snapshot_id</a> () const </td></tr>
<tr class="separator:a4304c74f47b7ec19d5e126dd161ca664"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a307426b2bbb68497d5ab4c75ceaddd31"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a307426b2bbb68497d5ab4c75ceaddd31">get_previous_snapshot_id_weak</a> () const </td></tr>
<tr class="separator:a307426b2bbb68497d5ab4c75ceaddd31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12f213f8bc7b46e75428a7624999c3fd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a12f213f8bc7b46e75428a7624999c3fd">read_snapshot_metadata</a> (<a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> snapshot_id, <a class="el" href="structfoedus_1_1snapshot_1_1SnapshotMetadata.html">SnapshotMetadata</a> *out)</td></tr>
<tr class="separator:a12f213f8bc7b46e75428a7624999c3fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4496237075c2f411bb548e1bec7ca06b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4496237075c2f411bb548e1bec7ca06b">trigger_snapshot_immediate</a> (bool wait_completion, <a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> suggested_snapshot_epoch)</td></tr>
<tr class="separator:a4496237075c2f411bb548e1bec7ca06b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac35e1cb910337b9d66852e47202fb442"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ac35e1cb910337b9d66852e47202fb442">stop_snapshot_thread</a> ()</td></tr>
<tr class="memdesc:ac35e1cb910337b9d66852e47202fb442"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a hidden API called at the beginning of engine shutdown (namely restart manager).  <a href="#ac35e1cb910337b9d66852e47202fb442">More...</a><br /></td></tr>
<tr class="separator:ac35e1cb910337b9d66852e47202fb442"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa267f8a5bae1442133dc336aa5e9e8c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aa267f8a5bae1442133dc336aa5e9e8c9">issue_next_snapshot_id</a> ()</td></tr>
<tr class="separator:aa267f8a5bae1442133dc336aa5e9e8c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab92f4472ad5436d0a216dd8183f26ec6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6">wakeup</a> ()</td></tr>
<tr class="separator:ab92f4472ad5436d0a216dd8183f26ec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6b7456f65be108f3e51455b485f9a12"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab6b7456f65be108f3e51455b485f9a12">sleep_a_while</a> ()</td></tr>
<tr class="separator:ab6b7456f65be108f3e51455b485f9a12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a501ce4a1b4b4a847a635ca671c5331de"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a> () const </td></tr>
<tr class="separator:a501ce4a1b4b4a847a635ca671c5331de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd36bdebf7a189e0ad51021f49ab5349"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#abd36bdebf7a189e0ad51021f49ab5349">is_gleaning</a> () const </td></tr>
<tr class="separator:abd36bdebf7a189e0ad51021f49ab5349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64e3c7594b7d7d0d5f8a144bd802d910"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910">handle_snapshot</a> ()</td></tr>
<tr class="memdesc:a64e3c7594b7d7d0d5f8a144bd802d910"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main routine for snapshot_thread_ in master engine.  <a href="#a64e3c7594b7d7d0d5f8a144bd802d910">More...</a><br /></td></tr>
<tr class="separator:a64e3c7594b7d7d0d5f8a144bd802d910"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a905ccf76fe0e076980dc1965f038fe10"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10">handle_snapshot_triggered</a> (<a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> *new_snapshot)</td></tr>
<tr class="memdesc:a905ccf76fe0e076980dc1965f038fe10"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. ">handle_snapshot()</a> calls this when it should start snapshotting.  <a href="#a905ccf76fe0e076980dc1965f038fe10">More...</a><br /></td></tr>
<tr class="separator:a905ccf76fe0e076980dc1965f038fe10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84fdf2f4ccf499b44afed05a273739d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a84fdf2f4ccf499b44afed05a273739d9">handle_snapshot_child</a> ()</td></tr>
<tr class="memdesc:a84fdf2f4ccf499b44afed05a273739d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main routine for snapshot_thread_ in child engines.  <a href="#a84fdf2f4ccf499b44afed05a273739d9">More...</a><br /></td></tr>
<tr class="separator:a84fdf2f4ccf499b44afed05a273739d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75c5d41290ab6f960725a004622dc3be"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a75c5d41290ab6f960725a004622dc3be">glean_logs</a> (const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;new_snapshot, std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; *new_root_page_pointers)</td></tr>
<tr class="memdesc:a75c5d41290ab6f960725a004622dc3be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>.  <a href="#a75c5d41290ab6f960725a004622dc3be">More...</a><br /></td></tr>
<tr class="separator:a75c5d41290ab6f960725a004622dc3be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ae6b016213cb70bb6e5df636b24d129"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4ae6b016213cb70bb6e5df636b24d129">snapshot_metadata</a> (const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;new_snapshot, const std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; &amp;new_root_page_pointers)</td></tr>
<tr class="memdesc:a4ae6b016213cb70bb6e5df636b24d129"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>.  <a href="#a4ae6b016213cb70bb6e5df636b24d129">More...</a><br /></td></tr>
<tr class="separator:a4ae6b016213cb70bb6e5df636b24d129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45097869d980cf8fe0ad3313e02c8117"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a45097869d980cf8fe0ad3313e02c8117">snapshot_savepoint</a> (const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;new_snapshot)</td></tr>
<tr class="memdesc:a45097869d980cf8fe0ad3313e02c8117"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>.  <a href="#a45097869d980cf8fe0ad3313e02c8117">More...</a><br /></td></tr>
<tr class="separator:a45097869d980cf8fe0ad3313e02c8117"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d474e7a6b4de127153103f2295cb0fa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa">drop_volatile_pages</a> (const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;new_snapshot, const std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; &amp;new_root_page_pointers)</td></tr>
<tr class="memdesc:a5d474e7a6b4de127153103f2295cb0fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>.  <a href="#a5d474e7a6b4de127153103f2295cb0fa">More...</a><br /></td></tr>
<tr class="separator:a5d474e7a6b4de127153103f2295cb0fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26c51902174b692c91aedd15218f01b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a26c51902174b692c91aedd15218f01b7">drop_volatile_pages_parallel</a> (const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;new_snapshot, const std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; &amp;new_root_page_pointers, void *result_memory, uint16_t parallel_id)</td></tr>
<tr class="memdesc:a26c51902174b692c91aedd15218f01b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">subroutine invoked by one thread for one node.  <a href="#a26c51902174b692c91aedd15218f01b7">More...</a><br /></td></tr>
<tr class="separator:a26c51902174b692c91aedd15218f01b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cb397e7c8042e460f5f0e36d939b3e0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1fs_1_1Path.html">fs::Path</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0">get_snapshot_metadata_file_path</a> (<a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> snapshot_id) const </td></tr>
<tr class="memdesc:a7cb397e7c8042e460f5f0e36d939b3e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">each snapshot has a snapshot-metadata file "snapshot_metadata_&lt;SNAPSHOT_ID&gt;.xml" in first node's first partition folder.  <a href="#a7cb397e7c8042e460f5f0e36d939b3e0">More...</a><br /></td></tr>
<tr class="separator:a7cb397e7c8042e460f5f0e36d939b3e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfoedus_1_1DefaultInitializable"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfoedus_1_1DefaultInitializable')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfoedus_1_1DefaultInitializable.html">foedus::DefaultInitializable</a></td></tr>
<tr class="memitem:a5e0a2679baa030e297c1a51847352945 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a5e0a2679baa030e297c1a51847352945">DefaultInitializable</a> ()</td></tr>
<tr class="separator:a5e0a2679baa030e297c1a51847352945 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe7a18ec3e5edd143eb7d6a75d65ef9b inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#afe7a18ec3e5edd143eb7d6a75d65ef9b">~DefaultInitializable</a> ()</td></tr>
<tr class="separator:afe7a18ec3e5edd143eb7d6a75d65ef9b inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd6a8f8296ab570b545430593287d454 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#afd6a8f8296ab570b545430593287d454">DefaultInitializable</a> (const <a class="el" href="classfoedus_1_1DefaultInitializable.html">DefaultInitializable</a> &amp;)=delete</td></tr>
<tr class="separator:afd6a8f8296ab570b545430593287d454 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31eb5acadf0544b97414efd33aed08c7 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1DefaultInitializable.html">DefaultInitializable</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a31eb5acadf0544b97414efd33aed08c7">operator=</a> (const <a class="el" href="classfoedus_1_1DefaultInitializable.html">DefaultInitializable</a> &amp;)=delete</td></tr>
<tr class="separator:a31eb5acadf0544b97414efd33aed08c7 inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22a0dc3bbbca682c3bc41eace9b6d1ff inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff">initialize</a> () override final</td></tr>
<tr class="memdesc:a22a0dc3bbbca682c3bc41eace9b6d1ff inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="mdescLeft">&#160;</td><td class="mdescRight">Typical implementation of <a class="el" href="classfoedus_1_1Initializable.html#aa087b096d1edaeb0304c250eadb0d7e1" title="Acquires resources in this object, usually called right after constructor. ">Initializable::initialize()</a> that provides initialize-once semantics.  <a href="#a22a0dc3bbbca682c3bc41eace9b6d1ff">More...</a><br /></td></tr>
<tr class="separator:a22a0dc3bbbca682c3bc41eace9b6d1ff inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab14b136a7d26f9f499ab9dc15a45a8cb inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb">uninitialize</a> () override final</td></tr>
<tr class="memdesc:ab14b136a7d26f9f499ab9dc15a45a8cb inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="mdescLeft">&#160;</td><td class="mdescRight">Typical implementation of <a class="el" href="classfoedus_1_1Initializable.html#afbe5738b0bc85362fba80bdf788fd3c3" title="An idempotent method to release all resources of this object, if any. ">Initializable::uninitialize()</a> that provides uninitialize-once semantics.  <a href="#ab14b136a7d26f9f499ab9dc15a45a8cb">More...</a><br /></td></tr>
<tr class="separator:ab14b136a7d26f9f499ab9dc15a45a8cb inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1abda1e84b8af8bd6916e52fd0a09f3e inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e">is_initialized</a> () const  override final</td></tr>
<tr class="memdesc:a1abda1e84b8af8bd6916e52fd0a09f3e inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns whether the object has been already initialized or not.  <a href="#a1abda1e84b8af8bd6916e52fd0a09f3e">More...</a><br /></td></tr>
<tr class="separator:a1abda1e84b8af8bd6916e52fd0a09f3e inherit pub_methods_classfoedus_1_1DefaultInitializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfoedus_1_1Initializable"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfoedus_1_1Initializable')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfoedus_1_1Initializable.html">foedus::Initializable</a></td></tr>
<tr class="memitem:aff308260543d18b3fd1367fd9017b176 inherit pub_methods_classfoedus_1_1Initializable"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1Initializable.html#aff308260543d18b3fd1367fd9017b176">~Initializable</a> ()</td></tr>
<tr class="separator:aff308260543d18b3fd1367fd9017b176 inherit pub_methods_classfoedus_1_1Initializable"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a0bbaceb941767610c240b0da20c92845"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1Engine.html">Engine</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a></td></tr>
<tr class="separator:a0bbaceb941767610c240b0da20c92845"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea8bce561f2a5274e75cf56932a212bc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html">SnapshotManagerControlBlock</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a></td></tr>
<tr class="separator:aea8bce561f2a5274e75cf56932a212bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa90b3763974fac3e2b1f32b0b7e66f1b"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aa90b3763974fac3e2b1f32b0b7e66f1b">snapshots_</a></td></tr>
<tr class="memdesc:aa90b3763974fac3e2b1f32b0b7e66f1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">All previously taken snapshots.  <a href="#aa90b3763974fac3e2b1f32b0b7e66f1b">More...</a><br /></td></tr>
<tr class="separator:aa90b3763974fac3e2b1f32b0b7e66f1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaccf99888d69af9c737638c198470161"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaccf99888d69af9c737638c198470161">stop_requested_</a></td></tr>
<tr class="memdesc:aaccf99888d69af9c737638c198470161"><td class="mdescLeft">&#160;</td><td class="mdescRight">To locally shutdown snapshot_thread_.  <a href="#aaccf99888d69af9c737638c198470161">More...</a><br /></td></tr>
<tr class="separator:aaccf99888d69af9c737638c198470161"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5c66ecba243eccfc78b5ae52aba9f7a"><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab5c66ecba243eccfc78b5ae52aba9f7a">snapshot_thread_</a></td></tr>
<tr class="memdesc:ab5c66ecba243eccfc78b5ae52aba9f7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The daemon thread of snapshot manager.  <a href="#ab5c66ecba243eccfc78b5ae52aba9f7a">More...</a><br /></td></tr>
<tr class="separator:ab5c66ecba243eccfc78b5ae52aba9f7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4775dadfb539af5c8d82118735212254"><td class="memItemLeft" align="right" valign="top">std::chrono::system_clock::time_point&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4775dadfb539af5c8d82118735212254">previous_snapshot_time_</a></td></tr>
<tr class="memdesc:a4775dadfb539af5c8d82118735212254"><td class="mdescLeft">&#160;</td><td class="mdescRight">When snapshot_thread_ took snapshot last time.  <a href="#a4775dadfb539af5c8d82118735212254">More...</a><br /></td></tr>
<tr class="separator:a4775dadfb539af5c8d82118735212254"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20ef0a4fa6050268d88fb3532b90c757"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classfoedus_1_1snapshot_1_1LogMapper.html">LogMapper</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">local_mappers_</a></td></tr>
<tr class="memdesc:a20ef0a4fa6050268d88fb3532b90c757"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mappers in this node.  <a href="#a20ef0a4fa6050268d88fb3532b90c757">More...</a><br /></td></tr>
<tr class="separator:a20ef0a4fa6050268d88fb3532b90c757"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5187637994473e2fbb7fc484023f307"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html">LogReducer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a></td></tr>
<tr class="memdesc:ad5187637994473e2fbb7fc484023f307"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reducer in this node.  <a href="#ad5187637994473e2fbb7fc484023f307">More...</a><br /></td></tr>
<tr class="separator:ad5187637994473e2fbb7fc484023f307"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dbaf73527e1fe3ee31b33abed6ab27c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html">LogGleanerResource</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">gleaner_resource_</a></td></tr>
<tr class="memdesc:a5dbaf73527e1fe3ee31b33abed6ab27c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Local resources for gleaner, which runs only in the master node.  <a href="#a5dbaf73527e1fe3ee31b33abed6ab27c">More...</a><br /></td></tr>
<tr class="separator:a5dbaf73527e1fe3ee31b33abed6ab27c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a8231d8152b07a15c465c881fa686aea6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::snapshot::SnapshotManagerPimpl::SnapshotManagerPimpl </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac7c2568bf6e872b574c2bfc2aafc7ce5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::snapshot::SnapshotManagerPimpl::SnapshotManagerPimpl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Engine.html">Engine</a> *&#160;</td>
          <td class="paramname"><em>engine</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00207">207</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    : <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>(engine), <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a>(<span class="keyword">nullptr</span>) {}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ad5187637994473e2fbb7fc484023f307"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">foedus::snapshot::SnapshotManagerPimpl::local_reducer_</a></div><div class="ttdeci">LogReducer * local_reducer_</div><div class="ttdoc">Reducer in this node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00353">snapshot_manager_pimpl.hpp:353</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a5d474e7a6b4de127153103f2295cb0fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::drop_volatile_pages </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;&#160;</td>
          <td class="paramname"><em>new_snapshot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>new_root_page_pointers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>. </p>
<p>Drop pointers to volatile pages based on the already-installed snapshot pointers. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00488">488</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="aligned__memory_8cpp_source.html#l00113">foedus::memory::AlignedMemory::alloc()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="page__pool_8hpp_source.html#l00062">foedus::memory::PagePoolOffsetChunk::clear()</a>, <a class="el" href="composer_8cpp_source.html#l00094">foedus::storage::Composer::drop_root_volatile()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00595">drop_volatile_pages_parallel()</a>, <a class="el" href="stop__watch_8hpp_source.html#l00048">foedus::debugging::StopWatch::elapsed_ms()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00168">foedus::memory::AlignedMemory::get_block()</a>, <a class="el" href="engine_8cpp_source.html#l00074">foedus::Engine::get_soc_count()</a>, <a class="el" href="engine_8cpp_source.html#l00061">foedus::Engine::get_xct_manager()</a>, <a class="el" href="epoch_8hpp_source.html#l00096">foedus::Epoch::is_valid()</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00083">foedus::memory::AlignedMemory::kNumaAllocOnnode</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="composer_8hpp_source.html#l00200">foedus::storage::Composer::DropResult::max_observed_</a>, <a class="el" href="snapshot_8hpp_source.html#l00058">foedus::snapshot::Snapshot::max_storage_id_</a>, <a class="el" href="xct__manager_8cpp_source.html#l00033">foedus::xct::XctManager::pause_accepting_xct()</a>, <a class="el" href="aligned__memory_8cpp_source.html#l00235">foedus::memory::AlignedMemory::release_block()</a>, <a class="el" href="xct__manager_8cpp_source.html#l00034">foedus::xct::XctManager::resume_accepting_xct()</a>, <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>, and <a class="el" href="snapshot_8hpp_source.html#l00055">foedus::snapshot::Snapshot::valid_until_epoch_</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>.</p>
<div class="fragment"><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                                                                      {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">// To speed up, we parallelize this process per node, and use the same partitioning scheme.</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Dropping volatile pointers...&quot;</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="comment">// initializations done.</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">// below, we should release the resources before exiting. So, let&#39;s not just use CHECK_ERROR.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keyword">const</span> uint16_t soc_count = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">get_soc_count</a>();</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">// collect results of pointer dropping for all storages for all nodes.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="comment">// this is just to drop the root page. DropResult[storage_id][node].</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  memory::AlignedMemory result_memory;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  result_memory.alloc(</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keyword">sizeof</span>(storage::Composer::DropResult) * soc_count * (new_snapshot.max_storage_id_ + 2U),</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    1U &lt;&lt; 12,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    0);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  memory::AlignedMemory chunks_memory;  <span class="comment">// only for drop_root</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  chunks_memory.alloc(</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keyword">sizeof</span>(memory::PagePoolOffsetChunk) * soc_count,</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    1U &lt;&lt; 12,</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    0);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// So far, we pause transaction executions during this step to simplify the algorithm.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="comment">// Without this simplification, not only this thread but also normal transaction executions</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="comment">// have to do several complex and expensive checks.</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a48d5e1f7ce2f70161c253f650c75ed95">get_xct_manager</a>()-&gt;<a class="code" href="classfoedus_1_1xct_1_1XctManager.html#a494c96802826b99e62384b72c2252c84">pause_accepting_xct</a>();</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="comment">// It will take a while for individual worker threads to complete the currently running xcts.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="comment">// Just wait for a while to let that happen.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  std::this_thread::sleep_for(std::chrono::milliseconds(100));  <span class="comment">// almost forever in OLTP xcts.</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Paused transaction executions to safely drop volatile pages and waited enough&quot;</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; to let currently running xcts end. Now start replace pointers.&quot;</span>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  debugging::StopWatch stop_watch;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  std::vector&lt; std::thread &gt; threads;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">for</span> (uint16_t node = 0; node &lt; soc_count; ++node) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    threads.emplace_back(</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      &amp;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a26c51902174b692c91aedd15218f01b7">SnapshotManagerPimpl::drop_volatile_pages_parallel</a>,</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keyword">this</span>,</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      new_snapshot,</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      new_root_page_pointers,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      result_memory.get_block(),</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      node);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordflow">for</span> (std::thread&amp; thr : threads) {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    thr.join();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Joined child threads. Now consider dropping root pages&quot;</span>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">// At last, we consider dropping root volatile pages.</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">// usually, this happens only when the root page doesn&#39;t have any volatile pointer.</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">// As an exceptional case, we might drop ALL volatile pages of a storage whose max_observed</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">// is not updated but for some reason dropped_all is false, eg non-matching boundaries.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// even in that case, we can drop all volatile pages safely because this is within pause.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  memory::PagePoolOffsetChunk* dropped_chunks = <span class="keyword">reinterpret_cast&lt;</span>memory::PagePoolOffsetChunk*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    chunks_memory.get_block());</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordflow">for</span> (uint16_t node = 0; node &lt; soc_count; ++node) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    dropped_chunks[node].clear();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  storage::Composer::DropResult* results</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    = <span class="keyword">reinterpret_cast&lt;</span>storage::Composer::DropResult*<span class="keyword">&gt;</span>(result_memory.get_block());</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a> <span class="keywordtype">id</span> = 1; <span class="keywordtype">id</span> &lt;= new_snapshot.max_storage_id_; ++id) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    VLOG(1) &lt;&lt; <span class="stringliteral">&quot;Considering to drop root page of storage-&quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; ...&quot;</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordtype">bool</span> cannot_drop = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">for</span> (uint16_t node = 0; node &lt; soc_count; ++node) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      storage::Composer::DropResult result = results[soc_count * <span class="keywordtype">id</span> + node];</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(result.max_observed_.is_valid());</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(result.max_observed_ &gt;= new_snapshot.valid_until_epoch_);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordflow">if</span> (result.max_observed_ &gt; new_snapshot.valid_until_epoch_) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        cannot_drop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">if</span> (cannot_drop) {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Looks like we can drop ALL volatile pages of storage-&quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;!!!&quot;</span>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">// Still, the specific implementation of the storage might not choose to do so.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">// We call a method in composer.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    uint64_t dropped_count = 0;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    storage::Composer::DropVolatilesArguments args = {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      new_snapshot,</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      0,</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keyword">false</span>,</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      dropped_chunks,</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      &amp;dropped_count};</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    storage::Composer composer(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    composer.drop_root_volatile(args);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;As a result, we dropped &quot;</span> &lt;&lt; dropped_count &lt;&lt; <span class="stringliteral">&quot; pages from storage-&quot;</span> &lt;&lt; id;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a48d5e1f7ce2f70161c253f650c75ed95">get_xct_manager</a>()-&gt;<a class="code" href="classfoedus_1_1xct_1_1XctManager.html#ad1e49dd4bd9a1d87db8bbe2c107d7d98">resume_accepting_xct</a>();</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Total: Dropped volatile pages in &quot;</span> &lt;&lt; stop_watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms.&quot;</span>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  chunks_memory.release_block();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  result_memory.release_block();</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">foedus::memory::AlignedMemory::kNumaAllocOnnode</a></div><div class="ttdoc">numa_alloc_onnode() and numa_free(). </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8hpp_source.html#l00083">aligned_memory.hpp:83</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a26c51902174b692c91aedd15218f01b7"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a26c51902174b692c91aedd15218f01b7">foedus::snapshot::SnapshotManagerPimpl::drop_volatile_pages_parallel</a></div><div class="ttdeci">void drop_volatile_pages_parallel(const Snapshot &amp;new_snapshot, const std::map&lt; storage::StorageId, storage::SnapshotPagePointer &gt; &amp;new_root_page_pointers, void *result_memory, uint16_t parallel_id)</div><div class="ttdoc">subroutine invoked by one thread for one node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00595">snapshot_manager_pimpl.cpp:595</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga595ca7fc4a3011a9704a883a25141e5f"><div class="ttname"><a href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">foedus::storage::StorageId</a></div><div class="ttdeci">uint32_t StorageId</div><div class="ttdoc">Unique ID for storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00055">storage_id.hpp:55</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManager_html_ad1e49dd4bd9a1d87db8bbe2c107d7d98"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManager.html#ad1e49dd4bd9a1d87db8bbe2c107d7d98">foedus::xct::XctManager::resume_accepting_xct</a></div><div class="ttdeci">void resume_accepting_xct()</div><div class="ttdoc">Make sure you call this after pause_accepting_xct(). </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager_8cpp_source.html#l00034">xct_manager.cpp:34</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1XctManager_html_a494c96802826b99e62384b72c2252c84"><div class="ttname"><a href="classfoedus_1_1xct_1_1XctManager.html#a494c96802826b99e62384b72c2252c84">foedus::xct::XctManager::pause_accepting_xct</a></div><div class="ttdeci">void pause_accepting_xct()</div><div class="ttdoc">Pause all begin_xct until you call resume_accepting_xct() </div><div class="ttdef"><b>Definition:</b> <a href="xct__manager_8cpp_source.html#l00033">xct_manager.cpp:33</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_af0ac9dbae9481b295a8492c6d9f6c1d5"><div class="ttname"><a href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">foedus::Engine::get_soc_count</a></div><div class="ttdeci">soc::SocId get_soc_count() const </div><div class="ttdoc">Shorthand for get_options().thread_.group_count_. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00074">engine.cpp:74</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a48d5e1f7ce2f70161c253f650c75ed95"><div class="ttname"><a href="classfoedus_1_1Engine.html#a48d5e1f7ce2f70161c253f650c75ed95">foedus::Engine::get_xct_manager</a></div><div class="ttdeci">xct::XctManager * get_xct_manager() const </div><div class="ttdoc">See Transaction Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00061">engine.cpp:61</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="512,287,725,328"/>
<area shape="rect" id="node13" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="813,68,948,110"/>
<area shape="rect" id="node15" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#a7e011070a4928973c6bbd9b0f0f96935" title="foedus::memory::PagePool\lOffsetChunk::clear" alt="" coords="529,39,708,80"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1Composer.html#af6d90399f471e1461fd4e59b0f3b923f" title="This is additionally called when no partitions observed any new modifications. " alt="" coords="283,1236,461,1278"/>
<area shape="rect" id="node27" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="803,1458,958,1485"/>
<area shape="rect" id="node30" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a26c51902174b692c91aedd15218f01b7" title="subroutine invoked by one thread for one node. " alt="" coords="280,606,464,662"/>
<area shape="rect" id="node31" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="551,104,686,146"/>
<area shape="rect" id="node32" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="512,170,725,211"/>
<area shape="rect" id="node38" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="536,1058,701,1099"/>
<area shape="rect" id="node45" href="classfoedus_1_1memory_1_1AlignedMemory.html#afd955f5f991e28943c72ecff1167c16b" title="Releases the memory block. " alt="" coords="512,1123,725,1164"/>
<area shape="rect" id="node46" href="classfoedus_1_1Engine.html#a48d5e1f7ce2f70161c253f650c75ed95" title="See Transaction Manager. " alt="" coords="305,1447,439,1488"/>
<area shape="rect" id="node47" href="classfoedus_1_1xct_1_1XctManager.html#a494c96802826b99e62384b72c2252c84" title="Pause all begin_xct until you call resume_accepting_xct() " alt="" coords="291,1512,453,1554"/>
<area shape="rect" id="node49" href="classfoedus_1_1xct_1_1XctManager.html#ad1e49dd4bd9a1d87db8bbe2c107d7d98" title="Make sure you call this after pause_accepting_xct(). " alt="" coords="291,1578,453,1619"/>
<area shape="rect" id="node3" href="namespacefoedus_1_1memory.html#ac2422aa4fe378da8a9594901762e17df" title="foedus::memory::alloc_mmap" alt="" coords="1036,345,1229,372"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="1290,396,1430,438"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1memory.html#ae51e4a90f52316ba9dce8ff783f30d84" title="foedus::memory::alloc\l_mmap_1gb_pages" alt="" coords="805,287,956,328"/>
<area shape="rect" id="node7" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="1052,156,1213,198"/>
<area shape="rect" id="node8" href="group__ASSORTED.html#gab3d1892edaa7db4b02029567b7993f37" title="In order to run even on a non&#45;numa machine or a machine with fewer sockets, we allow specifying arbit..." alt="" coords="805,506,956,547"/>
<area shape="rect" id="node9" href="numa_8h.html#a413cadd87796fff247c83d9ad817cc7e" title="numa_available" alt="" coords="1077,454,1188,481"/>
<area shape="rect" id="node11" href="numa_8h.html#aba49c14c68d23dc05d046db02766b928" title="numa_preferred" alt="" coords="825,134,936,161"/>
<area shape="rect" id="node12" href="numa_8h.html#a56f33968932f6550e5e5eb4d1acc67b3" title="numa_set_preferred" alt="" coords="813,236,949,262"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1memory.html#af6145d9296231995c84badafb6a2a0a9" title="Returns if 1GB hugepages were enabled. " alt="" coords="1277,331,1443,372"/>
<area shape="rect" id="node10" href="numa_8h.html#a22585176d6e08c221de8377637bd72a7" title="numa_num_configured\l_nodes" alt="" coords="1057,506,1209,547"/>
<area shape="rect" id="node14" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="1065,68,1200,110"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#a9ee9788f623a51584b4fd7f8ded6103a" title="foedus::storage::array\l::ArrayComposer::drop\l_root_volatile" alt="" coords="542,1189,695,1245"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1hash_1_1HashComposer.html#a4a9dc98b699194503e37e0e6609872ec" title="foedus::storage::hash\l::HashComposer::drop\l_root_volatile" alt="" coords="543,1349,695,1405"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposer.html#aa0cb9d19afa32166a7c128697f291ea2" title="foedus::storage::masstree\l::MasstreeComposer::drop\l_root_volatile" alt="" coords="531,1269,707,1325"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58" title="foedus::storage::array\l::ArrayStorage::get_array\l_metadata" alt="" coords="797,918,965,974"/>
<area shape="rect" id="node19" href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b" title="foedus::storage::Metadata\l::keeps_all_volatile_pages" alt="" coords="794,1392,967,1434"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01" title="Returns the unique name of this storage. " alt="" coords="799,1262,963,1303"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a3a535c4b81884868a2a5ead00428dd77" title="Returns the number of levels. " alt="" coords="795,999,966,1040"/>
<area shape="rect" id="node22" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="815,1327,947,1368"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a9c7bc21358a340d36f3c43a49f774b93" title="foedus::storage::array\l::ArrayPage::is_leaf" alt="" coords="1059,1104,1207,1146"/>
<area shape="rect" id="node24" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca" title="Returns the size of this array. " alt="" coords="781,1196,980,1238"/>
<area shape="rect" id="node25" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#ae6032f608834a39808e26c59aa0e42e2" title="foedus::storage::array\l::ArrayPage::get_leaf\l_record" alt="" coords="807,1065,955,1121"/>
<area shape="rect" id="node26" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#acc05e0b608094e78fa9a7025c08524b5" title="Returns byte size of one record in this array storage without internal overheads. ..." alt="" coords="773,852,988,894"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1Composer.html#a0995635b97031b208127004382947acd" title="Drops volatile pages that have not been modified since the snapshotted epoch. " alt="" coords="529,548,708,590"/>
<area shape="rect" id="node34" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="551,614,686,655"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523" title="Returns the storage of given ID. " alt="" coords="537,679,701,720"/>
<area shape="rect" id="node36" href="classfoedus_1_1debugging_1_1StopWatch.html#acc122593c59aa99c4bed52c0cb8e9a20" title="foedus::debugging::\lStopWatch::elapsed_sec" alt="" coords="535,744,703,786"/>
<area shape="rect" id="node37" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="533,810,704,837"/>
<area shape="rect" id="node39" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6" title="See Memory Manager. " alt="" coords="551,862,686,903"/>
<area shape="rect" id="node40" href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8" title="foedus::memory::EngineMemory\l::get_node_memory" alt="" coords="513,927,724,968"/>
<area shape="rect" id="node41" href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774" title="foedus::memory::NumaNode\lMemoryRef::get_volatile_pool" alt="" coords="523,992,714,1034"/>
<area shape="rect" id="node42" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ac661b8baf462a1e969a8a1c7e619858b" title="foedus::memory::PagePool\lOffsetChunk::empty" alt="" coords="529,352,708,394"/>
<area shape="rect" id="node43" href="classfoedus_1_1memory_1_1PagePool.html#a802171ff0578875748d20b4e9c8c9463" title="Returns the specified number of free pages from the chunk. " alt="" coords="529,418,708,459"/>
<area shape="rect" id="node44" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#affa4e09fc9e251f5cc259de81c23c6e2" title="foedus::memory::PagePool\lOffsetChunk::size" alt="" coords="529,483,708,524"/>
<area shape="rect" id="node48" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a19be4bae2114e48eb5c041c29e991983" title="Pause all begin_xct until you call resume_accepting_xct() " alt="" coords="521,1512,716,1554"/>
<area shape="rect" id="node50" href="classfoedus_1_1xct_1_1XctManagerPimpl.html#a9affae9e06ad2324c5857d0dd686995c" title="Make sure you call this after pause_accepting_xct(). " alt="" coords="521,1578,716,1619"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a5d474e7a6b4de127153103f2295cb0fa_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="280,31,491,87"/>
<area shape="rect" id="node3" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="567,5,721,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="539,71,749,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="797,5,992,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="797,71,992,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a26c51902174b692c91aedd15218f01b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::snapshot::SnapshotManagerPimpl::drop_volatile_pages_parallel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;&#160;</td>
          <td class="paramname"><em>new_snapshot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>new_root_page_pointers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>result_memory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>parallel_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>subroutine invoked by one thread for one node. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00595">595</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="aligned__memory_8cpp_source.html#l00113">foedus::memory::AlignedMemory::alloc()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="page__pool_8hpp_source.html#l00062">foedus::memory::PagePoolOffsetChunk::clear()</a>, <a class="el" href="composer_8cpp_source.html#l00083">foedus::storage::Composer::drop_volatiles()</a>, <a class="el" href="composer_8hpp_source.html#l00202">foedus::storage::Composer::DropResult::dropped_all_</a>, <a class="el" href="stop__watch_8hpp_source.html#l00048">foedus::debugging::StopWatch::elapsed_ms()</a>, <a class="el" href="stop__watch_8hpp_source.html#l00051">foedus::debugging::StopWatch::elapsed_sec()</a>, <a class="el" href="page__pool_8hpp_source.html#l00060">foedus::memory::PagePoolOffsetChunk::empty()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00168">foedus::memory::AlignedMemory::get_block()</a>, <a class="el" href="engine_8cpp_source.html#l00050">foedus::Engine::get_memory_manager()</a>, <a class="el" href="engine__memory_8hpp_source.html#l00076">foedus::memory::EngineMemory::get_node_memory()</a>, <a class="el" href="engine_8cpp_source.html#l00074">foedus::Engine::get_soc_count()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00047">foedus::storage::StorageManager::get_storage()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="numa__node__memory_8hpp_source.html#l00175">foedus::memory::NumaNodeMemoryRef::get_volatile_pool()</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00083">foedus::memory::AlignedMemory::kNumaAllocOnnode</a>, <a class="el" href="composer_8hpp_source.html#l00200">foedus::storage::Composer::DropResult::max_observed_</a>, <a class="el" href="snapshot_8hpp_source.html#l00058">foedus::snapshot::Snapshot::max_storage_id_</a>, <a class="el" href="storage_8hpp_source.html#l00084">foedus::storage::StorageControlBlock::meta_</a>, <a class="el" href="metadata_8hpp_source.html#l00107">foedus::storage::Metadata::name_</a>, <a class="el" href="epoch_8hpp_source.html#l00127">foedus::Epoch::one_more()</a>, <a class="el" href="page__pool_8cpp_source.html#l00134">foedus::memory::PagePool::release()</a>, <a class="el" href="aligned__memory_8cpp_source.html#l00235">foedus::memory::AlignedMemory::release_block()</a>, <a class="el" href="storage_8hpp_source.html#l00082">foedus::storage::StorageControlBlock::root_page_pointer_</a>, <a class="el" href="metadata_8hpp_source.html#l00112">foedus::storage::Metadata::root_snapshot_page_id_</a>, <a class="el" href="page__pool_8hpp_source.html#l00059">foedus::memory::PagePoolOffsetChunk::size()</a>, <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>, and <a class="el" href="snapshot_8hpp_source.html#l00055">foedus::snapshot::Snapshot::valid_until_epoch_</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00488">drop_volatile_pages()</a>.</p>
<div class="fragment"><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                        {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">// this thread is pinned on its own socket. We use the same partitioning scheme as reducer</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="comment">// so that this method mostly hits local pages</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  thread::NumaThreadScope numa_scope(parallel_id);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">const</span> uint16_t soc_count = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">get_soc_count</a>();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  storage::Composer::DropResult* results  <span class="comment">// DropResult[storage_id][node]</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    = <span class="keyword">reinterpret_cast&lt;</span>storage::Composer::DropResult*<span class="keyword">&gt;</span>(result_memory);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="comment">// To avoid invoking volatile pool for every dropped page, we cache them in chunks</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  memory::AlignedMemory chunks_memory;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  chunks_memory.alloc(</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keyword">sizeof</span>(memory::PagePoolOffsetChunk) * soc_count,</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    1U &lt;&lt; 12,</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    parallel_id);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  memory::PagePoolOffsetChunk* dropped_chunks = <span class="keyword">reinterpret_cast&lt;</span>memory::PagePoolOffsetChunk*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    chunks_memory.get_block());</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordflow">for</span> (uint16_t node = 0; node &lt; soc_count; ++node) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    dropped_chunks[node].clear();</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Thread-&quot;</span> &lt;&lt; parallel_id &lt;&lt; <span class="stringliteral">&quot; started dropping volatile pages.&quot;</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  uint64_t dropped_count_total = 0;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  debugging::StopWatch stop_watch;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a> <span class="keywordtype">id</span> = 1; <span class="keywordtype">id</span> &lt;= new_snapshot.max_storage_id_; ++id) {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; it = new_root_page_pointers.find(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">if</span> (it != new_root_page_pointers.end()) {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Dropping pointers for storage-&quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; ...&quot;</span>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> new_root_page_pointer = it-&gt;second;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_root_page_pointer != 0);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      storage::Composer composer(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      uint64_t dropped_count = 0;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      storage::Composer::DropVolatilesArguments args = {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        new_snapshot,</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        parallel_id,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keyword">true</span>,</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        dropped_chunks,</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        &amp;dropped_count};</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      debugging::StopWatch watch;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      storage::Composer::DropResult result = composer.drop_volatiles(args);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523">get_storage</a>(<span class="keywordtype">id</span>)-&gt;<a class="code" href="structfoedus_1_1storage_1_1StorageControlBlock.html#a24d5e6ead47bd1d330089c264575a909">root_page_pointer_</a>.</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        snapshot_pointer_ == new_root_page_pointer);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523">get_storage</a>(<span class="keywordtype">id</span>)-&gt;<a class="code" href="structfoedus_1_1storage_1_1StorageControlBlock.html#ae20f48002ac04f92b32085ee52a56ed0">meta_</a>.<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">root_snapshot_page_id_</a></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        == new_root_page_pointer);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      dropped_count_total += dropped_count;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      watch.stop();</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Thread-&quot;</span> &lt;&lt; parallel_id &lt;&lt; <span class="stringliteral">&quot; drop_volatiles for storage-&quot;</span> &lt;&lt; <span class="keywordtype">id</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523">get_storage</a>(<span class="keywordtype">id</span>)-&gt;<a class="code" href="structfoedus_1_1storage_1_1StorageControlBlock.html#ae20f48002ac04f92b32085ee52a56ed0">meta_</a>.<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#a0db8672e0efd0ed879c109dbef07c418">name_</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; took &quot;</span> &lt;&lt; watch.elapsed_sec() &lt;&lt; <span class="stringliteral">&quot;s. dropped_count=&quot;</span> &lt;&lt; dropped_count</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;. result =&quot;</span> &lt;&lt; result;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      results[soc_count * <span class="keywordtype">id</span> + parallel_id] = result;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Thread-&quot;</span> &lt;&lt; parallel_id &lt;&lt; <span class="stringliteral">&quot; storage-&quot;</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; wasn&#39;t changed no drop pointers&quot;</span>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      results[soc_count * <span class="keywordtype">id</span> + parallel_id].max_observed_</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        = new_snapshot.valid_until_epoch_.one_more();  <span class="comment">// do NOT drop root page in this case.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      results[soc_count * <span class="keywordtype">id</span> + parallel_id].dropped_all_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Thread-&quot;</span> &lt;&lt; parallel_id &lt;&lt; <span class="stringliteral">&quot; dropped &quot;</span> &lt;&lt; dropped_count_total</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; volatile pointers in &quot;</span> &lt;&lt; stop_watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms.&quot;</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keywordflow">for</span> (uint16_t node = 0; node &lt; soc_count; ++node) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    memory::PagePoolOffsetChunk* chunk = dropped_chunks + node;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    memory::PagePool* volatile_pool</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">get_memory_manager</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8">get_node_memory</a>(node)-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774">get_volatile_pool</a>();</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">if</span> (!chunk-&gt;empty()) {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      volatile_pool-&gt;<a class="code" href="classfoedus_1_1memory_1_1PagePool.html#a802171ff0578875748d20b4e9c8c9463">release</a>(chunk-&gt;size(), chunk);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(chunk-&gt;empty());</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  chunks_memory.release_block();</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageControlBlock_html_ae20f48002ac04f92b32085ee52a56ed0"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageControlBlock.html#ae20f48002ac04f92b32085ee52a56ed0">foedus::storage::StorageControlBlock::meta_</a></div><div class="ttdeci">Metadata meta_</div><div class="ttdoc">common part of the metadata. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00084">storage.hpp:84</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">foedus::memory::AlignedMemory::kNumaAllocOnnode</a></div><div class="ttdoc">numa_alloc_onnode() and numa_free(). </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8hpp_source.html#l00083">aligned_memory.hpp:83</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga595ca7fc4a3011a9704a883a25141e5f"><div class="ttname"><a href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">foedus::storage::StorageId</a></div><div class="ttdeci">uint32_t StorageId</div><div class="ttdoc">Unique ID for storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00055">storage_id.hpp:55</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageControlBlock_html_a24d5e6ead47bd1d330089c264575a909"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageControlBlock.html#a24d5e6ead47bd1d330089c264575a909">foedus::storage::StorageControlBlock::root_page_pointer_</a></div><div class="ttdeci">DualPagePointer root_page_pointer_</div><div class="ttdoc">Points to the root page (or something equivalent). </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00082">storage.hpp:82</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_af0ac9dbae9481b295a8492c6d9f6c1d5"><div class="ttname"><a href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">foedus::Engine::get_soc_count</a></div><div class="ttdeci">soc::SocId get_soc_count() const </div><div class="ttdoc">Shorthand for get_options().thread_.group_count_. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00074">engine.cpp:74</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga629d4b8103bfb83ef9c11b842a4fd398"><div class="ttname"><a href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">foedus::storage::SnapshotPagePointer</a></div><div class="ttdeci">uint64_t SnapshotPagePointer</div><div class="ttdoc">Page ID of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00079">storage_id.hpp:79</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1EngineMemory_html_a8bf8832e627cd97fe92c60d38ed96ac8"><div class="ttname"><a href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8">foedus::memory::EngineMemory::get_node_memory</a></div><div class="ttdeci">NumaNodeMemoryRef * get_node_memory(foedus::thread::ThreadGroupId group) const </div><div class="ttdef"><b>Definition:</b> <a href="engine__memory_8hpp_source.html#l00076">engine_memory.hpp:76</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Metadata_html_a0db8672e0efd0ed879c109dbef07c418"><div class="ttname"><a href="structfoedus_1_1storage_1_1Metadata.html#a0db8672e0efd0ed879c109dbef07c418">foedus::storage::Metadata::name_</a></div><div class="ttdeci">StorageName name_</div><div class="ttdoc">the unique name of this storage. </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8hpp_source.html#l00107">metadata.hpp:107</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1PagePool_html_a802171ff0578875748d20b4e9c8c9463"><div class="ttname"><a href="classfoedus_1_1memory_1_1PagePool.html#a802171ff0578875748d20b4e9c8c9463">foedus::memory::PagePool::release</a></div><div class="ttdeci">void release(uint32_t desired_release_count, PagePoolOffsetChunk *chunk)</div><div class="ttdoc">Returns the specified number of free pages from the chunk. </div><div class="ttdef"><b>Definition:</b> <a href="page__pool_8cpp_source.html#l00134">page_pool.cpp:134</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1NumaNodeMemoryRef_html_a70b68580143ce771f5b5b1f9a209f774"><div class="ttname"><a href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774">foedus::memory::NumaNodeMemoryRef::get_volatile_pool</a></div><div class="ttdeci">PagePool * get_volatile_pool()</div><div class="ttdef"><b>Definition:</b> <a href="numa__node__memory_8hpp_source.html#l00175">numa_node_memory.hpp:175</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a62a5d09952fe340dc03da8460f200523"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523">foedus::storage::StorageManager::get_storage</a></div><div class="ttdeci">StorageControlBlock * get_storage(StorageId id)</div><div class="ttdoc">Returns the storage of given ID. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager_8cpp_source.html#l00047">storage_manager.cpp:47</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a02ed05009c7baa8d75e04f202a86b2c6"><div class="ttname"><a href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">foedus::Engine::get_memory_manager</a></div><div class="ttdeci">memory::EngineMemory * get_memory_manager() const </div><div class="ttdoc">See Memory Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00050">engine.cpp:50</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Metadata_html_ab9d6a766410a36959158818af739df34"><div class="ttname"><a href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">foedus::storage::Metadata::root_snapshot_page_id_</a></div><div class="ttdeci">SnapshotPagePointer root_snapshot_page_id_</div><div class="ttdoc">Pointer to a snapshotted page this storage is rooted at. </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8hpp_source.html#l00112">metadata.hpp:112</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="237,250,451,291"/>
<area shape="rect" id="node13" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="523,451,657,492"/>
<area shape="rect" id="node15" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#a7e011070a4928973c6bbd9b0f0f96935" title="foedus::memory::PagePool\lOffsetChunk::clear" alt="" coords="255,1368,433,1410"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1Composer.html#a0995635b97031b208127004382947acd" title="Drops volatile pages that have not been modified since the snapshotted epoch. " alt="" coords="255,1434,433,1475"/>
<area shape="rect" id="node34" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6" title="See Memory Manager. " alt="" coords="767,1539,902,1580"/>
<area shape="rect" id="node35" href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8" title="foedus::memory::EngineMemory\l::get_node_memory" alt="" coords="729,1604,940,1646"/>
<area shape="rect" id="node36" href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774" title="foedus::memory::NumaNode\lMemoryRef::get_volatile_pool" alt="" coords="739,1670,930,1711"/>
<area shape="rect" id="node38" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="261,1699,427,1740"/>
<area shape="rect" id="node39" href="classfoedus_1_1debugging_1_1StopWatch.html#acc122593c59aa99c4bed52c0cb8e9a20" title="foedus::debugging::\lStopWatch::elapsed_sec" alt="" coords="260,1764,428,1806"/>
<area shape="rect" id="node40" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#ac661b8baf462a1e969a8a1c7e619858b" title="foedus::memory::PagePool\lOffsetChunk::empty" alt="" coords="255,1830,433,1871"/>
<area shape="rect" id="node41" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="237,1895,451,1936"/>
<area shape="rect" id="node42" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="277,1960,411,2002"/>
<area shape="rect" id="node43" href="classfoedus_1_1storage_1_1StorageManager.html#a62a5d09952fe340dc03da8460f200523" title="Returns the storage of given ID. " alt="" coords="262,2026,426,2067"/>
<area shape="rect" id="node45" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="277,2091,411,2132"/>
<area shape="rect" id="node46" href="classfoedus_1_1Epoch.html#a786afd92afdc87b54dfa11ef093f06f3" title="foedus::Epoch::one_more" alt="" coords="259,2157,429,2184"/>
<area shape="rect" id="node47" href="classfoedus_1_1memory_1_1PagePool.html#a802171ff0578875748d20b4e9c8c9463" title="Returns the specified number of free pages from the chunk. " alt="" coords="255,2208,433,2250"/>
<area shape="rect" id="node49" href="classfoedus_1_1memory_1_1AlignedMemory.html#afd955f5f991e28943c72ecff1167c16b" title="Releases the memory block. " alt="" coords="237,2274,451,2315"/>
<area shape="rect" id="node50" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#affa4e09fc9e251f5cc259de81c23c6e2" title="foedus::memory::PagePool\lOffsetChunk::size" alt="" coords="255,2339,433,2380"/>
<area shape="rect" id="node3" href="namespacefoedus_1_1memory.html#ac2422aa4fe378da8a9594901762e17df" title="foedus::memory::alloc_mmap" alt="" coords="738,181,931,208"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="1001,58,1141,99"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1memory.html#ae51e4a90f52316ba9dce8ff783f30d84" title="foedus::memory::alloc\l_mmap_1gb_pages" alt="" coords="515,334,665,375"/>
<area shape="rect" id="node7" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="754,386,915,427"/>
<area shape="rect" id="node8" href="group__ASSORTED.html#gab3d1892edaa7db4b02029567b7993f37" title="In order to run even on a non&#45;numa machine or a machine with fewer sockets, we allow specifying arbit..." alt="" coords="515,64,665,106"/>
<area shape="rect" id="node9" href="numa_8h.html#a413cadd87796fff247c83d9ad817cc7e" title="numa_available" alt="" coords="779,130,890,157"/>
<area shape="rect" id="node11" href="numa_8h.html#aba49c14c68d23dc05d046db02766b928" title="numa_preferred" alt="" coords="535,232,645,258"/>
<area shape="rect" id="node12" href="numa_8h.html#a56f33968932f6550e5e5eb4d1acc67b3" title="numa_set_preferred" alt="" coords="522,282,658,309"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1memory.html#af6145d9296231995c84badafb6a2a0a9" title="Returns if 1GB hugepages were enabled. " alt="" coords="988,174,1153,215"/>
<area shape="rect" id="node10" href="numa_8h.html#a22585176d6e08c221de8377637bd72a7" title="numa_num_configured\l_nodes" alt="" coords="759,64,911,106"/>
<area shape="rect" id="node14" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="767,451,902,492"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#abea76692cff38e66aa4328401422488a" title="drop_volatiles and related methods " alt="" coords="513,1217,667,1273"/>
<area shape="rect" id="node27" href="classfoedus_1_1storage_1_1hash_1_1HashComposer.html#a86416af851cf44112fbc0ea9c519c9b9" title="drop_volatiles and related methods " alt="" coords="514,904,666,960"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1sequential_1_1SequentialComposer.html#a93883e6731ee4a8f2efc4cf7cec2560f" title="foedus::storage::sequential\l::SequentialComposer::drop\l_volatiles" alt="" coords="499,1466,681,1522"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeComposer.html#ad25781d742feeced13ed8b047b485a3e" title="drop_volatiles and related methods " alt="" coords="502,1386,678,1442"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58" title="foedus::storage::array\l::ArrayStorage::get_array\l_metadata" alt="" coords="751,1328,919,1384"/>
<area shape="rect" id="node19" href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b" title="foedus::storage::Metadata\l::keeps_all_volatile_pages" alt="" coords="748,1050,921,1091"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01" title="Returns the unique name of this storage. " alt="" coords="753,1115,917,1156"/>
<area shape="rect" id="node21" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="769,1408,901,1450"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a9c7bc21358a340d36f3c43a49f774b93" title="foedus::storage::array\l::ArrayPage::is_leaf" alt="" coords="761,1262,909,1303"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a53643894d607ee034359b2a4f77f0d89" title="foedus::storage::array\l::ArrayPage::get_interior\l_record" alt="" coords="753,1181,916,1237"/>
<area shape="rect" id="node24" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="754,984,915,1026"/>
<area shape="rect" id="node25" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="741,904,929,960"/>
<area shape="rect" id="node26" href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html#a0cac5a92e42765bafd1fd54ca3200080" title="foedus::storage::Composer\l::DropResult::combine" alt="" coords="745,1474,924,1515"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a47a258c2edd9e4d3b3b4a5b472a07d62" title="foedus::storage::hash\l::HashStorage::get_hash\l_metadata" alt="" coords="751,597,918,653"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a0f94a4a418776e5ac253b6dcccda8cc6" title="foedus::storage::hash\l::HashStorage::get_root\l_children" alt="" coords="755,677,915,733"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f" title="foedus::storage::hash\l::HashIntermediatePage\l::get_level" alt="" coords="754,757,915,813"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1hash_1_1HashStorage.html#a37d93cdda67dd88454e0237f8a511995" title="foedus::storage::hash\l::HashStorage::get_levels" alt="" coords="749,838,920,879"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a9027ebbc2ee535519916906978347be9" title="foedus::storage::hash\l::HashIntermediatePage\l::get_pointer" alt="" coords="754,517,915,573"/>
<area shape="rect" id="node44" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#aea8861d6bf6c13c0df6d0c9777cdaa99" title="foedus::storage::Storage\lManagerPimpl::get_storage" alt="" coords="499,2026,681,2067"/>
<area shape="rect" id="node48" href="classfoedus_1_1memory_1_1PagePoolPimpl.html#a13d785355359fd936c2b3863d296ba2c" title="foedus::memory::PagePool\lPimpl::release" alt="" coords="501,2208,679,2250"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a26c51902174b692c91aedd15218f01b7_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="237,39,464,80"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="512,31,723,87"/>
<area shape="rect" id="node4" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="799,5,953,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="771,71,981,112"/>
<area shape="rect" id="node5" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1029,5,1224,47"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1029,71,1224,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a058c0e139d36b76aaeb1e8b9a62dd600"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structfoedus_1_1snapshot_1_1SnapshotOptions.html">SnapshotOptions</a> &amp; foedus::snapshot::SnapshotManagerPimpl::get_option </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>shorthand for engine_-&gt;get_options().snapshot_. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00057">57</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="engine_8cpp_source.html#l00039">foedus::Engine::get_options()</a>, and <a class="el" href="engine__options_8hpp_source.html#l00143">foedus::EngineOptions::snapshot_</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00480">get_snapshot_metadata_file_path()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00401">snapshot_metadata()</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                                              {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#ac8febbe3a3d3015c9b93cc1afb8154c1">snapshot_</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a6546930099132529543c320327367ef1"><div class="ttname"><a href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">foedus::Engine::get_options</a></div><div class="ttdeci">const EngineOptions &amp; get_options() const </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00039">engine.cpp:39</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_ac8febbe3a3d3015c9b93cc1afb8154c1"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#ac8febbe3a3d3015c9b93cc1afb8154c1">foedus::EngineOptions::snapshot_</a></div><div class="ttdeci">snapshot::SnapshotOptions snapshot_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00143">engine_options.hpp:143</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="237,5,372,47"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a058c0e139d36b76aaeb1e8b9a62dd600_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0" title="each snapshot has a snapshot&#45;metadata file &quot;snapshot_metadata_&lt;SNAPSHOT_ID&gt;.xml&quot; in first node&#39;s firs..." alt="" coords="237,28,428,84"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4ae6b016213cb70bb6e5df636b24d129" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="483,85,667,141"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="981,158,1192,199"/>
<area shape="rect" id="node9" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a12f213f8bc7b46e75428a7624999c3fd" title="foedus::snapshot::Snapshot\lManagerPimpl::read_snapshot\l_metadata" alt="" coords="476,5,675,61"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="723,85,933,141"/>
<area shape="rect" id="node5" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="1009,93,1164,134"/>
<area shape="rect" id="node6" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1240,93,1435,134"/>
<area shape="rect" id="node8" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1240,158,1435,199"/>
<area shape="rect" id="node10" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#a4508beef5e0c55a8db38b95f42c41fad" title="Read the snapshot metadata file that contains storages as of the snapshot. " alt="" coords="736,5,920,61"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a49864b0bae19e6c2fe61a2422d1650af" title="foedus::storage::Storage\lManagerPimpl::initialize\l_read_latest_snapshot" alt="" coords="1005,5,1169,61"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#ad89ca2bb2619e01c3b13d65302a3d7c9" title="foedus::storage::Storage\lManagerPimpl::initialize_once" alt="" coords="1240,13,1435,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4304c74f47b7ec19d5e126dd161ca664"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> foedus::snapshot::SnapshotManagerPimpl::get_previous_snapshot_id </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00218">218</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00140">foedus::snapshot::SnapshotManagerControlBlock::get_previous_snapshot_id()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager_8cpp_source.html#l00039">foedus::snapshot::SnapshotManager::get_previous_snapshot_id()</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a136e4d148ec15c2d4e1af49a381e3dc5">get_previous_snapshot_id</a>(); }</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a136e4d148ec15c2d4e1af49a381e3dc5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a136e4d148ec15c2d4e1af49a381e3dc5">foedus::snapshot::SnapshotManagerControlBlock::get_previous_snapshot_id</a></div><div class="ttdeci">SnapshotId get_previous_snapshot_id() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00140">snapshot_manager_pimpl.hpp:140</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a136e4d148ec15c2d4e1af49a381e3dc5" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_previous_snapshot_id" alt="" coords="239,5,423,61"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4304c74f47b7ec19d5e126dd161ca664_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#a2c35663dd056a2bfd5f97c002dbabdaa" title="Returns the most recent snapshot&#39;s ID. " alt="" coords="239,13,468,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a307426b2bbb68497d5ab4c75ceaddd31"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> foedus::snapshot::SnapshotManagerPimpl::get_previous_snapshot_id_weak </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00219">219</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00141">foedus::snapshot::SnapshotManagerControlBlock::get_previous_snapshot_id_weak()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager_8cpp_source.html#l00043">foedus::snapshot::SnapshotManager::get_previous_snapshot_id_weak()</a>.</p>
<div class="fragment"><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                                    {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a6a2fe431cb5f1ecda92cfa3a3f206491">get_previous_snapshot_id_weak</a>();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  }</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a6a2fe431cb5f1ecda92cfa3a3f206491"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a6a2fe431cb5f1ecda92cfa3a3f206491">foedus::snapshot::SnapshotManagerControlBlock::get_previous_snapshot_id_weak</a></div><div class="ttdeci">SnapshotId get_previous_snapshot_id_weak() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00141">snapshot_manager_pimpl.hpp:141</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a6a2fe431cb5f1ecda92cfa3a3f206491" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_previous_snapshot_id_weak" alt="" coords="239,5,429,61"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a307426b2bbb68497d5ab4c75ceaddd31_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#aff08b1c4ebbb6b14ad8b22996674e47d" title="Non&#45;atomic version. " alt="" coords="239,5,451,61"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2f1c4ffd479bb976c32d4ddb38517a3b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> foedus::snapshot::SnapshotManagerPimpl::get_snapshot_epoch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00215">215</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00136">foedus::snapshot::SnapshotManagerControlBlock::get_snapshot_epoch()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager_8cpp_source.html#l00034">foedus::snapshot::SnapshotManager::get_snapshot_epoch()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00277">trigger_snapshot_immediate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af87a96cd77347014fdd6acffac91d9f5">get_snapshot_epoch</a>(); }</div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af87a96cd77347014fdd6acffac91d9f5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af87a96cd77347014fdd6acffac91d9f5">foedus::snapshot::SnapshotManagerControlBlock::get_snapshot_epoch</a></div><div class="ttdeci">Epoch get_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00136">snapshot_manager_pimpl.hpp:136</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af87a96cd77347014fdd6acffac91d9f5" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_snapshot_epoch" alt="" coords="287,5,471,61"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a2f1c4ffd479bb976c32d4ddb38517a3b_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#a656febc5d2d6eecd25165b5bbd5fe3cb" title="Returns the most recently snapshot&#45;ed epoch, all logs upto this epoch is safe to delete. " alt="" coords="292,5,492,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="545,108,756,149"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="287,71,497,127"/>
<area shape="rect" id="node8" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4496237075c2f411bb548e1bec7ca06b" title="foedus::snapshot::Snapshot\lManagerPimpl::trigger_snapshot\l_immediate" alt="" coords="287,202,497,258"/>
<area shape="rect" id="node3" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="573,24,728,65"/>
<area shape="rect" id="node4" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="804,24,999,65"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="804,108,999,149"/>
<area shape="rect" id="node9" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#ad0ca7bd80adde3e30e439d6902d9b299" title="Immediately take a snapshot. " alt="" coords="559,202,743,258"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaf69db8a860cc752f39c69940b9f3d6e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a> foedus::snapshot::SnapshotManagerPimpl::get_snapshot_epoch_weak </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00216">216</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00137">foedus::snapshot::SnapshotManagerControlBlock::get_snapshot_epoch_weak()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager_8cpp_source.html#l00035">foedus::snapshot::SnapshotManager::get_snapshot_epoch_weak()</a>.</p>
<div class="fragment"><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a647ddbcc796ffa43a7567ec4a368383c">get_snapshot_epoch_weak</a>(); }</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a647ddbcc796ffa43a7567ec4a368383c"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a647ddbcc796ffa43a7567ec4a368383c">foedus::snapshot::SnapshotManagerControlBlock::get_snapshot_epoch_weak</a></div><div class="ttdeci">Epoch get_snapshot_epoch_weak() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00137">snapshot_manager_pimpl.hpp:137</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a647ddbcc796ffa43a7567ec4a368383c" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_snapshot_epoch_weak" alt="" coords="244,5,428,61"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aaf69db8a860cc752f39c69940b9f3d6e_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#a63ce4010488b4b54fa78ab523e660bd5" title="Non&#45;atomic version. " alt="" coords="244,13,481,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7cb397e7c8042e460f5f0e36d939b3e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1fs_1_1Path.html">fs::Path</a> foedus::snapshot::SnapshotManagerPimpl::get_snapshot_metadata_file_path </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a>&#160;</td>
          <td class="paramname"><em>snapshot_id</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>each snapshot has a snapshot-metadata file "snapshot_metadata_&lt;SNAPSHOT_ID&gt;.xml" in first node's first partition folder. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00480">480</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00057">get_option()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00453">read_snapshot_metadata()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00401">snapshot_metadata()</a>.</p>
<div class="fragment"><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                                                                                         {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  fs::Path folder(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600">get_option</a>().get_primary_folder_path());</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  fs::Path file(folder);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  file /= std::string(<span class="stringliteral">&quot;snapshot_metadata_&quot;</span>)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    + std::to_string(snapshot_id) + std::string(<span class="stringliteral">&quot;.xml&quot;</span>);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">return</span> file;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a058c0e139d36b76aaeb1e8b9a62dd600"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600">foedus::snapshot::SnapshotManagerPimpl::get_option</a></div><div class="ttdeci">const SnapshotOptions &amp; get_option() const </div><div class="ttdoc">shorthand for engine_->get_options().snapshot_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00057">snapshot_manager_pimpl.cpp:57</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600" title="shorthand for engine_&#45;&gt;get_options().snapshot_. " alt="" coords="244,13,428,54"/>
<area shape="rect" id="node3" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="476,13,611,54"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a7cb397e7c8042e460f5f0e36d939b3e0_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a12f213f8bc7b46e75428a7624999c3fd" title="foedus::snapshot::Snapshot\lManagerPimpl::read_snapshot\l_metadata" alt="" coords="244,5,443,61"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4ae6b016213cb70bb6e5df636b24d129" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="251,85,435,141"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#a4508beef5e0c55a8db38b95f42c41fad" title="Read the snapshot metadata file that contains storages as of the snapshot. " alt="" coords="504,5,688,61"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a49864b0bae19e6c2fe61a2422d1650af" title="foedus::storage::Storage\lManagerPimpl::initialize\l_read_latest_snapshot" alt="" coords="773,5,937,61"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#ad89ca2bb2619e01c3b13d65302a3d7c9" title="foedus::storage::Storage\lManagerPimpl::initialize_once" alt="" coords="1008,13,1203,54"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="491,85,701,141"/>
<area shape="rect" id="node8" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="777,89,932,130"/>
<area shape="rect" id="node10" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="749,154,960,195"/>
<area shape="rect" id="node9" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1008,89,1203,130"/>
<area shape="rect" id="node11" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1008,154,1203,195"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a75c5d41290ab6f960725a004622dc3be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::glean_logs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;&#160;</td>
          <td class="paramname"><em>new_snapshot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; *&#160;</td>
          <td class="paramname"><em>new_root_page_pointers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>. </p>
<p>Read log files, distribute them to each partition, and construct snapshot files at each partition. After successful completion, all snapshot files become also durable (<a class="el" href="classfoedus_1_1snapshot_1_1LogGleaner.html" title="A log-gleaner, which constructs a new set of snapshot files during snapshotting. ">LogGleaner</a>'s <a class="el" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb" title="Typical implementation of Initializable::uninitialize() that provides uninitialize-once semantics...">uninitialize()</a> makes it sure). Thus, now we can start installing pointers to the new snapshot file pages. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00386">386</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="log__gleaner__impl_8cpp_source.html#l00148">foedus::snapshot::LogGleaner::execute()</a>, <a class="el" href="log__gleaner__impl_8hpp_source.html#l00119">foedus::snapshot::LogGleaner::get_new_root_page_pointers()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00356">gleaner_resource_</a>, and <a class="el" href="error__stack_8hpp_source.html#l00385">foedus::ErrorStack::is_error()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                                                                {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">// Log gleaner is an object allocated/deallocated per snapshotting.</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">// Gleaner runs on this thread (snapshot_thread_)</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  LogGleaner gleaner(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>, &amp;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">gleaner_resource_</a>, new_snapshot);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  ErrorStack result = gleaner.execute();</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">if</span> (result.is_error()) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Log Gleaner encountered either an error or early termination request&quot;</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="comment">// the output is list of pointers to new root pages</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  *new_root_page_pointers = gleaner.get_new_root_page_pointers();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a5dbaf73527e1fe3ee31b33abed6ab27c"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">foedus::snapshot::SnapshotManagerPimpl::gleaner_resource_</a></div><div class="ttdeci">LogGleanerResource gleaner_resource_</div><div class="ttdoc">Local resources for gleaner, which runs only in the master node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00356">snapshot_manager_pimpl.hpp:356</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1LogGleaner.html#a617c3de45c34c6533c7f3e82216557f4" title="Main routine of log gleaner. " alt="" coords="237,283,432,324"/>
<area shape="rect" id="node15" href="classfoedus_1_1snapshot_1_1LogGleaner.html#a1629807dcb35f0174fa6ad6e247eda8f" title="Returns pointers to new root pages constructed at the end of gleaning. " alt="" coords="237,348,432,389"/>
<area shape="rect" id="node16" href="classfoedus_1_1ErrorStack.html#a9c7b3a8b3806ff623c7fb4a9db5cbeec" title="Returns if this return code is not kErrorCodeOk. " alt="" coords="269,413,400,455"/>
<area shape="rect" id="node3" href="classfoedus_1_1debugging_1_1StopWatch.html#acc122593c59aa99c4bed52c0cb8e9a20" title="foedus::debugging::\lStopWatch::elapsed_sec" alt="" coords="493,5,661,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb" title="foedus::soc::SharedMemory\lRepo::get_global_memory\l_anchors" alt="" coords="485,71,670,127"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c" title="Returns the shared memories maintained across SOCs. " alt="" coords="487,152,667,193"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1LogGleanerRef.html#a429b6bdd5e14d8ce0ad71aaf44d25f93" title="foedus::snapshot::LogGleaner\lRef::get_snapshot_id" alt="" coords="480,217,675,259"/>
<area shape="rect" id="node8" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e" title="See SOC and IPC. " alt="" coords="510,283,645,324"/>
<area shape="rect" id="node9" href="classfoedus_1_1snapshot_1_1LogGleanerRef.html#a10961d61eb650f91fa737270dd690a0b" title="foedus::snapshot::LogGleaner\lRef::is_all_completed" alt="" coords="480,348,675,389"/>
<area shape="rect" id="node10" href="classfoedus_1_1snapshot_1_1LogGleanerRef.html#ae06d65ba38a5838c873c3b9b788905f3" title="foedus::snapshot::LogGleaner\lRef::is_all_exitted" alt="" coords="480,413,675,455"/>
<area shape="rect" id="node11" href="classfoedus_1_1snapshot_1_1LogGleanerRef.html#ac5b28bcfdc09bd7fe48cd7dd1e687fd1" title="foedus::snapshot::LogGleaner\lRef::is_error" alt="" coords="480,479,675,520"/>
<area shape="rect" id="node12" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="510,544,645,585"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1LogGleanerRef.html#aa21d824a0cd1489c832ed6d6b7105331" title="foedus::snapshot::LogGleaner\lRef::get_cur_snapshot" alt="" coords="723,217,917,259"/>
<area shape="rect" id="node13" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="739,511,901,552"/>
<area shape="rect" id="node14" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="753,576,887,617"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a75c5d41290ab6f960725a004622dc3be_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="237,31,448,87"/>
<area shape="rect" id="node3" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="524,5,679,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="496,71,707,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="755,5,949,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="755,71,949,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a64e3c7594b7d7d0d5f8a144bd802d910"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::snapshot::SnapshotManagerPimpl::handle_snapshot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main routine for snapshot_thread_ in master engine. </p>
<p>This method keeps taking snapshot periodically. When there are no logs in all the private buffers for a while, it goes into sleep. This method exits when this object's <a class="el" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb" title="Typical implementation of Initializable::uninitialize() that provides uninitialize-once semantics...">uninitialize()</a> is called. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">191</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="log__manager_8cpp_source.html#l00036">foedus::log::LogManager::get_durable_global_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00057">get_option()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00144">foedus::snapshot::SnapshotManagerControlBlock::get_requested_snapshot_epoch()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00215">get_snapshot_epoch()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>, <a class="el" href="error__stack_8hpp_source.html#l00385">foedus::ErrorStack::is_error()</a>, <a class="el" href="engine_8cpp_source.html#l00063">foedus::Engine::is_initialized()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00250">is_stop_requested()</a>, <a class="el" href="epoch_8hpp_source.html#l00096">foedus::Epoch::is_valid()</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00046">foedus::assorted::memory_fence_acquire()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00348">previous_snapshot_time_</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00181">sleep_a_while()</a>, and <a class="el" href="assorted__func_8hpp_source.html#l00256">SPINLOCK_WHILE</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                           {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot daemon started&quot;</span>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">// The actual snapshotting can&#39;t start until all other modules are initialized.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <a class="code" href="group__ASSORTED.html#gae932f87b60cbd230347151ccf33eed86">SPINLOCK_WHILE</a>(!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>() &amp;&amp; !<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ab775099e113c717528318dfd8642340c">is_initialized</a>()) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot daemon now starts taking snapshot&quot;</span>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab6b7456f65be108f3e51455b485f9a12">sleep_a_while</a>();</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// should we start snapshotting? or keep sleeping?</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordtype">bool</span> triggered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    std::chrono::system_clock::time_point until = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4775dadfb539af5c8d82118735212254">previous_snapshot_time_</a> +</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      std::chrono::milliseconds(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600">get_option</a>().snapshot_interval_milliseconds_);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    Epoch durable_epoch = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa">get_durable_global_epoch</a>();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    Epoch previous_epoch = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (previous_epoch.is_valid() &amp;&amp; previous_epoch == durable_epoch) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Current snapshot is already latest. durable_epoch=&quot;</span> &lt;&lt; durable_epoch;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b">get_requested_snapshot_epoch</a>().<a class="code" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9">is_valid</a>()</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        &amp;&amp; (!previous_epoch.is_valid()</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            || <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b">get_requested_snapshot_epoch</a>() &gt; previous_epoch)) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="comment">// if someone requested immediate snapshot, do it.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      triggered = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Immediate snapshot request detected. snapshotting..&quot;</span>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::chrono::system_clock::now() &gt;= until) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      triggered = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot interval has elapsed. snapshotting..&quot;</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="comment">// TASK(Hideaki): check free pages in page pool and compare with configuration.</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (triggered) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      Snapshot new_snapshot;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      ErrorStack stack = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10">handle_snapshot_triggered</a>(&amp;new_snapshot);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keywordflow">if</span> (stack.is_error()) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Snapshot failed:&quot;</span> &lt;&lt; stack;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      VLOG(1) &lt;&lt; <span class="stringliteral">&quot;Snapshotting not triggered. going to sleep again&quot;</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot daemon ended. &quot;</span>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ab6b7456f65be108f3e51455b485f9a12"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab6b7456f65be108f3e51455b485f9a12">foedus::snapshot::SnapshotManagerPimpl::sleep_a_while</a></div><div class="ttdeci">void sleep_a_while()</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00181">snapshot_manager_pimpl.cpp:181</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a34892c22330eb4e43e9be9754951916b"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b">foedus::snapshot::SnapshotManagerControlBlock::get_requested_snapshot_epoch</a></div><div class="ttdeci">Epoch get_requested_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00144">snapshot_manager_pimpl.hpp:144</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a058c0e139d36b76aaeb1e8b9a62dd600"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600">foedus::snapshot::SnapshotManagerPimpl::get_option</a></div><div class="ttdeci">const SnapshotOptions &amp; get_option() const </div><div class="ttdoc">shorthand for engine_->get_options().snapshot_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00057">snapshot_manager_pimpl.cpp:57</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a905ccf76fe0e076980dc1965f038fe10"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10">foedus::snapshot::SnapshotManagerPimpl::handle_snapshot_triggered</a></div><div class="ttdeci">ErrorStack handle_snapshot_triggered(Snapshot *new_snapshot)</div><div class="ttdoc">handle_snapshot() calls this when it should start snapshotting. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00316">snapshot_manager_pimpl.cpp:316</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gae932f87b60cbd230347151ccf33eed86"><div class="ttname"><a href="group__ASSORTED.html#gae932f87b60cbd230347151ccf33eed86">SPINLOCK_WHILE</a></div><div class="ttdeci">#define SPINLOCK_WHILE(x)</div><div class="ttdoc">A macro to busy-wait (spinlock) with occasional pause. </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8hpp_source.html#l00256">assorted_func.hpp:256</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a2f1c4ffd479bb976c32d4ddb38517a3b"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">foedus::snapshot::SnapshotManagerPimpl::get_snapshot_epoch</a></div><div class="ttdeci">Epoch get_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00215">snapshot_manager_pimpl.hpp:215</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a4775dadfb539af5c8d82118735212254"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4775dadfb539af5c8d82118735212254">foedus::snapshot::SnapshotManagerPimpl::previous_snapshot_time_</a></div><div class="ttdeci">std::chrono::system_clock::time_point previous_snapshot_time_</div><div class="ttdoc">When snapshot_thread_ took snapshot last time. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00348">snapshot_manager_pimpl.hpp:348</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_ab775099e113c717528318dfd8642340c"><div class="ttname"><a href="classfoedus_1_1Engine.html#ab775099e113c717528318dfd8642340c">foedus::Engine::is_initialized</a></div><div class="ttdeci">bool is_initialized() const  override</div><div class="ttdoc">Returns whether the engine is currently running. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00063">engine.cpp:63</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a8228a1a49b7db9b93498a778cb40f8e9"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9">foedus::Epoch::is_valid</a></div><div class="ttdeci">bool is_valid() const </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00096">epoch.hpp:96</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_a3d0f1491c5d6ef15601986b7b1dd6aaa"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa">foedus::log::LogManager::get_durable_global_epoch</a></div><div class="ttdeci">Epoch get_durable_global_epoch() const </div><div class="ttdoc">Returns the durable epoch of the entire engine. </div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00036">log_manager.cpp:36</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a501ce4a1b4b4a847a635ca671c5331de"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">foedus::snapshot::SnapshotManagerPimpl::is_stop_requested</a></div><div class="ttdeci">bool is_stop_requested() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00250">snapshot_manager_pimpl.hpp:250</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaf84f9944a16c5848f69beacdfeedf939"><div class="ttname"><a href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">foedus::assorted::memory_fence_acquire</a></div><div class="ttdeci">void memory_fence_acquire()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_acquire). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00046">atomic_fences.hpp:46</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa" title="Returns the durable epoch of the entire engine. " alt="" coords="549,9,729,51"/>
<area shape="rect" id="node4" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="572,192,707,233"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600" title="shorthand for engine_&#45;&gt;get_options().snapshot_. " alt="" coords="1064,1465,1248,1507"/>
<area shape="rect" id="node7" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_requested_snapshot_epoch" alt="" coords="545,258,733,314"/>
<area shape="rect" id="node8" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b" title="foedus::snapshot::Snapshot\lManagerPimpl::get_snapshot_epoch" alt="" coords="523,75,756,116"/>
<area shape="rect" id="node10" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="264,622,475,678"/>
<area shape="rect" id="node15" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="825,533,980,559"/>
<area shape="rect" id="node22" href="classfoedus_1_1ErrorStack.html#a9c7b3a8b3806ff623c7fb4a9db5cbeec" title="Returns if this return code is not kErrorCodeOk. " alt="" coords="837,200,968,241"/>
<area shape="rect" id="node45" href="classfoedus_1_1Engine.html#ab775099e113c717528318dfd8642340c" title="Returns whether the engine is currently running. " alt="" coords="306,1321,433,1363"/>
<area shape="rect" id="node46" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de" title="foedus::snapshot::Snapshot\lManagerPimpl::is_stop_requested" alt="" coords="530,1947,749,1988"/>
<area shape="rect" id="node47" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="283,1979,456,2020"/>
<area shape="rect" id="node48" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab6b7456f65be108f3e51455b485f9a12" title="foedus::snapshot::Snapshot\lManagerPimpl::sleep_a_while" alt="" coords="272,2044,467,2085"/>
<area shape="rect" id="node3" href="classfoedus_1_1log_1_1LogManagerPimpl.html#a61e44b4b7bb5dfc3d4111bb6bef25ea9" title="foedus::log::LogManagerPimpl\l::get_durable_global_epoch" alt="" coords="804,5,1001,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="1311,1465,1445,1507"/>
<area shape="rect" id="node9" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af87a96cd77347014fdd6acffac91d9f5" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_snapshot_epoch" alt="" coords="811,71,995,127"/>
<area shape="rect" id="node11" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="576,404,703,445"/>
<area shape="rect" id="node12" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="835,649,970,691"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac" title="Returns whether the object has been already initialized or not. " alt="" coords="557,1696,721,1737"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1StorageManager.html#a33c97509f7fffbd7fcced3e34fe16616" title="Returns the largest StorageId that does or did exist. " alt="" coords="534,600,745,641"/>
<area shape="rect" id="node17" href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730" title="Increment SnapshotId. " alt="" coords="546,717,733,743"/>
<area shape="rect" id="node18" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a75c5d41290ab6f960725a004622dc3be" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="547,469,731,511"/>
<area shape="rect" id="node23" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4ae6b016213cb70bb6e5df636b24d129" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="547,1003,731,1059"/>
<area shape="rect" id="node24" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="831,715,974,742"/>
<area shape="rect" id="node37" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a45097869d980cf8fe0ad3313e02c8117" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="547,1603,731,1659"/>
<area shape="rect" id="node42" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="526,535,753,576"/>
<area shape="rect" id="node43" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="553,869,726,911"/>
<area shape="rect" id="node44" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="551,339,728,380"/>
<area shape="rect" id="node14" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="817,1829,989,1871"/>
<area shape="rect" id="node19" href="classfoedus_1_1snapshot_1_1LogGleaner.html#a617c3de45c34c6533c7f3e82216557f4" title="Main routine of log gleaner. " alt="" coords="1059,336,1253,377"/>
<area shape="rect" id="node21" href="classfoedus_1_1snapshot_1_1LogGleaner.html#a1629807dcb35f0174fa6ad6e247eda8f" title="Returns pointers to new root pages constructed at the end of gleaning. " alt="" coords="805,365,1000,407"/>
<area shape="rect" id="node20" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="1311,592,1445,633"/>
<area shape="rect" id="node25" href="classfoedus_1_1storage_1_1StorageManager.html#a1b7056a40786dc501f373380e411a6ae" title="This method is called during snapshotting to clone metadata of all existing storages to the given obj..." alt="" coords="812,817,993,873"/>
<area shape="rect" id="node26" href="structfoedus_1_1storage_1_1StorageControlBlock.html#a7777fa908acfd1da5918e9f0369f8ed7" title="foedus::storage::Storage\lControlBlock::is_valid\l_status" alt="" coords="821,1078,985,1134"/>
<area shape="rect" id="node27" href="structfoedus_1_1snapshot_1_1SnapshotMetadata.html#a69ec31282dee73c4cbea823aa2a06a85" title="foedus::snapshot::Snapshot\lMetadata::get_metadata" alt="" coords="811,1159,995,1200"/>
<area shape="rect" id="node28" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4" title="Returns if the file exists. " alt="" coords="1317,1027,1439,1054"/>
<area shape="rect" id="node29" href="group__FILESYSTEM.html#gaca1dd0a627c83ff76e30603ea67c4816" title="Recursive mkdir (mkdirs). " alt="" coords="1095,1079,1217,1120"/>
<area shape="rect" id="node30" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0" title="each snapshot has a snapshot&#45;metadata file &quot;snapshot_metadata_&lt;SNAPSHOT_ID&gt;.xml&quot; in first node&#39;s firs..." alt="" coords="807,1393,998,1449"/>
<area shape="rect" id="node31" href="structfoedus_1_1externalize_1_1Externalizable.html#af4e4989a732573c1bbd538a3fbfad930" title="Atomically and durably writes out this object to the specified XML file. " alt="" coords="829,947,976,1003"/>
<area shape="rect" id="node33" href="group__FILESYSTEM.html#ga08865450d848cb894243005bdd226d1e" title="Makes the content and metadata of the file durable all the way up to devices. " alt="" coords="1097,907,1215,934"/>
<area shape="rect" id="node34" href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8" title="Returns size of the file. " alt="" coords="836,1275,969,1302"/>
<area shape="rect" id="node35" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="820,584,985,625"/>
<area shape="rect" id="node36" href="classfoedus_1_1debugging_1_1StopWatch.html#a9f35df8dc3c371659227375baa247074" title="Take current time tick. " alt="" coords="835,1327,970,1368"/>
<area shape="rect" id="node32" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="1049,817,1263,859"/>
<area shape="rect" id="node38" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8" title="See Savepoint Manager. " alt="" coords="833,1764,973,1805"/>
<area shape="rect" id="node39" href="classfoedus_1_1savepoint_1_1SavepointManager.html#aaecb5989eaca658a8fbdc7de6c85222c" title="Takes a savepoint just to remember the newly taken snapshot. " alt="" coords="815,1523,990,1579"/>
<area shape="rect" id="node40" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a97ee635381be9e59996fe7b4c9276b0c" title="foedus::savepoint::\lSavepointManager::get\l_latest_snapshot_id" alt="" coords="825,1603,980,1659"/>
<area shape="rect" id="node41" href="classfoedus_1_1savepoint_1_1SavepointManager.html#af2bd4752f20f177d0576f6227feb729b" title="foedus::savepoint::\lSavepointManager::get\l_latest_snapshot_epoch" alt="" coords="821,1683,984,1739"/>
<area shape="rect" id="node49" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="551,2037,728,2079"/>
<area shape="rect" id="node50" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="551,2103,728,2144"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a64e3c7594b7d7d0d5f8a144bd802d910_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="264,5,459,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a84fdf2f4ccf499b44afed05a273739d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::snapshot::SnapshotManagerPimpl::handle_snapshot_child </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main routine for snapshot_thread_ in child engines. </p>
<p>All this does is to launch mappers/reducers threads when asked by master engine. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">239</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="shared__polling_8cpp_source.html#l00105">foedus::soc::SharedPolling::acquire_ticket()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00083">foedus::snapshot::LogGleanerControlBlock::cur_snapshot_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="engine_8cpp_source.html#l00073">foedus::Engine::get_soc_id()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00194">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a>, <a class="el" href="snapshot_8hpp_source.html#l00043">foedus::snapshot::Snapshot::id_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00251">is_gleaning()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00250">is_stop_requested()</a>, <a class="el" href="mapreduce__base__impl_8cpp_source.html#l00045">foedus::snapshot::MapReduceBase::join_thread()</a>, <a class="el" href="mapreduce__base__impl_8cpp_source.html#l00040">foedus::snapshot::MapReduceBase::launch_thread()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00351">local_mappers_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00353">local_reducer_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00191">foedus::snapshot::SnapshotManagerControlBlock::snapshot_children_wakeup_</a>, and <a class="el" href="shared__polling_8cpp_source.html#l00063">foedus::soc::SharedPolling::timedwait()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                                 {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Child snapshot daemon-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9">get_soc_id</a>() &lt;&lt; <span class="stringliteral">&quot; started&quot;</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  thread::NumaThreadScope scope(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9">get_soc_id</a>());</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <a class="code" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> previous_id = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a700b0a6fc11f5ea720d43a69b793e8a5">cur_snapshot_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1Snapshot.html#abc612428c163a6545a60aa61f696ef9d">id_</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      uint64_t demand = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a9b87a7590a0628931ad8a89bf105d638">snapshot_children_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">acquire_ticket</a>();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>() &amp;&amp; !<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#abd36bdebf7a189e0ad51021f49ab5349">is_gleaning</a>()) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a9b87a7590a0628931ad8a89bf105d638">snapshot_children_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">timedwait</a>(demand, 100000ULL);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#abd36bdebf7a189e0ad51021f49ab5349">is_gleaning</a>() || previous_id == <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a700b0a6fc11f5ea720d43a69b793e8a5">cur_snapshot_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1Snapshot.html#abc612428c163a6545a60aa61f696ef9d">id_</a>) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> current_id = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a700b0a6fc11f5ea720d43a69b793e8a5">cur_snapshot_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1Snapshot.html#abc612428c163a6545a60aa61f696ef9d">id_</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Child snapshot daemon-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9">get_soc_id</a>() &lt;&lt; <span class="stringliteral">&quot; received a request&quot;</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; for snapshot-&quot;</span> &lt;&lt; current_id;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a>-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MapReduceBase.html#a4bb73ed60ea4202f906f63f203b467ff">launch_thread</a>();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">for</span> (LogMapper* mapper : <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">local_mappers_</a>) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      mapper-&gt;launch_thread();</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Child snapshot daemon-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9">get_soc_id</a>() &lt;&lt; <span class="stringliteral">&quot; launched mappers/reducer&quot;</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="stringliteral">&quot; for snapshot-&quot;</span> &lt;&lt; current_id;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">for</span> (LogMapper* mapper : local_mappers_) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      mapper-&gt;join_thread();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a>-&gt;<a class="code" href="classfoedus_1_1snapshot_1_1MapReduceBase.html#af685ecd4f6aa00202e875c4d4780ad38">join_thread</a>();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Child snapshot daemon-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9">get_soc_id</a>() &lt;&lt; <span class="stringliteral">&quot; joined mappers/reducer&quot;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="stringliteral">&quot; for snapshot-&quot;</span> &lt;&lt; current_id;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    previous_id = current_id;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Child snapshot daemon-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9">get_soc_id</a>() &lt;&lt; <span class="stringliteral">&quot; ended&quot;</span>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_abd36bdebf7a189e0ad51021f49ab5349"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#abd36bdebf7a189e0ad51021f49ab5349">foedus::snapshot::SnapshotManagerPimpl::is_gleaning</a></div><div class="ttdeci">bool is_gleaning() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00251">snapshot_manager_pimpl.hpp:251</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MapReduceBase_html_a4bb73ed60ea4202f906f63f203b467ff"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MapReduceBase.html#a4bb73ed60ea4202f906f63f203b467ff">foedus::snapshot::MapReduceBase::launch_thread</a></div><div class="ttdeci">void launch_thread()</div><div class="ttdoc">Start executing. </div><div class="ttdef"><b>Definition:</b> <a href="mapreduce__base__impl_8cpp_source.html#l00040">mapreduce_base_impl.cpp:40</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1MapReduceBase_html_af685ecd4f6aa00202e875c4d4780ad38"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1MapReduceBase.html#af685ecd4f6aa00202e875c4d4780ad38">foedus::snapshot::MapReduceBase::join_thread</a></div><div class="ttdeci">void join_thread()</div><div class="ttdef"><b>Definition:</b> <a href="mapreduce__base__impl_8cpp_source.html#l00045">mapreduce_base_impl.cpp:45</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ac6ad7822e42e2e942b55708b1da8516b"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">foedus::soc::SharedPolling::acquire_ticket</a></div><div class="ttdeci">uint64_t acquire_ticket() const </div><div class="ttdoc">Gives the ticket to. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00105">shared_polling.cpp:105</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af62dcd6c7942c46ce4d64485721a1ac5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a></div><div class="ttdeci">LogGleanerControlBlock gleaner_</div><div class="ttdoc">Gleaner-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00194">snapshot_manager_pimpl.hpp:194</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1Snapshot_html_abc612428c163a6545a60aa61f696ef9d"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1Snapshot.html#abc612428c163a6545a60aa61f696ef9d">foedus::snapshot::Snapshot::id_</a></div><div class="ttdeci">SnapshotId id_</div><div class="ttdoc">Unique ID of this snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot_8hpp_source.html#l00043">snapshot.hpp:43</a></div></div>
<div class="ttc" id="group__SNAPSHOT_html_gaec32eb05303ebec1048d120f73295031"><div class="ttname"><a href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">foedus::snapshot::SnapshotId</a></div><div class="ttdeci">uint16_t SnapshotId</div><div class="ttdoc">Unique ID of Snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00043">snapshot_id.hpp:43</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ad5187637994473e2fbb7fc484023f307"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">foedus::snapshot::SnapshotManagerPimpl::local_reducer_</a></div><div class="ttdeci">LogReducer * local_reducer_</div><div class="ttdoc">Reducer in this node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00353">snapshot_manager_pimpl.hpp:353</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a20ef0a4fa6050268d88fb3532b90c757"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">foedus::snapshot::SnapshotManagerPimpl::local_mappers_</a></div><div class="ttdeci">std::vector&lt; LogMapper * &gt; local_mappers_</div><div class="ttdoc">Mappers in this node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00351">snapshot_manager_pimpl.hpp:351</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_a700b0a6fc11f5ea720d43a69b793e8a5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a700b0a6fc11f5ea720d43a69b793e8a5">foedus::snapshot::LogGleanerControlBlock::cur_snapshot_</a></div><div class="ttdeci">Snapshot cur_snapshot_</div><div class="ttdoc">The snapshot we are now taking. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00083">snapshot_manager_pimpl.hpp:83</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a501ce4a1b4b4a847a635ca671c5331de"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">foedus::snapshot::SnapshotManagerPimpl::is_stop_requested</a></div><div class="ttdeci">bool is_stop_requested() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00250">snapshot_manager_pimpl.hpp:250</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a8d9a31e48aec9b73e16b64170c0250f9"><div class="ttname"><a href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9">foedus::Engine::get_soc_id</a></div><div class="ttdeci">soc::SocId get_soc_id() const </div><div class="ttdoc">If this is a child instance, returns its SOC ID (NUMA node). </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00073">engine.cpp:73</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a9b87a7590a0628931ad8a89bf105d638"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a9b87a7590a0628931ad8a89bf105d638">foedus::snapshot::SnapshotManagerControlBlock::snapshot_children_wakeup_</a></div><div class="ttdeci">soc::SharedPolling snapshot_children_wakeup_</div><div class="ttdoc">Child snapshot managers (the ones in SOC engines) sleep on this condition until the master snapshot m...</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00191">snapshot_manager_pimpl.hpp:191</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_a1b9f5c8b129c454887a77d3255956157"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">foedus::soc::SharedPolling::timedwait</a></div><div class="ttdeci">bool timedwait(uint64_t demanded_ticket, uint64_t timeout_microsec, uint64_t polling_spins=kDefaultPollingSpins, uint64_t max_interval_us=kDefaultPollingMaxIntervalUs) const </div><div class="ttdoc">Wait for signal up to the given timeout. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00063">shared_polling.cpp:63</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="319,5,497,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9" title="If this is a child instance, returns its SOC ID (NUMA node). " alt="" coords="341,71,475,112"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#abd36bdebf7a189e0ad51021f49ab5349" title="foedus::snapshot::Snapshot\lManagerPimpl::is_gleaning" alt="" coords="316,136,500,177"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de" title="foedus::snapshot::Snapshot\lManagerPimpl::is_stop_requested" alt="" coords="299,201,517,243"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1MapReduceBase.html#af685ecd4f6aa00202e875c4d4780ad38" title="foedus::snapshot::MapReduce\lBase::join_thread" alt="" coords="309,267,507,308"/>
<area shape="rect" id="node9" href="classfoedus_1_1snapshot_1_1MapReduceBase.html#a4bb73ed60ea4202f906f63f203b467ff" title="Start executing. " alt="" coords="309,332,507,373"/>
<area shape="rect" id="node10" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="319,397,497,439"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="578,5,751,47"/>
<area shape="rect" id="node8" href="classfoedus_1_1snapshot_1_1MapReduceBase.html#ac6e7366e9f890077872aea8f2c16099b" title="Expects &quot;LogReducer&#45;x&quot;, &quot;LogMapper&#45;y&quot; etc. " alt="" coords="565,300,764,341"/>
<area shape="rect" id="node11" href="namespacefoedus_1_1soc.html#a875ded688a72b32f8f690f37750e609f" title="foedus::soc::get_now\l_microsec" alt="" coords="592,397,737,439"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a84fdf2f4ccf499b44afed05a273739d9_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="299,5,493,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a905ccf76fe0e076980dc1965f038fe10"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::handle_snapshot_triggered </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> *&#160;</td>
          <td class="paramname"><em>new_snapshot</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. ">handle_snapshot()</a> calls this when it should start snapshotting. </p>
<p>In other words, this function is the main routine of snapshotting. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">316</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="snapshot_8hpp_source.html#l00049">foedus::snapshot::Snapshot::base_epoch_</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00083">foedus::snapshot::LogGleanerControlBlock::cur_snapshot_</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00488">drop_volatile_pages()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="log__manager_8cpp_source.html#l00036">foedus::log::LogManager::get_durable_global_epoch()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00055">foedus::storage::StorageManager::get_largest_storage_id()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00144">foedus::snapshot::SnapshotManagerControlBlock::get_requested_snapshot_epoch()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00215">get_snapshot_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00386">glean_logs()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00194">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a>, <a class="el" href="snapshot_8hpp_source.html#l00043">foedus::snapshot::Snapshot::id_</a>, <a class="el" href="snapshot__id_8hpp_source.html#l00052">foedus::snapshot::increment()</a>, <a class="el" href="storage__manager_8cpp_source.html#l00044">foedus::storage::StorageManager::is_initialized()</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="epoch_8hpp_source.html#l00096">foedus::Epoch::is_valid()</a>, <a class="el" href="snapshot__id_8hpp_source.html#l00045">foedus::snapshot::kNullSnapshotId</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="snapshot_8hpp_source.html#l00058">foedus::snapshot::Snapshot::max_storage_id_</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00175">foedus::snapshot::SnapshotManagerControlBlock::previous_snapshot_id_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00348">previous_snapshot_time_</a>, <a class="el" href="shared__polling_8cpp_source.html#l00100">foedus::soc::SharedPolling::signal()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00160">foedus::snapshot::SnapshotManagerControlBlock::snapshot_epoch_</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00401">snapshot_metadata()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00469">snapshot_savepoint()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00178">foedus::snapshot::SnapshotManagerControlBlock::snapshot_taken_</a>, <a class="el" href="snapshot_8hpp_source.html#l00055">foedus::snapshot::Snapshot::valid_until_epoch_</a>, and <a class="el" href="epoch_8hpp_source.html#l00102">foedus::Epoch::value()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, and <a class="el" href="restart__manager__pimpl_8cpp_source.html#l00071">foedus::restart::RestartManagerPimpl::recover()</a>.</p>
<div class="fragment"><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                                                                 {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>());</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac">is_initialized</a>());  <span class="comment">// snapshot relied on storage module</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  Epoch durable_epoch = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa">get_durable_global_epoch</a>();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  Epoch previous_epoch = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Taking a new snapshot. durable_epoch=&quot;</span> &lt;&lt; durable_epoch</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, requested_snapshot_epoch=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b">get_requested_snapshot_epoch</a>()</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;. previous_snapshot=&quot;</span> &lt;&lt; previous_epoch;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(durable_epoch.is_valid() &amp;&amp;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    (!previous_epoch.is_valid() || durable_epoch &gt; previous_epoch));</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  new_snapshot-&gt;base_epoch_ = previous_epoch;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  Epoch requested_epoch = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b">get_requested_snapshot_epoch</a>();</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> (requested_epoch.is_valid()) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(requested_epoch &lt;= durable_epoch);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!previous_epoch.is_valid() || requested_epoch &gt; previous_epoch);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    new_snapshot-&gt;valid_until_epoch_ = requested_epoch;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    new_snapshot-&gt;valid_until_epoch_ = durable_epoch;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  new_snapshot-&gt;max_storage_id_ = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a33c97509f7fffbd7fcced3e34fe16616">get_largest_storage_id</a>();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_snapshot-&gt;max_storage_id_</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    &gt;= <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a700b0a6fc11f5ea720d43a69b793e8a5">cur_snapshot_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1Snapshot.html#a8c49cffe9c5f2cabc33086424489b193">max_storage_id_</a>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="comment">// determine the snapshot ID</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <a class="code" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> snapshot_id;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a> == <a class="code" href="namespacefoedus_1_1snapshot.html#a26a2120f7b28c565f2d22ff799ee2280">kNullSnapshotId</a>) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    snapshot_id = 1;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    snapshot_id = <a class="code" href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730">increment</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Issued ID for this snapshot:&quot;</span> &lt;&lt; snapshot_id;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  new_snapshot-&gt;id_ = snapshot_id;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">// okay, let&#39;s start the snapshotting.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// The procedures below will take long time, so we keep checking our &quot;is_stop_requested&quot;</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">// and stops our child threads when it happens.</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// For each storage that was modified in this snapshotting,</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">// this holds the pointer to new root page.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  std::map&lt;storage::StorageId, storage::SnapshotPagePointer&gt; new_root_page_pointers;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// Log gleaners design partitioning and do scatter-gather to consume the logs.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">// This will create snapshot files at each partition and tell us the new root pages of</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">// each storage.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a75c5d41290ab6f960725a004622dc3be">glean_logs</a>(*new_snapshot, &amp;new_root_page_pointers));</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">// Write out the metadata file.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4ae6b016213cb70bb6e5df636b24d129">snapshot_metadata</a>(*new_snapshot, new_root_page_pointers));</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="comment">// Invokes savepoint module to make sure this snapshot has &quot;happened&quot;.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a45097869d980cf8fe0ad3313e02c8117">snapshot_savepoint</a>(*new_snapshot));</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">// install pointers to snapshot pages and drop volatile pages.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa">drop_volatile_pages</a>(*new_snapshot, new_root_page_pointers));</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  Epoch new_snapshot_epoch = new_snapshot-&gt;valid_until_epoch_;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_snapshot_epoch.is_valid() &amp;&amp;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>().<a class="code" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9">is_valid</a>() || new_snapshot_epoch &gt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>()));</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">// done. notify waiters if exist</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <a class="code" href="classfoedus_1_1Epoch.html#a62a30a9e703c23a5ef1b0fdaab0c34e1">Epoch::EpochInteger</a> epoch_after = new_snapshot_epoch.value();</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a> = snapshot_id;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4775dadfb539af5c8d82118735212254">previous_snapshot_time_</a> = std::chrono::system_clock::now();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#ab73c559e1fc986006764b2e6b7c9ac66">snapshot_epoch_</a> = epoch_after;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aa7fabf15a3fd3d86138ef69c4de51c16">snapshot_taken_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">signal</a>();</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a34892c22330eb4e43e9be9754951916b"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b">foedus::snapshot::SnapshotManagerControlBlock::get_requested_snapshot_epoch</a></div><div class="ttdeci">Epoch get_requested_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00144">snapshot_manager_pimpl.hpp:144</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a62a30a9e703c23a5ef1b0fdaab0c34e1"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a62a30a9e703c23a5ef1b0fdaab0c34e1">foedus::Epoch::EpochInteger</a></div><div class="ttdeci">uint32_t EpochInteger</div><div class="ttdoc">Unsigned integer representation of epoch. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00064">epoch.hpp:64</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a45097869d980cf8fe0ad3313e02c8117"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a45097869d980cf8fe0ad3313e02c8117">foedus::snapshot::SnapshotManagerPimpl::snapshot_savepoint</a></div><div class="ttdeci">ErrorStack snapshot_savepoint(const Snapshot &amp;new_snapshot)</div><div class="ttdoc">Sub-routine of handle_snapshot_triggered(). </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00469">snapshot_manager_pimpl.cpp:469</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af32b1c2d95d9a9f3919bb27ec8602204"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">foedus::snapshot::SnapshotManagerControlBlock::previous_snapshot_id_</a></div><div class="ttdeci">std::atomic&lt; SnapshotId &gt; previous_snapshot_id_</div><div class="ttdoc">ID of previously completed snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00175">snapshot_manager_pimpl.hpp:175</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af62dcd6c7942c46ce4d64485721a1ac5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a></div><div class="ttdeci">LogGleanerControlBlock gleaner_</div><div class="ttdoc">Gleaner-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00194">snapshot_manager_pimpl.hpp:194</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1Snapshot_html_a8c49cffe9c5f2cabc33086424489b193"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1Snapshot.html#a8c49cffe9c5f2cabc33086424489b193">foedus::snapshot::Snapshot::max_storage_id_</a></div><div class="ttdeci">storage::StorageId max_storage_id_</div><div class="ttdoc">Largest storage ID as of starting to take the snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot_8hpp_source.html#l00058">snapshot.hpp:58</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a3a9d5aa09e337f0c997a128b805df8ac"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac">foedus::storage::StorageManager::is_initialized</a></div><div class="ttdeci">bool is_initialized() const  override</div><div class="ttdoc">Returns whether the object has been already initialized or not. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager_8cpp_source.html#l00044">storage_manager.cpp:44</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a4ae6b016213cb70bb6e5df636b24d129"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4ae6b016213cb70bb6e5df636b24d129">foedus::snapshot::SnapshotManagerPimpl::snapshot_metadata</a></div><div class="ttdeci">ErrorStack snapshot_metadata(const Snapshot &amp;new_snapshot, const std::map&lt; storage::StorageId, storage::SnapshotPagePointer &gt; &amp;new_root_page_pointers)</div><div class="ttdoc">Sub-routine of handle_snapshot_triggered(). </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00401">snapshot_manager_pimpl.cpp:401</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a2f1c4ffd479bb976c32d4ddb38517a3b"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">foedus::snapshot::SnapshotManagerPimpl::get_snapshot_epoch</a></div><div class="ttdeci">Epoch get_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00215">snapshot_manager_pimpl.hpp:215</a></div></div>
<div class="ttc" id="group__SNAPSHOT_html_gad1370b531dc11ee1b942d3d8ad829730"><div class="ttname"><a href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730">foedus::snapshot::increment</a></div><div class="ttdeci">SnapshotId increment(SnapshotId id)</div><div class="ttdoc">Increment SnapshotId. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00052">snapshot_id.hpp:52</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a4775dadfb539af5c8d82118735212254"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4775dadfb539af5c8d82118735212254">foedus::snapshot::SnapshotManagerPimpl::previous_snapshot_time_</a></div><div class="ttdeci">std::chrono::system_clock::time_point previous_snapshot_time_</div><div class="ttdoc">When snapshot_thread_ took snapshot last time. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00348">snapshot_manager_pimpl.hpp:348</a></div></div>
<div class="ttc" id="group__SNAPSHOT_html_gaec32eb05303ebec1048d120f73295031"><div class="ttname"><a href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">foedus::snapshot::SnapshotId</a></div><div class="ttdeci">uint16_t SnapshotId</div><div class="ttdoc">Unique ID of Snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00043">snapshot_id.hpp:43</a></div></div>
<div class="ttc" id="namespacefoedus_1_1snapshot_html_a26a2120f7b28c565f2d22ff799ee2280"><div class="ttname"><a href="namespacefoedus_1_1snapshot.html#a26a2120f7b28c565f2d22ff799ee2280">foedus::snapshot::kNullSnapshotId</a></div><div class="ttdeci">const SnapshotId kNullSnapshotId</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00045">snapshot_id.hpp:45</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a33c97509f7fffbd7fcced3e34fe16616"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a33c97509f7fffbd7fcced3e34fe16616">foedus::storage::StorageManager::get_largest_storage_id</a></div><div class="ttdeci">StorageId get_largest_storage_id()</div><div class="ttdoc">Returns the largest StorageId that does or did exist. </div><div class="ttdef"><b>Definition:</b> <a href="storage__manager_8cpp_source.html#l00055">storage_manager.cpp:55</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a8228a1a49b7db9b93498a778cb40f8e9"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9">foedus::Epoch::is_valid</a></div><div class="ttdeci">bool is_valid() const </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00096">epoch.hpp:96</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_a3d0f1491c5d6ef15601986b7b1dd6aaa"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa">foedus::log::LogManager::get_durable_global_epoch</a></div><div class="ttdeci">Epoch get_durable_global_epoch() const </div><div class="ttdoc">Returns the durable epoch of the entire engine. </div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00036">log_manager.cpp:36</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_a700b0a6fc11f5ea720d43a69b793e8a5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a700b0a6fc11f5ea720d43a69b793e8a5">foedus::snapshot::LogGleanerControlBlock::cur_snapshot_</a></div><div class="ttdeci">Snapshot cur_snapshot_</div><div class="ttdoc">The snapshot we are now taking. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00083">snapshot_manager_pimpl.hpp:83</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a5d474e7a6b4de127153103f2295cb0fa"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa">foedus::snapshot::SnapshotManagerPimpl::drop_volatile_pages</a></div><div class="ttdeci">ErrorStack drop_volatile_pages(const Snapshot &amp;new_snapshot, const std::map&lt; storage::StorageId, storage::SnapshotPagePointer &gt; &amp;new_root_page_pointers)</div><div class="ttdoc">Sub-routine of handle_snapshot_triggered(). </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00488">snapshot_manager_pimpl.cpp:488</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_aa7fabf15a3fd3d86138ef69c4de51c16"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aa7fabf15a3fd3d86138ef69c4de51c16">foedus::snapshot::SnapshotManagerControlBlock::snapshot_taken_</a></div><div class="ttdeci">soc::SharedPolling snapshot_taken_</div><div class="ttdoc">Fired (notify_all) whenever snapshotting is completed. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00178">snapshot_manager_pimpl.hpp:178</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a75c5d41290ab6f960725a004622dc3be"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a75c5d41290ab6f960725a004622dc3be">foedus::snapshot::SnapshotManagerPimpl::glean_logs</a></div><div class="ttdeci">ErrorStack glean_logs(const Snapshot &amp;new_snapshot, std::map&lt; storage::StorageId, storage::SnapshotPagePointer &gt; *new_root_page_pointers)</div><div class="ttdoc">Sub-routine of handle_snapshot_triggered(). </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00386">snapshot_manager_pimpl.cpp:386</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_ab73c559e1fc986006764b2e6b7c9ac66"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#ab73c559e1fc986006764b2e6b7c9ac66">foedus::snapshot::SnapshotManagerControlBlock::snapshot_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; snapshot_epoch_</div><div class="ttdoc">The most recently snapshot-ed epoch, all logs upto this epoch is safe to delete. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00160">snapshot_manager_pimpl.hpp:160</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ae523f3b3bda39c0c81bfb5cb0d5ad626"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">foedus::soc::SharedPolling::signal</a></div><div class="ttdeci">void signal()</div><div class="ttdoc">Signal it to let waiters exit. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00100">shared_polling.cpp:100</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="267,1347,494,1389"/>
<area shape="rect" id="node11" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="830,943,965,985"/>
<area shape="rect" id="node14" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="567,1664,721,1691"/>
<area shape="rect" id="node17" href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa" title="Returns the durable epoch of the entire engine. " alt="" coords="291,1773,471,1814"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1StorageManager.html#a33c97509f7fffbd7fcced3e34fe16616" title="Returns the largest StorageId that does or did exist. " alt="" coords="275,1838,486,1879"/>
<area shape="rect" id="node20" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="313,1903,448,1945"/>
<area shape="rect" id="node21" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_requested_snapshot_epoch" alt="" coords="287,1969,475,2025"/>
<area shape="rect" id="node22" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b" title="foedus::snapshot::Snapshot\lManagerPimpl::get_snapshot_epoch" alt="" coords="264,2050,497,2091"/>
<area shape="rect" id="node24" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a75c5d41290ab6f960725a004622dc3be" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="289,1707,473,1749"/>
<area shape="rect" id="node28" href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730" title="Increment SnapshotId. " alt="" coords="287,2116,474,2143"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1StorageManager.html#a3a9d5aa09e337f0c997a128b805df8ac" title="Returns whether the object has been already initialized or not. " alt="" coords="299,2167,463,2209"/>
<area shape="rect" id="node31" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="317,2233,444,2274"/>
<area shape="rect" id="node32" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="294,2298,467,2339"/>
<area shape="rect" id="node33" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="292,2363,469,2405"/>
<area shape="rect" id="node36" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4ae6b016213cb70bb6e5df636b24d129" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="289,472,473,528"/>
<area shape="rect" id="node37" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="573,5,715,32"/>
<area shape="rect" id="node49" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a45097869d980cf8fe0ad3313e02c8117" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="289,2429,473,2485"/>
<area shape="rect" id="node3" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="791,867,1004,909"/>
<area shape="rect" id="node4" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="1052,1133,1187,1174"/>
<area shape="rect" id="node5" href="classfoedus_1_1memory_1_1PagePoolOffsetChunk.html#a7e011070a4928973c6bbd9b0f0f96935" title="foedus::memory::PagePool\lOffsetChunk::clear" alt="" coords="808,1273,987,1314"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1Composer.html#af6d90399f471e1461fd4e59b0f3b923f" title="This is additionally called when no partitions observed any new modifications. " alt="" coords="555,1482,733,1523"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a26c51902174b692c91aedd15218f01b7" title="subroutine invoked by one thread for one node. " alt="" coords="552,1117,736,1173"/>
<area shape="rect" id="node8" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="815,1009,980,1050"/>
<area shape="rect" id="node9" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="791,1359,1004,1401"/>
<area shape="rect" id="node10" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="830,1074,965,1115"/>
<area shape="rect" id="node12" href="classfoedus_1_1memory_1_1AlignedMemory.html#afd955f5f991e28943c72ecff1167c16b" title="Releases the memory block. " alt="" coords="791,1197,1004,1238"/>
<area shape="rect" id="node13" href="classfoedus_1_1Engine.html#a48d5e1f7ce2f70161c253f650c75ed95" title="See Transaction Manager. " alt="" coords="577,1547,711,1589"/>
<area shape="rect" id="node15" href="classfoedus_1_1xct_1_1XctManager.html#a494c96802826b99e62384b72c2252c84" title="Pause all begin_xct until you call resume_accepting_xct() " alt="" coords="563,1198,725,1239"/>
<area shape="rect" id="node16" href="classfoedus_1_1xct_1_1XctManager.html#ad1e49dd4bd9a1d87db8bbe2c107d7d98" title="Make sure you call this after pause_accepting_xct(). " alt="" coords="563,1263,725,1305"/>
<area shape="rect" id="node18" href="classfoedus_1_1log_1_1LogManagerPimpl.html#a61e44b4b7bb5dfc3d4111bb6bef25ea9" title="foedus::log::LogManagerPimpl\l::get_durable_global_epoch" alt="" coords="545,1897,743,1938"/>
<area shape="rect" id="node23" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af87a96cd77347014fdd6acffac91d9f5" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_snapshot_epoch" alt="" coords="552,2043,736,2099"/>
<area shape="rect" id="node25" href="classfoedus_1_1snapshot_1_1LogGleaner.html#a617c3de45c34c6533c7f3e82216557f4" title="Main routine of log gleaner. " alt="" coords="800,1594,995,1635"/>
<area shape="rect" id="node26" href="classfoedus_1_1snapshot_1_1LogGleaner.html#a1629807dcb35f0174fa6ad6e247eda8f" title="Returns pointers to new root pages constructed at the end of gleaning. " alt="" coords="547,1831,741,1873"/>
<area shape="rect" id="node27" href="classfoedus_1_1ErrorStack.html#a9c7b3a8b3806ff623c7fb4a9db5cbeec" title="Returns if this return code is not kErrorCodeOk. " alt="" coords="579,1766,709,1807"/>
<area shape="rect" id="node30" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="558,2167,730,2209"/>
<area shape="rect" id="node34" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="557,2311,731,2353"/>
<area shape="rect" id="node35" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="549,2377,739,2404"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1StorageManager.html#a1b7056a40786dc501f373380e411a6ae" title="This method is called during snapshotting to clone metadata of all existing storages to the given obj..." alt="" coords="553,355,735,411"/>
<area shape="rect" id="node39" href="structfoedus_1_1storage_1_1StorageControlBlock.html#a7777fa908acfd1da5918e9f0369f8ed7" title="foedus::storage::Storage\lControlBlock::is_valid\l_status" alt="" coords="562,435,726,491"/>
<area shape="rect" id="node40" href="structfoedus_1_1snapshot_1_1SnapshotMetadata.html#a69ec31282dee73c4cbea823aa2a06a85" title="foedus::snapshot::Snapshot\lMetadata::get_metadata" alt="" coords="552,515,736,557"/>
<area shape="rect" id="node41" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600" title="shorthand for engine_&#45;&gt;get_options().snapshot_. " alt="" coords="805,97,989,138"/>
<area shape="rect" id="node42" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4" title="Returns if the file exists. " alt="" coords="1059,583,1180,609"/>
<area shape="rect" id="node43" href="group__FILESYSTEM.html#gaca1dd0a627c83ff76e30603ea67c4816" title="Recursive mkdir (mkdirs). " alt="" coords="836,575,959,617"/>
<area shape="rect" id="node44" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0" title="each snapshot has a snapshot&#45;metadata file &quot;snapshot_metadata_&lt;SNAPSHOT_ID&gt;.xml&quot; in first node&#39;s firs..." alt="" coords="549,56,739,112"/>
<area shape="rect" id="node45" href="structfoedus_1_1externalize_1_1Externalizable.html#af4e4989a732573c1bbd538a3fbfad930" title="Atomically and durably writes out this object to the specified XML file. " alt="" coords="571,683,717,739"/>
<area shape="rect" id="node46" href="group__FILESYSTEM.html#ga08865450d848cb894243005bdd226d1e" title="Makes the content and metadata of the file durable all the way up to devices. " alt="" coords="839,643,956,669"/>
<area shape="rect" id="node47" href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8" title="Returns size of the file. " alt="" coords="577,187,711,213"/>
<area shape="rect" id="node48" href="classfoedus_1_1debugging_1_1StopWatch.html#a9f35df8dc3c371659227375baa247074" title="Take current time tick. " alt="" coords="577,238,711,279"/>
<area shape="rect" id="node50" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8" title="See Savepoint Manager. " alt="" coords="574,2437,714,2478"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a905ccf76fe0e076980dc1965f038fe10_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="264,5,475,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="292,71,447,112"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="523,5,717,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="523,71,717,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a632a4da7b3c67dd687f7eba4f6ec1d76"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::initialize_once </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classfoedus_1_1DefaultInitializable.html#ab8ae37e5f20f312f8b945fc40d3e0250">foedus::DefaultInitializable</a>.</p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">61</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00116">foedus::snapshot::LogGleanerControlBlock::all_count_</a>, <a class="el" href="log__gleaner__resource_8cpp_source.html#l00023">foedus::snapshot::LogGleanerResource::allocate()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="partitioner_8hpp_source.html#l00246">foedus::storage::PartitionerMetadata::data_size_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="error__stack_8hpp_source.html#l00480">ERROR_STACK</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00514">foedus::soc::SharedMemoryRepo::get_global_memory_anchors()</a>, <a class="el" href="savepoint__manager_8cpp_source.html#l00052">foedus::savepoint::SavepointManager::get_latest_snapshot_epoch()</a>, <a class="el" href="savepoint__manager_8cpp_source.html#l00049">foedus::savepoint::SavepointManager::get_latest_snapshot_id()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="engine_8cpp_source.html#l00039">foedus::Engine::get_options()</a>, <a class="el" href="engine_8cpp_source.html#l00053">foedus::Engine::get_savepoint_manager()</a>, <a class="el" href="soc__manager_8cpp_source.html#l00038">foedus::soc::SocManager::get_shared_memory_repo()</a>, <a class="el" href="engine_8cpp_source.html#l00074">foedus::Engine::get_soc_count()</a>, <a class="el" href="engine_8cpp_source.html#l00059">foedus::Engine::get_soc_manager()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00194">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00356">gleaner_resource_</a>, <a class="el" href="thread__options_8hpp_source.html#l00043">foedus::thread::ThreadOptions::group_count_</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">handle_snapshot_child()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00125">foedus::snapshot::SnapshotManagerControlBlock::initialize()</a>, <a class="el" href="initializable_8hpp_source.html#l00169">foedus::DefaultInitializable::initialize()</a>, <a class="el" href="partitioner_8hpp_source.html#l00214">foedus::storage::PartitionerMetadata::initialize()</a>, <a class="el" href="log__manager_8cpp_source.html#l00032">foedus::log::LogManager::is_initialized()</a>, <a class="el" href="shared__mutex_8hpp_source.html#l00058">foedus::soc::SharedMutex::is_initialized()</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="epoch_8hpp_source.html#l00068">foedus::Epoch::kEpochInvalid</a>, <a class="el" href="error__code_8hpp_source.html#l00109">foedus::kErrorCodeDepedentModuleUnavailableInit</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00351">local_mappers_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00353">local_reducer_</a>, <a class="el" href="engine__options_8hpp_source.html#l00138">foedus::EngineOptions::log_</a>, <a class="el" href="log__options_8hpp_source.html#l00080">foedus::log::LogOptions::loggers_per_node_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00112">foedus::snapshot::LogGleanerControlBlock::mappers_count_</a>, <a class="el" href="storage__options_8hpp_source.html#l00043">foedus::storage::StorageOptions::max_storages_</a>, <a class="el" href="partitioner_8hpp_source.html#l00232">foedus::storage::PartitionerMetadata::mutex_</a>, <a class="el" href="storage__options_8hpp_source.html#l00051">foedus::storage::StorageOptions::partitioner_data_memory_mb_</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00271">foedus::soc::GlobalMemoryAnchors::partitioner_metadata_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00175">foedus::snapshot::SnapshotManagerControlBlock::previous_snapshot_id_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00348">previous_snapshot_time_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00114">foedus::snapshot::LogGleanerControlBlock::reducers_count_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00168">foedus::snapshot::SnapshotManagerControlBlock::requested_snapshot_epoch_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00160">foedus::snapshot::SnapshotManagerControlBlock::snapshot_epoch_</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00261">foedus::soc::GlobalMemoryAnchors::snapshot_manager_memory_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00342">snapshot_thread_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00333">stop_requested_</a>, <a class="el" href="engine__options_8hpp_source.html#l00145">foedus::EngineOptions::storage_</a>, <a class="el" href="engine__options_8hpp_source.html#l00146">foedus::EngineOptions::thread_</a>, and <a class="el" href="epoch_8hpp_source.html#l00102">foedus::Epoch::value()</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                                 {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Initializing SnapshotManager..&quot;</span>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#ac69401e015fb167c3a7739bb6b40bc1e">is_initialized</a>()) {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a154d6f9c4bf17ea4f3909286f00e2d7d">kErrorCodeDepedentModuleUnavailableInit</a>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  soc::SharedMemoryRepo* repo = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e">get_soc_manager</a>()-&gt;<a class="code" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c">get_shared_memory_repo</a>();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a> = repo-&gt;get_global_memory_anchors()-&gt;snapshot_manager_memory_;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>()) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a797d62d33506815f6945b0c06bab280d">initialize</a>();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// get snapshot status from savepoint</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#ab73c559e1fc986006764b2e6b7c9ac66">snapshot_epoch_</a></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">get_savepoint_manager</a>()-&gt;<a class="code" href="classfoedus_1_1savepoint_1_1SavepointManager.html#af2bd4752f20f177d0576f6227feb729b">get_latest_snapshot_epoch</a>().<a class="code" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf">value</a>();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">get_savepoint_manager</a>()-&gt;<a class="code" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a97ee635381be9e59996fe7b4c9276b0c">get_latest_snapshot_id</a>();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Latest snapshot: id=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a> &lt;&lt; <span class="stringliteral">&quot;, epoch=&quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#ab73c559e1fc986006764b2e6b7c9ac66">snapshot_epoch_</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a23f8122328ae56b2e599e46cef336701">requested_snapshot_epoch_</a>.store(<a class="code" href="classfoedus_1_1Epoch.html#a987db657e61845e18835ce4b1617470fa16cb33440c051fd4414f3714bb93dcbf">Epoch::kEpochInvalid</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keyword">const</span> EngineOptions&amp; options = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>();</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    uint32_t reducer_count = options.<a class="code" href="structfoedus_1_1EngineOptions.html#a97a206187b610b15a6edbfc75a384b1a">thread_</a>.<a class="code" href="structfoedus_1_1thread_1_1ThreadOptions.html#ad9cfcfe5d16d5c394694919d2f59e627">group_count_</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    uint32_t mapper_count = reducer_count * options.log_.loggers_per_node_;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a21d82ff9ff9b5666c19fce5aa1256785">reducers_count_</a> = reducer_count;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#ae389d11e33892902a0615887b0347478">mappers_count_</a> = mapper_count;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#ab83006539253d08a388edcae4bba4fbe">all_count_</a> = reducer_count + mapper_count;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// also initialize the shared memory for partitioner</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    uint32_t max_storages = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#a3e40cfe4530b10e87344b42be16927e1">storage_</a>.<a class="code" href="structfoedus_1_1storage_1_1StorageOptions.html#a8b258af832ab43776a532c0f7a935b47">max_storages_</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    storage::PartitionerMetadata* partitioner_metadata</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      = repo-&gt;get_global_memory_anchors()-&gt;partitioner_metadata_;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a> i = 0; i &lt; max_storages; ++i) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      storage::PartitionerMetadata* meta = partitioner_metadata + i;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!meta-&gt;mutex_.is_initialized());</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      meta-&gt;initialize();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(meta-&gt;mutex_.is_initialized());</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// set the size of partitioner data</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    repo-&gt;get_global_memory_anchors()-&gt;partitioner_metadata_[0].data_size_</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#a3e40cfe4530b10e87344b42be16927e1">storage_</a>.<a class="code" href="structfoedus_1_1storage_1_1StorageOptions.html#a127e9bf3b4309f1dafca757fc11ae6e5">partitioner_data_memory_mb_</a> * (1ULL &lt;&lt; 20);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// And master-only resources for running gleaner. These are NOT shared memory. local to master.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">gleaner_resource_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#a8327c8ba0d722a15f441abc4434bea2b">allocate</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">get_soc_count</a>());</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// in child engines, we instantiate local mappers/reducer objects (but not the threads yet)</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4775dadfb539af5c8d82118735212254">previous_snapshot_time_</a> = std::chrono::system_clock::now();</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaccf99888d69af9c737638c198470161">stop_requested_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>()) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a> = <span class="keyword">new</span> LogReducer(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a>-&gt;<a class="code" href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff">initialize</a>());</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#aee56a2e02a140b766a74d9e9c3088ddb">log_</a>.<a class="code" href="structfoedus_1_1log_1_1LogOptions.html#ab5a3f1900a8a5bf69c7d6e049fe30f90">loggers_per_node_</a>; ++i) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">local_mappers_</a>.push_back(<span class="keyword">new</span> LogMapper(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>, i));</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">local_mappers_</a>[i]-&gt;<a class="code" href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff">initialize</a>());</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// Launch the daemon thread at last</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>()) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab5c66ecba243eccfc78b5ae52aba9f7a">snapshot_thread_</a> = std::move(std::thread(&amp;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910">SnapshotManagerPimpl::handle_snapshot</a>, <span class="keyword">this</span>));</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab5c66ecba243eccfc78b5ae52aba9f7a">snapshot_thread_</a> = std::move(std::thread(&amp;<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a84fdf2f4ccf499b44afed05a273739d9">SnapshotManagerPimpl::handle_snapshot_child</a>, <span class="keyword">this</span>));</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a64e3c7594b7d7d0d5f8a144bd802d910"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910">foedus::snapshot::SnapshotManagerPimpl::handle_snapshot</a></div><div class="ttdeci">void handle_snapshot()</div><div class="ttdoc">Main routine for snapshot_thread_ in master engine. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00191">snapshot_manager_pimpl.cpp:191</a></div></div>
<div class="ttc" id="classfoedus_1_1savepoint_1_1SavepointManager_html_a97ee635381be9e59996fe7b4c9276b0c"><div class="ttname"><a href="classfoedus_1_1savepoint_1_1SavepointManager.html#a97ee635381be9e59996fe7b4c9276b0c">foedus::savepoint::SavepointManager::get_latest_snapshot_id</a></div><div class="ttdeci">snapshot::SnapshotId get_latest_snapshot_id() const </div><div class="ttdef"><b>Definition:</b> <a href="savepoint__manager_8cpp_source.html#l00049">savepoint_manager.cpp:49</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa598b0ca7f0de626ecfa17f2cd58d5b4"><div class="ttname"><a href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a></div><div class="ttdeci">#define ERROR_STACK(e)        </div><div class="ttdoc">Instantiates ErrorStack with the given foedus::error_code, creating an error stack with the current f...</div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00480">error_stack.hpp:480</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga595ca7fc4a3011a9704a883a25141e5f"><div class="ttname"><a href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">foedus::storage::StorageId</a></div><div class="ttdeci">uint32_t StorageId</div><div class="ttdoc">Unique ID for storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00055">storage_id.hpp:55</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_ac69401e015fb167c3a7739bb6b40bc1e"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#ac69401e015fb167c3a7739bb6b40bc1e">foedus::log::LogManager::is_initialized</a></div><div class="ttdeci">bool is_initialized() const  override</div><div class="ttdoc">Returns whether the object has been already initialized or not. </div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00032">log_manager.cpp:32</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a154d6f9c4bf17ea4f3909286f00e2d7d"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a154d6f9c4bf17ea4f3909286f00e2d7d">foedus::kErrorCodeDepedentModuleUnavailableInit</a></div><div class="ttdoc">0x0005 : "GENERAL: A dependent module is not initialized yet. This implies a wrong initialization ord...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00109">error_code.hpp:109</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerResource_html_a8327c8ba0d722a15f441abc4434bea2b"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#a8327c8ba0d722a15f441abc4434bea2b">foedus::snapshot::LogGleanerResource::allocate</a></div><div class="ttdeci">void allocate(uint16_t node_count)</div><div class="ttdef"><b>Definition:</b> <a href="log__gleaner__resource_8cpp_source.html#l00023">log_gleaner_resource.cpp:23</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_a21d82ff9ff9b5666c19fce5aa1256785"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a21d82ff9ff9b5666c19fce5aa1256785">foedus::snapshot::LogGleanerControlBlock::reducers_count_</a></div><div class="ttdeci">uint16_t reducers_count_</div><div class="ttdoc">Total number of mappers. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00114">snapshot_manager_pimpl.hpp:114</a></div></div>
<div class="ttc" id="classfoedus_1_1savepoint_1_1SavepointManager_html_af2bd4752f20f177d0576f6227feb729b"><div class="ttname"><a href="classfoedus_1_1savepoint_1_1SavepointManager.html#af2bd4752f20f177d0576f6227feb729b">foedus::savepoint::SavepointManager::get_latest_snapshot_epoch</a></div><div class="ttdeci">Epoch get_latest_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="savepoint__manager_8cpp_source.html#l00052">savepoint_manager.cpp:52</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af32b1c2d95d9a9f3919bb27ec8602204"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">foedus::snapshot::SnapshotManagerControlBlock::previous_snapshot_id_</a></div><div class="ttdeci">std::atomic&lt; SnapshotId &gt; previous_snapshot_id_</div><div class="ttdoc">ID of previously completed snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00175">snapshot_manager_pimpl.hpp:175</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a6546930099132529543c320327367ef1"><div class="ttname"><a href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">foedus::Engine::get_options</a></div><div class="ttdeci">const EngineOptions &amp; get_options() const </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00039">engine.cpp:39</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageOptions_html_a8b258af832ab43776a532c0f7a935b47"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageOptions.html#a8b258af832ab43776a532c0f7a935b47">foedus::storage::StorageOptions::max_storages_</a></div><div class="ttdeci">uint32_t max_storages_</div><div class="ttdoc">Maximum number of storages in this database. </div><div class="ttdef"><b>Definition:</b> <a href="storage__options_8hpp_source.html#l00043">storage_options.hpp:43</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a4f168d41ea00249fefe905def87e80c8"><div class="ttname"><a href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">foedus::Engine::get_savepoint_manager</a></div><div class="ttdeci">savepoint::SavepointManager * get_savepoint_manager() const </div><div class="ttdoc">See Savepoint Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00053">engine.cpp:53</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a5dbaf73527e1fe3ee31b33abed6ab27c"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">foedus::snapshot::SnapshotManagerPimpl::gleaner_resource_</a></div><div class="ttdeci">LogGleanerResource gleaner_resource_</div><div class="ttdoc">Local resources for gleaner, which runs only in the master node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00356">snapshot_manager_pimpl.hpp:356</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_a987db657e61845e18835ce4b1617470fa16cb33440c051fd4414f3714bb93dcbf"><div class="ttname"><a href="classfoedus_1_1Epoch.html#a987db657e61845e18835ce4b1617470fa16cb33440c051fd4414f3714bb93dcbf">foedus::Epoch::kEpochInvalid</a></div><div class="ttdoc">Zero is always reserved for invalid epoch. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00068">epoch.hpp:68</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_af0ac9dbae9481b295a8492c6d9f6c1d5"><div class="ttname"><a href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5">foedus::Engine::get_soc_count</a></div><div class="ttdeci">soc::SocId get_soc_count() const </div><div class="ttdoc">Shorthand for get_options().thread_.group_count_. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00074">engine.cpp:74</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af62dcd6c7942c46ce4d64485721a1ac5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a></div><div class="ttdeci">LogGleanerControlBlock gleaner_</div><div class="ttdoc">Gleaner-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00194">snapshot_manager_pimpl.hpp:194</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageOptions_html_a127e9bf3b4309f1dafca757fc11ae6e5"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageOptions.html#a127e9bf3b4309f1dafca757fc11ae6e5">foedus::storage::StorageOptions::partitioner_data_memory_mb_</a></div><div class="ttdeci">uint32_t partitioner_data_memory_mb_</div><div class="ttdoc">Size in MB of a shared memory buffer allocated for all partitioners during log gleaning. </div><div class="ttdef"><b>Definition:</b> <a href="storage__options_8hpp_source.html#l00051">storage_options.hpp:51</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_ae389d11e33892902a0615887b0347478"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#ae389d11e33892902a0615887b0347478">foedus::snapshot::LogGleanerControlBlock::mappers_count_</a></div><div class="ttdeci">uint16_t mappers_count_</div><div class="ttdoc">Total number of mappers. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00112">snapshot_manager_pimpl.hpp:112</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_a3e40cfe4530b10e87344b42be16927e1"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#a3e40cfe4530b10e87344b42be16927e1">foedus::EngineOptions::storage_</a></div><div class="ttdeci">storage::StorageOptions storage_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00145">engine_options.hpp:145</a></div></div>
<div class="ttc" id="classfoedus_1_1DefaultInitializable_html_a22a0dc3bbbca682c3bc41eace9b6d1ff"><div class="ttname"><a href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff">foedus::DefaultInitializable::initialize</a></div><div class="ttdeci">ErrorStack initialize() override final</div><div class="ttdoc">Typical implementation of Initializable::initialize() that provides initialize-once semantics...</div><div class="ttdef"><b>Definition:</b> <a href="initializable_8hpp_source.html#l00169">initializable.hpp:169</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_ab83006539253d08a388edcae4bba4fbe"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#ab83006539253d08a388edcae4bba4fbe">foedus::snapshot::LogGleanerControlBlock::all_count_</a></div><div class="ttdeci">uint16_t all_count_</div><div class="ttdoc">mappers_count_ + reducers_count_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00116">snapshot_manager_pimpl.hpp:116</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a4775dadfb539af5c8d82118735212254"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4775dadfb539af5c8d82118735212254">foedus::snapshot::SnapshotManagerPimpl::previous_snapshot_time_</a></div><div class="ttdeci">std::chrono::system_clock::time_point previous_snapshot_time_</div><div class="ttdoc">When snapshot_thread_ took snapshot last time. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00348">snapshot_manager_pimpl.hpp:348</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a23f8122328ae56b2e599e46cef336701"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a23f8122328ae56b2e599e46cef336701">foedus::snapshot::SnapshotManagerControlBlock::requested_snapshot_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; requested_snapshot_epoch_</div><div class="ttdoc">When a caller wants to immediately invoke snapshot, it calls trigger_snapshot_immediate(), which sets this value and then wakes up snapshot_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00168">snapshot_manager_pimpl.hpp:168</a></div></div>
<div class="ttc" id="structfoedus_1_1thread_1_1ThreadOptions_html_ad9cfcfe5d16d5c394694919d2f59e627"><div class="ttname"><a href="structfoedus_1_1thread_1_1ThreadOptions.html#ad9cfcfe5d16d5c394694919d2f59e627">foedus::thread::ThreadOptions::group_count_</a></div><div class="ttdeci">uint16_t group_count_</div><div class="ttdoc">Number of ThreadGroup in the engine. </div><div class="ttdef"><b>Definition:</b> <a href="thread__options_8hpp_source.html#l00043">thread_options.hpp:43</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ad5187637994473e2fbb7fc484023f307"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">foedus::snapshot::SnapshotManagerPimpl::local_reducer_</a></div><div class="ttdeci">LogReducer * local_reducer_</div><div class="ttdoc">Reducer in this node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00353">snapshot_manager_pimpl.hpp:353</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a20ef0a4fa6050268d88fb3532b90c757"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">foedus::snapshot::SnapshotManagerPimpl::local_mappers_</a></div><div class="ttdeci">std::vector&lt; LogMapper * &gt; local_mappers_</div><div class="ttdoc">Mappers in this node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00351">snapshot_manager_pimpl.hpp:351</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_a97a206187b610b15a6edbfc75a384b1a"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#a97a206187b610b15a6edbfc75a384b1a">foedus::EngineOptions::thread_</a></div><div class="ttdeci">thread::ThreadOptions thread_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00146">engine_options.hpp:146</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a797d62d33506815f6945b0c06bab280d"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a797d62d33506815f6945b0c06bab280d">foedus::snapshot::SnapshotManagerControlBlock::initialize</a></div><div class="ttdeci">void initialize()</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00125">snapshot_manager_pimpl.hpp:125</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_ae9ad7ab6a3df52b0e9f0e50ede6faa2e"><div class="ttname"><a href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e">foedus::Engine::get_soc_manager</a></div><div class="ttdeci">soc::SocManager * get_soc_manager() const </div><div class="ttdoc">See SOC and IPC. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00059">engine.cpp:59</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_ab73c559e1fc986006764b2e6b7c9ac66"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#ab73c559e1fc986006764b2e6b7c9ac66">foedus::snapshot::SnapshotManagerControlBlock::snapshot_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; snapshot_epoch_</div><div class="ttdoc">The most recently snapshot-ed epoch, all logs upto this epoch is safe to delete. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00160">snapshot_manager_pimpl.hpp:160</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a84fdf2f4ccf499b44afed05a273739d9"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a84fdf2f4ccf499b44afed05a273739d9">foedus::snapshot::SnapshotManagerPimpl::handle_snapshot_child</a></div><div class="ttdeci">void handle_snapshot_child()</div><div class="ttdoc">Main routine for snapshot_thread_ in child engines. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00239">snapshot_manager_pimpl.cpp:239</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ab5c66ecba243eccfc78b5ae52aba9f7a"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab5c66ecba243eccfc78b5ae52aba9f7a">foedus::snapshot::SnapshotManagerPimpl::snapshot_thread_</a></div><div class="ttdeci">std::thread snapshot_thread_</div><div class="ttdoc">The daemon thread of snapshot manager. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00342">snapshot_manager_pimpl.hpp:342</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_aee56a2e02a140b766a74d9e9c3088ddb"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#aee56a2e02a140b766a74d9e9c3088ddb">foedus::EngineOptions::log_</a></div><div class="ttdeci">log::LogOptions log_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00138">engine_options.hpp:138</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aaccf99888d69af9c737638c198470161"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaccf99888d69af9c737638c198470161">foedus::snapshot::SnapshotManagerPimpl::stop_requested_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; stop_requested_</div><div class="ttdoc">To locally shutdown snapshot_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00333">snapshot_manager_pimpl.hpp:333</a></div></div>
<div class="ttc" id="structfoedus_1_1log_1_1LogOptions_html_ab5a3f1900a8a5bf69c7d6e049fe30f90"><div class="ttname"><a href="structfoedus_1_1log_1_1LogOptions.html#ab5a3f1900a8a5bf69c7d6e049fe30f90">foedus::log::LogOptions::loggers_per_node_</a></div><div class="ttdeci">uint16_t loggers_per_node_</div><div class="ttdoc">Number of loggers per NUMA node. </div><div class="ttdef"><b>Definition:</b> <a href="log__options_8hpp_source.html#l00080">log_options.hpp:80</a></div></div>
<div class="ttc" id="classfoedus_1_1Epoch_html_af13cf48db2b5bd1d273f5f7350a4d8cf"><div class="ttname"><a href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf">foedus::Epoch::value</a></div><div class="ttdeci">EpochInteger value() const </div><div class="ttdoc">Returns the raw integer representation. </div><div class="ttdef"><b>Definition:</b> <a href="epoch_8hpp_source.html#l00102">epoch.hpp:102</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SocManager_html_a627cf434892c441c90c2de7c20637e9c"><div class="ttname"><a href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c">foedus::soc::SocManager::get_shared_memory_repo</a></div><div class="ttdeci">SharedMemoryRepo * get_shared_memory_repo()</div><div class="ttdoc">Returns the shared memories maintained across SOCs. </div><div class="ttdef"><b>Definition:</b> <a href="soc__manager_8cpp_source.html#l00038">soc_manager.cpp:38</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a632a4da7b3c67dd687f7eba4f6ec1d76_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a632a4da7b3c67dd687f7eba4f6ec1d76_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a632a4da7b3c67dd687f7eba4f6ec1d76_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a632a4da7b3c67dd687f7eba4f6ec1d76_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#a8327c8ba0d722a15f441abc4434bea2b" title="foedus::snapshot::LogGleaner\lResource::allocate" alt="" coords="256,64,451,105"/>
<area shape="rect" id="node7" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb" title="foedus::soc::SharedMemory\lRepo::get_global_memory\l_anchors" alt="" coords="261,130,446,186"/>
<area shape="rect" id="node8" href="classfoedus_1_1savepoint_1_1SavepointManager.html#af2bd4752f20f177d0576f6227feb729b" title="foedus::savepoint::\lSavepointManager::get\l_latest_snapshot_epoch" alt="" coords="272,210,435,266"/>
<area shape="rect" id="node10" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a97ee635381be9e59996fe7b4c9276b0c" title="foedus::savepoint::\lSavepointManager::get\l_latest_snapshot_id" alt="" coords="276,290,431,346"/>
<area shape="rect" id="node12" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="849,531,984,572"/>
<area shape="rect" id="node13" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="849,413,984,455"/>
<area shape="rect" id="node14" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8" title="See Savepoint Manager. " alt="" coords="283,587,423,628"/>
<area shape="rect" id="node15" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c" title="Returns the shared memories maintained across SOCs. " alt="" coords="263,652,443,693"/>
<area shape="rect" id="node16" href="classfoedus_1_1Engine.html#af0ac9dbae9481b295a8492c6d9f6c1d5" title="Shorthand for get_options().thread_.group_count_. " alt="" coords="286,717,421,759"/>
<area shape="rect" id="node17" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e" title="See SOC and IPC. " alt="" coords="286,783,421,824"/>
<area shape="rect" id="node18" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="248,848,459,889"/>
<area shape="rect" id="node24" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="853,883,980,924"/>
<area shape="rect" id="node26" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="845,949,988,975"/>
<area shape="rect" id="node35" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a84fdf2f4ccf499b44afed05a273739d9" title="Main routine for snapshot_thread_ in child engines. " alt="" coords="507,1156,752,1197"/>
<area shape="rect" id="node40" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a797d62d33506815f6945b0c06bab280d" title="foedus::snapshot::Snapshot\lManagerControlBlock::initialize" alt="" coords="253,1535,454,1576"/>
<area shape="rect" id="node43" href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff" title="Typical implementation of Initializable::initialize() that provides initialize&#45;once semantics..." alt="" coords="267,1345,439,1387"/>
<area shape="rect" id="node46" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#adf6f2b1d87dea8f45cd14632fc1c752c" title="foedus::storage::Partitioner\lMetadata::initialize" alt="" coords="264,1632,443,1673"/>
<area shape="rect" id="node49" href="classfoedus_1_1log_1_1LogManager.html#ac69401e015fb167c3a7739bb6b40bc1e" title="Returns whether the object has been already initialized or not. " alt="" coords="271,1697,435,1739"/>
<area shape="rect" id="node50" href="classfoedus_1_1soc_1_1SharedMutex.html#ae886a5d8af1495da00400cc3c958a3d9" title="foedus::soc::SharedMutex\l::is_initialized" alt="" coords="266,1763,441,1804"/>
<area shape="rect" id="node3" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="523,64,736,105"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1memory.html#ac2422aa4fe378da8a9594901762e17df" title="foedus::memory::alloc_mmap" alt="" coords="1081,42,1275,69"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1memory.html#ae51e4a90f52316ba9dce8ff783f30d84" title="foedus::memory::alloc\l_mmap_1gb_pages" alt="" coords="841,5,992,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="836,123,997,164"/>
<area shape="rect" id="node9" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#a941b737c96b7067ca435c69f7af50c31" title="foedus::savepoint::\lSavepointManagerPimpl\l::get_latest_snapshot_epoch" alt="" coords="535,210,724,266"/>
<area shape="rect" id="node11" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#a0f7cfdf2d011c976dafd0d51c43d8ced" title="foedus::savepoint::\lSavepointManagerPimpl\l::get_latest_snapshot_id" alt="" coords="547,290,711,346"/>
<area shape="rect" id="node19" href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa" title="Returns the durable epoch of the entire engine. " alt="" coords="827,611,1007,652"/>
<area shape="rect" id="node20" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600" title="shorthand for engine_&#45;&gt;get_options().snapshot_. " alt="" coords="537,472,721,513"/>
<area shape="rect" id="node21" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a34892c22330eb4e43e9be9754951916b" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_requested_snapshot_epoch" alt="" coords="823,685,1011,741"/>
<area shape="rect" id="node22" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b" title="foedus::snapshot::Snapshot\lManagerPimpl::get_snapshot_epoch" alt="" coords="800,765,1033,807"/>
<area shape="rect" id="node23" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="524,807,735,863"/>
<area shape="rect" id="node25" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="839,831,994,858"/>
<area shape="rect" id="node27" href="classfoedus_1_1ErrorStack.html#a9c7b3a8b3806ff623c7fb4a9db5cbeec" title="Returns if this return code is not kErrorCodeOk. " alt="" coords="564,1287,695,1328"/>
<area shape="rect" id="node28" href="classfoedus_1_1Engine.html#ab775099e113c717528318dfd8642340c" title="Returns whether the engine is currently running. " alt="" coords="566,1221,693,1263"/>
<area shape="rect" id="node30" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de" title="foedus::snapshot::Snapshot\lManagerPimpl::is_stop_requested" alt="" coords="807,1000,1026,1041"/>
<area shape="rect" id="node31" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939" title="Equivalent to std::atomic_thread_fence(std::memory_order_acquire). " alt="" coords="543,640,716,681"/>
<area shape="rect" id="node32" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab6b7456f65be108f3e51455b485f9a12" title="foedus::snapshot::Snapshot\lManagerPimpl::sleep_a_while" alt="" coords="532,1091,727,1132"/>
<area shape="rect" id="node29" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="831,1457,1003,1499"/>
<area shape="rect" id="node33" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="828,1065,1005,1107"/>
<area shape="rect" id="node34" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="828,1131,1005,1172"/>
<area shape="rect" id="node36" href="classfoedus_1_1Engine.html#a8d9a31e48aec9b73e16b64170c0250f9" title="If this is a child instance, returns its SOC ID (NUMA node). " alt="" coords="849,1261,984,1303"/>
<area shape="rect" id="node37" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#abd36bdebf7a189e0ad51021f49ab5349" title="foedus::snapshot::Snapshot\lManagerPimpl::is_gleaning" alt="" coords="825,1327,1009,1368"/>
<area shape="rect" id="node38" href="classfoedus_1_1snapshot_1_1MapReduceBase.html#af685ecd4f6aa00202e875c4d4780ad38" title="foedus::snapshot::MapReduce\lBase::join_thread" alt="" coords="817,1392,1016,1433"/>
<area shape="rect" id="node39" href="classfoedus_1_1snapshot_1_1MapReduceBase.html#a4bb73ed60ea4202f906f63f203b467ff" title="Start executing. " alt="" coords="817,1196,1016,1237"/>
<area shape="rect" id="node41" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a81c5e030a2ec66c5757e4f995b7d3da6" title="foedus::snapshot::LogGleaner\lControlBlock::initialize" alt="" coords="532,1535,727,1576"/>
<area shape="rect" id="node42" href="classfoedus_1_1soc_1_1SharedPolling.html#ace449e19d0a13388da16570aefd42994" title="foedus::soc::SharedPolling\l::initialize" alt="" coords="541,1600,718,1641"/>
<area shape="rect" id="node44" href="classfoedus_1_1DefaultInitializable.html#ab8ae37e5f20f312f8b945fc40d3e0250" title="foedus::DefaultInitializable\l::initialize_once" alt="" coords="543,1469,715,1511"/>
<area shape="rect" id="node45" href="classfoedus_1_1DefaultInitializable.html#a764be22ce1454279e7a7e78f4c8e380b" title="foedus::DefaultInitializable\l::uninitialize_once" alt="" coords="543,1404,715,1445"/>
<area shape="rect" id="node47" href="classfoedus_1_1soc_1_1SharedMutex.html#a752dda273486899f5a58171c2ede01fb" title="foedus::soc::SharedMutex\l::initialize" alt="" coords="542,1665,717,1707"/>
<area shape="rect" id="node48" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a7586439779bf7e56b33ee636c62efdb0" title="foedus::storage::Partitioner\lMetadata::clear_counts" alt="" coords="540,1731,719,1772"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abd36bdebf7a189e0ad51021f49ab5349"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::snapshot::SnapshotManagerPimpl::is_gleaning </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00251">251</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00194">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00076">foedus::snapshot::LogGleanerControlBlock::gleaning_</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">handle_snapshot_child()</a>.</p>
<div class="fragment"><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#acb3ff26887b22796e291c35b8f1b0557">gleaning_</a>; }</div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_acb3ff26887b22796e291c35b8f1b0557"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#acb3ff26887b22796e291c35b8f1b0557">foedus::snapshot::LogGleanerControlBlock::gleaning_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; gleaning_</div><div class="ttdoc">Whether the log gleaner is now running. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00076">snapshot_manager_pimpl.hpp:76</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af62dcd6c7942c46ce4d64485721a1ac5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a></div><div class="ttdeci">LogGleanerControlBlock gleaner_</div><div class="ttdoc">Gleaner-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00194">snapshot_manager_pimpl.hpp:194</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_abd36bdebf7a189e0ad51021f49ab5349_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_abd36bdebf7a189e0ad51021f49ab5349_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_abd36bdebf7a189e0ad51021f49ab5349_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_abd36bdebf7a189e0ad51021f49ab5349_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a84fdf2f4ccf499b44afed05a273739d9" title="Main routine for snapshot_thread_ in child engines. " alt="" coords="237,5,483,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="531,5,725,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a501ce4a1b4b4a847a635ca671c5331de"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool foedus::snapshot::SnapshotManagerPimpl::is_stop_requested </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00250">250</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00333">stop_requested_</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">handle_snapshot_child()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00181">sleep_a_while()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00277">trigger_snapshot_immediate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaccf99888d69af9c737638c198470161">stop_requested_</a>; }</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aaccf99888d69af9c737638c198470161"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaccf99888d69af9c737638c198470161">foedus::snapshot::SnapshotManagerPimpl::stop_requested_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; stop_requested_</div><div class="ttdoc">To locally shutdown snapshot_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00333">snapshot_manager_pimpl.hpp:333</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a501ce4a1b4b4a847a635ca671c5331de_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a501ce4a1b4b4a847a635ca671c5331de_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a501ce4a1b4b4a847a635ca671c5331de_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a501ce4a1b4b4a847a635ca671c5331de_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="547,19,757,60"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a84fdf2f4ccf499b44afed05a273739d9" title="Main routine for snapshot_thread_ in child engines. " alt="" coords="529,84,775,126"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab6b7456f65be108f3e51455b485f9a12" title="foedus::snapshot::Snapshot\lManagerPimpl::sleep_a_while" alt="" coords="279,28,474,70"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4496237075c2f411bb548e1bec7ca06b" title="foedus::snapshot::Snapshot\lManagerPimpl::trigger_snapshot\l_immediate" alt="" coords="272,146,481,202"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="823,52,1017,94"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#ad0ca7bd80adde3e30e439d6902d9b299" title="Immediately take a snapshot. " alt="" coords="560,150,744,206"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa267f8a5bae1442133dc336aa5e9e8c9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a> foedus::snapshot::SnapshotManagerPimpl::issue_next_snapshot_id </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00239">239</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__id_8hpp_source.html#l00052">foedus::snapshot::increment()</a>, <a class="el" href="snapshot__id_8hpp_source.html#l00045">foedus::snapshot::kNullSnapshotId</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00175">foedus::snapshot::SnapshotManagerControlBlock::previous_snapshot_id_</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                      {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a> == <a class="code" href="namespacefoedus_1_1snapshot.html#a26a2120f7b28c565f2d22ff799ee2280">kNullSnapshotId</a>) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a> = 1;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a> = <a class="code" href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730">increment</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">previous_snapshot_id_</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af32b1c2d95d9a9f3919bb27ec8602204"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af32b1c2d95d9a9f3919bb27ec8602204">foedus::snapshot::SnapshotManagerControlBlock::previous_snapshot_id_</a></div><div class="ttdeci">std::atomic&lt; SnapshotId &gt; previous_snapshot_id_</div><div class="ttdoc">ID of previously completed snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00175">snapshot_manager_pimpl.hpp:175</a></div></div>
<div class="ttc" id="group__SNAPSHOT_html_gad1370b531dc11ee1b942d3d8ad829730"><div class="ttname"><a href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730">foedus::snapshot::increment</a></div><div class="ttdeci">SnapshotId increment(SnapshotId id)</div><div class="ttdoc">Increment SnapshotId. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00052">snapshot_id.hpp:52</a></div></div>
<div class="ttc" id="namespacefoedus_1_1snapshot_html_a26a2120f7b28c565f2d22ff799ee2280"><div class="ttname"><a href="namespacefoedus_1_1snapshot.html#a26a2120f7b28c565f2d22ff799ee2280">foedus::snapshot::kNullSnapshotId</a></div><div class="ttdeci">const SnapshotId kNullSnapshotId</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00045">snapshot_id.hpp:45</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aa267f8a5bae1442133dc336aa5e9e8c9_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aa267f8a5bae1442133dc336aa5e9e8c9_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aa267f8a5bae1442133dc336aa5e9e8c9_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_aa267f8a5bae1442133dc336aa5e9e8c9_cgraph">
<area shape="rect" id="node2" href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730" title="Increment SnapshotId. " alt="" coords="237,20,424,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a12f213f8bc7b46e75428a7624999c3fd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::read_snapshot_metadata </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a>&#160;</td>
          <td class="paramname"><em>snapshot_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1snapshot_1_1SnapshotMetadata.html">SnapshotMetadata</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00453">453</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="stop__watch_8hpp_source.html#l00048">foedus::debugging::StopWatch::elapsed_ms()</a>, <a class="el" href="filesystem_8cpp_source.html#l00120">foedus::fs::file_size()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00480">get_snapshot_metadata_file_path()</a>, <a class="el" href="snapshot__metadata_8hpp_source.html#l00056">foedus::snapshot::SnapshotMetadata::id_</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="externalizable_8cpp_source.html#l00075">foedus::externalize::Externalizable::load_from_file()</a>, and <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager_8cpp_source.html#l00047">foedus::snapshot::SnapshotManager::read_snapshot_metadata()</a>.</p>
<div class="fragment"><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                         {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  fs::Path file = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0">get_snapshot_metadata_file_path</a>(snapshot_id);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Reading snapshot metadata file fullpath=&quot;</span> &lt;&lt; file;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  debugging::StopWatch stop_watch;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(out-&gt;load_from_file(file));</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Read a snapshot metadata file. size=&quot;</span> &lt;&lt; <a class="code" href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8">fs::file_size</a>(file) &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, elapsed time to read+parse=&quot;</span> &lt;&lt; stop_watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms.&quot;</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(out-&gt;id_ == snapshot_id);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;}</div>
<div class="ttc" id="group__FILESYSTEM_html_ga1048a33bafe4dcea89991112ae2660d8"><div class="ttname"><a href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8">foedus::fs::file_size</a></div><div class="ttdeci">uint64_t file_size(const Path &amp;p)</div><div class="ttdoc">Returns size of the file. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8cpp_source.html#l00120">filesystem.cpp:120</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a7cb397e7c8042e460f5f0e36d939b3e0"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0">foedus::snapshot::SnapshotManagerPimpl::get_snapshot_metadata_file_path</a></div><div class="ttdeci">fs::Path get_snapshot_metadata_file_path(SnapshotId snapshot_id) const </div><div class="ttdoc">each snapshot has a snapshot-metadata file "snapshot_metadata_<SNAPSHOT_ID>.xml" in first node&#39;s firs...</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00480">snapshot_manager_pimpl.cpp:480</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="265,5,430,47"/>
<area shape="rect" id="node3" href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8" title="Returns size of the file. " alt="" coords="729,71,862,98"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0" title="each snapshot has a snapshot&#45;metadata file &quot;snapshot_metadata_&lt;SNAPSHOT_ID&gt;.xml&quot; in first node&#39;s firs..." alt="" coords="252,122,443,178"/>
<area shape="rect" id="node8" href="structfoedus_1_1externalize_1_1Externalizable.html#a6f66d8519bcfee0a582cae47a822fe18" title="Load the content of this object from the specified XML file. " alt="" coords="275,213,419,269"/>
<area shape="rect" id="node13" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="280,356,415,397"/>
<area shape="rect" id="node4" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="916,189,1067,215"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600" title="shorthand for engine_&#45;&gt;get_options().snapshot_. " alt="" coords="491,123,675,164"/>
<area shape="rect" id="node7" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="728,123,863,164"/>
<area shape="rect" id="node9" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4" title="Returns if the file exists. " alt="" coords="522,239,643,266"/>
<area shape="rect" id="node12" href="structfoedus_1_1externalize_1_1Externalizable.html#a546988f0869a3899e671f702ecbc5b17" title="Reads the content of this object from the given XML element. " alt="" coords="511,291,655,332"/>
<area shape="rect" id="node10" href="structfoedus_1_1fs_1_1FileStatus.html#ac4ab24d4308aab673c8d1606a84367e5" title="foedus::fs::FileStatus\l::exists" alt="" coords="723,240,868,281"/>
<area shape="rect" id="node11" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="734,306,857,333"/>
<area shape="rect" id="node14" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="502,356,663,397"/>
<area shape="rect" id="node15" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="515,421,650,463"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a12f213f8bc7b46e75428a7624999c3fd_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#a4508beef5e0c55a8db38b95f42c41fad" title="Read the snapshot metadata file that contains storages as of the snapshot. " alt="" coords="252,5,436,61"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a49864b0bae19e6c2fe61a2422d1650af" title="foedus::storage::Storage\lManagerPimpl::initialize\l_read_latest_snapshot" alt="" coords="484,5,648,61"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#ad89ca2bb2619e01c3b13d65302a3d7c9" title="foedus::storage::Storage\lManagerPimpl::initialize_once" alt="" coords="696,13,891,54"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab6b7456f65be108f3e51455b485f9a12"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::snapshot::SnapshotManagerPimpl::sleep_a_while </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00181">181</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="shared__polling_8cpp_source.html#l00105">foedus::soc::SharedPolling::acquire_ticket()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00250">is_stop_requested()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00184">foedus::snapshot::SnapshotManagerControlBlock::snapshot_wakeup_</a>, and <a class="el" href="shared__polling_8cpp_source.html#l00063">foedus::soc::SharedPolling::timedwait()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                         {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  uint64_t demand = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a4cf18e1b591da3508ee04696b950f98e">snapshot_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">acquire_ticket</a>();</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>()) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a4cf18e1b591da3508ee04696b950f98e">snapshot_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">timedwait</a>(demand, 20000ULL);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ac6ad7822e42e2e942b55708b1da8516b"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">foedus::soc::SharedPolling::acquire_ticket</a></div><div class="ttdeci">uint64_t acquire_ticket() const </div><div class="ttdoc">Gives the ticket to. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00105">shared_polling.cpp:105</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a4cf18e1b591da3508ee04696b950f98e"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a4cf18e1b591da3508ee04696b950f98e">foedus::snapshot::SnapshotManagerControlBlock::snapshot_wakeup_</a></div><div class="ttdeci">soc::SharedPolling snapshot_wakeup_</div><div class="ttdoc">Snapshot thread sleeps on this condition variable. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00184">snapshot_manager_pimpl.hpp:184</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a501ce4a1b4b4a847a635ca671c5331de"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">foedus::snapshot::SnapshotManagerPimpl::is_stop_requested</a></div><div class="ttdeci">bool is_stop_requested() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00250">snapshot_manager_pimpl.hpp:250</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_a1b9f5c8b129c454887a77d3255956157"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">foedus::soc::SharedPolling::timedwait</a></div><div class="ttdeci">bool timedwait(uint64_t demanded_ticket, uint64_t timeout_microsec, uint64_t polling_spins=kDefaultPollingSpins, uint64_t max_interval_us=kDefaultPollingMaxIntervalUs) const </div><div class="ttdoc">Wait for signal up to the given timeout. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00063">shared_polling.cpp:63</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="269,5,446,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de" title="foedus::snapshot::Snapshot\lManagerPimpl::is_stop_requested" alt="" coords="248,71,467,112"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="269,136,446,177"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="515,5,688,47"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1soc.html#a875ded688a72b32f8f690f37750e609f" title="foedus::soc::get_now\l_microsec" alt="" coords="529,136,674,177"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab6b7456f65be108f3e51455b485f9a12_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="248,5,459,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="507,5,701,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4ae6b016213cb70bb6e5df636b24d129"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::snapshot_metadata </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;&#160;</td>
          <td class="paramname"><em>new_snapshot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a>, <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>new_root_page_pointers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>. </p>
<p>Write out a snapshot metadata file that contains metadata of all storages and a few other global metadata. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00401">401</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="snapshot_8hpp_source.html#l00049">foedus::snapshot::Snapshot::base_epoch_</a>, <a class="el" href="snapshot__metadata_8hpp_source.html#l00059">foedus::snapshot::SnapshotMetadata::base_epoch_</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="storage__manager_8cpp_source.html#l00119">foedus::storage::StorageManager::clone_all_storage_metadata()</a>, <a class="el" href="filesystem_8cpp_source.html#l00089">foedus::fs::create_directories()</a>, <a class="el" href="stop__watch_8hpp_source.html#l00048">foedus::debugging::StopWatch::elapsed_ms()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="error__stack_8hpp_source.html#l00480">ERROR_STACK</a>, <a class="el" href="filesystem_8hpp_source.html#l00128">foedus::fs::exists()</a>, <a class="el" href="filesystem_8cpp_source.html#l00120">foedus::fs::file_size()</a>, <a class="el" href="filesystem_8cpp_source.html#l00203">foedus::fs::fsync()</a>, <a class="el" href="snapshot__metadata_8hpp_source.html#l00046">foedus::snapshot::SnapshotMetadata::get_metadata()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00057">get_option()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00480">get_snapshot_metadata_file_path()</a>, <a class="el" href="engine_8cpp_source.html#l00060">foedus::Engine::get_storage_manager()</a>, <a class="el" href="snapshot_8hpp_source.html#l00043">foedus::snapshot::Snapshot::id_</a>, <a class="el" href="snapshot__metadata_8hpp_source.html#l00056">foedus::snapshot::SnapshotMetadata::id_</a>, <a class="el" href="storage_8hpp_source.html#l00059">foedus::storage::StorageControlBlock::is_valid_status()</a>, <a class="el" href="error__code_8hpp_source.html#l00138">foedus::kErrorCodeFsMkdirFailed</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="snapshot__metadata_8hpp_source.html#l00065">foedus::snapshot::SnapshotMetadata::largest_storage_id_</a>, <a class="el" href="snapshot_8hpp_source.html#l00058">foedus::snapshot::Snapshot::max_storage_id_</a>, <a class="el" href="externalizable_8cpp_source.html#l00096">foedus::externalize::Externalizable::save_to_file()</a>, <a class="el" href="stop__watch_8cpp_source.html#l00030">foedus::debugging::StopWatch::start()</a>, <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>, <a class="el" href="snapshot__metadata_8hpp_source.html#l00072">foedus::snapshot::SnapshotMetadata::storage_control_blocks_</a>, <a class="el" href="snapshot_8hpp_source.html#l00055">foedus::snapshot::Snapshot::valid_until_epoch_</a>, <a class="el" href="snapshot__metadata_8hpp_source.html#l00062">foedus::snapshot::SnapshotMetadata::valid_until_epoch_</a>, and <a class="el" href="epoch_8hpp_source.html#l00102">foedus::Epoch::value()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>.</p>
<div class="fragment"><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                                                                      {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// construct metadata object</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  SnapshotMetadata metadata;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  metadata.id_ = new_snapshot.id_;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  metadata.base_epoch_ = new_snapshot.base_epoch_.value();</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  metadata.valid_until_epoch_ = new_snapshot.valid_until_epoch_.value();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  metadata.largest_storage_id_ = new_snapshot.max_storage_id_;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">get_storage_manager</a>()-&gt;<a class="code" href="classfoedus_1_1storage_1_1StorageManager.html#a1b7056a40786dc501f373380e411a6ae">clone_all_storage_metadata</a>(&amp;metadata));</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">// we modified the root page.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  uint32_t installed_root_pages_count = 0;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a> <span class="keywordtype">id</span> = 1; <span class="keywordtype">id</span> &lt;= metadata.largest_storage_id_; ++id) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; it = new_root_page_pointers.find(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(metadata.storage_control_blocks_[<span class="keywordtype">id</span>].is_valid_status());</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    storage::Metadata* meta = metadata.get_metadata(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span> (it != new_root_page_pointers.end()) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> new_pointer = it-&gt;second;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="comment">// composer&#39;s construct_root should have been already set the new root pointer</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_pointer == meta-&gt;root_snapshot_page_id_);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      ++installed_root_pages_count;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Out of &quot;</span> &lt;&lt; metadata.largest_storage_id_ &lt;&lt; <span class="stringliteral">&quot; storages, &quot;</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    &lt;&lt; installed_root_pages_count &lt;&lt; <span class="stringliteral">&quot; changed their root pages.&quot;</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(installed_root_pages_count == new_root_page_pointers.size());</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">// save it to a file</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  fs::Path folder(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600">get_option</a>().get_primary_folder_path());</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4">fs::exists</a>(folder)) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="group__FILESYSTEM.html#gaca1dd0a627c83ff76e30603ea67c4816">fs::create_directories</a>(folder, <span class="keyword">true</span>)) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Failed to create directory:&quot;</span> &lt;&lt; folder &lt;&lt; <span class="stringliteral">&quot;. check permission.&quot;</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aebb349586ff80831796c84138fd32f68">kErrorCodeFsMkdirFailed</a>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  fs::Path file = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0">get_snapshot_metadata_file_path</a>(new_snapshot.id_);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;New snapshot metadata file fullpath=&quot;</span> &lt;&lt; file;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  debugging::StopWatch stop_watch;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(metadata.save_to_file(file));</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Wrote a snapshot metadata file. size=&quot;</span> &lt;&lt; <a class="code" href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8">fs::file_size</a>(file) &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, elapsed time to write=&quot;</span> &lt;&lt; stop_watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms. now fsyncing...&quot;</span>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  stop_watch.start();</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <a class="code" href="group__FILESYSTEM.html#ga08865450d848cb894243005bdd226d1e">fs::fsync</a>(file, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;fsynced the file and the folder! elapsed=&quot;</span> &lt;&lt; stop_watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms.&quot;</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56aebb349586ff80831796c84138fd32f68"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56aebb349586ff80831796c84138fd32f68">foedus::kErrorCodeFsMkdirFailed</a></div><div class="ttdoc">0x020D : "FILESYS: Failed to create a directory" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00138">error_code.hpp:138</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_ac27d3734638fe8d18fbdc9b4ee4666b2"><div class="ttname"><a href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2">foedus::Engine::get_storage_manager</a></div><div class="ttdeci">storage::StorageManager * get_storage_manager() const </div><div class="ttdoc">See Storage Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00060">engine.cpp:60</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa598b0ca7f0de626ecfa17f2cd58d5b4"><div class="ttname"><a href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a></div><div class="ttdeci">#define ERROR_STACK(e)        </div><div class="ttdoc">Instantiates ErrorStack with the given foedus::error_code, creating an error stack with the current f...</div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00480">error_stack.hpp:480</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a058c0e139d36b76aaeb1e8b9a62dd600"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600">foedus::snapshot::SnapshotManagerPimpl::get_option</a></div><div class="ttdeci">const SnapshotOptions &amp; get_option() const </div><div class="ttdoc">shorthand for engine_->get_options().snapshot_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00057">snapshot_manager_pimpl.cpp:57</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga595ca7fc4a3011a9704a883a25141e5f"><div class="ttname"><a href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">foedus::storage::StorageId</a></div><div class="ttdeci">uint32_t StorageId</div><div class="ttdoc">Unique ID for storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00055">storage_id.hpp:55</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1StorageManager_html_a1b7056a40786dc501f373380e411a6ae"><div class="ttname"><a href="classfoedus_1_1storage_1_1StorageManager.html#a1b7056a40786dc501f373380e411a6ae">foedus::storage::StorageManager::clone_all_storage_metadata</a></div><div class="ttdeci">ErrorStack clone_all_storage_metadata(snapshot::SnapshotMetadata *metadata)</div><div class="ttdoc">This method is called during snapshotting to clone metadata of all existing storages to the given obj...</div><div class="ttdef"><b>Definition:</b> <a href="storage__manager_8cpp_source.html#l00119">storage_manager.cpp:119</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga629d4b8103bfb83ef9c11b842a4fd398"><div class="ttname"><a href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">foedus::storage::SnapshotPagePointer</a></div><div class="ttdeci">uint64_t SnapshotPagePointer</div><div class="ttdoc">Page ID of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00079">storage_id.hpp:79</a></div></div>
<div class="ttc" id="group__FILESYSTEM_html_gaca1dd0a627c83ff76e30603ea67c4816"><div class="ttname"><a href="group__FILESYSTEM.html#gaca1dd0a627c83ff76e30603ea67c4816">foedus::fs::create_directories</a></div><div class="ttdeci">bool create_directories(const Path &amp;p, bool sync=false)</div><div class="ttdoc">Recursive mkdir (mkdirs). </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8cpp_source.html#l00089">filesystem.cpp:89</a></div></div>
<div class="ttc" id="group__FILESYSTEM_html_ga4f8f53901e9c98fce72b6b3c52cf83a4"><div class="ttname"><a href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4">foedus::fs::exists</a></div><div class="ttdeci">bool exists(const Path &amp;p)</div><div class="ttdoc">Returns if the file exists. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8hpp_source.html#l00128">filesystem.hpp:128</a></div></div>
<div class="ttc" id="group__FILESYSTEM_html_ga1048a33bafe4dcea89991112ae2660d8"><div class="ttname"><a href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8">foedus::fs::file_size</a></div><div class="ttdeci">uint64_t file_size(const Path &amp;p)</div><div class="ttdoc">Returns size of the file. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8cpp_source.html#l00120">filesystem.cpp:120</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a7cb397e7c8042e460f5f0e36d939b3e0"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0">foedus::snapshot::SnapshotManagerPimpl::get_snapshot_metadata_file_path</a></div><div class="ttdeci">fs::Path get_snapshot_metadata_file_path(SnapshotId snapshot_id) const </div><div class="ttdoc">each snapshot has a snapshot-metadata file "snapshot_metadata_<SNAPSHOT_ID>.xml" in first node&#39;s firs...</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00480">snapshot_manager_pimpl.cpp:480</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__FILESYSTEM_html_ga08865450d848cb894243005bdd226d1e"><div class="ttname"><a href="group__FILESYSTEM.html#ga08865450d848cb894243005bdd226d1e">foedus::fs::fsync</a></div><div class="ttdeci">bool fsync(const Path &amp;path, bool sync_parent_directory=false)</div><div class="ttdoc">Makes the content and metadata of the file durable all the way up to devices. </div><div class="ttdef"><b>Definition:</b> <a href="filesystem_8cpp_source.html#l00203">filesystem.cpp:203</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1StorageManager.html#a1b7056a40786dc501f373380e411a6ae" title="This method is called during snapshotting to clone metadata of all existing storages to the given obj..." alt="" coords="242,1119,423,1175"/>
<area shape="rect" id="node16" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="981,1307,1115,1348"/>
<area shape="rect" id="node19" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="732,1301,897,1343"/>
<area shape="rect" id="node20" href="group__FILESYSTEM.html#gaca1dd0a627c83ff76e30603ea67c4816" title="Recursive mkdir (mkdirs). " alt="" coords="753,251,876,292"/>
<area shape="rect" id="node23" href="group__FILESYSTEM.html#ga08865450d848cb894243005bdd226d1e" title="Makes the content and metadata of the file durable all the way up to devices. " alt="" coords="1213,607,1330,634"/>
<area shape="rect" id="node30" href="group__FILESYSTEM.html#ga4f8f53901e9c98fce72b6b3c52cf83a4" title="Returns if the file exists. " alt="" coords="987,119,1109,146"/>
<area shape="rect" id="node32" href="group__FILESYSTEM.html#ga1048a33bafe4dcea89991112ae2660d8" title="Returns size of the file. " alt="" coords="748,47,881,74"/>
<area shape="rect" id="node33" href="structfoedus_1_1snapshot_1_1SnapshotMetadata.html#a69ec31282dee73c4cbea823aa2a06a85" title="foedus::snapshot::Snapshot\lMetadata::get_metadata" alt="" coords="241,1301,425,1343"/>
<area shape="rect" id="node34" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a058c0e139d36b76aaeb1e8b9a62dd600" title="shorthand for engine_&#45;&gt;get_options().snapshot_. " alt="" coords="476,1429,660,1471"/>
<area shape="rect" id="node36" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a7cb397e7c8042e460f5f0e36d939b3e0" title="each snapshot has a snapshot&#45;metadata file &quot;snapshot_metadata_&lt;SNAPSHOT_ID&gt;.xml&quot; in first node&#39;s firs..." alt="" coords="237,1367,428,1423"/>
<area shape="rect" id="node37" href="classfoedus_1_1Engine.html#ac27d3734638fe8d18fbdc9b4ee4666b2" title="See Storage Manager. " alt="" coords="265,1499,400,1540"/>
<area shape="rect" id="node38" href="structfoedus_1_1storage_1_1StorageControlBlock.html#a7777fa908acfd1da5918e9f0369f8ed7" title="foedus::storage::Storage\lControlBlock::is_valid\l_status" alt="" coords="251,1565,415,1621"/>
<area shape="rect" id="node39" href="structfoedus_1_1externalize_1_1Externalizable.html#af4e4989a732573c1bbd538a3fbfad930" title="Atomically and durably writes out this object to the specified XML file. " alt="" coords="259,575,406,631"/>
<area shape="rect" id="node49" href="classfoedus_1_1debugging_1_1StopWatch.html#a9f35df8dc3c371659227375baa247074" title="Take current time tick. " alt="" coords="501,1312,635,1353"/>
<area shape="rect" id="node50" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="261,1645,404,1671"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1StorageManagerPimpl.html#a7e6f699df114e5e49194791ed183f52f" title="foedus::storage::Storage\lManagerPimpl::clone_all\l_storage_metadata" alt="" coords="486,1119,650,1175"/>
<area shape="rect" id="node4" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="728,1236,901,1277"/>
<area shape="rect" id="node5" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="708,1003,921,1044"/>
<area shape="rect" id="node18" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="708,1171,921,1212"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1memory.html#ac2422aa4fe378da8a9594901762e17df" title="foedus::memory::alloc_mmap" alt="" coords="1175,1087,1368,1114"/>
<area shape="rect" id="node8" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="1441,811,1581,852"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1memory.html#ae51e4a90f52316ba9dce8ff783f30d84" title="foedus::memory::alloc\l_mmap_1gb_pages" alt="" coords="973,1139,1123,1180"/>
<area shape="rect" id="node10" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="1191,1273,1352,1315"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gab3d1892edaa7db4b02029567b7993f37" title="In order to run even on a non&#45;numa machine or a machine with fewer sockets, we allow specifying arbit..." alt="" coords="973,1021,1123,1063"/>
<area shape="rect" id="node12" href="numa_8h.html#a413cadd87796fff247c83d9ad817cc7e" title="numa_available" alt="" coords="1216,970,1327,997"/>
<area shape="rect" id="node14" href="numa_8h.html#aba49c14c68d23dc05d046db02766b928" title="numa_preferred" alt="" coords="993,1205,1103,1231"/>
<area shape="rect" id="node15" href="numa_8h.html#a56f33968932f6550e5e5eb4d1acc67b3" title="numa_set_preferred" alt="" coords="980,919,1116,946"/>
<area shape="rect" id="node7" href="namespacefoedus_1_1memory.html#af6145d9296231995c84badafb6a2a0a9" title="Returns if 1GB hugepages were enabled. " alt="" coords="1428,1080,1593,1121"/>
<area shape="rect" id="node13" href="numa_8h.html#a22585176d6e08c221de8377637bd72a7" title="numa_num_configured\l_nodes" alt="" coords="1195,1021,1347,1063"/>
<area shape="rect" id="node17" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="1204,1352,1339,1393"/>
<area shape="rect" id="node21" href="group__FILESYSTEM.html#ga5cf40c936f78178ef58af0a900031b8b" title="mkdir. " alt="" coords="987,272,1109,313"/>
<area shape="rect" id="node27" href="classfoedus_1_1fs_1_1Path.html#a9859706102ecca097e723d762ec468ae" title="foedus::fs::Path::parent_path" alt="" coords="1416,441,1605,467"/>
<area shape="rect" id="node29" href="classfoedus_1_1fs_1_1Path.html#a4efe9caad4e61d844b04a90a4c43b3cb" title="foedus::fs::Path::empty" alt="" coords="969,221,1127,247"/>
<area shape="rect" id="node22" href="classfoedus_1_1fs_1_1Path.html#a821cee2f2cec808d90e187513064f40f" title="foedus::fs::Path::c_str" alt="" coords="1849,319,2000,346"/>
<area shape="rect" id="node24" href="group__FILESYSTEM.html#ga87c90d834f65aad6f7b6540ae226f305" title="Returns if the file is a directory. " alt="" coords="1434,607,1587,634"/>
<area shape="rect" id="node25" href="structfoedus_1_1fs_1_1FileStatus.html#a7b8858f191dee3d9a92cae0cd759c1e5" title="foedus::fs::FileStatus\l::is_directory" alt="" coords="1655,592,1800,633"/>
<area shape="rect" id="node26" href="group__FILESYSTEM.html#gaaa833e3af93824a2485400b32dab7bcd" title="Returns the status of the file. " alt="" coords="1666,385,1789,411"/>
<area shape="rect" id="node28" href="classfoedus_1_1fs_1_1Path.html#a95efbd1ef2b5f97560bdc964ab0b00ed" title="foedus::fs::Path::Path" alt="" coords="1653,334,1801,361"/>
<area shape="rect" id="node31" href="structfoedus_1_1fs_1_1FileStatus.html#ac4ab24d4308aab673c8d1606a84367e5" title="foedus::fs::FileStatus\l::exists" alt="" coords="1199,112,1344,153"/>
<area shape="rect" id="node35" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="747,1429,882,1471"/>
<area shape="rect" id="node40" href="classfoedus_1_1fs_1_1DirectIoFile.html#a7888a3b0c169fbc6b2e6e83c86d5f267" title="Close the file if not yet closed. " alt="" coords="493,819,643,860"/>
<area shape="rect" id="node41" href="group__FILESYSTEM.html#ga71591d3386f8adc320dac30d0320a3ee" title="fsync() on source file before rename, then fsync() on the parent folder after rename. " alt="" coords="984,549,1112,591"/>
<area shape="rect" id="node43" href="structfoedus_1_1externalize_1_1Externalizable.html#ad6b9ab6485d761a9d2d5402da7c97700" title="Returns an XML tag name for this object as a root element. " alt="" coords="499,250,637,306"/>
<area shape="rect" id="node44" href="classfoedus_1_1fs_1_1DirectIoFile.html#aaa3c1e50680d02783b61f5fe23f98b14" title="Tries to open the file for the specified volume. " alt="" coords="493,448,643,489"/>
<area shape="rect" id="node46" href="classfoedus_1_1fs_1_1DirectIoFile.html#a9f19d10be82ac60706853e106a5de0e1" title="Sequentially write the given amount of contents from the current position. " alt="" coords="739,549,890,591"/>
<area shape="rect" id="node47" href="structfoedus_1_1externalize_1_1Externalizable.html#a19c407586854a4765981cf165b653ef5" title="Writes the content of this object to the given XML element. " alt="" coords="495,331,641,372"/>
<area shape="rect" id="node48" href="group__FILESYSTEM.html#ga3bc4f808e645c94d80e86221b0d32301" title="Equivalent to unique_path(&quot;%%%%&#45;%%%%&#45;%%%%&#45;%%%%&quot;). " alt="" coords="487,514,649,541"/>
<area shape="rect" id="node42" href="group__FILESYSTEM.html#gae7728f7a6fdfeeb13567e1f1f110fcd8" title="Renames the old file to the new file with the POSIX atomic&#45;rename semantics. " alt="" coords="1665,467,1790,508"/>
<area shape="rect" id="node45" href="classfoedus_1_1fs_1_1DirectIoFile.html#a1c6bff6aafc955fd4c2a8e11e7f41f40" title="Sequentially read the given amount of contents from the current position. " alt="" coords="739,432,890,473"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4ae6b016213cb70bb6e5df636b24d129_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="237,31,448,87"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="496,5,707,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="524,71,679,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="755,5,949,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="755,71,949,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a45097869d980cf8fe0ad3313e02c8117"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::snapshot_savepoint </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &amp;&#160;</td>
          <td class="paramname"><em>new_snapshot</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sub-routine of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. ">handle_snapshot_triggered()</a>. </p>
<p>Invokes the savepoint module to take savepoint pointing to this snapshot. Until that, the snapshot is not yet deemed as "happened". </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00469">469</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="savepoint__manager_8cpp_source.html#l00052">foedus::savepoint::SavepointManager::get_latest_snapshot_epoch()</a>, <a class="el" href="savepoint__manager_8cpp_source.html#l00049">foedus::savepoint::SavepointManager::get_latest_snapshot_id()</a>, <a class="el" href="engine_8cpp_source.html#l00053">foedus::Engine::get_savepoint_manager()</a>, <a class="el" href="snapshot_8hpp_source.html#l00043">foedus::snapshot::Snapshot::id_</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="savepoint__manager_8cpp_source.html#l00059">foedus::savepoint::SavepointManager::take_savepoint_after_snapshot()</a>, and <a class="el" href="snapshot_8hpp_source.html#l00055">foedus::snapshot::Snapshot::valid_until_epoch_</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>.</p>
<div class="fragment"><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                                                                {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Taking savepoint to include this new snapshot....&quot;</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">get_savepoint_manager</a>()-&gt;<a class="code" href="classfoedus_1_1savepoint_1_1SavepointManager.html#aaecb5989eaca658a8fbdc7de6c85222c">take_savepoint_after_snapshot</a>(</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    new_snapshot.id_,</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    new_snapshot.valid_until_epoch_));</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">get_savepoint_manager</a>()-&gt;<a class="code" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a97ee635381be9e59996fe7b4c9276b0c">get_latest_snapshot_id</a>() == new_snapshot.id_);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">get_savepoint_manager</a>()-&gt;<a class="code" href="classfoedus_1_1savepoint_1_1SavepointManager.html#af2bd4752f20f177d0576f6227feb729b">get_latest_snapshot_epoch</a>()</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    == new_snapshot.valid_until_epoch_);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1savepoint_1_1SavepointManager_html_aaecb5989eaca658a8fbdc7de6c85222c"><div class="ttname"><a href="classfoedus_1_1savepoint_1_1SavepointManager.html#aaecb5989eaca658a8fbdc7de6c85222c">foedus::savepoint::SavepointManager::take_savepoint_after_snapshot</a></div><div class="ttdeci">ErrorStack take_savepoint_after_snapshot(snapshot::SnapshotId new_snapshot_id, Epoch new_snapshot_epoch)</div><div class="ttdoc">Takes a savepoint just to remember the newly taken snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="savepoint__manager_8cpp_source.html#l00059">savepoint_manager.cpp:59</a></div></div>
<div class="ttc" id="classfoedus_1_1savepoint_1_1SavepointManager_html_a97ee635381be9e59996fe7b4c9276b0c"><div class="ttname"><a href="classfoedus_1_1savepoint_1_1SavepointManager.html#a97ee635381be9e59996fe7b4c9276b0c">foedus::savepoint::SavepointManager::get_latest_snapshot_id</a></div><div class="ttdeci">snapshot::SnapshotId get_latest_snapshot_id() const </div><div class="ttdef"><b>Definition:</b> <a href="savepoint__manager_8cpp_source.html#l00049">savepoint_manager.cpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1savepoint_1_1SavepointManager_html_af2bd4752f20f177d0576f6227feb729b"><div class="ttname"><a href="classfoedus_1_1savepoint_1_1SavepointManager.html#af2bd4752f20f177d0576f6227feb729b">foedus::savepoint::SavepointManager::get_latest_snapshot_epoch</a></div><div class="ttdeci">Epoch get_latest_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="savepoint__manager_8cpp_source.html#l00052">savepoint_manager.cpp:52</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a4f168d41ea00249fefe905def87e80c8"><div class="ttname"><a href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">foedus::Engine::get_savepoint_manager</a></div><div class="ttdeci">savepoint::SavepointManager * get_savepoint_manager() const </div><div class="ttdoc">See Savepoint Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00053">engine.cpp:53</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1savepoint_1_1SavepointManager.html#af2bd4752f20f177d0576f6227feb729b" title="foedus::savepoint::\lSavepointManager::get\l_latest_snapshot_epoch" alt="" coords="460,5,623,61"/>
<area shape="rect" id="node4" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a97ee635381be9e59996fe7b4c9276b0c" title="foedus::savepoint::\lSavepointManager::get\l_latest_snapshot_id" alt="" coords="464,85,619,141"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8" title="See Savepoint Manager. " alt="" coords="255,231,395,273"/>
<area shape="rect" id="node7" href="classfoedus_1_1savepoint_1_1SavepointManager.html#aaecb5989eaca658a8fbdc7de6c85222c" title="Takes a savepoint just to remember the newly taken snapshot. " alt="" coords="237,151,412,207"/>
<area shape="rect" id="node3" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#a941b737c96b7067ca435c69f7af50c31" title="foedus::savepoint::\lSavepointManagerPimpl\l::get_latest_snapshot_epoch" alt="" coords="671,5,860,61"/>
<area shape="rect" id="node5" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#a0f7cfdf2d011c976dafd0d51c43d8ced" title="foedus::savepoint::\lSavepointManagerPimpl\l::get_latest_snapshot_id" alt="" coords="683,85,847,141"/>
<area shape="rect" id="node8" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#a48fedb8938affadcce93051ff8c2ce6f" title="foedus::savepoint::\lSavepointManagerPimpl\l::take_savepoint_after\l_snapshot" alt="" coords="461,166,622,237"/>
<area shape="rect" id="node9" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="677,282,854,323"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="677,347,854,389"/>
<area shape="rect" id="node13" href="classfoedus_1_1Epoch.html#af13cf48db2b5bd1d273f5f7350a4d8cf" title="Returns the raw integer representation. " alt="" coords="694,165,837,192"/>
<area shape="rect" id="node14" href="classfoedus_1_1soc_1_1SharedPolling.html#a9fc7bfaf57e1f2224be9869a8e9708d3" title="Unconditionally wait for signal. " alt="" coords="677,217,854,258"/>
<area shape="rect" id="node10" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="917,286,1090,327"/>
<area shape="rect" id="node12" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="908,355,1099,381"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a45097869d980cf8fe0ad3313e02c8117_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="237,31,448,87"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="496,5,707,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="524,71,679,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="755,5,949,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="755,71,949,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac35e1cb910337b9d66852e47202fb442"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::snapshot::SnapshotManagerPimpl::stop_snapshot_thread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is a hidden API called at the beginning of engine shutdown (namely restart manager). </p>
<p><a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html" title="Represents one snapshot that converts all logs from base epoch to valid_until epoch into snapshot fil...">Snapshot</a> Manager initializes before Storage because it must <em>read</em> previous snapshot, but it must stop snapshot thread before Storage because the snapshot thread relies on storage module. To solve the issue, we call this method from restart manager's uninit to stop snapshot thread. This method is also called by snapshot manager's own uninit() in case restart manager didn't initialize. Thus, this method must be idempotent. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00164">164</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00078">foedus::snapshot::LogGleanerControlBlock::cancelled_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00194">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00342">snapshot_thread_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00333">stop_requested_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00080">foedus::snapshot::LogGleanerControlBlock::terminating_</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00187">wakeup()</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00150">foedus::snapshot::SnapshotManagerControlBlock::wakeup_snapshot_children()</a>.</p>

<p>Referenced by <a class="el" href="restart__manager__pimpl_8cpp_source.html#l00057">foedus::restart::RestartManagerPimpl::uninitialize_once()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00125">uninitialize_once()</a>.</p>
<div class="fragment"><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                                                {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Stopping the snapshot thread...&quot;</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab5c66ecba243eccfc78b5ae52aba9f7a">snapshot_thread_</a>.joinable()) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// whether from master or not, just make sure all reducers/mappers notice that it&#39;s closing</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaccf99888d69af9c737638c198470161">stop_requested_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a5bbb45b0f13414460c233e1d1c6962d2">cancelled_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">gleaner_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#ada104b0ad4f83572ee044cbffcfd6a5a">terminating_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>()) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6">wakeup</a>();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aea6701821c4d7184cac37f3ad552c60f">wakeup_snapshot_children</a>();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab5c66ecba243eccfc78b5ae52aba9f7a">snapshot_thread_</a>.join();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Stopped the snapshot thread.&quot;</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_af62dcd6c7942c46ce4d64485721a1ac5"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af62dcd6c7942c46ce4d64485721a1ac5">foedus::snapshot::SnapshotManagerControlBlock::gleaner_</a></div><div class="ttdeci">LogGleanerControlBlock gleaner_</div><div class="ttdoc">Gleaner-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00194">snapshot_manager_pimpl.hpp:194</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_aea6701821c4d7184cac37f3ad552c60f"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aea6701821c4d7184cac37f3ad552c60f">foedus::snapshot::SnapshotManagerControlBlock::wakeup_snapshot_children</a></div><div class="ttdeci">void wakeup_snapshot_children()</div><div class="ttdoc">Fires snapshot_children_wakeup_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00150">snapshot_manager_pimpl.hpp:150</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_ada104b0ad4f83572ee044cbffcfd6a5a"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#ada104b0ad4f83572ee044cbffcfd6a5a">foedus::snapshot::LogGleanerControlBlock::terminating_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; terminating_</div><div class="ttdoc">Whether the engine is being terminated. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00080">snapshot_manager_pimpl.hpp:80</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ab5c66ecba243eccfc78b5ae52aba9f7a"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab5c66ecba243eccfc78b5ae52aba9f7a">foedus::snapshot::SnapshotManagerPimpl::snapshot_thread_</a></div><div class="ttdeci">std::thread snapshot_thread_</div><div class="ttdoc">The daemon thread of snapshot manager. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00342">snapshot_manager_pimpl.hpp:342</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ab92f4472ad5436d0a216dd8183f26ec6"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6">foedus::snapshot::SnapshotManagerPimpl::wakeup</a></div><div class="ttdeci">void wakeup()</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00187">snapshot_manager_pimpl.cpp:187</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerControlBlock_html_a5bbb45b0f13414460c233e1d1c6962d2"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#a5bbb45b0f13414460c233e1d1c6962d2">foedus::snapshot::LogGleanerControlBlock::cancelled_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; cancelled_</div><div class="ttdoc">Whether the log gleaner has been cancalled. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00078">snapshot_manager_pimpl.hpp:78</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aaccf99888d69af9c737638c198470161"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aaccf99888d69af9c737638c198470161">foedus::snapshot::SnapshotManagerPimpl::stop_requested_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; stop_requested_</div><div class="ttdoc">To locally shutdown snapshot_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00333">snapshot_manager_pimpl.hpp:333</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="331,5,457,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6" title="foedus::snapshot::Snapshot\lManagerPimpl::wakeup" alt="" coords="302,71,486,112"/>
<area shape="rect" id="node7" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aea6701821c4d7184cac37f3ad552c60f" title="Fires snapshot_children_wakeup_. " alt="" coords="295,137,493,193"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="541,75,719,116"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="775,45,949,87"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="767,111,957,138"/>
<area shape="rect" id="node8" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="543,144,717,185"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ac35e1cb910337b9d66852e47202fb442_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#ad6262cf557ce9b4e8295ccc67a865554" title="foedus::restart::Restart\lManagerPimpl::uninitialize_once" alt="" coords="295,5,504,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4fd4f82797b7ce89da73feca6570f581" title="foedus::snapshot::Snapshot\lManagerPimpl::uninitialize_once" alt="" coords="295,71,504,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4496237075c2f411bb548e1bec7ca06b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::snapshot::SnapshotManagerPimpl::trigger_snapshot_immediate </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>wait_completion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a>&#160;</td>
          <td class="paramname"><em>suggested_snapshot_epoch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00277">277</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="shared__polling_8cpp_source.html#l00105">foedus::soc::SharedPolling::acquire_ticket()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="log__manager_8cpp_source.html#l00036">foedus::log::LogManager::get_durable_global_epoch()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00215">get_snapshot_epoch()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00250">is_stop_requested()</a>, <a class="el" href="epoch_8hpp_source.html#l00096">foedus::Epoch::is_valid()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00168">foedus::snapshot::SnapshotManagerControlBlock::requested_snapshot_epoch_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00178">foedus::snapshot::SnapshotManagerControlBlock::snapshot_taken_</a>, <a class="el" href="shared__polling_8cpp_source.html#l00063">foedus::soc::SharedPolling::timedwait()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00187">wakeup()</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager_8cpp_source.html#l00052">foedus::snapshot::SnapshotManager::trigger_snapshot_immediate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                  {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Requesting to immediately take a snapshot. suggested_snapshot_epoch=&quot;</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    &lt;&lt; suggested_snapshot_epoch;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  Epoch before = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  Epoch durable_epoch = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa">get_durable_global_epoch</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(durable_epoch.is_valid());</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  Epoch new_snapshot_epoch = durable_epoch;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">if</span> (suggested_snapshot_epoch.is_valid()) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (suggested_snapshot_epoch &gt; durable_epoch) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;You can&#39;t specify non-durable epoch for snapshot.&quot;</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      new_snapshot_epoch = suggested_snapshot_epoch;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">if</span> (before.is_valid() &amp;&amp; before &gt;= durable_epoch) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Current snapshot already satisfies. new_snapshot_epoch=&quot;</span> &lt;&lt; new_snapshot_epoch;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a23f8122328ae56b2e599e46cef336701">requested_snapshot_epoch_</a>.store(new_snapshot_epoch.value());</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6">wakeup</a>();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">if</span> (wait_completion) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    VLOG(0) &lt;&lt; <span class="stringliteral">&quot;Waiting for the completion of snapshot... before=&quot;</span> &lt;&lt; before;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>() &amp;&amp;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>().is_valid() || new_snapshot_epoch &gt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>())) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      uint64_t demand = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aa7fabf15a3fd3d86138ef69c4de51c16">snapshot_taken_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">acquire_ticket</a>();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">is_stop_requested</a>() &amp;&amp;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>().is_valid() || new_snapshot_epoch &gt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>())) {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aa7fabf15a3fd3d86138ef69c4de51c16">snapshot_taken_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">timedwait</a>(demand, 100000ULL);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Observed the completion of snapshot! after=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">get_snapshot_epoch</a>();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ac6ad7822e42e2e942b55708b1da8516b"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b">foedus::soc::SharedPolling::acquire_ticket</a></div><div class="ttdeci">uint64_t acquire_ticket() const </div><div class="ttdoc">Gives the ticket to. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00105">shared_polling.cpp:105</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a2f1c4ffd479bb976c32d4ddb38517a3b"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b">foedus::snapshot::SnapshotManagerPimpl::get_snapshot_epoch</a></div><div class="ttdeci">Epoch get_snapshot_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00215">snapshot_manager_pimpl.hpp:215</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a23f8122328ae56b2e599e46cef336701"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a23f8122328ae56b2e599e46cef336701">foedus::snapshot::SnapshotManagerControlBlock::requested_snapshot_epoch_</a></div><div class="ttdeci">std::atomic&lt; Epoch::EpochInteger &gt; requested_snapshot_epoch_</div><div class="ttdoc">When a caller wants to immediately invoke snapshot, it calls trigger_snapshot_immediate(), which sets this value and then wakes up snapshot_thread_. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00168">snapshot_manager_pimpl.hpp:168</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_a3d0f1491c5d6ef15601986b7b1dd6aaa"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa">foedus::log::LogManager::get_durable_global_epoch</a></div><div class="ttdeci">Epoch get_durable_global_epoch() const </div><div class="ttdoc">Returns the durable epoch of the entire engine. </div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00036">log_manager.cpp:36</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a501ce4a1b4b4a847a635ca671c5331de"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de">foedus::snapshot::SnapshotManagerPimpl::is_stop_requested</a></div><div class="ttdeci">bool is_stop_requested() const </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00250">snapshot_manager_pimpl.hpp:250</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_aa7fabf15a3fd3d86138ef69c4de51c16"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aa7fabf15a3fd3d86138ef69c4de51c16">foedus::snapshot::SnapshotManagerControlBlock::snapshot_taken_</a></div><div class="ttdeci">soc::SharedPolling snapshot_taken_</div><div class="ttdoc">Fired (notify_all) whenever snapshotting is completed. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00178">snapshot_manager_pimpl.hpp:178</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_a1b9f5c8b129c454887a77d3255956157"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157">foedus::soc::SharedPolling::timedwait</a></div><div class="ttdeci">bool timedwait(uint64_t demanded_ticket, uint64_t timeout_microsec, uint64_t polling_spins=kDefaultPollingSpins, uint64_t max_interval_us=kDefaultPollingMaxIntervalUs) const </div><div class="ttdoc">Wait for signal up to the given timeout. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00063">shared_polling.cpp:63</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ab92f4472ad5436d0a216dd8183f26ec6"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6">foedus::snapshot::SnapshotManagerPimpl::wakeup</a></div><div class="ttdeci">void wakeup()</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00187">snapshot_manager_pimpl.cpp:187</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ac6ad7822e42e2e942b55708b1da8516b" title="Gives the ticket to. " alt="" coords="554,5,731,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1log_1_1LogManager.html#a3d0f1491c5d6ef15601986b7b1dd6aaa" title="Returns the durable epoch of the entire engine. " alt="" coords="289,64,469,105"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="312,129,447,171"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a2f1c4ffd479bb976c32d4ddb38517a3b" title="foedus::snapshot::Snapshot\lManagerPimpl::get_snapshot_epoch" alt="" coords="263,195,496,236"/>
<area shape="rect" id="node9" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a501ce4a1b4b4a847a635ca671c5331de" title="foedus::snapshot::Snapshot\lManagerPimpl::is_stop_requested" alt="" coords="270,260,489,301"/>
<area shape="rect" id="node10" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="302,326,457,353"/>
<area shape="rect" id="node11" href="classfoedus_1_1soc_1_1SharedPolling.html#a1b9f5c8b129c454887a77d3255956157" title="Wait for signal up to the given timeout. " alt="" coords="291,377,468,419"/>
<area shape="rect" id="node13" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6" title="foedus::snapshot::Snapshot\lManagerPimpl::wakeup" alt="" coords="287,443,471,484"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="798,195,971,236"/>
<area shape="rect" id="node5" href="classfoedus_1_1log_1_1LogManagerPimpl.html#a61e44b4b7bb5dfc3d4111bb6bef25ea9" title="foedus::log::LogManagerPimpl\l::get_durable_global_epoch" alt="" coords="544,71,741,112"/>
<area shape="rect" id="node8" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#af87a96cd77347014fdd6acffac91d9f5" title="foedus::snapshot::Snapshot\lManagerControlBlock::get\l_snapshot_epoch" alt="" coords="551,187,735,243"/>
<area shape="rect" id="node12" href="namespacefoedus_1_1soc.html#a875ded688a72b32f8f690f37750e609f" title="foedus::soc::get_now\l_microsec" alt="" coords="570,377,715,419"/>
<area shape="rect" id="node14" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="554,443,731,484"/>
<area shape="rect" id="node15" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="789,450,980,477"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4496237075c2f411bb548e1bec7ca06b_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#ad0ca7bd80adde3e30e439d6902d9b299" title="Immediately take a snapshot. " alt="" coords="263,5,447,61"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4fd4f82797b7ce89da73feca6570f581"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::snapshot::SnapshotManagerPimpl::uninitialize_once </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classfoedus_1_1DefaultInitializable.html#a764be22ce1454279e7a7e78f4c8e380b">foedus::DefaultInitializable</a>.</p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00125">125</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="log__gleaner__resource_8cpp_source.html#l00038">foedus::snapshot::LogGleanerResource::deallocate()</a>, <a class="el" href="error__stack__batch_8hpp_source.html#l00083">foedus::ErrorStackBatch::emprace_back()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">engine_</a>, <a class="el" href="error__stack_8hpp_source.html#l00480">ERROR_STACK</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00514">foedus::soc::SharedMemoryRepo::get_global_memory_anchors()</a>, <a class="el" href="engine_8cpp_source.html#l00049">foedus::Engine::get_log_manager()</a>, <a class="el" href="engine_8cpp_source.html#l00039">foedus::Engine::get_options()</a>, <a class="el" href="soc__manager_8cpp_source.html#l00038">foedus::soc::SocManager::get_shared_memory_repo()</a>, <a class="el" href="engine_8cpp_source.html#l00059">foedus::Engine::get_soc_manager()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00356">gleaner_resource_</a>, <a class="el" href="log__manager_8cpp_source.html#l00032">foedus::log::LogManager::is_initialized()</a>, <a class="el" href="shared__mutex_8hpp_source.html#l00058">foedus::soc::SharedMutex::is_initialized()</a>, <a class="el" href="engine_8cpp_source.html#l00068">foedus::Engine::is_master()</a>, <a class="el" href="error__code_8hpp_source.html#l00110">foedus::kErrorCodeDepedentModuleUnavailableUninit</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00351">local_mappers_</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00353">local_reducer_</a>, <a class="el" href="storage__options_8hpp_source.html#l00043">foedus::storage::StorageOptions::max_storages_</a>, <a class="el" href="partitioner_8hpp_source.html#l00232">foedus::storage::PartitionerMetadata::mutex_</a>, <a class="el" href="shared__memory__repo_8hpp_source.html#l00271">foedus::soc::GlobalMemoryAnchors::partitioner_metadata_</a>, <a class="el" href="log__gleaner__resource_8hpp_source.html#l00070">foedus::snapshot::LogGleanerResource::per_node_resources_</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00164">stop_snapshot_thread()</a>, <a class="el" href="engine__options_8hpp_source.html#l00145">foedus::EngineOptions::storage_</a>, <a class="el" href="error__stack__batch_8hpp_source.html#l00136">SUMMARIZE_ERROR_BATCH</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00132">foedus::snapshot::SnapshotManagerControlBlock::uninitialize()</a>, <a class="el" href="initializable_8hpp_source.html#l00187">foedus::DefaultInitializable::uninitialize()</a>, and <a class="el" href="partitioner_8hpp_source.html#l00218">foedus::storage::PartitionerMetadata::uninitialize()</a>.</p>
<div class="fragment"><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                                   {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Uninitializing SnapshotManager..&quot;</span>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  ErrorStackBatch batch;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">get_log_manager</a>()-&gt;<a class="code" href="classfoedus_1_1log_1_1LogManager.html#ac69401e015fb167c3a7739bb6b40bc1e">is_initialized</a>()) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    batch.emprace_back(<a class="code" href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a3f20fb5c9683a0a7ac634160b380d504">kErrorCodeDepedentModuleUnavailableUninit</a>));</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ac35e1cb910337b9d66852e47202fb442">stop_snapshot_thread</a>();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">is_master</a>()) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// also uninitialize the shared memory for partitioner</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    soc::GlobalMemoryAnchors* anchors</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e">get_soc_manager</a>()-&gt;<a class="code" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c">get_shared_memory_repo</a>()-&gt;<a class="code" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb">get_global_memory_anchors</a>();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    uint32_t max_storages = <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#a3e40cfe4530b10e87344b42be16927e1">storage_</a>.<a class="code" href="structfoedus_1_1storage_1_1StorageOptions.html#a8b258af832ab43776a532c0f7a935b47">max_storages_</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">storage::StorageId</a> i = 0; i &lt; max_storages; ++i) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(anchors-&gt;partitioner_metadata_[i].mutex_.is_initialized());</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      anchors-&gt;partitioner_metadata_[i].uninitialize();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!anchors-&gt;partitioner_metadata_[i].mutex_.is_initialized());</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a2ecbba2c39099b67fb89e4c136f8fcf0">uninitialize</a>();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a> == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">local_mappers_</a>.size() == 0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">gleaner_resource_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#acf5601b4d2d98698d321a5b6f5c7b80f">deallocate</a>();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a>) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      batch.emprace_back(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a>-&gt;<a class="code" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb">uninitialize</a>());</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keyword">delete</span> <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">local_reducer_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">for</span> (LogMapper* mapper : <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">local_mappers_</a>) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      batch.emprace_back(mapper-&gt;uninitialize());</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keyword">delete</span> mapper;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    local_mappers_.clear();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">gleaner_resource_</a>.<a class="code" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#af047707971bb9ac2bfc1a234f4781499">per_node_resources_</a>.empty());</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga67390b22b0afbe5a4938df9847eafda9">SUMMARIZE_ERROR_BATCH</a>(batch);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerResource_html_acf5601b4d2d98698d321a5b6f5c7b80f"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#acf5601b4d2d98698d321a5b6f5c7b80f">foedus::snapshot::LogGleanerResource::deallocate</a></div><div class="ttdeci">void deallocate()</div><div class="ttdef"><b>Definition:</b> <a href="log__gleaner__resource_8cpp_source.html#l00038">log_gleaner_resource.cpp:38</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a2ecbba2c39099b67fb89e4c136f8fcf0"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a2ecbba2c39099b67fb89e4c136f8fcf0">foedus::snapshot::SnapshotManagerControlBlock::uninitialize</a></div><div class="ttdeci">void uninitialize()</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00132">snapshot_manager_pimpl.hpp:132</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa598b0ca7f0de626ecfa17f2cd58d5b4"><div class="ttname"><a href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a></div><div class="ttdeci">#define ERROR_STACK(e)        </div><div class="ttdoc">Instantiates ErrorStack with the given foedus::error_code, creating an error stack with the current f...</div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00480">error_stack.hpp:480</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga595ca7fc4a3011a9704a883a25141e5f"><div class="ttname"><a href="group__STORAGE.html#ga595ca7fc4a3011a9704a883a25141e5f">foedus::storage::StorageId</a></div><div class="ttdeci">uint32_t StorageId</div><div class="ttdoc">Unique ID for storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00055">storage_id.hpp:55</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedMemoryRepo_html_a1c21cc6a27cabaf4a8c9dc26985aacfb"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb">foedus::soc::SharedMemoryRepo::get_global_memory_anchors</a></div><div class="ttdeci">GlobalMemoryAnchors * get_global_memory_anchors()</div><div class="ttdef"><b>Definition:</b> <a href="shared__memory__repo_8hpp_source.html#l00514">shared_memory_repo.hpp:514</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1LogGleanerResource_html_af047707971bb9ac2bfc1a234f4781499"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#af047707971bb9ac2bfc1a234f4781499">foedus::snapshot::LogGleanerResource::per_node_resources_</a></div><div class="ttdeci">std::vector&lt; PerNodeResource &gt; per_node_resources_</div><div class="ttdef"><b>Definition:</b> <a href="log__gleaner__resource_8hpp_source.html#l00070">log_gleaner_resource.hpp:70</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1LogManager_html_ac69401e015fb167c3a7739bb6b40bc1e"><div class="ttname"><a href="classfoedus_1_1log_1_1LogManager.html#ac69401e015fb167c3a7739bb6b40bc1e">foedus::log::LogManager::is_initialized</a></div><div class="ttdeci">bool is_initialized() const  override</div><div class="ttdoc">Returns whether the object has been already initialized or not. </div><div class="ttdef"><b>Definition:</b> <a href="log__manager_8cpp_source.html#l00032">log_manager.cpp:32</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a0bbaceb941767610c240b0da20c92845"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a0bbaceb941767610c240b0da20c92845">foedus::snapshot::SnapshotManagerPimpl::engine_</a></div><div class="ttdeci">Engine *const engine_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00321">snapshot_manager_pimpl.hpp:321</a></div></div>
<div class="ttc" id="classfoedus_1_1DefaultInitializable_html_ab14b136a7d26f9f499ab9dc15a45a8cb"><div class="ttname"><a href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb">foedus::DefaultInitializable::uninitialize</a></div><div class="ttdeci">ErrorStack uninitialize() override final</div><div class="ttdoc">Typical implementation of Initializable::uninitialize() that provides uninitialize-once semantics...</div><div class="ttdef"><b>Definition:</b> <a href="initializable_8hpp_source.html#l00187">initializable.hpp:187</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a6546930099132529543c320327367ef1"><div class="ttname"><a href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">foedus::Engine::get_options</a></div><div class="ttdeci">const EngineOptions &amp; get_options() const </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00039">engine.cpp:39</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageOptions_html_a8b258af832ab43776a532c0f7a935b47"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageOptions.html#a8b258af832ab43776a532c0f7a935b47">foedus::storage::StorageOptions::max_storages_</a></div><div class="ttdeci">uint32_t max_storages_</div><div class="ttdoc">Maximum number of storages in this database. </div><div class="ttdef"><b>Definition:</b> <a href="storage__options_8hpp_source.html#l00043">storage_options.hpp:43</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a5a390a597023f4b5c8cbcdcdd95e17ee"><div class="ttname"><a href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee">foedus::Engine::is_master</a></div><div class="ttdeci">bool is_master() const </div><div class="ttdoc">Returns if this engine object is a master instance. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00068">engine.cpp:68</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a5dbaf73527e1fe3ee31b33abed6ab27c"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5dbaf73527e1fe3ee31b33abed6ab27c">foedus::snapshot::SnapshotManagerPimpl::gleaner_resource_</a></div><div class="ttdeci">LogGleanerResource gleaner_resource_</div><div class="ttdoc">Local resources for gleaner, which runs only in the master node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00356">snapshot_manager_pimpl.hpp:356</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_aa27f031bd1e256d38e616ec9a499eefc"><div class="ttname"><a href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc">foedus::Engine::get_log_manager</a></div><div class="ttdeci">log::LogManager * get_log_manager() const </div><div class="ttdoc">See Log Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00049">engine.cpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_a3e40cfe4530b10e87344b42be16927e1"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#a3e40cfe4530b10e87344b42be16927e1">foedus::EngineOptions::storage_</a></div><div class="ttdeci">storage::StorageOptions storage_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00145">engine_options.hpp:145</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga67390b22b0afbe5a4938df9847eafda9"><div class="ttname"><a href="group__ERRORCODES.html#ga67390b22b0afbe5a4938df9847eafda9">SUMMARIZE_ERROR_BATCH</a></div><div class="ttdeci">#define SUMMARIZE_ERROR_BATCH(x)</div><div class="ttdoc">This macro calls ErrorStackBatch::summarize() with automatically provided parameters. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack__batch_8hpp_source.html#l00136">error_stack_batch.hpp:136</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ad5187637994473e2fbb7fc484023f307"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ad5187637994473e2fbb7fc484023f307">foedus::snapshot::SnapshotManagerPimpl::local_reducer_</a></div><div class="ttdeci">LogReducer * local_reducer_</div><div class="ttdoc">Reducer in this node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00353">snapshot_manager_pimpl.hpp:353</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_a20ef0a4fa6050268d88fb3532b90c757"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a20ef0a4fa6050268d88fb3532b90c757">foedus::snapshot::SnapshotManagerPimpl::local_mappers_</a></div><div class="ttdeci">std::vector&lt; LogMapper * &gt; local_mappers_</div><div class="ttdoc">Mappers in this node. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00351">snapshot_manager_pimpl.hpp:351</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_ae9ad7ab6a3df52b0e9f0e50ede6faa2e"><div class="ttname"><a href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e">foedus::Engine::get_soc_manager</a></div><div class="ttdeci">soc::SocManager * get_soc_manager() const </div><div class="ttdoc">See SOC and IPC. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00059">engine.cpp:59</a></div></div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_ac35e1cb910337b9d66852e47202fb442"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ac35e1cb910337b9d66852e47202fb442">foedus::snapshot::SnapshotManagerPimpl::stop_snapshot_thread</a></div><div class="ttdeci">void stop_snapshot_thread()</div><div class="ttdoc">This is a hidden API called at the beginning of engine shutdown (namely restart manager). </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8cpp_source.html#l00164">snapshot_manager_pimpl.cpp:164</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a3f20fb5c9683a0a7ac634160b380d504"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a3f20fb5c9683a0a7ac634160b380d504">foedus::kErrorCodeDepedentModuleUnavailableUninit</a></div><div class="ttdoc">0x0006 : "GENERAL: A dependent module is already uninitialized. This implies a wrong uninitialization...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00110">error_code.hpp:110</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SocManager_html_a627cf434892c441c90c2de7c20637e9c"><div class="ttname"><a href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c">foedus::soc::SocManager::get_shared_memory_repo</a></div><div class="ttdeci">SharedMemoryRepo * get_shared_memory_repo()</div><div class="ttdoc">Returns the shared memories maintained across SOCs. </div><div class="ttdef"><b>Definition:</b> <a href="soc__manager_8cpp_source.html#l00038">soc_manager.cpp:38</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4fd4f82797b7ce89da73feca6570f581_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4fd4f82797b7ce89da73feca6570f581_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4fd4f82797b7ce89da73feca6570f581_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_a4fd4f82797b7ce89da73feca6570f581_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#acf5601b4d2d98698d321a5b6f5c7b80f" title="foedus::snapshot::LogGleaner\lResource::deallocate" alt="" coords="286,5,481,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1ErrorStackBatch.html#a1fe18afaafed459feb5c644ba9d7c56e" title="If the given ErrorStack is an error, this method adds it to the end of this batch. " alt="" coords="301,71,465,112"/>
<area shape="rect" id="node5" href="classfoedus_1_1soc_1_1SharedMemoryRepo.html#a1c21cc6a27cabaf4a8c9dc26985aacfb" title="foedus::soc::SharedMemory\lRepo::get_global_memory\l_anchors" alt="" coords="291,137,476,193"/>
<area shape="rect" id="node6" href="classfoedus_1_1Engine.html#aa27f031bd1e256d38e616ec9a499eefc" title="See Log Manager. " alt="" coords="316,217,451,259"/>
<area shape="rect" id="node7" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1" title="foedus::Engine::get\l_options" alt="" coords="316,283,451,324"/>
<area shape="rect" id="node8" href="classfoedus_1_1soc_1_1SocManager.html#a627cf434892c441c90c2de7c20637e9c" title="Returns the shared memories maintained across SOCs. " alt="" coords="293,348,473,389"/>
<area shape="rect" id="node9" href="classfoedus_1_1Engine.html#ae9ad7ab6a3df52b0e9f0e50ede6faa2e" title="See SOC and IPC. " alt="" coords="316,413,451,455"/>
<area shape="rect" id="node10" href="classfoedus_1_1log_1_1LogManager.html#ac69401e015fb167c3a7739bb6b40bc1e" title="Returns whether the object has been already initialized or not. " alt="" coords="301,479,465,520"/>
<area shape="rect" id="node12" href="classfoedus_1_1soc_1_1SharedMutex.html#ae886a5d8af1495da00400cc3c958a3d9" title="foedus::soc::SharedMutex\l::is_initialized" alt="" coords="296,544,471,585"/>
<area shape="rect" id="node13" href="classfoedus_1_1Engine.html#a5a390a597023f4b5c8cbcdcdd95e17ee" title="Returns if this engine object is a master instance. " alt="" coords="595,661,722,703"/>
<area shape="rect" id="node14" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ac35e1cb910337b9d66852e47202fb442" title="This is a hidden API called at the beginning of engine shutdown (namely restart manager). " alt="" coords="263,727,504,768"/>
<area shape="rect" id="node21" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a2ecbba2c39099b67fb89e4c136f8fcf0" title="foedus::snapshot::Snapshot\lManagerControlBlock::uninitialize" alt="" coords="276,812,491,853"/>
<area shape="rect" id="node23" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb" title="Typical implementation of Initializable::uninitialize() that provides uninitialize&#45;once semantics..." alt="" coords="297,609,469,651"/>
<area shape="rect" id="node25" href="structfoedus_1_1storage_1_1PartitionerMetadata.html#a4a2b866bb37a79a612da1bc3bc67fd23" title="foedus::storage::Partitioner\lMetadata::uninitialize" alt="" coords="294,917,473,959"/>
<area shape="rect" id="node3" href="classfoedus_1_1memory_1_1AlignedMemory.html#afd955f5f991e28943c72ecff1167c16b" title="Releases the memory block. " alt="" coords="552,5,765,47"/>
<area shape="rect" id="node11" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="573,504,745,545"/>
<area shape="rect" id="node15" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ab92f4472ad5436d0a216dd8183f26ec6" title="foedus::snapshot::Snapshot\lManagerPimpl::wakeup" alt="" coords="567,727,751,768"/>
<area shape="rect" id="node19" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#aea6701821c4d7184cac37f3ad552c60f" title="Fires snapshot_children_wakeup_. " alt="" coords="559,793,758,849"/>
<area shape="rect" id="node16" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="813,731,991,772"/>
<area shape="rect" id="node17" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="1047,701,1221,743"/>
<area shape="rect" id="node18" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="1039,767,1229,794"/>
<area shape="rect" id="node20" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="815,800,989,841"/>
<area shape="rect" id="node22" href="structfoedus_1_1snapshot_1_1LogGleanerControlBlock.html#ae813f6d3e5d1e0b6c74db20a8360180c" title="foedus::snapshot::LogGleaner\lControlBlock::uninitialize" alt="" coords="561,873,756,915"/>
<area shape="rect" id="node24" href="classfoedus_1_1DefaultInitializable.html#a764be22ce1454279e7a7e78f4c8e380b" title="foedus::DefaultInitializable\l::uninitialize_once" alt="" coords="573,596,745,637"/>
<area shape="rect" id="node26" href="classfoedus_1_1soc_1_1SharedMutex.html#a8631c8500a5ab03940e1358f23b654c4" title="foedus::soc::SharedMutex\l::uninitialize" alt="" coords="571,939,746,980"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab92f4472ad5436d0a216dd8183f26ec6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::snapshot::SnapshotManagerPimpl::wakeup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00187">187</a> of file <a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a>.</p>

<p>References <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">control_block_</a>, <a class="el" href="shared__polling_8cpp_source.html#l00100">foedus::soc::SharedPolling::signal()</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00184">foedus::snapshot::SnapshotManagerControlBlock::snapshot_wakeup_</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00164">stop_snapshot_thread()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00277">trigger_snapshot_immediate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                  {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <a class="code" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">control_block_</a>-&gt;<a class="code" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a4cf18e1b591da3508ee04696b950f98e">snapshot_wakeup_</a>.<a class="code" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">signal</a>();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_html_aea8bce561f2a5274e75cf56932a212bc"><div class="ttname"><a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aea8bce561f2a5274e75cf56932a212bc">foedus::snapshot::SnapshotManagerPimpl::control_block_</a></div><div class="ttdeci">SnapshotManagerControlBlock * control_block_</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00323">snapshot_manager_pimpl.hpp:323</a></div></div>
<div class="ttc" id="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock_html_a4cf18e1b591da3508ee04696b950f98e"><div class="ttname"><a href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html#a4cf18e1b591da3508ee04696b950f98e">foedus::snapshot::SnapshotManagerControlBlock::snapshot_wakeup_</a></div><div class="ttdeci">soc::SharedPolling snapshot_wakeup_</div><div class="ttdoc">Snapshot thread sleeps on this condition variable. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__manager__pimpl_8hpp_source.html#l00184">snapshot_manager_pimpl.hpp:184</a></div></div>
<div class="ttc" id="classfoedus_1_1soc_1_1SharedPolling_html_ae523f3b3bda39c0c81bfb5cb0d5ad626"><div class="ttname"><a href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626">foedus::soc::SharedPolling::signal</a></div><div class="ttdeci">void signal()</div><div class="ttdoc">Signal it to let waiters exit. </div><div class="ttdef"><b>Definition:</b> <a href="shared__polling_8cpp_source.html#l00100">shared_polling.cpp:100</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_cgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_cgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_cgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1soc_1_1SharedPolling.html#ae523f3b3bda39c0c81bfb5cb0d5ad626" title="Signal it to let waiters exit. " alt="" coords="237,35,415,76"/>
<area shape="rect" id="node3" href="group__ASSORTED.html#gaff9fa4aedd631410da28740f6e1dddbf" title="Equivalent to std::atomic_thread_fence(std::memory_order_acq_rel). " alt="" coords="471,5,645,47"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1soc.html#ad6b40c6c8e2db3fbf1bbdf6daa025275" title="foedus::soc::ugly_atomic_inc" alt="" coords="463,71,653,98"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_icgraph.png" border="0" usemap="#classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_icgraph" alt=""/></div>
<map name="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_icgraph" id="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl_ab92f4472ad5436d0a216dd8183f26ec6_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#ac35e1cb910337b9d66852e47202fb442" title="This is a hidden API called at the beginning of engine shutdown (namely restart manager). " alt="" coords="237,71,479,112"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4496237075c2f411bb548e1bec7ca06b" title="foedus::snapshot::Snapshot\lManagerPimpl::trigger_snapshot\l_immediate" alt="" coords="253,137,463,193"/>
<area shape="rect" id="node3" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#ad6262cf557ce9b4e8295ccc67a865554" title="foedus::restart::Restart\lManagerPimpl::uninitialize_once" alt="" coords="527,5,736,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a4fd4f82797b7ce89da73feca6570f581" title="foedus::snapshot::Snapshot\lManagerPimpl::uninitialize_once" alt="" coords="527,71,736,112"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManager.html#ad0ca7bd80adde3e30e439d6902d9b299" title="Immediately take a snapshot. " alt="" coords="539,137,723,193"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="aea8bce561f2a5274e75cf56932a212bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfoedus_1_1snapshot_1_1SnapshotManagerControlBlock.html">SnapshotManagerControlBlock</a>* foedus::snapshot::SnapshotManagerPimpl::control_block_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00323">323</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00218">get_previous_snapshot_id()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00219">get_previous_snapshot_id_weak()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00215">get_snapshot_epoch()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00216">get_snapshot_epoch_weak()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">handle_snapshot_child()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00251">is_gleaning()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00239">issue_next_snapshot_id()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00181">sleep_a_while()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00164">stop_snapshot_thread()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00277">trigger_snapshot_immediate()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00125">uninitialize_once()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00187">wakeup()</a>.</p>

</div>
</div>
<a class="anchor" id="a0bbaceb941767610c240b0da20c92845"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1Engine.html">Engine</a>* const foedus::snapshot::SnapshotManagerPimpl::engine_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00321">321</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00488">drop_volatile_pages()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00595">drop_volatile_pages_parallel()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00057">get_option()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00386">glean_logs()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">handle_snapshot_child()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00401">snapshot_metadata()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00469">snapshot_savepoint()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00164">stop_snapshot_thread()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00277">trigger_snapshot_immediate()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00125">uninitialize_once()</a>.</p>

</div>
</div>
<a class="anchor" id="a5dbaf73527e1fe3ee31b33abed6ab27c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html">LogGleanerResource</a> foedus::snapshot::SnapshotManagerPimpl::gleaner_resource_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Local resources for gleaner, which runs only in the master node. </p>
<p>Empty in child nodes. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00356">356</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00386">glean_logs()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00125">uninitialize_once()</a>.</p>

</div>
</div>
<a class="anchor" id="a20ef0a4fa6050268d88fb3532b90c757"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classfoedus_1_1snapshot_1_1LogMapper.html">LogMapper</a>*&gt; foedus::snapshot::SnapshotManagerPimpl::local_mappers_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mappers in this node. </p>
<p>Index is logger ordinal. Empty in master engine. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00351">351</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">handle_snapshot_child()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00125">uninitialize_once()</a>.</p>

</div>
</div>
<a class="anchor" id="ad5187637994473e2fbb7fc484023f307"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html">LogReducer</a>* foedus::snapshot::SnapshotManagerPimpl::local_reducer_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reducer in this node. </p>
<p>Null in master engine. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00353">353</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00239">handle_snapshot_child()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00125">uninitialize_once()</a>.</p>

</div>
</div>
<a class="anchor" id="a4775dadfb539af5c8d82118735212254"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::system_clock::time_point foedus::snapshot::SnapshotManagerPimpl::previous_snapshot_time_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>When snapshot_thread_ took snapshot last time. </p>
<p>Read and written only by snapshot_thread_. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00348">348</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00191">handle_snapshot()</a>, <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">handle_snapshot_triggered()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>.</p>

</div>
</div>
<a class="anchor" id="ab5c66ecba243eccfc78b5ae52aba9f7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::thread foedus::snapshot::SnapshotManagerPimpl::snapshot_thread_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The daemon thread of snapshot manager. </p>
<p>In master engine, this occasionally wakes up and serves as the main managing thread for snapshotting, which consists of several child threads and multiple phases. In child engine, this receives requests from master engine's snapshot_thread_ and launch mappers/reducers in this node. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00342">342</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00164">stop_snapshot_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="aa90b3763974fac3e2b1f32b0b7e66f1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">Snapshot</a> &gt; foedus::snapshot::SnapshotManagerPimpl::snapshots_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>All previously taken snapshots. </p>
<p>Access to this data must be protected with mutex. This is populated only in master engine. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00330">330</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="aaccf99888d69af9c737638c198470161"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;bool&gt; foedus::snapshot::SnapshotManagerPimpl::stop_requested_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>To locally shutdown snapshot_thread_. </p>
<p>This is not a shared memory. </p>

<p>Definition at line <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00333">333</a> of file <a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00061">initialize_once()</a>, <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00250">is_stop_requested()</a>, and <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00164">stop_snapshot_thread()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/snapshot/<a class="el" href="snapshot__manager__pimpl_8hpp_source.html">snapshot_manager_pimpl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/snapshot/<a class="el" href="snapshot__manager__pimpl_8cpp_source.html">snapshot_manager_pimpl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1snapshot.html">snapshot</a></li><li class="navelem"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html">SnapshotManagerPimpl</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
