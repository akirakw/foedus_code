<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::cache::CacheHashtable Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1cache_1_1CacheHashtable.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classfoedus_1_1cache_1_1CacheHashtable-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::cache::CacheHashtable Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__CACHE.html">Snapshot Cache Manager</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A NUMA-local hashtable of cached snapshot pages.  
 <a href="classfoedus_1_1cache_1_1CacheHashtable.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A NUMA-local hashtable of cached snapshot pages. </p>
<dl class="section user"><dt>Structure Overview</dt><dd>Each key (SnapshotPagePointer) has its own <em>best</em> position calculated from its hash value. If the key exists in this table, it is either in some bucket between the best position (including) and best position + kHopNeighbors (excluding) or in the <em>overflow</em> linked list. Simple, stupid, thus fast.</dd></dl>
<dl class="section user"><dt>Modularity for Testability</dt><dd>Yes, we love them. Classes in this file are totally orthogonal to the actual page pool and other stuffs in the engine. This class only handles <em>content</em> (eg offset in page pool) as the data linked to the key. It's left to the caller on how the content is created, consumed, or reclaimed so that we can test/debug/tune the classes easily. In fact, test_hash_table.cpp (the testcase for this class) doesn't even instantiate an engine.</dd></dl>
<dl class="section user"><dt>Hash Function in cache table</dt><dd>We have a fixed type of key, SnapshotPagePointer. For the fastest calculation of the hash we simply divide by the size of hashtable, which we adjust to be <em>almost</em> a prime number (in many cases actually a prime). We use <a class="el" href="structfoedus_1_1assorted_1_1ConstDiv.html" title="The pre-calculated p-m pair for optimized integer division by constant. ">assorted::ConstDiv</a> to speed up the division.</dd></dl>
<dl class="section user"><dt>Some history on choice of algorithm</dt><dd>We were initially based on Herlihy's Hopscotch, but we heavily departed from it to exploit our loose requirements for eliminitating all locks and atomic operations. The only Currently, we even don't do the bucket migration in hopscotch, so it's no longer correct to call this a hop-scotch. Instead, we use an overflow linked list, which should be almost always empty or close-to-empty. </dd></dl>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00233">233</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for foedus::cache::CacheHashtable:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable__coll__graph.png" border="0" usemap="#foedus_1_1cache_1_1CacheHashtable_coll__map" alt="Collaboration graph"/></div>
<map name="foedus_1_1cache_1_1CacheHashtable_coll__map" id="foedus_1_1cache_1_1CacheHashtable_coll__map">
<area shape="rect" id="node2" href="structfoedus_1_1cache_1_1HashFunc.html" title="A simple hash function logic used in snasphot cache. " alt="" coords="349,8,520,35"/>
<area shape="rect" id="node3" href="structfoedus_1_1assorted_1_1ConstDiv.html" title="The pre&#45;calculated p&#45;m pair for optimized integer division by constant. " alt="" coords="17,8,195,35"/>
<area shape="rect" id="node4" href="classfoedus_1_1soc_1_1SharedMutex.html" title="A mutex that can be placed in shared memory and used from multiple processes. " alt="" coords="347,64,522,91"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1cache.html#structfoedus_1_1cache_1_1CacheOverflowEntry" title="An entry in the overflow linked list for snapshot cache. " alt="" coords="337,178,533,219"/>
<area shape="rect" id="node6" href="structfoedus_1_1cache_1_1CacheBucket.html" title="Hash bucket in cache table. " alt="" coords="11,140,201,167"/>
<area shape="rect" id="node7" href="structfoedus_1_1cache_1_1CacheRefCount.html" title="A loosely maintained reference count for CLOCK algorithm. " alt="" coords="5,212,207,239"/>
<area shape="rect" id="node8" href="classfoedus_1_1memory_1_1AlignedMemory.html" title="Represents one memory block aligned to actual OS/hardware pages. " alt="" coords="328,324,541,351"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html">EvictArgs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parameters for <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e9c6560b489d4709183256c6e6d332a" title="Evict some entries from the hashtable. ">evict()</a>  <a href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfoedus_1_1cache_1_1CacheHashtable_1_1Stat"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CACHE.html#structfoedus_1_1cache_1_1CacheHashtable_1_1Stat">Stat</a></td></tr>
<tr class="separator:structfoedus_1_1cache_1_1CacheHashtable_1_1Stat"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a9eb2a178b8368240d82ccc787841f200"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200">Constants</a> { <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334">kMaxFindBatchSize</a> = 32
 }<tr class="separator:a9eb2a178b8368240d82ccc787841f200"><td class="memSeparator" colspan="2">&#160;</td></tr>
</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab50df22f687f1366d13be2f0f950177b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ab50df22f687f1366d13be2f0f950177b">CacheHashtable</a> (<a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> physical_buckets, uint16_t numa_node)</td></tr>
<tr class="separator:ab50df22f687f1366d13be2f0f950177b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac92d7a0c69e61cfdcacd72b9e8c7bd74"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#a90670494c3a525f4921b61d4e06ca369">ContentId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac92d7a0c69e61cfdcacd72b9e8c7bd74">find</a> (<a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> page_id) const __attribute__((always_inline))</td></tr>
<tr class="memdesc:ac92d7a0c69e61cfdcacd72b9e8c7bd74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns an offset for the given page ID <em>opportunistically</em>.  <a href="#ac92d7a0c69e61cfdcacd72b9e8c7bd74">More...</a><br /></td></tr>
<tr class="separator:ac92d7a0c69e61cfdcacd72b9e8c7bd74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e48716623ca44e83cc5ef871c10b131"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e48716623ca44e83cc5ef871c10b131">find_batch</a> (uint16_t batch_size, const <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> *page_ids, <a class="el" href="namespacefoedus_1_1cache.html#a90670494c3a525f4921b61d4e06ca369">ContentId</a> *out) const </td></tr>
<tr class="memdesc:a8e48716623ca44e83cc5ef871c10b131"><td class="mdescLeft">&#160;</td><td class="mdescRight">Batched version of <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac92d7a0c69e61cfdcacd72b9e8c7bd74" title="Returns an offset for the given page ID opportunistically. ">find()</a>.  <a href="#a8e48716623ca44e83cc5ef871c10b131">More...</a><br /></td></tr>
<tr class="separator:a8e48716623ca44e83cc5ef871c10b131"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7762689517cd7a18dd64d8591a3272a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#af7762689517cd7a18dd64d8591a3272a">install</a> (<a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> page_id, <a class="el" href="namespacefoedus_1_1cache.html#a90670494c3a525f4921b61d4e06ca369">ContentId</a> content)</td></tr>
<tr class="memdesc:af7762689517cd7a18dd64d8591a3272a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when a cached page is not found.  <a href="#af7762689517cd7a18dd64d8591a3272a">More...</a><br /></td></tr>
<tr class="separator:af7762689517cd7a18dd64d8591a3272a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e9c6560b489d4709183256c6e6d332a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e9c6560b489d4709183256c6e6d332a">evict</a> (<a class="el" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html">EvictArgs</a> *args)</td></tr>
<tr class="memdesc:a8e9c6560b489d4709183256c6e6d332a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evict some entries from the hashtable.  <a href="#a8e9c6560b489d4709183256c6e6d332a">More...</a><br /></td></tr>
<tr class="separator:a8e9c6560b489d4709183256c6e6d332a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acea3236385a3b8d05ed1a60186e32ee8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#acea3236385a3b8d05ed1a60186e32ee8">get_logical_buckets</a> () const __attribute__((always_inline))</td></tr>
<tr class="separator:acea3236385a3b8d05ed1a60186e32ee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd3c185877f109817850f92eab7ff4b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">get_physical_buckets</a> () const __attribute__((always_inline))</td></tr>
<tr class="separator:abd3c185877f109817850f92eab7ff4b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30b6a0b28cce30d50da7e0419c8cad20"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20">get_bucket_number</a> (<a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> page_id) const __attribute__((always_inline))</td></tr>
<tr class="memdesc:a30b6a0b28cce30d50da7e0419c8cad20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a bucket number the given page ID <em>should</em> belong to.  <a href="#a30b6a0b28cce30d50da7e0419c8cad20">More...</a><br /></td></tr>
<tr class="separator:a30b6a0b28cce30d50da7e0419c8cad20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a222973805e7f70a5c6d1c28867454229"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a222973805e7f70a5c6d1c28867454229">verify_single_thread</a> () const </td></tr>
<tr class="memdesc:a222973805e7f70a5c6d1c28867454229"><td class="mdescLeft">&#160;</td><td class="mdescRight">only for debugging.  <a href="#a222973805e7f70a5c6d1c28867454229">More...</a><br /></td></tr>
<tr class="separator:a222973805e7f70a5c6d1c28867454229"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fc7762ccff5d6a09d881ae258fae13d"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structfoedus_1_1cache_1_1CacheBucket.html">CacheBucket</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a1fc7762ccff5d6a09d881ae258fae13d">get_bucket</a> (<a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> bucket_id) const </td></tr>
<tr class="separator:a1fc7762ccff5d6a09d881ae258fae13d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4f979361eb029d81d1ad61d368d86be"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__CACHE.html#structfoedus_1_1cache_1_1CacheHashtable_1_1Stat">Stat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ab4f979361eb029d81d1ad61d368d86be">get_stat_single_thread</a> () const </td></tr>
<tr class="memdesc:ab4f979361eb029d81d1ad61d368d86be"><td class="mdescLeft">&#160;</td><td class="mdescRight">only for debugging.  <a href="#ab4f979361eb029d81d1ad61d368d86be">More...</a><br /></td></tr>
<tr class="separator:ab4f979361eb029d81d1ad61d368d86be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a090081806f98e5bb1184632b9fce6293"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a090081806f98e5bb1184632b9fce6293">evict_main_loop</a> (<a class="el" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html">EvictArgs</a> *args, <a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> cur, uint16_t loop)</td></tr>
<tr class="separator:a090081806f98e5bb1184632b9fce6293"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcd23e94ab45dd35b1ae158a498e4344"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#abcd23e94ab45dd35b1ae158a498e4344">evict_overflow_loop</a> (<a class="el" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html">EvictArgs</a> *args, uint16_t loop)</td></tr>
<tr class="separator:abcd23e94ab45dd35b1ae158a498e4344"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ae86a50505266a7691692e0b6297eeebf"><td class="memItemLeft" align="right" valign="top">const uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">numa_node_</a></td></tr>
<tr class="separator:ae86a50505266a7691692e0b6297eeebf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43cecea26ba2304eb80c60307decfa54"><td class="memItemLeft" align="right" valign="top">const uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a43cecea26ba2304eb80c60307decfa54">overflow_buckets_count_</a></td></tr>
<tr class="separator:a43cecea26ba2304eb80c60307decfa54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a445d065db71ba9b4bb0ef35c1bdcd097"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structfoedus_1_1cache_1_1HashFunc.html">HashFunc</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">hash_func_</a></td></tr>
<tr class="separator:a445d065db71ba9b4bb0ef35c1bdcd097"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1b4ed7d210e4a1f7be234fc52a22ab6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html">memory::AlignedMemory</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#aa1b4ed7d210e4a1f7be234fc52a22ab6">buckets_memory_</a></td></tr>
<tr class="separator:aa1b4ed7d210e4a1f7be234fc52a22ab6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add385b7b32261364ee132909c69bf924"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html">memory::AlignedMemory</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#add385b7b32261364ee132909c69bf924">refcounts_memory_</a></td></tr>
<tr class="separator:add385b7b32261364ee132909c69bf924"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bac6a88e7e0f33f88170e7014e597e0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html">memory::AlignedMemory</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a0bac6a88e7e0f33f88170e7014e597e0">overflow_buckets_memory_</a></td></tr>
<tr class="separator:a0bac6a88e7e0f33f88170e7014e597e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a27ca6cf18b0313816d7982d2c0667e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfoedus_1_1cache_1_1CacheBucket.html">CacheBucket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a></td></tr>
<tr class="separator:a9a27ca6cf18b0313816d7982d2c0667e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae71e9e3e6d08ece9f4a640d2d9dcea8b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfoedus_1_1cache_1_1CacheRefCount.html">CacheRefCount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a></td></tr>
<tr class="separator:ae71e9e3e6d08ece9f4a640d2d9dcea8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc6c1d5e06ba80515bee790d0f240baf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#structfoedus_1_1cache_1_1CacheOverflowEntry">CacheOverflowEntry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a></td></tr>
<tr class="separator:afc6c1d5e06ba80515bee790d0f240baf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a483f0657f4ce6795f74d1c5984b28108"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a></td></tr>
<tr class="memdesc:a483f0657f4ce6795f74d1c5984b28108"><td class="mdescLeft">&#160;</td><td class="mdescRight">This forms a singly-linked list of active overflow entries.  <a href="#a483f0657f4ce6795f74d1c5984b28108">More...</a><br /></td></tr>
<tr class="separator:a483f0657f4ce6795f74d1c5984b28108"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84f35d72cd5d519f59142b41189f79c3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a84f35d72cd5d519f59142b41189f79c3">overflow_free_buckets_head_</a></td></tr>
<tr class="memdesc:a84f35d72cd5d519f59142b41189f79c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">This forms another singly-linked list of free overflow entries.  <a href="#a84f35d72cd5d519f59142b41189f79c3">More...</a><br /></td></tr>
<tr class="separator:a84f35d72cd5d519f59142b41189f79c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac05195f8bd620a7ebe6d3321f97bb34e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1soc_1_1SharedMutex.html">soc::SharedMutex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac05195f8bd620a7ebe6d3321f97bb34e">overflow_free_buckets_mutex_</a></td></tr>
<tr class="memdesc:ac05195f8bd620a7ebe6d3321f97bb34e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The mutex to protect free overflow entries.  <a href="#ac05195f8bd620a7ebe6d3321f97bb34e">More...</a><br /></td></tr>
<tr class="separator:ac05195f8bd620a7ebe6d3321f97bb34e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a727376cbbde951edc3535a7ff6e46b68"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">clockhand_</a></td></tr>
<tr class="memdesc:a727376cbbde951edc3535a7ff6e46b68"><td class="mdescLeft">&#160;</td><td class="mdescRight">We previously stopped eviction here for usual buckets.  <a href="#a727376cbbde951edc3535a7ff6e46b68">More...</a><br /></td></tr>
<tr class="separator:a727376cbbde951edc3535a7ff6e46b68"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:aac3194f117eb41ce165f1fe06a17f1e4"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#aac3194f117eb41ce165f1fe06a17f1e4">operator&lt;&lt;</a> (std::ostream &amp;o, const <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html">CacheHashtable</a> &amp;v)</td></tr>
<tr class="separator:aac3194f117eb41ce165f1fe06a17f1e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a9eb2a178b8368240d82ccc787841f200"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200">foedus::cache::CacheHashtable::Constants</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334"></a>kMaxFindBatchSize&#160;</td><td class="fielddoc">
<p>Max size for <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e48716623ca44e83cc5ef871c10b131" title="Batched version of find(). ">find_batch()</a> </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00235">235</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                 {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334">kMaxFindBatchSize</a> = 32,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  };</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334">foedus::cache::CacheHashtable::kMaxFindBatchSize</a></div><div class="ttdoc">Max size for find_batch() </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00237">cache_hashtable.hpp:237</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ab50df22f687f1366d13be2f0f950177b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">foedus::cache::CacheHashtable::CacheHashtable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td>
          <td class="paramname"><em>physical_buckets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>numa_node</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00066">66</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="aligned__memory_8cpp_source.html#l00113">foedus::memory::AlignedMemory::alloc()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00192">foedus::cache::CacheOverflowEntry::bucket_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00341">buckets_memory_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00164">foedus::cache::CacheRefCount::count_</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00168">foedus::memory::AlignedMemory::get_block()</a>, <a class="el" href="aligned__memory_8hpp_source.html#l00083">foedus::memory::AlignedMemory::kNumaAllocOnnode</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00198">foedus::cache::CacheOverflowEntry::next_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00350">overflow_buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00339">overflow_buckets_count_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00355">overflow_buckets_head_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00343">overflow_buckets_memory_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00364">overflow_free_buckets_head_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00200">foedus::cache::CacheOverflowEntry::padding_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00199">foedus::cache::CacheOverflowEntry::refcount_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00347">refcounts_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00342">refcounts_memory_</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00143">foedus::cache::CacheBucket::reset()</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  : <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">numa_node_</a>(numa_node),</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a43cecea26ba2304eb80c60307decfa54">overflow_buckets_count_</a>(<a class="code" href="namespacefoedus_1_1cache.html#ab75ca4bf05b56cb8ee86740875a0d173">determine_overflow_list_size</a>(physical_buckets)),</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">hash_func_</a>(physical_buckets),</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">clockhand_</a>(0) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#aa1b4ed7d210e4a1f7be234fc52a22ab6">buckets_memory_</a>.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e">alloc</a>(</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">sizeof</span>(CacheBucket) * physical_buckets,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    1U &lt;&lt; 21,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    numa_node);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#add385b7b32261364ee132909c69bf924">refcounts_memory_</a>.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e">alloc</a>(</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keyword">sizeof</span>(CacheRefCount) * physical_buckets,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    1U &lt;&lt; 21,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    numa_node);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a> = <span class="keyword">reinterpret_cast&lt;</span>CacheBucket*<span class="keyword">&gt;</span>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#aa1b4ed7d210e4a1f7be234fc52a22ab6">buckets_memory_</a>.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1">get_block</a>());</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a> = <span class="keyword">reinterpret_cast&lt;</span>CacheRefCount*<span class="keyword">&gt;</span>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#add385b7b32261364ee132909c69bf924">refcounts_memory_</a>.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1">get_block</a>());</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// index-0 should be never used. 0 means null.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[0].<a class="code" href="structfoedus_1_1cache_1_1CacheBucket.html#aaa52396996e73a08cace2a2dcef82ffb">reset</a>();</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a>[0].<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#a3733234e6687c556d47a94d28ffcef35">count_</a> = 0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// for overflow list</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a0bac6a88e7e0f33f88170e7014e597e0">overflow_buckets_memory_</a>.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e">alloc</a>(</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keyword">sizeof</span>(CacheOverflowEntry) * <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a43cecea26ba2304eb80c60307decfa54">overflow_buckets_count_</a>,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    1U &lt;&lt; 21,</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">memory::AlignedMemory::kNumaAllocOnnode</a>,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    numa_node);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a> = <span class="keyword">reinterpret_cast&lt;</span>CacheOverflowEntry*<span class="keyword">&gt;</span>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a0bac6a88e7e0f33f88170e7014e597e0">overflow_buckets_memory_</a>.<a class="code" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1">get_block</a>());</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a> = 0;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// index-0 should be never used. 0 means null.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[0].<a class="code" href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">bucket_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheBucket.html#aaa52396996e73a08cace2a2dcef82ffb">reset</a>();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[0].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a> = 0;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[0].<a class="code" href="namespacefoedus_1_1cache.html#a31235fb6af483bc6a9fed7897987208d">padding_</a> = 0;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[0].<a class="code" href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">refcount_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#a3733234e6687c556d47a94d28ffcef35">count_</a> = 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// initially all entries are in free list.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a84f35d72cd5d519f59142b41189f79c3">overflow_free_buckets_head_</a> = 1;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> i = 1U; i &lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a43cecea26ba2304eb80c60307decfa54">overflow_buckets_count_</a>; ++i) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span> (i &lt; overflow_buckets_count_ - 1U) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a> = i + 1U;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a> = 0;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a31235fb6af483bc6a9fed7897987208d"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a31235fb6af483bc6a9fed7897987208d">foedus::cache::CacheOverflowEntry::padding_</a></div><div class="ttdeci">uint16_t padding_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00200">cache_hashtable.hpp:200</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#a57abf88bfdff732d23c00b6738567a43a104f4cb2cd45d6529e9b3096c552c225">foedus::memory::AlignedMemory::kNumaAllocOnnode</a></div><div class="ttdoc">numa_alloc_onnode() and numa_free(). </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8hpp_source.html#l00083">aligned_memory.hpp:83</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a727376cbbde951edc3535a7ff6e46b68"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">foedus::cache::CacheHashtable::clockhand_</a></div><div class="ttdeci">BucketId clockhand_</div><div class="ttdoc">We previously stopped eviction here for usual buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00378">cache_hashtable.hpp:378</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_afc6c1d5e06ba80515bee790d0f240baf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">foedus::cache::CacheHashtable::overflow_buckets_</a></div><div class="ttdeci">CacheOverflowEntry * overflow_buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00350">cache_hashtable.hpp:350</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_aa1b4ed7d210e4a1f7be234fc52a22ab6"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#aa1b4ed7d210e4a1f7be234fc52a22ab6">foedus::cache::CacheHashtable::buckets_memory_</a></div><div class="ttdeci">memory::AlignedMemory buckets_memory_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00341">cache_hashtable.hpp:341</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_add385b7b32261364ee132909c69bf924"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#add385b7b32261364ee132909c69bf924">foedus::cache::CacheHashtable::refcounts_memory_</a></div><div class="ttdeci">memory::AlignedMemory refcounts_memory_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00342">cache_hashtable.hpp:342</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a2d1f26fae41d62d8c2db91322b4f5466"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">foedus::cache::OverflowPointer</a></div><div class="ttdeci">uint32_t OverflowPointer</div><div class="ttdoc">Position in the overflow buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00072">cache_hashtable.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_a5166bae2fdad9ffa0d5c279edfd3307e"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e">foedus::memory::AlignedMemory::alloc</a></div><div class="ttdeci">void alloc(uint64_t size, uint64_t alignment, AllocType alloc_type, int numa_node) noexcept</div><div class="ttdoc">Allocate a memory, releasing the current memory if exists. </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8cpp_source.html#l00113">aligned_memory.cpp:113</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ab75ca4bf05b56cb8ee86740875a0d173"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ab75ca4bf05b56cb8ee86740875a0d173">foedus::cache::determine_overflow_list_size</a></div><div class="ttdeci">uint32_t determine_overflow_list_size(BucketId physical_buckets)</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8cpp_source.html#l00049">cache_hashtable.cpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a84f35d72cd5d519f59142b41189f79c3"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a84f35d72cd5d519f59142b41189f79c3">foedus::cache::CacheHashtable::overflow_free_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_free_buckets_head_</div><div class="ttdoc">This forms another singly-linked list of free overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00364">cache_hashtable.hpp:364</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheRefCount_html_a3733234e6687c556d47a94d28ffcef35"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheRefCount.html#a3733234e6687c556d47a94d28ffcef35">foedus::cache::CacheRefCount::count_</a></div><div class="ttdeci">uint16_t count_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00164">cache_hashtable.hpp:164</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a43cecea26ba2304eb80c60307decfa54"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a43cecea26ba2304eb80c60307decfa54">foedus::cache::CacheHashtable::overflow_buckets_count_</a></div><div class="ttdeci">const uint32_t overflow_buckets_count_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00339">cache_hashtable.hpp:339</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae71e9e3e6d08ece9f4a640d2d9dcea8b"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">foedus::cache::CacheHashtable::refcounts_</a></div><div class="ttdeci">CacheRefCount * refcounts_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00347">cache_hashtable.hpp:347</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a0bac6a88e7e0f33f88170e7014e597e0"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a0bac6a88e7e0f33f88170e7014e597e0">foedus::cache::CacheHashtable::overflow_buckets_memory_</a></div><div class="ttdeci">memory::AlignedMemory overflow_buckets_memory_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00343">cache_hashtable.hpp:343</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1AlignedMemory_html_af306ba60622e2a87f75ae93dc6c597b1"><div class="ttname"><a href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1">foedus::memory::AlignedMemory::get_block</a></div><div class="ttdeci">void * get_block() const </div><div class="ttdoc">Returns the memory block. </div><div class="ttdef"><b>Definition:</b> <a href="aligned__memory_8hpp_source.html#l00168">aligned_memory.hpp:168</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ac6b943d816bc16689f894a7b735bb861"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">foedus::cache::CacheOverflowEntry::refcount_</a></div><div class="ttdeci">CacheRefCount refcount_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00199">cache_hashtable.hpp:199</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae86a50505266a7691692e0b6297eeebf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">foedus::cache::CacheHashtable::numa_node_</a></div><div class="ttdeci">const uint16_t numa_node_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00338">cache_hashtable.hpp:338</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a445d065db71ba9b4bb0ef35c1bdcd097"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">foedus::cache::CacheHashtable::hash_func_</a></div><div class="ttdeci">const HashFunc hash_func_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00340">cache_hashtable.hpp:340</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheBucket_html_aaa52396996e73a08cace2a2dcef82ffb"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheBucket.html#aaa52396996e73a08cace2a2dcef82ffb">foedus::cache::CacheBucket::reset</a></div><div class="ttdeci">void reset(ContentId id=0, PageIdTag tag=0)</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00143">cache_hashtable.hpp:143</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ae12719ddad39c1aaac04a294fe0dea3f"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">foedus::cache::CacheOverflowEntry::next_</a></div><div class="ttdeci">OverflowPointer next_</div><div class="ttdoc">Note that we don&#39;t have to atomically maintain/follow this pointer thanks to the loose requirements...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00198">cache_hashtable.hpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a483f0657f4ce6795f74d1c5984b28108"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">foedus::cache::CacheHashtable::overflow_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_buckets_head_</div><div class="ttdoc">This forms a singly-linked list of active overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00355">cache_hashtable.hpp:355</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a60ed7dceb59de97100cce445f5dbcd3a"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">foedus::cache::CacheOverflowEntry::bucket_</a></div><div class="ttdeci">CacheBucket bucket_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00192">cache_hashtable.hpp:192</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_ab50df22f687f1366d13be2f0f950177b_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_ab50df22f687f1366d13be2f0f950177b_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_ab50df22f687f1366d13be2f0f950177b_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_ab50df22f687f1366d13be2f0f950177b_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1memory_1_1AlignedMemory.html#a5166bae2fdad9ffa0d5c279edfd3307e" title="Allocate a memory, releasing the current memory if exists. " alt="" coords="260,199,473,240"/>
<area shape="rect" id="node15" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="260,264,473,306"/>
<area shape="rect" id="node16" href="structfoedus_1_1cache_1_1CacheBucket.html#aaa52396996e73a08cace2a2dcef82ffb" title="foedus::cache::CacheBucket\l::reset" alt="" coords="272,330,461,371"/>
<area shape="rect" id="node3" href="numa_8h.html#a413cadd87796fff247c83d9ad817cc7e" title="numa_available" alt="" coords="761,38,872,65"/>
<area shape="rect" id="node4" href="numa_8h.html#aba49c14c68d23dc05d046db02766b928" title="numa_preferred" alt="" coords="541,38,652,65"/>
<area shape="rect" id="node5" href="numa_8h.html#a56f33968932f6550e5e5eb4d1acc67b3" title="numa_set_preferred" alt="" coords="529,89,665,116"/>
<area shape="rect" id="node6" href="group__ASSORTED.html#gab3d1892edaa7db4b02029567b7993f37" title="In order to run even on a non&#45;numa machine or a machine with fewer sockets, we allow specifying arbit..." alt="" coords="521,140,672,182"/>
<area shape="rect" id="node8" href="namespacefoedus_1_1memory.html#ac2422aa4fe378da8a9594901762e17df" title="foedus::memory::alloc_mmap" alt="" coords="720,262,913,289"/>
<area shape="rect" id="node10" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="974,316,1114,358"/>
<area shape="rect" id="node11" href="namespacefoedus_1_1memory.html#ae51e4a90f52316ba9dce8ff783f30d84" title="foedus::memory::alloc\l_mmap_1gb_pages" alt="" coords="521,258,672,299"/>
<area shape="rect" id="node12" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="529,375,664,416"/>
<area shape="rect" id="node14" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="736,440,897,482"/>
<area shape="rect" id="node7" href="numa_8h.html#a22585176d6e08c221de8377637bd72a7" title="numa_num_configured\l_nodes" alt="" coords="741,140,893,182"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1memory.html#af6145d9296231995c84badafb6a2a0a9" title="Returns if 1GB hugepages were enabled. " alt="" coords="961,251,1127,292"/>
<area shape="rect" id="node13" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="749,375,884,416"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a8e9c6560b489d4709183256c6e6d332a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::cache::CacheHashtable::evict </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html">CacheHashtable::EvictArgs</a> *&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evict some entries from the hashtable. </p>
<p>Compared to traditional bufferpools, this is much simpler and more scalable thanks to the loose requirements and epoch-based reclamation of the evicted pages. This method only evicts the hashtable entries, so reclaiming the pages pointed from the entries is done by the caller. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00171">171</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00378">clockhand_</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00212">evict_main_loop()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00277">evict_overflow_loop()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00290">foedus::cache::CacheHashtable::EvictArgs::evicted_count_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00314">get_physical_buckets()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00338">numa_node_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00355">overflow_buckets_head_</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00288">foedus::cache::CacheHashtable::EvictArgs::target_count_</a>.</p>

<p>Referenced by <a class="el" href="cache__manager__pimpl_8cpp_source.html#l00190">foedus::cache::CacheManagerPimpl::handle_cleaner_evict_pages()</a>.</p>
<div class="fragment"><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                                        {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot-Cache eviction starts at node-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">numa_node_</a></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, clockhand_=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">clockhand_</a> &lt;&lt; <span class="stringliteral">&quot;, #target=&quot;</span> &lt;&lt; args-&gt;target_count_;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> end = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">get_physical_buckets</a>();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> cur = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">clockhand_</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// we check each entry in refcounts_, which are 2 bytes each.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">// for quicker checks, we want 8-byte aligned access.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// also, we should anyway do prefetch, so make it 64-byte aligned</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  cur = (cur &gt;&gt; 5) &lt;&lt; 5;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur % (1U &lt;&lt; 5) == 0);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">if</span> (cur &gt;= end) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    cur = 0;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">// evict on the normal buckets first.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  args-&gt;evicted_count_ = 0;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  uint16_t loops;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keyword">const</span> uint16_t kMaxLoops = 16;  <span class="comment">// if we need more loops than this, something is wrong...</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">for</span> (loops = 0; loops &lt; kMaxLoops; ++loops) {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    cur = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a090081806f98e5bb1184632b9fce6293">evict_main_loop</a>(args, cur, loops);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (cur &gt;= <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">get_physical_buckets</a>()) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      cur = 0;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="comment">// we went over all buckets in usual entries. now check the overflow linked list.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#abcd23e94ab45dd35b1ae158a498e4344">evict_overflow_loop</a>(args, loops);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (args-&gt;evicted_count_ &gt;= args-&gt;target_count_) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur == 0);  <span class="comment">// we checked all buckets and wrapped around, right? go on to next loop</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">clockhand_</a> = cur;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot-Cache eviction completed at node-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">numa_node_</a></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, clockhand_=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">clockhand_</a> &lt;&lt; <span class="stringliteral">&quot;, #evicted=&quot;</span> &lt;&lt; args-&gt;evicted_count_</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, looped-over the whole hashtable for &quot;</span> &lt;&lt; loops &lt;&lt; <span class="stringliteral">&quot; times&quot;</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_abcd23e94ab45dd35b1ae158a498e4344"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#abcd23e94ab45dd35b1ae158a498e4344">foedus::cache::CacheHashtable::evict_overflow_loop</a></div><div class="ttdeci">void evict_overflow_loop(EvictArgs *args, uint16_t loop)</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8cpp_source.html#l00277">cache_hashtable.cpp:277</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a727376cbbde951edc3535a7ff6e46b68"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">foedus::cache::CacheHashtable::clockhand_</a></div><div class="ttdeci">BucketId clockhand_</div><div class="ttdoc">We previously stopped eviction here for usual buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00378">cache_hashtable.hpp:378</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_abfca49eb29e5129b80bf087c7b9cfaa7"><div class="ttname"><a href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">foedus::cache::BucketId</a></div><div class="ttdeci">uint32_t BucketId</div><div class="ttdoc">Offset in hashtable bucket. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00049">cache_hashtable.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_abd3c185877f109817850f92eab7ff4b3"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">foedus::cache::CacheHashtable::get_physical_buckets</a></div><div class="ttdeci">BucketId get_physical_buckets() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00314">cache_hashtable.hpp:314</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a090081806f98e5bb1184632b9fce6293"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a090081806f98e5bb1184632b9fce6293">foedus::cache::CacheHashtable::evict_main_loop</a></div><div class="ttdeci">BucketId evict_main_loop(EvictArgs *args, BucketId cur, uint16_t loop)</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8cpp_source.html#l00212">cache_hashtable.cpp:212</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae86a50505266a7691692e0b6297eeebf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">foedus::cache::CacheHashtable::numa_node_</a></div><div class="ttdeci">const uint16_t numa_node_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00338">cache_hashtable.hpp:338</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a483f0657f4ce6795f74d1c5984b28108"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">foedus::cache::CacheHashtable::overflow_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_buckets_head_</div><div class="ttdoc">This forms a singly-linked list of active overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00355">cache_hashtable.hpp:355</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#a090081806f98e5bb1184632b9fce6293" title="foedus::cache::CacheHashtable\l::evict_main_loop" alt="" coords="260,169,467,211"/>
<area shape="rect" id="node3" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3" title="foedus::cache::CacheHashtable\l::get_physical_buckets" alt="" coords="515,5,721,47"/>
<area shape="rect" id="node12" href="classfoedus_1_1cache_1_1CacheHashtable.html#abcd23e94ab45dd35b1ae158a498e4344" title="foedus::cache::CacheHashtable\l::evict_overflow_loop" alt="" coords="260,235,467,276"/>
<area shape="rect" id="node4" href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83" title="Prefetch multiple contiguous cachelines to L1 cache. " alt="" coords="532,71,704,112"/>
<area shape="rect" id="node6" href="structfoedus_1_1cache_1_1CacheRefCount.html#a13f4ce6af05ea4a063dbce09a4479439" title="returns whether the counter is still non&#45;zero " alt="" coords="517,332,719,373"/>
<area shape="rect" id="node7" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html#abf10e784be4a89750374654daa89d1d3" title="foedus::cache::CacheHashtable\l::EvictArgs::add_evicted" alt="" coords="515,136,721,177"/>
<area shape="rect" id="node8" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="551,201,685,243"/>
<area shape="rect" id="node11" href="classfoedus_1_1debugging_1_1StopWatch.html#a7f1f05f4dd494dd57c3ecafb5d9131fb" title="foedus::debugging::\lStopWatch::elapsed_us" alt="" coords="537,267,699,308"/>
<area shape="rect" id="node5" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="769,71,941,112"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="788,233,923,275"/>
<area shape="rect" id="node10" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="775,168,936,209"/>
<area shape="rect" id="node13" href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d" title="foedus::cache::CacheBucket\l::get_content_id" alt="" coords="523,397,713,439"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a8e9c6560b489d4709183256c6e6d332a_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a0b5e7574ed3474be65757a9f1d2595fc" title="Evicts pages up to about target_count (maybe a bit more or less). " alt="" coords="260,5,485,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="533,5,732,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="780,5,979,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1027,5,1225,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a090081806f98e5bb1184632b9fce6293"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> foedus::cache::CacheHashtable::evict_main_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html">CacheHashtable::EvictArgs</a> *&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td>
          <td class="paramname"><em>cur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>loop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00212">212</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="cache__hashtable_8hpp_source.html#l00295">foedus::cache::CacheHashtable::EvictArgs::add_evicted()</a>, <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="compiler_8hpp_source.html#l00111">ASSUME_ALIGNED</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00378">clockhand_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00141">foedus::cache::CacheBucket::data_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00172">foedus::cache::CacheRefCount::decrement()</a>, <a class="el" href="stop__watch_8hpp_source.html#l00045">foedus::debugging::StopWatch::elapsed_us()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00290">foedus::cache::CacheHashtable::EvictArgs::evicted_count_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00314">get_physical_buckets()</a>, <a class="el" href="cacheline_8hpp_source.html#l00042">foedus::assorted::kCachelineSize</a>, <a class="el" href="compiler_8hpp_source.html#l00103">LIKELY</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00338">numa_node_</a>, <a class="el" href="cacheline_8hpp_source.html#l00066">foedus::assorted::prefetch_cachelines()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00347">refcounts_</a>, <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00288">foedus::cache::CacheHashtable::EvictArgs::target_count_</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00171">evict()</a>.</p>
<div class="fragment"><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                 {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur % (1U &lt;&lt; 5) == 0);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>((<a class="code" href="group__ASSORTED.html#gad5ea63b0770685f3aad857fbd6e9096e">assorted::kCachelineSize</a> &gt;&gt; 5) == <span class="keyword">sizeof</span>(CacheRefCount));</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keyword">const</span> uint16_t decrements = 1U &lt;&lt; loop;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  debugging::StopWatch watch;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// the main idea is as follows.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">// whenever the bucket has never been used or been used but released without unlucky races,</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// the corresponding refcount is zero. hence, we just check for non-zeros in refcounts_.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// this is trivially vectorized and the only observable cost is L1 cache miss.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// we reduce L1 cache miss cost by prefetching a lot.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  uint32_t cur_cacheline = cur &gt;&gt; 5;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keyword">const</span> uint32_t end_cacheline = (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">get_physical_buckets</a>() &gt;&gt; 5) + 1ULL;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">// for example, we prefetch cacheline 16-23 while reading cacheline 0-7.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keyword">const</span> uint16_t kL1PrefetchBatch = 8;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keyword">const</span> uint16_t kL1PrefetchAhead = 16;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">for</span> (; cur_cacheline &lt; end_cacheline; ++cur_cacheline) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (cur_cacheline / kL1PrefetchBatch == 0) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <a class="code" href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83">assorted::prefetch_cachelines</a>(</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a> + ((cur_cacheline + kL1PrefetchAhead) &lt;&lt; 5),</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        kL1PrefetchBatch);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> bucket = cur_cacheline &lt;&lt; 5;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// gcc, you should be smart enough to optimize this. at least with O3.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    uint64_t* ints = <span class="keyword">reinterpret_cast&lt;</span>uint64_t*<span class="keyword">&gt;</span>(<a class="code" href="group__COMPILER.html#gae36a71bd5471dacafdfc44648ab7fd2b">ASSUME_ALIGNED</a>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a> + bucket, 64));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordtype">bool</span> all_zeros = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; 8U; ++i) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">if</span> (ints[i] != 0) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        all_zeros = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#gad10e2a9bf230cc6fdd98a6c70958ef81">LIKELY</a>(all_zeros)) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">// this should be a rare case as far as we keep the hashtable sparse.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      CacheRefCount* base = <span class="keyword">reinterpret_cast&lt;</span>CacheRefCount*<span class="keyword">&gt;</span>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a> + bucket);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; 32U; ++i) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> (base[i].count_ &gt; 0) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;          <span class="keywordtype">bool</span> still_non_zero = base[i].decrement(decrements);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;          <span class="keywordflow">if</span> (!still_non_zero) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            args-&gt;add_evicted(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[bucket + i].get_content_id());</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[bucket + i].<a class="code" href="structfoedus_1_1cache_1_1CacheBucket.html#a65fb833842c41ebfa7fec52146309ffa">data_</a> = 0;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (args-&gt;evicted_count_ &gt;= args-&gt;target_count_) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  watch.stop();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot-Cache eviction main_loop at node-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">numa_node_</a> &lt;&lt; <span class="stringliteral">&quot;, checked &quot;</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    &lt;&lt; ((cur_cacheline &lt;&lt; 5) - <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">clockhand_</a>) &lt;&lt; <span class="stringliteral">&quot; buckets in &quot;</span> &lt;&lt; watch.elapsed_us() &lt;&lt; <span class="stringliteral">&quot;us&quot;</span>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">return</span> cur_cacheline &lt;&lt; 5;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a727376cbbde951edc3535a7ff6e46b68"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a727376cbbde951edc3535a7ff6e46b68">foedus::cache::CacheHashtable::clockhand_</a></div><div class="ttdeci">BucketId clockhand_</div><div class="ttdoc">We previously stopped eviction here for usual buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00378">cache_hashtable.hpp:378</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_abfca49eb29e5129b80bf087c7b9cfaa7"><div class="ttname"><a href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">foedus::cache::BucketId</a></div><div class="ttdeci">uint32_t BucketId</div><div class="ttdoc">Offset in hashtable bucket. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00049">cache_hashtable.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_abd3c185877f109817850f92eab7ff4b3"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">foedus::cache::CacheHashtable::get_physical_buckets</a></div><div class="ttdeci">BucketId get_physical_buckets() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00314">cache_hashtable.hpp:314</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga14adcd2a780f37023df88933f17a5a83"><div class="ttname"><a href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83">foedus::assorted::prefetch_cachelines</a></div><div class="ttdeci">void prefetch_cachelines(const void *address, int cacheline_count)</div><div class="ttdoc">Prefetch multiple contiguous cachelines to L1 cache. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00066">cacheline.hpp:66</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
<div class="ttc" id="group__COMPILER_html_gae36a71bd5471dacafdfc44648ab7fd2b"><div class="ttname"><a href="group__COMPILER.html#gae36a71bd5471dacafdfc44648ab7fd2b">ASSUME_ALIGNED</a></div><div class="ttdeci">#define ASSUME_ALIGNED(x, y)</div><div class="ttdoc">Wraps GCC&#39;s __builtin_assume_aligned. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00111">compiler.hpp:111</a></div></div>
<div class="ttc" id="group__COMPILER_html_gad10e2a9bf230cc6fdd98a6c70958ef81"><div class="ttname"><a href="group__COMPILER.html#gad10e2a9bf230cc6fdd98a6c70958ef81">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)        </div><div class="ttdoc">Hints that x is highly likely true. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00103">compiler.hpp:103</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gad5ea63b0770685f3aad857fbd6e9096e"><div class="ttname"><a href="group__ASSORTED.html#gad5ea63b0770685f3aad857fbd6e9096e">foedus::assorted::kCachelineSize</a></div><div class="ttdeci">const uint16_t kCachelineSize</div><div class="ttdoc">Byte count of one cache line. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00042">cacheline.hpp:42</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheBucket_html_a65fb833842c41ebfa7fec52146309ffa"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheBucket.html#a65fb833842c41ebfa7fec52146309ffa">foedus::cache::CacheBucket::data_</a></div><div class="ttdeci">uint64_t data_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00141">cache_hashtable.hpp:141</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae71e9e3e6d08ece9f4a640d2d9dcea8b"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">foedus::cache::CacheHashtable::refcounts_</a></div><div class="ttdeci">CacheRefCount * refcounts_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00347">cache_hashtable.hpp:347</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae86a50505266a7691692e0b6297eeebf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">foedus::cache::CacheHashtable::numa_node_</a></div><div class="ttdeci">const uint16_t numa_node_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00338">cache_hashtable.hpp:338</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html#abf10e784be4a89750374654daa89d1d3" title="foedus::cache::CacheHashtable\l::EvictArgs::add_evicted" alt="" coords="260,5,467,47"/>
<area shape="rect" id="node3" href="structfoedus_1_1cache_1_1CacheRefCount.html#a13f4ce6af05ea4a063dbce09a4479439" title="returns whether the counter is still non&#45;zero " alt="" coords="263,71,464,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1debugging_1_1StopWatch.html#a7f1f05f4dd494dd57c3ecafb5d9131fb" title="foedus::debugging::\lStopWatch::elapsed_us" alt="" coords="283,136,444,177"/>
<area shape="rect" id="node5" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3" title="foedus::cache::CacheHashtable\l::get_physical_buckets" alt="" coords="260,201,467,243"/>
<area shape="rect" id="node6" href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83" title="Prefetch multiple contiguous cachelines to L1 cache. " alt="" coords="277,267,449,308"/>
<area shape="rect" id="node8" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="296,332,431,373"/>
<area shape="rect" id="node7" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="515,267,687,308"/>
<area shape="rect" id="node9" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="533,332,668,373"/>
<area shape="rect" id="node10" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="520,397,681,439"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a090081806f98e5bb1184632b9fce6293_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e9c6560b489d4709183256c6e6d332a" title="Evict some entries from the hashtable. " alt="" coords="260,5,467,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a0b5e7574ed3474be65757a9f1d2595fc" title="Evicts pages up to about target_count (maybe a bit more or less). " alt="" coords="515,5,740,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="788,5,987,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="1035,5,1233,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1281,5,1480,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abcd23e94ab45dd35b1ae158a498e4344"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::cache::CacheHashtable::evict_overflow_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html">CacheHashtable::EvictArgs</a> *&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>loop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00277">277</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="cache__hashtable_8hpp_source.html#l00295">foedus::cache::CacheHashtable::EvictArgs::add_evicted()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00192">foedus::cache::CacheOverflowEntry::bucket_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00141">foedus::cache::CacheBucket::data_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00172">foedus::cache::CacheRefCount::decrement()</a>, <a class="el" href="stop__watch_8hpp_source.html#l00045">foedus::debugging::StopWatch::elapsed_us()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00147">foedus::cache::CacheBucket::get_content_id()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00198">foedus::cache::CacheOverflowEntry::next_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00338">numa_node_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00350">overflow_buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00355">overflow_buckets_head_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00370">overflow_free_buckets_mutex_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00199">foedus::cache::CacheOverflowEntry::refcount_</a>, and <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00171">evict()</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                                                                     {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keyword">const</span> uint16_t decrements = 1U &lt;&lt; loop;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  uint32_t checked_count = 0;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// store evicted entries into</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> evicted_head = 0;  <span class="comment">// evicted</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  debugging::StopWatch watch;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// We block this method entirely with the free buckets mutex.</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">// This does NOT block usual transactions unless they actually have to newly add to overflow,</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// which should be very rare. This is cheap yet enough to make the free-list safe.</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    soc::SharedMutexScope scope(&amp;<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac05195f8bd620a7ebe6d3321f97bb34e">overflow_free_buckets_mutex_</a>);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// no interesting optimization. overflow list should be empty or almost empty.</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> head = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span> (head != 0) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="comment">// skip the head. we handle it at the last.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> prev = head;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> cur = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[prev].next_; cur != 0;) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        CacheOverflowEntry* cur_entry = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a> + cur;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> next = cur_entry-&gt;next_;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordtype">bool</span> still_non_zero = cur_entry-&gt;refcount_.decrement(decrements);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (!still_non_zero) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          args-&gt;add_evicted(cur_entry-&gt;bucket_.get_content_id());</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          CacheOverflowEntry* prev_entry = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a> + prev;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          prev_entry-&gt;<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a> = next;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          cur_entry-&gt;bucket_.data_ = 0;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          cur_entry-&gt;next_ = evicted_head;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          evicted_head = cur;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        prev = cur;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        cur = next;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        ++checked_count;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="comment">// finally check the head</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      CacheOverflowEntry* cur_entry = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a> + head;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordtype">bool</span> still_non_zero = cur_entry-&gt;<a class="code" href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">refcount_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#a13f4ce6af05ea4a063dbce09a4479439">decrement</a>(decrements);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">if</span> (!still_non_zero) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        args-&gt;add_evicted(cur_entry-&gt;bucket_.get_content_id());</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a> = cur_entry-&gt;next_;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        cur_entry-&gt;bucket_.data_ = 0;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        cur_entry-&gt;next_ = evicted_head;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        evicted_head = head;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      ++checked_count;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  watch.stop();</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Snapshot-Cache eviction overflow_loop at node-&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">numa_node_</a> &lt;&lt; <span class="stringliteral">&quot;, checked &quot;</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    &lt;&lt; (checked_count) &lt;&lt; <span class="stringliteral">&quot; buckets in &quot;</span> &lt;&lt; watch.elapsed_us() &lt;&lt; <span class="stringliteral">&quot;us&quot;</span>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ac05195f8bd620a7ebe6d3321f97bb34e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ac05195f8bd620a7ebe6d3321f97bb34e">foedus::cache::CacheHashtable::overflow_free_buckets_mutex_</a></div><div class="ttdeci">soc::SharedMutex overflow_free_buckets_mutex_</div><div class="ttdoc">The mutex to protect free overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00370">cache_hashtable.hpp:370</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_afc6c1d5e06ba80515bee790d0f240baf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">foedus::cache::CacheHashtable::overflow_buckets_</a></div><div class="ttdeci">CacheOverflowEntry * overflow_buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00350">cache_hashtable.hpp:350</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a2d1f26fae41d62d8c2db91322b4f5466"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">foedus::cache::OverflowPointer</a></div><div class="ttdeci">uint32_t OverflowPointer</div><div class="ttdoc">Position in the overflow buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00072">cache_hashtable.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheRefCount_html_a13f4ce6af05ea4a063dbce09a4479439"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheRefCount.html#a13f4ce6af05ea4a063dbce09a4479439">foedus::cache::CacheRefCount::decrement</a></div><div class="ttdeci">bool decrement(uint16_t subtract) __attribute__((always_inline))</div><div class="ttdoc">returns whether the counter is still non-zero </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00172">cache_hashtable.hpp:172</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ac6b943d816bc16689f894a7b735bb861"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">foedus::cache::CacheOverflowEntry::refcount_</a></div><div class="ttdeci">CacheRefCount refcount_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00199">cache_hashtable.hpp:199</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae86a50505266a7691692e0b6297eeebf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae86a50505266a7691692e0b6297eeebf">foedus::cache::CacheHashtable::numa_node_</a></div><div class="ttdeci">const uint16_t numa_node_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00338">cache_hashtable.hpp:338</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ae12719ddad39c1aaac04a294fe0dea3f"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">foedus::cache::CacheOverflowEntry::next_</a></div><div class="ttdeci">OverflowPointer next_</div><div class="ttdoc">Note that we don&#39;t have to atomically maintain/follow this pointer thanks to the loose requirements...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00198">cache_hashtable.hpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a483f0657f4ce6795f74d1c5984b28108"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">foedus::cache::CacheHashtable::overflow_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_buckets_head_</div><div class="ttdoc">This forms a singly-linked list of active overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00355">cache_hashtable.hpp:355</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1cache_1_1CacheHashtable_1_1EvictArgs.html#abf10e784be4a89750374654daa89d1d3" title="foedus::cache::CacheHashtable\l::EvictArgs::add_evicted" alt="" coords="260,5,467,47"/>
<area shape="rect" id="node3" href="structfoedus_1_1cache_1_1CacheRefCount.html#a13f4ce6af05ea4a063dbce09a4479439" title="returns whether the counter is still non&#45;zero " alt="" coords="263,71,464,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1debugging_1_1StopWatch.html#a7f1f05f4dd494dd57c3ecafb5d9131fb" title="foedus::debugging::\lStopWatch::elapsed_us" alt="" coords="283,136,444,177"/>
<area shape="rect" id="node5" href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d" title="foedus::cache::CacheBucket\l::get_content_id" alt="" coords="269,201,458,243"/>
<area shape="rect" id="node6" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="296,267,431,308"/>
<area shape="rect" id="node7" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="528,233,663,275"/>
<area shape="rect" id="node8" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="515,299,676,340"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_abcd23e94ab45dd35b1ae158a498e4344_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e9c6560b489d4709183256c6e6d332a" title="Evict some entries from the hashtable. " alt="" coords="260,5,467,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a0b5e7574ed3474be65757a9f1d2595fc" title="Evicts pages up to about target_count (maybe a bit more or less). " alt="" coords="515,5,740,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="788,5,987,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="1035,5,1233,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1281,5,1480,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac92d7a0c69e61cfdcacd72b9e8c7bd74"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#a90670494c3a525f4921b61d4e06ca369">ContentId</a> foedus::cache::CacheHashtable::find </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a>&#160;</td>
          <td class="paramname"><em>page_id</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns an offset for the given page ID <em>opportunistically</em>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">page_id</td><td>Page ID to look for </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>offset that contains the page. 0 if not found.</dd></dl>
<p>This doesn't take a lock, so a concurrent thread might have inserted the wanted page concurrrently. It's fine. Then we read the page from snapshot, just wasting a bit. Instead, an entry is removed from the cache gracefully, thus an offset we observed will not become invalid soon (pages are garbage collected with grace period). No precise concurrency control needed.</p>
<p>However, it might (very occasionally) cause a false negative due to the way we verify (each <a class="el" href="structfoedus_1_1cache_1_1CacheBucket.html" title="Hash bucket in cache table. ">CacheBucket</a> contains only a compressed version of the page Id). So, the caller must check whether the returned ContentId really points to a correct page, and invoke <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#af7762689517cd7a18dd64d8591a3272a" title="Called when a cached page is not found. ">install()</a> in that case. Again, no precise concurrency control required. Even for false positives/negatives, we just get a bit slower. No correctness issue. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00415">415</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00192">foedus::cache::CacheOverflowEntry::bucket_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00319">get_bucket_number()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00147">foedus::cache::CacheBucket::get_content_id()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00313">get_logical_buckets()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00406">foedus::cache::HashFunc::get_tag()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00155">foedus::cache::CacheBucket::get_tag()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00166">foedus::cache::CacheRefCount::increment()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00080">foedus::cache::kHopNeighbors</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00198">foedus::cache::CacheOverflowEntry::next_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00350">overflow_buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00355">overflow_buckets_head_</a>, <a class="el" href="cacheline_8hpp_source.html#l00066">foedus::assorted::prefetch_cachelines()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00199">foedus::cache::CacheOverflowEntry::refcount_</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00347">refcounts_</a>.</p>

<p>Referenced by <a class="el" href="thread__pimpl_8cpp_source.html#l00647">foedus::thread::ThreadPimpl::find_or_read_a_snapshot_page()</a>.</p>
<div class="fragment"><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                                                              {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page_id &gt; 0);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> bucket_number = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20">get_bucket_number</a>(page_id);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bucket_number &lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#acea3236385a3b8d05ed1a60186e32ee8">get_logical_buckets</a>());</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">// we prefetch up to 128 bytes (16 entries).</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83">assorted::prefetch_cachelines</a>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a> + bucket_number, 2);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#a9e55979322d3cfceff78e1f77d901a82">PageIdTag</a> tag = <a class="code" href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6">HashFunc::get_tag</a>(page_id);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tag != 0);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; <a class="code" href="namespacefoedus_1_1cache.html#a56bdc23db45d170f73d6558b12ffab5a">kHopNeighbors</a>; ++i) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keyword">const</span> CacheBucket&amp; bucket = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[bucket_number + i];</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">if</span> (bucket.get_tag() == tag) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="comment">// found (probably)!</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a>[bucket_number + i].<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa">increment</a>();</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">return</span> bucket.get_content_id();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// Not found. let&#39;s check overflow list</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> i = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>; i != 0;) {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].bucket_.get_tag() == tag) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">refcount_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa">increment</a>();</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">bucket_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d">get_content_id</a>();</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      i = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a>;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_afc6c1d5e06ba80515bee790d0f240baf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">foedus::cache::CacheHashtable::overflow_buckets_</a></div><div class="ttdeci">CacheOverflowEntry * overflow_buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00350">cache_hashtable.hpp:350</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_abfca49eb29e5129b80bf087c7b9cfaa7"><div class="ttname"><a href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">foedus::cache::BucketId</a></div><div class="ttdeci">uint32_t BucketId</div><div class="ttdoc">Offset in hashtable bucket. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00049">cache_hashtable.hpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1HashFunc_html_a9470855bb66d98df48f82fc5ba6655c6"><div class="ttname"><a href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6">foedus::cache::HashFunc::get_tag</a></div><div class="ttdeci">static PageIdTag get_tag(storage::SnapshotPagePointer page_id) __attribute__((always_inline))</div><div class="ttdoc">Returns another hash value used to differentiate IDs with similar hash values. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00406">cache_hashtable.hpp:406</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a2d1f26fae41d62d8c2db91322b4f5466"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">foedus::cache::OverflowPointer</a></div><div class="ttdeci">uint32_t OverflowPointer</div><div class="ttdoc">Position in the overflow buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00072">cache_hashtable.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga14adcd2a780f37023df88933f17a5a83"><div class="ttname"><a href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83">foedus::assorted::prefetch_cachelines</a></div><div class="ttdeci">void prefetch_cachelines(const void *address, int cacheline_count)</div><div class="ttdoc">Prefetch multiple contiguous cachelines to L1 cache. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00066">cacheline.hpp:66</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheRefCount_html_af555d7665e995d8e65f315c708d28daa"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa">foedus::cache::CacheRefCount::increment</a></div><div class="ttdeci">void increment() __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00166">cache_hashtable.hpp:166</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a9e55979322d3cfceff78e1f77d901a82"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a9e55979322d3cfceff78e1f77d901a82">foedus::cache::PageIdTag</a></div><div class="ttdeci">uint32_t PageIdTag</div><div class="ttdoc">This is a lossy-compressed representation of SnapshotPagePointer used to quickly identify whether the...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00067">cache_hashtable.hpp:67</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae71e9e3e6d08ece9f4a640d2d9dcea8b"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">foedus::cache::CacheHashtable::refcounts_</a></div><div class="ttdeci">CacheRefCount * refcounts_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00347">cache_hashtable.hpp:347</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a56bdc23db45d170f73d6558b12ffab5a"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a56bdc23db45d170f73d6558b12ffab5a">foedus::cache::kHopNeighbors</a></div><div class="ttdeci">const uint16_t kHopNeighbors</div><div class="ttdoc">Starting from the given position, we consider this many buckets for the entry. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00080">cache_hashtable.hpp:80</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheBucket_html_ab91d1b89c885979b7a6a4ef70b12b54d"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d">foedus::cache::CacheBucket::get_content_id</a></div><div class="ttdeci">ContentId get_content_id() const </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00147">cache_hashtable.hpp:147</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ac6b943d816bc16689f894a7b735bb861"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">foedus::cache::CacheOverflowEntry::refcount_</a></div><div class="ttdeci">CacheRefCount refcount_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00199">cache_hashtable.hpp:199</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_acea3236385a3b8d05ed1a60186e32ee8"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#acea3236385a3b8d05ed1a60186e32ee8">foedus::cache::CacheHashtable::get_logical_buckets</a></div><div class="ttdeci">BucketId get_logical_buckets() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00313">cache_hashtable.hpp:313</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a30b6a0b28cce30d50da7e0419c8cad20"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20">foedus::cache::CacheHashtable::get_bucket_number</a></div><div class="ttdeci">BucketId get_bucket_number(storage::SnapshotPagePointer page_id) const __attribute__((always_inline))</div><div class="ttdoc">Returns a bucket number the given page ID should belong to. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00319">cache_hashtable.hpp:319</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ae12719ddad39c1aaac04a294fe0dea3f"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">foedus::cache::CacheOverflowEntry::next_</a></div><div class="ttdeci">OverflowPointer next_</div><div class="ttdoc">Note that we don&#39;t have to atomically maintain/follow this pointer thanks to the loose requirements...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00198">cache_hashtable.hpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a483f0657f4ce6795f74d1c5984b28108"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">foedus::cache::CacheHashtable::overflow_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_buckets_head_</div><div class="ttdoc">This forms a singly-linked list of active overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00355">cache_hashtable.hpp:355</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a60ed7dceb59de97100cce445f5dbcd3a"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">foedus::cache::CacheOverflowEntry::bucket_</a></div><div class="ttdeci">CacheBucket bucket_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00192">cache_hashtable.hpp:192</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20" title="Returns a bucket number the given page ID should belong to. " alt="" coords="260,158,467,199"/>
<area shape="rect" id="node10" href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d" title="foedus::cache::CacheBucket\l::get_content_id" alt="" coords="269,223,458,265"/>
<area shape="rect" id="node11" href="classfoedus_1_1cache_1_1CacheHashtable.html#acea3236385a3b8d05ed1a60186e32ee8" title="foedus::cache::CacheHashtable\l::get_logical_buckets" alt="" coords="260,289,467,330"/>
<area shape="rect" id="node12" href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6" title="Returns another hash value used to differentiate IDs with similar hash values. " alt="" coords="278,354,449,395"/>
<area shape="rect" id="node13" href="structfoedus_1_1cache_1_1CacheBucket.html#aad7099f48418a335a80260a664bf2f02" title="foedus::cache::CacheBucket\l::get_tag" alt="" coords="269,419,458,461"/>
<area shape="rect" id="node14" href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa" title="foedus::cache::CacheRefCount\l::increment" alt="" coords="263,485,464,526"/>
<area shape="rect" id="node15" href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83" title="Prefetch multiple contiguous cachelines to L1 cache. " alt="" coords="277,550,449,591"/>
<area shape="rect" id="node3" href="structfoedus_1_1cache_1_1HashFunc.html#a19737fa3c91676f9c85536f5928b7501" title="Returns a bucket number the given snapshot page ID should belong to. " alt="" coords="515,158,686,199"/>
<area shape="rect" id="node4" href="structfoedus_1_1cache_1_1HashFunc.html#aa9020cb1e5915b6777d089521ef618a9" title="Returns a hash value for the given snapshot page ID. " alt="" coords="738,93,909,134"/>
<area shape="rect" id="node8" href="structfoedus_1_1assorted_1_1ConstDiv.html#a6892a2d35b9ae08a00190c9440e22a21" title="32&#45;bit integer division that outputs both quotient and remainder. " alt="" coords="735,158,912,199"/>
<area shape="rect" id="node9" href="structfoedus_1_1assorted_1_1ConstDiv.html#afbfa08664902f9b633edbd395706b230" title="Calculate remainder. " alt="" coords="735,223,912,265"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="965,5,1155,61"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="966,85,1154,141"/>
<area shape="rect" id="node7" href="namespacefoedus_1_1storage.html#a3c3e7a984303d1ef88e001db1591b1be" title="foedus::storage::extract\l_local_page_id_from_snapshot\l_pointer" alt="" coords="960,165,1160,221"/>
<area shape="rect" id="node16" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="515,550,687,591"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_ac92d7a0c69e61cfdcacd72b9e8c7bd74_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a16c6375f66e9f177c908dc1fbc132681" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="260,549,469,590"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="981,357,1191,398"/>
<area shape="rect" id="node24" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a4a95ef1bd710a66e0c24df998f881d04" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="517,549,701,590"/>
<area shape="rect" id="node26" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a9b77133f66157bca81a49caeca9a9904" title="A general method to follow (read) a page pointer. " alt="" coords="749,622,933,663"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#af22fe9e661763ca3225eeedf7fa62879" title="foedus::storage::array\l::ArrayStoragePimpl::prefetch\l_pages_recurse" alt="" coords="1239,469,1432,525"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f" title="for non&#45;root " alt="" coords="1491,317,1704,358"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02" title="subroutine to follow a pointer to head of bin from a volatile parent " alt="" coords="1246,309,1425,365"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105" title="Simpler version of locate_record for when we are in snapshot world. " alt="" coords="1245,179,1426,235"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#abe8cbf3d8edfb47a32d460029707aace" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_follow" alt="" coords="1249,389,1422,445"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#adbf75cfe4ac8c4c5e1e8a32342b66d00" title="defined in array_storage_prefetch.cpp " alt="" coords="1480,529,1715,570"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#af420e19da8ee4ed731ae387932cc991e" title="Prefetch data pages in this storage. " alt="" coords="1764,529,1967,570"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c" title="Find a pointer to the bin that contains records for the hash. " alt="" coords="1763,329,1968,370"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a222e0d485305f3253b0e1c97720dc0c8" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record" alt="" coords="2035,5,2199,61"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4eff8bc4e42a5973c8553830890d8a24" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record_part" alt="" coords="2035,85,2199,141"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#ac9c35890555ddb10d908b77602a1f28c" title="foedus::storage::hash\l::HashStoragePimpl::insert\l_record" alt="" coords="2028,165,2207,221"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a357386c8e5be667334520a33aff51725" title="foedus::storage::hash\l::HashStoragePimpl::delete\l_record" alt="" coords="2027,245,2208,301"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a49df48b50c0c645d3a047e8b153c4015" title="foedus::storage::hash\l::HashStoragePimpl::upsert\l_record" alt="" coords="2026,325,2209,381"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#add8aafbb32713dc6be20804da789f43d" title="foedus::storage::hash\l::HashStoragePimpl::overwrite\l_record" alt="" coords="2019,405,2215,461"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a233fcd7ffd24bd59d2d0943af3d0de03" title="foedus::storage::hash\l::HashStoragePimpl::increment\l_record" alt="" coords="2016,485,2219,541"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a86af9aa3326dd20ffdac2a1beffea0b4" title="Usually follows locate_bin to locate the exact physical record for the key, or create a new one if no..." alt="" coords="1507,179,1688,235"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aa8d098fb8e3b997b1dc52ede62b8acb6" title="locate_record()&#39;s physical_only version. " alt="" coords="1775,248,1956,304"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d" title="locate_record()&#39;s logical+physical version. " alt="" coords="1775,168,1956,224"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a4c4630d85af99ceafad404bc5c5c7eef" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_normalized\l_recurse" alt="" coords="1503,382,1691,453"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a99bb085d9e427fc36182b13bb20371e9" title="defined in masstree_storage_prefetch.cpp " alt="" coords="1771,608,1959,664"/>
<area shape="rect" id="node25" href="classfoedus_1_1thread_1_1Thread.html#a13d14670c512a2f2f85ff6519a28488c" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="1007,477,1165,518"/>
<area shape="rect" id="node48" href="classfoedus_1_1thread_1_1ThreadPimpl.html#aac3821c478965e40c60c819a7e5a83e5" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="749,541,933,597"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6" title="A general method to follow (read) a page pointer. " alt="" coords="1011,727,1161,769"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ae0f40ca19aa9b9ac924542746e1b53c1" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointer" alt="" coords="1246,840,1425,896"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#abae9ebd099ebba507d98b8df782bd143" title="foedus::storage::array\l::ArrayStoragePimpl::get\l_root_page" alt="" coords="1253,760,1418,816"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538" title="Retrieves the root page of this storage. " alt="" coords="1253,680,1417,736"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#adc32aaf6f4537fcc1ada207e1d6902ec" title="Root&#45;node related, such as a method to retrieve 1st&#45;root, to grow, etc. " alt="" coords="1511,995,1684,1051"/>
<area shape="rect" id="node45" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff31f521523d7a7b81ff5b750e081dac" title="Thread::follow_page_pointer() for masstree. " alt="" coords="1249,1155,1422,1211"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a7f9205c706c8be3ad4f0c030a285d884" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read" alt="" coords="1505,915,1690,971"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a10c44402ff1533f5fee533cc13119759" title="This version always returns a volatile page, installing a new one if needed. " alt="" coords="1505,835,1690,891"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a86a1e1fb54d44f15bc17c3f622f9f279" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read_batch" alt="" coords="1505,755,1690,811"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a77af2675acbbf1c831925b3a2c972aa6" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_write_batch" alt="" coords="1505,595,1690,651"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac612c67d7e9e1a68dcccce98648cad0c" title="foedus::storage::array\l::ArrayStoragePimpl::verify\l_single_thread" alt="" coords="1509,675,1685,731"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeCursor.html#a226f6c437144cfb13f8e64baecb41d8a" title="foedus::storage::masstree\l::MasstreeCursor::open" alt="" coords="1779,834,1952,875"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#ad6c9eb02ad32cc1bffe9daac3521ad24" title="Returns the count of direct children in the first&#45;root node. " alt="" coords="1779,899,1952,970"/>
<area shape="rect" id="node39" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a32332060560b864a857a839bb0adb4fd" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::fatify_first_root_double" alt="" coords="2031,907,2204,963"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a91dac48625f8f7d2906fcfba5908cbc1" title="Identifies page and record for the key. " alt="" coords="1779,1155,1952,1211"/>
<area shape="rect" id="node41" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a0ce23624d660da08cb1ee04ac2297171" title="Identifies page and record for the normalized key. " alt="" coords="1776,995,1955,1051"/>
<area shape="rect" id="node42" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a52a1bce48d9230ad2ce3f52c4da51b8e" title="Like locate_record(), this is also a logical operation. " alt="" coords="1779,1235,1952,1291"/>
<area shape="rect" id="node43" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#acac5f9308b4aed46777d34f6fa171c8e" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::reserve_record_normalized" alt="" coords="1773,1075,1957,1131"/>
<area shape="rect" id="node44" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a2a4e90569074d49ab538041caedacf6a" title="These are defined in masstree_storage_verify.cpp. " alt="" coords="1779,703,1952,759"/>
<area shape="rect" id="node46" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a738313356f0e54e8e2d732c2017797c0" title="Find a border node in the layer that corresponds to the given key slice. " alt="" coords="1511,1115,1684,1171"/>
<area shape="rect" id="node47" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a6188e676e564b4ebecaa556178cdb81e" title="Follows to next layer&#39;s root page. " alt="" coords="1511,1195,1684,1251"/>
<area shape="rect" id="node49" href="classfoedus_1_1thread_1_1Thread.html#a2b375e7de4d6c9c7b222c45b271126dc" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="1011,548,1161,604"/>
<area shape="rect" id="node50" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ad0c8eb92d19915b679137e594bdfae31" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_write_batch" alt="" coords="1246,549,1425,605"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8e48716623ca44e83cc5ef871c10b131"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::cache::CacheHashtable::find_batch </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a> *&#160;</td>
          <td class="paramname"><em>page_ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1cache.html#a90670494c3a525f4921b61d4e06ca369">ContentId</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Batched version of <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac92d7a0c69e61cfdcacd72b9e8c7bd74" title="Returns an offset for the given page ID opportunistically. ">find()</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">batch_size</td><td>Batch size. Must be kMaxFindBatchSize or less. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">page_ids</td><td>Array of Page IDs to look for, size=batch_size </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Output </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Only possible error is kErrorCodeInvalidParameter for too large batch_size</dd></dl>
<p>This might perform much faster because of parallel prefetching, SIMD-ized hash calculattion (planned, not implemented yet) etc. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00376">376</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00192">foedus::cache::CacheOverflowEntry::bucket_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00319">get_bucket_number()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00147">foedus::cache::CacheBucket::get_content_id()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00313">get_logical_buckets()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00406">foedus::cache::HashFunc::get_tag()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00155">foedus::cache::CacheBucket::get_tag()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00166">foedus::cache::CacheRefCount::increment()</a>, <a class="el" href="error__code_8hpp_source.html#l00106">foedus::kErrorCodeInvalidParameter</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00080">foedus::cache::kHopNeighbors</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00237">kMaxFindBatchSize</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00198">foedus::cache::CacheOverflowEntry::next_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00350">overflow_buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00355">overflow_buckets_head_</a>, <a class="el" href="cacheline_8hpp_source.html#l00066">foedus::assorted::prefetch_cachelines()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00199">foedus::cache::CacheOverflowEntry::refcount_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00347">refcounts_</a>, and <a class="el" href="compiler_8hpp_source.html#l00104">UNLIKELY</a>.</p>

<p>Referenced by <a class="el" href="thread__pimpl_8cpp_source.html#l00687">foedus::thread::ThreadPimpl::find_or_read_snapshot_pages_batch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                        {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">if</span> (batch_size == 0) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(batch_size &lt;= <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334">kMaxFindBatchSize</a>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(batch_size &gt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334">kMaxFindBatchSize</a>)) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a01914ad44c1e130dd69580da3c04a195">kErrorCodeInvalidParameter</a>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// first, calculate hash values and prefetch</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> bucket_numbers[<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334">kMaxFindBatchSize</a>];</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">for</span> (uint16_t b = 0; b &lt; batch_size; ++b) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">if</span> (page_ids[b] == 0) {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b &gt; 0 &amp;&amp; page_ids[b - 1] == page_ids[b]) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    bucket_numbers[b] = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20">get_bucket_number</a>(page_ids[b]);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bucket_numbers[b] &lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#acea3236385a3b8d05ed1a60186e32ee8">get_logical_buckets</a>());</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// we prefetch up to 128 bytes (16 entries).</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <a class="code" href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83">assorted::prefetch_cachelines</a>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a> + bucket_numbers[b], 2);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">for</span> (uint16_t b = 0; b &lt; batch_size; ++b) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    out[b] = 0;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (page_ids[b] == 0) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b &gt; 0 &amp;&amp; page_ids[b - 1] == page_ids[b]) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      out[b] = out[b - 1];</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="namespacefoedus_1_1cache.html#a9e55979322d3cfceff78e1f77d901a82">PageIdTag</a> tag = <a class="code" href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6">HashFunc::get_tag</a>(page_ids[b]);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tag != 0);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> bucket_number = bucket_numbers[b];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; <a class="code" href="namespacefoedus_1_1cache.html#a56bdc23db45d170f73d6558b12ffab5a">kHopNeighbors</a>; ++i) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keyword">const</span> CacheBucket&amp; bucket = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[bucket_number + i];</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordflow">if</span> (bucket.get_tag() == tag) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment">// found (probably)!</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a>[bucket_number + i].<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa">increment</a>();</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        out[b] = bucket.get_content_id();</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">// Not found. let&#39;s check overflow list</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span> (out[b] == 0 &amp;&amp; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> i = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>; i != 0;) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].bucket_.get_tag() == tag) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">refcount_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa">increment</a>();</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;          out[b] = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">bucket_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d">get_content_id</a>();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        i = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a01914ad44c1e130dd69580da3c04a195"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a01914ad44c1e130dd69580da3c04a195">foedus::kErrorCodeInvalidParameter</a></div><div class="ttdoc">0x0002 : "GENERAL: Invalid parameter given" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00106">error_code.hpp:106</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_afc6c1d5e06ba80515bee790d0f240baf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">foedus::cache::CacheHashtable::overflow_buckets_</a></div><div class="ttdeci">CacheOverflowEntry * overflow_buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00350">cache_hashtable.hpp:350</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_abfca49eb29e5129b80bf087c7b9cfaa7"><div class="ttname"><a href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">foedus::cache::BucketId</a></div><div class="ttdeci">uint32_t BucketId</div><div class="ttdoc">Offset in hashtable bucket. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00049">cache_hashtable.hpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1HashFunc_html_a9470855bb66d98df48f82fc5ba6655c6"><div class="ttname"><a href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6">foedus::cache::HashFunc::get_tag</a></div><div class="ttdeci">static PageIdTag get_tag(storage::SnapshotPagePointer page_id) __attribute__((always_inline))</div><div class="ttdoc">Returns another hash value used to differentiate IDs with similar hash values. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00406">cache_hashtable.hpp:406</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a2d1f26fae41d62d8c2db91322b4f5466"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">foedus::cache::OverflowPointer</a></div><div class="ttdeci">uint32_t OverflowPointer</div><div class="ttdoc">Position in the overflow buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00072">cache_hashtable.hpp:72</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga14adcd2a780f37023df88933f17a5a83"><div class="ttname"><a href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83">foedus::assorted::prefetch_cachelines</a></div><div class="ttdeci">void prefetch_cachelines(const void *address, int cacheline_count)</div><div class="ttdoc">Prefetch multiple contiguous cachelines to L1 cache. </div><div class="ttdef"><b>Definition:</b> <a href="cacheline_8hpp_source.html#l00066">cacheline.hpp:66</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheRefCount_html_af555d7665e995d8e65f315c708d28daa"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa">foedus::cache::CacheRefCount::increment</a></div><div class="ttdeci">void increment() __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00166">cache_hashtable.hpp:166</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9eb2a178b8368240d82ccc787841f200a524de05ad7502c6d46ae15540d1e6334">foedus::cache::CacheHashtable::kMaxFindBatchSize</a></div><div class="ttdoc">Max size for find_batch() </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00237">cache_hashtable.hpp:237</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a9e55979322d3cfceff78e1f77d901a82"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a9e55979322d3cfceff78e1f77d901a82">foedus::cache::PageIdTag</a></div><div class="ttdeci">uint32_t PageIdTag</div><div class="ttdoc">This is a lossy-compressed representation of SnapshotPagePointer used to quickly identify whether the...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00067">cache_hashtable.hpp:67</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae71e9e3e6d08ece9f4a640d2d9dcea8b"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">foedus::cache::CacheHashtable::refcounts_</a></div><div class="ttdeci">CacheRefCount * refcounts_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00347">cache_hashtable.hpp:347</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a56bdc23db45d170f73d6558b12ffab5a"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a56bdc23db45d170f73d6558b12ffab5a">foedus::cache::kHopNeighbors</a></div><div class="ttdeci">const uint16_t kHopNeighbors</div><div class="ttdoc">Starting from the given position, we consider this many buckets for the entry. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00080">cache_hashtable.hpp:80</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheBucket_html_ab91d1b89c885979b7a6a4ef70b12b54d"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d">foedus::cache::CacheBucket::get_content_id</a></div><div class="ttdeci">ContentId get_content_id() const </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00147">cache_hashtable.hpp:147</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ac6b943d816bc16689f894a7b735bb861"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">foedus::cache::CacheOverflowEntry::refcount_</a></div><div class="ttdeci">CacheRefCount refcount_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00199">cache_hashtable.hpp:199</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_acea3236385a3b8d05ed1a60186e32ee8"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#acea3236385a3b8d05ed1a60186e32ee8">foedus::cache::CacheHashtable::get_logical_buckets</a></div><div class="ttdeci">BucketId get_logical_buckets() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00313">cache_hashtable.hpp:313</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a30b6a0b28cce30d50da7e0419c8cad20"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20">foedus::cache::CacheHashtable::get_bucket_number</a></div><div class="ttdeci">BucketId get_bucket_number(storage::SnapshotPagePointer page_id) const __attribute__((always_inline))</div><div class="ttdoc">Returns a bucket number the given page ID should belong to. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00319">cache_hashtable.hpp:319</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ae12719ddad39c1aaac04a294fe0dea3f"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">foedus::cache::CacheOverflowEntry::next_</a></div><div class="ttdeci">OverflowPointer next_</div><div class="ttdoc">Note that we don&#39;t have to atomically maintain/follow this pointer thanks to the loose requirements...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00198">cache_hashtable.hpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a483f0657f4ce6795f74d1c5984b28108"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">foedus::cache::CacheHashtable::overflow_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_buckets_head_</div><div class="ttdoc">This forms a singly-linked list of active overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00355">cache_hashtable.hpp:355</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a60ed7dceb59de97100cce445f5dbcd3a"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">foedus::cache::CacheOverflowEntry::bucket_</a></div><div class="ttdeci">CacheBucket bucket_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00192">cache_hashtable.hpp:192</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20" title="Returns a bucket number the given page ID should belong to. " alt="" coords="260,158,467,199"/>
<area shape="rect" id="node10" href="structfoedus_1_1cache_1_1CacheBucket.html#ab91d1b89c885979b7a6a4ef70b12b54d" title="foedus::cache::CacheBucket\l::get_content_id" alt="" coords="269,223,458,265"/>
<area shape="rect" id="node11" href="classfoedus_1_1cache_1_1CacheHashtable.html#acea3236385a3b8d05ed1a60186e32ee8" title="foedus::cache::CacheHashtable\l::get_logical_buckets" alt="" coords="260,289,467,330"/>
<area shape="rect" id="node12" href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6" title="Returns another hash value used to differentiate IDs with similar hash values. " alt="" coords="278,354,449,395"/>
<area shape="rect" id="node13" href="structfoedus_1_1cache_1_1CacheBucket.html#aad7099f48418a335a80260a664bf2f02" title="foedus::cache::CacheBucket\l::get_tag" alt="" coords="269,419,458,461"/>
<area shape="rect" id="node14" href="structfoedus_1_1cache_1_1CacheRefCount.html#af555d7665e995d8e65f315c708d28daa" title="foedus::cache::CacheRefCount\l::increment" alt="" coords="263,485,464,526"/>
<area shape="rect" id="node15" href="group__ASSORTED.html#ga14adcd2a780f37023df88933f17a5a83" title="Prefetch multiple contiguous cachelines to L1 cache. " alt="" coords="277,550,449,591"/>
<area shape="rect" id="node3" href="structfoedus_1_1cache_1_1HashFunc.html#a19737fa3c91676f9c85536f5928b7501" title="Returns a bucket number the given snapshot page ID should belong to. " alt="" coords="515,158,686,199"/>
<area shape="rect" id="node4" href="structfoedus_1_1cache_1_1HashFunc.html#aa9020cb1e5915b6777d089521ef618a9" title="Returns a hash value for the given snapshot page ID. " alt="" coords="738,93,909,134"/>
<area shape="rect" id="node8" href="structfoedus_1_1assorted_1_1ConstDiv.html#a6892a2d35b9ae08a00190c9440e22a21" title="32&#45;bit integer division that outputs both quotient and remainder. " alt="" coords="735,158,912,199"/>
<area shape="rect" id="node9" href="structfoedus_1_1assorted_1_1ConstDiv.html#afbfa08664902f9b633edbd395706b230" title="Calculate remainder. " alt="" coords="735,223,912,265"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="965,5,1155,61"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="966,85,1154,141"/>
<area shape="rect" id="node7" href="namespacefoedus_1_1storage.html#a3c3e7a984303d1ef88e001db1591b1be" title="foedus::storage::extract\l_local_page_id_from_snapshot\l_pointer" alt="" coords="960,165,1160,221"/>
<area shape="rect" id="node16" href="group__ASSORTED.html#ga354bfce84ebf918859d54ba97b8ddc36" title="Prefetch one cacheline to L1 cache. " alt="" coords="515,550,687,591"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a8e48716623ca44e83cc5ef871c10b131_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a98de2aa47bebca5add3e0550f2c602bf" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="260,45,444,101"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1Thread.html#a878c3aa228a6e8925e21a3b7b0592349" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="504,5,664,61"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a89fe2af2a31e70a89e143cbc2d687ffb" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="492,85,676,141"/>
<area shape="rect" id="node5" href="classfoedus_1_1thread_1_1Thread.html#abb36cf6186f747e38d98a13c6419e128" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="724,85,875,141"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac71ccdf1742ae0e9a7119cc92fcac092" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_read_batch" alt="" coords="923,85,1101,141"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a86a1e1fb54d44f15bc17c3f622f9f279" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read_batch" alt="" coords="1149,85,1335,141"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a617e3f91fe74f5215ae4f0081e30ab6d" title="foedus::storage::array\l::ArrayStoragePimpl::locate\l_record_for_read_batch" alt="" coords="1383,85,1565,141"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a23cc3a8049590a9c4be3177ab9b5661b" title="foedus::storage::array\l::ArrayStoragePimpl::get\l_record_primitive_batch" alt="" coords="1613,45,1779,101"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ae4373a9f195884ab885458e9c1a18ee7" title="foedus::storage::array\l::ArrayStoragePimpl::get\l_record_payload_batch" alt="" coords="1613,125,1779,181"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a7a0a99eb452ebc4ec0e2e86d520d315f" title="batched interface " alt="" coords="1827,45,2001,101"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a69f548ffc92c96cc52238068d781bbf8" title="foedus::storage::array\l::ArrayStorage::get_record\l_payload_batch" alt="" coords="1827,125,2001,181"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1fc7762ccff5d6a09d881ae258fae13d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structfoedus_1_1cache_1_1CacheBucket.html">CacheBucket</a>&amp; foedus::cache::CacheHashtable::get_bucket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a>&#160;</td>
          <td class="paramname"><em>bucket_id</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00326">326</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>References <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>.</p>
<div class="fragment"><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[bucket_id]; }</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a30b6a0b28cce30d50da7e0419c8cad20"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> foedus::cache::CacheHashtable::get_bucket_number </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a>&#160;</td>
          <td class="paramname"><em>page_id</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns a bucket number the given page ID <em>should</em> belong to. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00319">319</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>References <a class="el" href="cache__hashtable_8hpp_source.html#l00110">foedus::cache::HashFunc::get_bucket_number()</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00340">hash_func_</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8hpp_source.html#l00415">find()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00376">find_batch()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>.</p>
<div class="fragment"><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                                                                     {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">hash_func_</a>.<a class="code" href="structfoedus_1_1cache_1_1HashFunc.html#a19737fa3c91676f9c85536f5928b7501">get_bucket_number</a>(page_id);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div>
<div class="ttc" id="structfoedus_1_1cache_1_1HashFunc_html_a19737fa3c91676f9c85536f5928b7501"><div class="ttname"><a href="structfoedus_1_1cache_1_1HashFunc.html#a19737fa3c91676f9c85536f5928b7501">foedus::cache::HashFunc::get_bucket_number</a></div><div class="ttdeci">BucketId get_bucket_number(storage::SnapshotPagePointer page_id) const __attribute__((always_inline))</div><div class="ttdoc">Returns a bucket number the given snapshot page ID should belong to. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00110">cache_hashtable.hpp:110</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a445d065db71ba9b4bb0ef35c1bdcd097"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">foedus::cache::CacheHashtable::hash_func_</a></div><div class="ttdeci">const HashFunc hash_func_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00340">cache_hashtable.hpp:340</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1cache_1_1HashFunc.html#a19737fa3c91676f9c85536f5928b7501" title="Returns a bucket number the given snapshot page ID should belong to. " alt="" coords="260,158,431,199"/>
<area shape="rect" id="node3" href="structfoedus_1_1cache_1_1HashFunc.html#aa9020cb1e5915b6777d089521ef618a9" title="Returns a hash value for the given snapshot page ID. " alt="" coords="482,93,653,134"/>
<area shape="rect" id="node7" href="structfoedus_1_1assorted_1_1ConstDiv.html#a6892a2d35b9ae08a00190c9440e22a21" title="32&#45;bit integer division that outputs both quotient and remainder. " alt="" coords="479,158,656,199"/>
<area shape="rect" id="node8" href="structfoedus_1_1assorted_1_1ConstDiv.html#afbfa08664902f9b633edbd395706b230" title="Calculate remainder. " alt="" coords="479,223,656,265"/>
<area shape="rect" id="node4" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="709,5,899,61"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="710,85,898,141"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1storage.html#a3c3e7a984303d1ef88e001db1591b1be" title="foedus::storage::extract\l_local_page_id_from_snapshot\l_pointer" alt="" coords="704,165,904,221"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a30b6a0b28cce30d50da7e0419c8cad20_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac92d7a0c69e61cfdcacd72b9e8c7bd74" title="Returns an offset for the given page ID opportunistically. " alt="" coords="260,594,467,635"/>
<area shape="rect" id="node44" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e48716623ca44e83cc5ef871c10b131" title="Batched version of find(). " alt="" coords="260,725,467,766"/>
<area shape="rect" id="node50" href="classfoedus_1_1cache_1_1CacheHashtable.html#af7762689517cd7a18dd64d8591a3272a" title="Called when a cached page is not found. " alt="" coords="260,659,467,701"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a16c6375f66e9f177c908dc1fbc132681" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="515,594,724,635"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="1236,337,1445,378"/>
<area shape="rect" id="node25" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a4a95ef1bd710a66e0c24df998f881d04" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="772,623,956,665"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a9b77133f66157bca81a49caeca9a9904" title="A general method to follow (read) a page pointer. " alt="" coords="1004,613,1188,654"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#af22fe9e661763ca3225eeedf7fa62879" title="foedus::storage::array\l::ArrayStoragePimpl::prefetch\l_pages_recurse" alt="" coords="1493,264,1687,320"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f" title="for non&#45;root " alt="" coords="1745,402,1959,443"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02" title="subroutine to follow a pointer to head of bin from a volatile parent " alt="" coords="1501,395,1679,451"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105" title="Simpler version of locate_record for when we are in snapshot world. " alt="" coords="1499,100,1681,156"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#abe8cbf3d8edfb47a32d460029707aace" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_follow" alt="" coords="1503,184,1677,240"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#adbf75cfe4ac8c4c5e1e8a32342b66d00" title="defined in array_storage_prefetch.cpp " alt="" coords="1735,337,1969,378"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#af420e19da8ee4ed731ae387932cc991e" title="Prefetch data pages in this storage. " alt="" coords="2019,337,2221,378"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c" title="Find a pointer to the bin that contains records for the hash. " alt="" coords="2017,402,2223,443"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a222e0d485305f3253b0e1c97720dc0c8" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record" alt="" coords="2290,485,2454,541"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4eff8bc4e42a5973c8553830890d8a24" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record_part" alt="" coords="2290,5,2454,61"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#ac9c35890555ddb10d908b77602a1f28c" title="foedus::storage::hash\l::HashStoragePimpl::insert\l_record" alt="" coords="2283,85,2461,141"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a357386c8e5be667334520a33aff51725" title="foedus::storage::hash\l::HashStoragePimpl::delete\l_record" alt="" coords="2281,165,2463,221"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a49df48b50c0c645d3a047e8b153c4015" title="foedus::storage::hash\l::HashStoragePimpl::upsert\l_record" alt="" coords="2281,245,2463,301"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#add8aafbb32713dc6be20804da789f43d" title="foedus::storage::hash\l::HashStoragePimpl::overwrite\l_record" alt="" coords="2274,325,2470,381"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a233fcd7ffd24bd59d2d0943af3d0de03" title="foedus::storage::hash\l::HashStoragePimpl::increment\l_record" alt="" coords="2271,405,2473,461"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a86af9aa3326dd20ffdac2a1beffea0b4" title="Usually follows locate_bin to locate the exact physical record for the key, or create a new one if no..." alt="" coords="1761,97,1943,153"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aa8d098fb8e3b997b1dc52ede62b8acb6" title="locate_record()&#39;s physical_only version. " alt="" coords="2029,176,2211,232"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d" title="locate_record()&#39;s logical+physical version. " alt="" coords="2029,96,2211,152"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a4c4630d85af99ceafad404bc5c5c7eef" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_normalized\l_recurse" alt="" coords="1758,178,1946,249"/>
<area shape="rect" id="node24" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a99bb085d9e427fc36182b13bb20371e9" title="defined in masstree_storage_prefetch.cpp " alt="" coords="2026,256,2214,312"/>
<area shape="rect" id="node26" href="classfoedus_1_1thread_1_1Thread.html#a13d14670c512a2f2f85ff6519a28488c" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="1261,271,1420,313"/>
<area shape="rect" id="node41" href="classfoedus_1_1thread_1_1ThreadPimpl.html#aac3821c478965e40c60c819a7e5a83e5" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="1004,681,1188,737"/>
<area shape="rect" id="node28" href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6" title="A general method to follow (read) a page pointer. " alt="" coords="1265,613,1416,654"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ae0f40ca19aa9b9ac924542746e1b53c1" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointer" alt="" coords="1501,845,1679,901"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#abae9ebd099ebba507d98b8df782bd143" title="foedus::storage::array\l::ArrayStoragePimpl::get\l_root_page" alt="" coords="1507,765,1673,821"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538" title="Retrieves the root page of this storage. " alt="" coords="1508,925,1672,981"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#adc32aaf6f4537fcc1ada207e1d6902ec" title="Root&#45;node related, such as a method to retrieve 1st&#45;root, to grow, etc. " alt="" coords="1503,525,1677,581"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff31f521523d7a7b81ff5b750e081dac" title="Thread::follow_page_pointer() for masstree. " alt="" coords="1503,605,1677,661"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a7f9205c706c8be3ad4f0c030a285d884" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read" alt="" coords="1759,788,1945,844"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a10c44402ff1533f5fee533cc13119759" title="This version always returns a volatile page, installing a new one if needed. " alt="" coords="1759,868,1945,924"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a86a1e1fb54d44f15bc17c3f622f9f279" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read_batch" alt="" coords="1759,948,1945,1004"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a77af2675acbbf1c831925b3a2c972aa6" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_write_batch" alt="" coords="1759,628,1945,684"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac612c67d7e9e1a68dcccce98648cad0c" title="foedus::storage::array\l::ArrayStoragePimpl::verify\l_single_thread" alt="" coords="1764,708,1940,764"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeCursor.html#a226f6c437144cfb13f8e64baecb41d8a" title="foedus::storage::masstree\l::MasstreeCursor::open" alt="" coords="1765,562,1939,603"/>
<area shape="rect" id="node39" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#ad6c9eb02ad32cc1bffe9daac3521ad24" title="Returns the count of direct children in the first&#45;root node. " alt="" coords="1765,467,1939,538"/>
<area shape="rect" id="node42" href="classfoedus_1_1thread_1_1Thread.html#a2b375e7de4d6c9c7b222c45b271126dc" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="1265,684,1416,740"/>
<area shape="rect" id="node43" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ad0c8eb92d19915b679137e594bdfae31" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_write_batch" alt="" coords="1501,685,1679,741"/>
<area shape="rect" id="node45" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a98de2aa47bebca5add3e0550f2c602bf" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="527,717,711,773"/>
<area shape="rect" id="node46" href="classfoedus_1_1thread_1_1Thread.html#a878c3aa228a6e8925e21a3b7b0592349" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="784,717,944,773"/>
<area shape="rect" id="node47" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a89fe2af2a31e70a89e143cbc2d687ffb" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="772,913,956,969"/>
<area shape="rect" id="node48" href="classfoedus_1_1thread_1_1Thread.html#abb36cf6186f747e38d98a13c6419e128" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="1021,925,1171,981"/>
<area shape="rect" id="node49" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac71ccdf1742ae0e9a7119cc92fcac092" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_read_batch" alt="" coords="1251,969,1430,1025"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acea3236385a3b8d05ed1a60186e32ee8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> foedus::cache::CacheHashtable::get_logical_buckets </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00313">313</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>References <a class="el" href="cache__hashtable_8hpp_source.html#l00340">hash_func_</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00092">foedus::cache::HashFunc::logical_buckets_</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8hpp_source.html#l00415">find()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00376">find_batch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">hash_func_</a>.<a class="code" href="structfoedus_1_1cache_1_1HashFunc.html#a1b749296267e5825518d43799c987d5f">logical_buckets_</a>; }</div>
<div class="ttc" id="structfoedus_1_1cache_1_1HashFunc_html_a1b749296267e5825518d43799c987d5f"><div class="ttname"><a href="structfoedus_1_1cache_1_1HashFunc.html#a1b749296267e5825518d43799c987d5f">foedus::cache::HashFunc::logical_buckets_</a></div><div class="ttdeci">const BucketId logical_buckets_</div><div class="ttdoc">Number of logical (actually used) buckets in this table. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00092">cache_hashtable.hpp:92</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a445d065db71ba9b4bb0ef35c1bdcd097"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">foedus::cache::CacheHashtable::hash_func_</a></div><div class="ttdeci">const HashFunc hash_func_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00340">cache_hashtable.hpp:340</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_acea3236385a3b8d05ed1a60186e32ee8_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_acea3236385a3b8d05ed1a60186e32ee8_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_acea3236385a3b8d05ed1a60186e32ee8_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_acea3236385a3b8d05ed1a60186e32ee8_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac92d7a0c69e61cfdcacd72b9e8c7bd74" title="Returns an offset for the given page ID opportunistically. " alt="" coords="260,715,467,757"/>
<area shape="rect" id="node45" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e48716623ca44e83cc5ef871c10b131" title="Batched version of find(). " alt="" coords="260,782,467,823"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a16c6375f66e9f177c908dc1fbc132681" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="515,685,724,726"/>
<area shape="rect" id="node4" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="1236,727,1445,769"/>
<area shape="rect" id="node25" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a4a95ef1bd710a66e0c24df998f881d04" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="772,658,956,699"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a9b77133f66157bca81a49caeca9a9904" title="A general method to follow (read) a page pointer. " alt="" coords="1004,582,1188,623"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#af22fe9e661763ca3225eeedf7fa62879" title="foedus::storage::array\l::ArrayStoragePimpl::prefetch\l_pages_recurse" alt="" coords="1493,756,1687,812"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f" title="for non&#45;root " alt="" coords="1745,370,1959,411"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02" title="subroutine to follow a pointer to head of bin from a volatile parent " alt="" coords="1501,385,1679,441"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105" title="Simpler version of locate_record for when we are in snapshot world. " alt="" coords="1499,992,1681,1048"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#abe8cbf3d8edfb47a32d460029707aace" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_follow" alt="" coords="1503,905,1677,961"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#adbf75cfe4ac8c4c5e1e8a32342b66d00" title="defined in array_storage_prefetch.cpp " alt="" coords="1735,757,1969,798"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#af420e19da8ee4ed731ae387932cc991e" title="Prefetch data pages in this storage. " alt="" coords="2019,637,2221,678"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c" title="Find a pointer to the bin that contains records for the hash. " alt="" coords="2017,490,2223,531"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a222e0d485305f3253b0e1c97720dc0c8" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record" alt="" coords="2290,512,2454,568"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4eff8bc4e42a5973c8553830890d8a24" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record_part" alt="" coords="2290,592,2454,648"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#ac9c35890555ddb10d908b77602a1f28c" title="foedus::storage::hash\l::HashStoragePimpl::insert\l_record" alt="" coords="2283,672,2461,728"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a357386c8e5be667334520a33aff51725" title="foedus::storage::hash\l::HashStoragePimpl::delete\l_record" alt="" coords="2281,752,2463,808"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a49df48b50c0c645d3a047e8b153c4015" title="foedus::storage::hash\l::HashStoragePimpl::upsert\l_record" alt="" coords="2281,832,2463,888"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#add8aafbb32713dc6be20804da789f43d" title="foedus::storage::hash\l::HashStoragePimpl::overwrite\l_record" alt="" coords="2274,352,2470,408"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a233fcd7ffd24bd59d2d0943af3d0de03" title="foedus::storage::hash\l::HashStoragePimpl::increment\l_record" alt="" coords="2271,432,2473,488"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a86af9aa3326dd20ffdac2a1beffea0b4" title="Usually follows locate_bin to locate the exact physical record for the key, or create a new one if no..." alt="" coords="1761,999,1943,1055"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aa8d098fb8e3b997b1dc52ede62b8acb6" title="locate_record()&#39;s physical_only version. " alt="" coords="2029,999,2211,1055"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d" title="locate_record()&#39;s logical+physical version. " alt="" coords="2029,703,2211,759"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a4c4630d85af99ceafad404bc5c5c7eef" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_normalized\l_recurse" alt="" coords="1758,903,1946,974"/>
<area shape="rect" id="node24" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a99bb085d9e427fc36182b13bb20371e9" title="defined in masstree_storage_prefetch.cpp " alt="" coords="2026,556,2214,612"/>
<area shape="rect" id="node26" href="classfoedus_1_1thread_1_1Thread.html#a13d14670c512a2f2f85ff6519a28488c" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="1261,793,1420,834"/>
<area shape="rect" id="node42" href="classfoedus_1_1thread_1_1ThreadPimpl.html#aac3821c478965e40c60c819a7e5a83e5" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="1004,648,1188,704"/>
<area shape="rect" id="node28" href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6" title="A general method to follow (read) a page pointer. " alt="" coords="1265,361,1416,402"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ae0f40ca19aa9b9ac924542746e1b53c1" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointer" alt="" coords="1501,516,1679,572"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#abae9ebd099ebba507d98b8df782bd143" title="foedus::storage::array\l::ArrayStoragePimpl::get\l_root_page" alt="" coords="1507,596,1673,652"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538" title="Retrieves the root page of this storage. " alt="" coords="1508,255,1672,311"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#adc32aaf6f4537fcc1ada207e1d6902ec" title="Root&#45;node related, such as a method to retrieve 1st&#45;root, to grow, etc. " alt="" coords="1503,95,1677,151"/>
<area shape="rect" id="node41" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff31f521523d7a7b81ff5b750e081dac" title="Thread::follow_page_pointer() for masstree. " alt="" coords="1503,175,1677,231"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a7f9205c706c8be3ad4f0c030a285d884" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read" alt="" coords="1759,516,1945,572"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a10c44402ff1533f5fee533cc13119759" title="This version always returns a volatile page, installing a new one if needed. " alt="" coords="1759,436,1945,492"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a86a1e1fb54d44f15bc17c3f622f9f279" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read_batch" alt="" coords="1759,823,1945,879"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a77af2675acbbf1c831925b3a2c972aa6" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_write_batch" alt="" coords="1759,676,1945,732"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac612c67d7e9e1a68dcccce98648cad0c" title="foedus::storage::array\l::ArrayStoragePimpl::verify\l_single_thread" alt="" coords="1764,596,1940,652"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeCursor.html#a226f6c437144cfb13f8e64baecb41d8a" title="foedus::storage::masstree\l::MasstreeCursor::open" alt="" coords="1765,127,1939,169"/>
<area shape="rect" id="node39" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#ad6c9eb02ad32cc1bffe9daac3521ad24" title="Returns the count of direct children in the first&#45;root node. " alt="" coords="1765,33,1939,103"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a32332060560b864a857a839bb0adb4fd" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::fatify_first_root_double" alt="" coords="2033,40,2207,96"/>
<area shape="rect" id="node43" href="classfoedus_1_1thread_1_1Thread.html#a2b375e7de4d6c9c7b222c45b271126dc" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="1265,647,1416,703"/>
<area shape="rect" id="node44" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ad0c8eb92d19915b679137e594bdfae31" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_write_batch" alt="" coords="1501,676,1679,732"/>
<area shape="rect" id="node46" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a98de2aa47bebca5add3e0550f2c602bf" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="527,779,711,835"/>
<area shape="rect" id="node47" href="classfoedus_1_1thread_1_1Thread.html#a878c3aa228a6e8925e21a3b7b0592349" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="784,779,944,835"/>
<area shape="rect" id="node48" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a89fe2af2a31e70a89e143cbc2d687ffb" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="772,859,956,915"/>
<area shape="rect" id="node49" href="classfoedus_1_1thread_1_1Thread.html#abb36cf6186f747e38d98a13c6419e128" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="1021,859,1171,915"/>
<area shape="rect" id="node50" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac71ccdf1742ae0e9a7119cc92fcac092" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_read_batch" alt="" coords="1251,859,1430,915"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abd3c185877f109817850f92eab7ff4b3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> foedus::cache::CacheHashtable::get_physical_buckets </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00314">314</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>References <a class="el" href="cache__hashtable_8hpp_source.html#l00340">hash_func_</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00094">foedus::cache::HashFunc::physical_buckets_</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00171">evict()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00212">evict_main_loop()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00351">get_stat_single_thread()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00340">verify_single_thread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">hash_func_</a>.<a class="code" href="structfoedus_1_1cache_1_1HashFunc.html#ab1cfd4550ca00368b3be5b8b20cb7250">physical_buckets_</a>; }</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a445d065db71ba9b4bb0ef35c1bdcd097"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a445d065db71ba9b4bb0ef35c1bdcd097">foedus::cache::CacheHashtable::hash_func_</a></div><div class="ttdeci">const HashFunc hash_func_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00340">cache_hashtable.hpp:340</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1HashFunc_html_ab1cfd4550ca00368b3be5b8b20cb7250"><div class="ttname"><a href="structfoedus_1_1cache_1_1HashFunc.html#ab1cfd4550ca00368b3be5b8b20cb7250">foedus::cache::HashFunc::physical_buckets_</a></div><div class="ttdeci">const BucketId physical_buckets_</div><div class="ttdoc">Number of buckets that are physically allocated, at least kHopNeighbors more than logical...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00094">cache_hashtable.hpp:94</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_abd3c185877f109817850f92eab7ff4b3_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_abd3c185877f109817850f92eab7ff4b3_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_abd3c185877f109817850f92eab7ff4b3_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_abd3c185877f109817850f92eab7ff4b3_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#a8e9c6560b489d4709183256c6e6d332a" title="Evict some entries from the hashtable. " alt="" coords="515,5,721,47"/>
<area shape="rect" id="node7" href="classfoedus_1_1cache_1_1CacheHashtable.html#a090081806f98e5bb1184632b9fce6293" title="foedus::cache::CacheHashtable\l::evict_main_loop" alt="" coords="260,35,467,76"/>
<area shape="rect" id="node8" href="classfoedus_1_1cache_1_1CacheHashtable.html#ab4f979361eb029d81d1ad61d368d86be" title="only for debugging. " alt="" coords="260,100,467,141"/>
<area shape="rect" id="node9" href="classfoedus_1_1cache_1_1CacheHashtable.html#a222973805e7f70a5c6d1c28867454229" title="only for debugging. " alt="" coords="260,165,467,207"/>
<area shape="rect" id="node3" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a0b5e7574ed3474be65757a9f1d2595fc" title="Evicts pages up to about target_count (maybe a bit more or less). " alt="" coords="769,5,995,47"/>
<area shape="rect" id="node4" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#a5a0fd87ff73e0f43e5a901f1c4fa34e3" title="Main routine of cleaner_. " alt="" coords="1043,5,1241,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1cache_1_1CacheManagerPimpl.html#af04416fadb8ec5160408982fa67a08c1" title="foedus::cache::CacheManager\lPimpl::initialize_once" alt="" coords="1289,5,1488,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1cache_1_1CacheManager.html#a9181ec7d7e0ee1faa942ba9eec6c1345" title="foedus::cache::CacheManager\l::initialize_once" alt="" coords="1536,5,1735,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab4f979361eb029d81d1ad61d368d86be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__CACHE.html#structfoedus_1_1cache_1_1CacheHashtable_1_1Stat">CacheHashtable::Stat</a> foedus::cache::CacheHashtable::get_stat_single_thread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>only for debugging. </p>
<p>you can call this in a race, but the results are a bit inaccurate. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00351">351</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00314">get_physical_buckets()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00198">foedus::cache::CacheOverflowEntry::next_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00329">foedus::cache::CacheHashtable::Stat::normal_entries_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00350">overflow_buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00355">overflow_buckets_head_</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00330">foedus::cache::CacheHashtable::Stat::overflow_entries_</a>.</p>
<div class="fragment"><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                                                {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  Stat result;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  result.normal_entries_ = 0;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  result.overflow_entries_ = 0;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> end = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">get_physical_buckets</a>();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> i = 0; i &lt; end; ++i) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[i].is_content_set()) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      ++result.normal_entries_;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>) {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> i = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>; i != 0;) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].bucket_.is_content_set()) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        ++result.overflow_entries_;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      i = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[i].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_afc6c1d5e06ba80515bee790d0f240baf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">foedus::cache::CacheHashtable::overflow_buckets_</a></div><div class="ttdeci">CacheOverflowEntry * overflow_buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00350">cache_hashtable.hpp:350</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_abfca49eb29e5129b80bf087c7b9cfaa7"><div class="ttname"><a href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">foedus::cache::BucketId</a></div><div class="ttdeci">uint32_t BucketId</div><div class="ttdoc">Offset in hashtable bucket. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00049">cache_hashtable.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_abd3c185877f109817850f92eab7ff4b3"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">foedus::cache::CacheHashtable::get_physical_buckets</a></div><div class="ttdeci">BucketId get_physical_buckets() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00314">cache_hashtable.hpp:314</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a2d1f26fae41d62d8c2db91322b4f5466"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">foedus::cache::OverflowPointer</a></div><div class="ttdeci">uint32_t OverflowPointer</div><div class="ttdoc">Position in the overflow buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00072">cache_hashtable.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ae12719ddad39c1aaac04a294fe0dea3f"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">foedus::cache::CacheOverflowEntry::next_</a></div><div class="ttdeci">OverflowPointer next_</div><div class="ttdoc">Note that we don&#39;t have to atomically maintain/follow this pointer thanks to the loose requirements...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00198">cache_hashtable.hpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a483f0657f4ce6795f74d1c5984b28108"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">foedus::cache::CacheHashtable::overflow_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_buckets_head_</div><div class="ttdoc">This forms a singly-linked list of active overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00355">cache_hashtable.hpp:355</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_ab4f979361eb029d81d1ad61d368d86be_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_ab4f979361eb029d81d1ad61d368d86be_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_ab4f979361eb029d81d1ad61d368d86be_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_ab4f979361eb029d81d1ad61d368d86be_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3" title="foedus::cache::CacheHashtable\l::get_physical_buckets" alt="" coords="260,5,467,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af7762689517cd7a18dd64d8591a3272a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> foedus::cache::CacheHashtable::install </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">storage::SnapshotPagePointer</a>&#160;</td>
          <td class="paramname"><em>page_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefoedus_1_1cache.html#a90670494c3a525f4921b61d4e06ca369">ContentId</a>&#160;</td>
          <td class="paramname"><em>content</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when a cached page is not found. </p>
<dl class="section return"><dt>Returns</dt><dd>the only possible error code is kErrorCodeCacheTooManyOverflow, which is super-rare.</dd></dl>
<p>This method installs the new content to this hashtable. We are anyway doing at least 4kb memory copy in this case, so no need for serious optimization. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00114">114</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00192">foedus::cache::CacheOverflowEntry::bucket_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00164">foedus::cache::CacheRefCount::count_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00319">get_bucket_number()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00406">foedus::cache::HashFunc::get_tag()</a>, <a class="el" href="error__code_8hpp_source.html#l00194">foedus::kErrorCodeCacheTooManyOverflow</a>, <a class="el" href="error__code_8hpp_source.html#l00087">foedus::kErrorCodeOk</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00080">foedus::cache::kHopNeighbors</a>, <a class="el" href="atomic__fences_8hpp_source.html#l00058">foedus::assorted::memory_fence_release()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00198">foedus::cache::CacheOverflowEntry::next_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00350">overflow_buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00339">overflow_buckets_count_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00355">overflow_buckets_head_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00364">overflow_free_buckets_head_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00370">overflow_free_buckets_mutex_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00199">foedus::cache::CacheOverflowEntry::refcount_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00347">refcounts_</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00143">foedus::cache::CacheBucket::reset()</a>.</p>

<p>Referenced by <a class="el" href="thread__pimpl_8cpp_source.html#l00647">foedus::thread::ThreadPimpl::find_or_read_a_snapshot_page()</a>, and <a class="el" href="thread__pimpl_8cpp_source.html#l00687">foedus::thread::ThreadPimpl::find_or_read_snapshot_pages_batch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                                                                       {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(content != 0);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// Grab a bucket to install a new page.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// The bucket does not have to be the only bucket to serve the page, so</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// the logic below is much simpler than typical bufferpool.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> ideal_bucket = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20">get_bucket_number</a>(page_id);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#a9e55979322d3cfceff78e1f77d901a82">PageIdTag</a> tag = <a class="code" href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6">HashFunc::get_tag</a>(page_id);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(tag != 0);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  CacheBucket new_bucket;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  new_bucket.reset(content, tag);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// An opportunistic optimization. if the exact bucket already has the same page_id,</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// most likely someone else is trying to install it at the same time. let&#39;s wait.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> bucket = ideal_bucket; bucket &lt; ideal_bucket + <a class="code" href="namespacefoedus_1_1cache.html#a56bdc23db45d170f73d6558b12ffab5a">kHopNeighbors</a>; ++bucket) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[bucket].is_content_set()) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="comment">// looks like this is empty!</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[bucket] = new_bucket;  <span class="comment">// 8-byte implicitly-atomic write</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">refcounts_</a>[bucket].<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#a3733234e6687c556d47a94d28ffcef35">count_</a> = 1;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="comment">// this might be immediately overwritten by someone else, but that&#39;s fine.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">// that only causes a future cache miss. no correctness issue.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// unlucky, no empty slot. If this happens often, we are seriously troubled.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  DVLOG(0) &lt;&lt; <span class="stringliteral">&quot;Ohhh, we have to add this to overflow list! This should be really rare.&quot;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    &lt;&lt; <span class="stringliteral">&quot; page_id=&quot;</span> &lt;&lt; assorted::Hex(page_id)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, content=&quot;</span> &lt;&lt; assorted::Hex(content)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, ideal_bucket=&quot;</span> &lt;&lt; assorted::Hex(ideal_bucket)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, tag=&quot;</span> &lt;&lt; assorted::Hex(tag)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;, page_id=&quot;</span> &lt;&lt; assorted::Hex(page_id);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">// we come here anyway very occasionally, so taking mutex here wouldn&#39;t cause performance issue.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">// note that this mutex just protects the free-list, which is rarely used.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  soc::SharedMutexScope scope(&amp;<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#ac05195f8bd620a7ebe6d3321f97bb34e">overflow_free_buckets_mutex_</a>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> new_overflow_entry = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a84f35d72cd5d519f59142b41189f79c3">overflow_free_buckets_head_</a>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">if</span> (new_overflow_entry == 0) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Oh my god. we consumed all overflow entries, which means we have too many&quot;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; hash collisions. page_id=&quot;</span> &lt;&lt; assorted::Hex(page_id)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;, content=&quot;</span> &lt;&lt; assorted::Hex(content)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;, ideal_bucket=&quot;</span> &lt;&lt; assorted::Hex(ideal_bucket)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;, tag=&quot;</span> &lt;&lt; assorted::Hex(tag)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;, page_id=&quot;</span> &lt;&lt; assorted::Hex(page_id);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a454f5827b8ab78e51dc35d236480bc73">kErrorCodeCacheTooManyOverflow</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_overflow_entry &lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a43cecea26ba2304eb80c60307decfa54">overflow_buckets_count_</a>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a84f35d72cd5d519f59142b41189f79c3">overflow_free_buckets_head_</a> = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[new_overflow_entry].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[new_overflow_entry].<a class="code" href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">next_</a> = <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[new_overflow_entry].<a class="code" href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">refcount_</a>.<a class="code" href="structfoedus_1_1cache_1_1CacheRefCount.html#a3733234e6687c556d47a94d28ffcef35">count_</a> = 1;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">overflow_buckets_</a>[new_overflow_entry].<a class="code" href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">bucket_</a> = new_bucket;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <a class="code" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">assorted::memory_fence_release</a>();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">overflow_buckets_head_</a> = new_overflow_entry;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ac05195f8bd620a7ebe6d3321f97bb34e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ac05195f8bd620a7ebe6d3321f97bb34e">foedus::cache::CacheHashtable::overflow_free_buckets_mutex_</a></div><div class="ttdeci">soc::SharedMutex overflow_free_buckets_mutex_</div><div class="ttdoc">The mutex to protect free overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00370">cache_hashtable.hpp:370</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_afc6c1d5e06ba80515bee790d0f240baf"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#afc6c1d5e06ba80515bee790d0f240baf">foedus::cache::CacheHashtable::overflow_buckets_</a></div><div class="ttdeci">CacheOverflowEntry * overflow_buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00350">cache_hashtable.hpp:350</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_abfca49eb29e5129b80bf087c7b9cfaa7"><div class="ttname"><a href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">foedus::cache::BucketId</a></div><div class="ttdeci">uint32_t BucketId</div><div class="ttdoc">Offset in hashtable bucket. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00049">cache_hashtable.hpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1HashFunc_html_a9470855bb66d98df48f82fc5ba6655c6"><div class="ttname"><a href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6">foedus::cache::HashFunc::get_tag</a></div><div class="ttdeci">static PageIdTag get_tag(storage::SnapshotPagePointer page_id) __attribute__((always_inline))</div><div class="ttdoc">Returns another hash value used to differentiate IDs with similar hash values. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00406">cache_hashtable.hpp:406</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a2d1f26fae41d62d8c2db91322b4f5466"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">foedus::cache::OverflowPointer</a></div><div class="ttdeci">uint32_t OverflowPointer</div><div class="ttdoc">Position in the overflow buckets. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00072">cache_hashtable.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a84f35d72cd5d519f59142b41189f79c3"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a84f35d72cd5d519f59142b41189f79c3">foedus::cache::CacheHashtable::overflow_free_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_free_buckets_head_</div><div class="ttdoc">This forms another singly-linked list of free overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00364">cache_hashtable.hpp:364</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a9e55979322d3cfceff78e1f77d901a82"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a9e55979322d3cfceff78e1f77d901a82">foedus::cache::PageIdTag</a></div><div class="ttdeci">uint32_t PageIdTag</div><div class="ttdoc">This is a lossy-compressed representation of SnapshotPagePointer used to quickly identify whether the...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00067">cache_hashtable.hpp:67</a></div></div>
<div class="ttc" id="structfoedus_1_1cache_1_1CacheRefCount_html_a3733234e6687c556d47a94d28ffcef35"><div class="ttname"><a href="structfoedus_1_1cache_1_1CacheRefCount.html#a3733234e6687c556d47a94d28ffcef35">foedus::cache::CacheRefCount::count_</a></div><div class="ttdeci">uint16_t count_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00164">cache_hashtable.hpp:164</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a43cecea26ba2304eb80c60307decfa54"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a43cecea26ba2304eb80c60307decfa54">foedus::cache::CacheHashtable::overflow_buckets_count_</a></div><div class="ttdeci">const uint32_t overflow_buckets_count_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00339">cache_hashtable.hpp:339</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_ae71e9e3e6d08ece9f4a640d2d9dcea8b"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#ae71e9e3e6d08ece9f4a640d2d9dcea8b">foedus::cache::CacheHashtable::refcounts_</a></div><div class="ttdeci">CacheRefCount * refcounts_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00347">cache_hashtable.hpp:347</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a56bdc23db45d170f73d6558b12ffab5a"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a56bdc23db45d170f73d6558b12ffab5a">foedus::cache::kHopNeighbors</a></div><div class="ttdeci">const uint16_t kHopNeighbors</div><div class="ttdoc">Starting from the given position, we consider this many buckets for the entry. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00080">cache_hashtable.hpp:80</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ac6b943d816bc16689f894a7b735bb861"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ac6b943d816bc16689f894a7b735bb861">foedus::cache::CacheOverflowEntry::refcount_</a></div><div class="ttdeci">CacheRefCount refcount_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00199">cache_hashtable.hpp:199</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a30b6a0b28cce30d50da7e0419c8cad20"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20">foedus::cache::CacheHashtable::get_bucket_number</a></div><div class="ttdeci">BucketId get_bucket_number(storage::SnapshotPagePointer page_id) const __attribute__((always_inline))</div><div class="ttdoc">Returns a bucket number the given page ID should belong to. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00319">cache_hashtable.hpp:319</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gafc1110de4c6bb85c7e1f7feccc27f6d7"><div class="ttname"><a href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7">foedus::assorted::memory_fence_release</a></div><div class="ttdeci">void memory_fence_release()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_release). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00058">atomic_fences.hpp:58</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_ae12719ddad39c1aaac04a294fe0dea3f"><div class="ttname"><a href="namespacefoedus_1_1cache.html#ae12719ddad39c1aaac04a294fe0dea3f">foedus::cache::CacheOverflowEntry::next_</a></div><div class="ttdeci">OverflowPointer next_</div><div class="ttdoc">Note that we don&#39;t have to atomically maintain/follow this pointer thanks to the loose requirements...</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00198">cache_hashtable.hpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a483f0657f4ce6795f74d1c5984b28108"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a483f0657f4ce6795f74d1c5984b28108">foedus::cache::CacheHashtable::overflow_buckets_head_</a></div><div class="ttdeci">OverflowPointer overflow_buckets_head_</div><div class="ttdoc">This forms a singly-linked list of active overflow entries. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00355">cache_hashtable.hpp:355</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a454f5827b8ab78e51dc35d236480bc73"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a454f5827b8ab78e51dc35d236480bc73">foedus::kErrorCodeCacheTooManyOverflow</a></div><div class="ttdoc">0x0903 : "SPCACHE: Hashtable for snapshot cache got too many overflow entries" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00194">error_code.hpp:194</a></div></div>
<div class="ttc" id="namespacefoedus_1_1cache_html_a60ed7dceb59de97100cce445f5dbcd3a"><div class="ttname"><a href="namespacefoedus_1_1cache.html#a60ed7dceb59de97100cce445f5dbcd3a">foedus::cache::CacheOverflowEntry::bucket_</a></div><div class="ttdeci">CacheBucket bucket_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00192">cache_hashtable.hpp:192</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#a30b6a0b28cce30d50da7e0419c8cad20" title="Returns a bucket number the given page ID should belong to. " alt="" coords="260,158,467,199"/>
<area shape="rect" id="node10" href="structfoedus_1_1cache_1_1HashFunc.html#a9470855bb66d98df48f82fc5ba6655c6" title="Returns another hash value used to differentiate IDs with similar hash values. " alt="" coords="278,223,449,265"/>
<area shape="rect" id="node11" href="group__ASSORTED.html#gafc1110de4c6bb85c7e1f7feccc27f6d7" title="Equivalent to std::atomic_thread_fence(std::memory_order_release). " alt="" coords="277,289,450,330"/>
<area shape="rect" id="node12" href="structfoedus_1_1cache_1_1CacheBucket.html#aaa52396996e73a08cace2a2dcef82ffb" title="foedus::cache::CacheBucket\l::reset" alt="" coords="269,354,458,395"/>
<area shape="rect" id="node3" href="structfoedus_1_1cache_1_1HashFunc.html#a19737fa3c91676f9c85536f5928b7501" title="Returns a bucket number the given snapshot page ID should belong to. " alt="" coords="515,158,685,199"/>
<area shape="rect" id="node4" href="structfoedus_1_1cache_1_1HashFunc.html#aa9020cb1e5915b6777d089521ef618a9" title="Returns a hash value for the given snapshot page ID. " alt="" coords="737,93,907,134"/>
<area shape="rect" id="node8" href="structfoedus_1_1assorted_1_1ConstDiv.html#a6892a2d35b9ae08a00190c9440e22a21" title="32&#45;bit integer division that outputs both quotient and remainder. " alt="" coords="733,158,911,199"/>
<area shape="rect" id="node9" href="structfoedus_1_1assorted_1_1ConstDiv.html#afbfa08664902f9b633edbd395706b230" title="Calculate remainder. " alt="" coords="733,223,911,265"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="963,5,1154,61"/>
<area shape="rect" id="node6" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="965,85,1153,141"/>
<area shape="rect" id="node7" href="namespacefoedus_1_1storage.html#a3c3e7a984303d1ef88e001db1591b1be" title="foedus::storage::extract\l_local_page_id_from_snapshot\l_pointer" alt="" coords="959,165,1159,221"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_icgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_icgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_icgraph" id="classfoedus_1_1cache_1_1CacheHashtable_af7762689517cd7a18dd64d8591a3272a_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a16c6375f66e9f177c908dc1fbc132681" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="260,587,469,629"/>
<area shape="rect" id="node46" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a98de2aa47bebca5add3e0550f2c602bf" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="273,679,457,735"/>
<area shape="rect" id="node3" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487" title="Find the given page in snapshot cache, reading it if not found. " alt="" coords="981,346,1191,387"/>
<area shape="rect" id="node24" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a4a95ef1bd710a66e0c24df998f881d04" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="517,539,701,581"/>
<area shape="rect" id="node26" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a9b77133f66157bca81a49caeca9a9904" title="A general method to follow (read) a page pointer. " alt="" coords="749,611,933,653"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#af22fe9e661763ca3225eeedf7fa62879" title="foedus::storage::array\l::ArrayStoragePimpl::prefetch\l_pages_recurse" alt="" coords="1239,451,1432,507"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f" title="for non&#45;root " alt="" coords="1491,370,1704,411"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02" title="subroutine to follow a pointer to head of bin from a volatile parent " alt="" coords="1246,371,1425,427"/>
<area shape="rect" id="node17" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105" title="Simpler version of locate_record for when we are in snapshot world. " alt="" coords="1245,157,1426,213"/>
<area shape="rect" id="node21" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#abe8cbf3d8edfb47a32d460029707aace" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_follow" alt="" coords="1249,240,1422,296"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#adbf75cfe4ac8c4c5e1e8a32342b66d00" title="defined in array_storage_prefetch.cpp " alt="" coords="1480,435,1715,477"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#af420e19da8ee4ed731ae387932cc991e" title="Prefetch data pages in this storage. " alt="" coords="1764,435,1967,477"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c" title="Find a pointer to the bin that contains records for the hash. " alt="" coords="1763,370,1968,411"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a222e0d485305f3253b0e1c97720dc0c8" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record" alt="" coords="2035,85,2199,141"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4eff8bc4e42a5973c8553830890d8a24" title="foedus::storage::hash\l::HashStoragePimpl::get\l_record_part" alt="" coords="2035,165,2199,221"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#ac9c35890555ddb10d908b77602a1f28c" title="foedus::storage::hash\l::HashStoragePimpl::insert\l_record" alt="" coords="2028,245,2207,301"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a357386c8e5be667334520a33aff51725" title="foedus::storage::hash\l::HashStoragePimpl::delete\l_record" alt="" coords="2027,325,2208,381"/>
<area shape="rect" id="node13" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a49df48b50c0c645d3a047e8b153c4015" title="foedus::storage::hash\l::HashStoragePimpl::upsert\l_record" alt="" coords="2026,405,2209,461"/>
<area shape="rect" id="node14" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#add8aafbb32713dc6be20804da789f43d" title="foedus::storage::hash\l::HashStoragePimpl::overwrite\l_record" alt="" coords="2019,485,2215,541"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a233fcd7ffd24bd59d2d0943af3d0de03" title="foedus::storage::hash\l::HashStoragePimpl::increment\l_record" alt="" coords="2016,5,2219,61"/>
<area shape="rect" id="node18" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a86af9aa3326dd20ffdac2a1beffea0b4" title="Usually follows locate_bin to locate the exact physical record for the key, or create a new one if no..." alt="" coords="1507,156,1688,212"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aa8d098fb8e3b997b1dc52ede62b8acb6" title="locate_record()&#39;s physical_only version. " alt="" coords="1775,209,1956,265"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d" title="locate_record()&#39;s logical+physical version. " alt="" coords="1775,129,1956,185"/>
<area shape="rect" id="node22" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a4c4630d85af99ceafad404bc5c5c7eef" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::prefetch_pages_normalized\l_recurse" alt="" coords="1503,237,1691,307"/>
<area shape="rect" id="node23" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a99bb085d9e427fc36182b13bb20371e9" title="defined in masstree_storage_prefetch.cpp " alt="" coords="1771,289,1959,345"/>
<area shape="rect" id="node25" href="classfoedus_1_1thread_1_1Thread.html#a13d14670c512a2f2f85ff6519a28488c" title="Installs a volatile page to the given dual pointer as a copy of the snapshot page. " alt="" coords="1007,458,1165,499"/>
<area shape="rect" id="node43" href="classfoedus_1_1thread_1_1ThreadPimpl.html#aac3821c478965e40c60c819a7e5a83e5" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="749,531,933,587"/>
<area shape="rect" id="node27" href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6" title="A general method to follow (read) a page pointer. " alt="" coords="1011,709,1161,750"/>
<area shape="rect" id="node28" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ae0f40ca19aa9b9ac924542746e1b53c1" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointer" alt="" coords="1246,741,1425,797"/>
<area shape="rect" id="node31" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#abae9ebd099ebba507d98b8df782bd143" title="foedus::storage::array\l::ArrayStoragePimpl::get\l_root_page" alt="" coords="1253,661,1418,717"/>
<area shape="rect" id="node35" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538" title="Retrieves the root page of this storage. " alt="" coords="1253,884,1417,940"/>
<area shape="rect" id="node36" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#adc32aaf6f4537fcc1ada207e1d6902ec" title="Root&#45;node related, such as a method to retrieve 1st&#45;root, to grow, etc. " alt="" coords="1249,1099,1422,1155"/>
<area shape="rect" id="node42" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#aff31f521523d7a7b81ff5b750e081dac" title="Thread::follow_page_pointer() for masstree. " alt="" coords="1249,1269,1422,1325"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a7f9205c706c8be3ad4f0c030a285d884" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read" alt="" coords="1505,741,1690,797"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a10c44402ff1533f5fee533cc13119759" title="This version always returns a volatile page, installing a new one if needed. " alt="" coords="1505,661,1690,717"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a86a1e1fb54d44f15bc17c3f622f9f279" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_read_batch" alt="" coords="1505,821,1690,877"/>
<area shape="rect" id="node33" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#a77af2675acbbf1c831925b3a2c972aa6" title="foedus::storage::array\l::ArrayStoragePimpl::lookup\l_for_write_batch" alt="" coords="1505,501,1690,557"/>
<area shape="rect" id="node34" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac612c67d7e9e1a68dcccce98648cad0c" title="foedus::storage::array\l::ArrayStoragePimpl::verify\l_single_thread" alt="" coords="1509,581,1685,637"/>
<area shape="rect" id="node37" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeCursor.html#a226f6c437144cfb13f8e64baecb41d8a" title="foedus::storage::masstree\l::MasstreeCursor::open" alt="" coords="1511,1259,1684,1301"/>
<area shape="rect" id="node38" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#ad6c9eb02ad32cc1bffe9daac3521ad24" title="Returns the count of direct children in the first&#45;root node. " alt="" coords="1511,1003,1684,1074"/>
<area shape="rect" id="node39" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a32332060560b864a857a839bb0adb4fd" title="foedus::storage::masstree\l::MasstreeStoragePimpl\l::fatify_first_root_double" alt="" coords="1779,1311,1952,1367"/>
<area shape="rect" id="node40" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a91dac48625f8f7d2906fcfba5908cbc1" title="Identifies page and record for the key. " alt="" coords="1511,1099,1684,1155"/>
<area shape="rect" id="node41" href="classfoedus_1_1storage_1_1masstree_1_1MasstreeStoragePimpl.html#a0ce23624d660da08cb1ee04ac2297171" title="Identifies page and record for the normalized key. " alt="" coords="1508,1179,1687,1235"/>
<area shape="rect" id="node44" href="classfoedus_1_1thread_1_1Thread.html#a2b375e7de4d6c9c7b222c45b271126dc" title="Batched version of follow_page_pointer with will_modify==true and tolerate_null_pointer==true. " alt="" coords="1011,531,1161,587"/>
<area shape="rect" id="node45" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ad0c8eb92d19915b679137e594bdfae31" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_write_batch" alt="" coords="1246,531,1425,587"/>
<area shape="rect" id="node47" href="classfoedus_1_1thread_1_1Thread.html#a878c3aa228a6e8925e21a3b7b0592349" title="Batched version of find_or_read_a_snapshot_page(). " alt="" coords="529,679,689,735"/>
<area shape="rect" id="node48" href="classfoedus_1_1thread_1_1ThreadPimpl.html#a89fe2af2a31e70a89e143cbc2d687ffb" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="517,801,701,857"/>
<area shape="rect" id="node49" href="classfoedus_1_1thread_1_1Thread.html#abb36cf6186f747e38d98a13c6419e128" title="Batched version of follow_page_pointer with will_modify==false. " alt="" coords="766,803,917,859"/>
<area shape="rect" id="node50" href="classfoedus_1_1storage_1_1array_1_1ArrayStoragePimpl.html#ac71ccdf1742ae0e9a7119cc92fcac092" title="foedus::storage::array\l::ArrayStoragePimpl::follow\l_pointers_for_read_batch" alt="" coords="997,813,1175,869"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a222973805e7f70a5c6d1c28867454229"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::cache::CacheHashtable::verify_single_thread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>only for debugging. </p>
<p>don't call this in a race </p>

<p>Definition at line <a class="el" href="cache__hashtable_8cpp_source.html#l00340">340</a> of file <a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00346">buckets_</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00314">get_physical_buckets()</a>, and <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>.</p>
<div class="fragment"><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                                      {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> i = 0; i &lt; <a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">get_physical_buckets</a>(); ++i) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[i].is_content_set()) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[i].get_tag() != 0);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">buckets_</a>[i].get_tag() == 0);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div>
<div class="ttc" id="namespacefoedus_1_1cache_html_abfca49eb29e5129b80bf087c7b9cfaa7"><div class="ttname"><a href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">foedus::cache::BucketId</a></div><div class="ttdeci">uint32_t BucketId</div><div class="ttdoc">Offset in hashtable bucket. </div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00049">cache_hashtable.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_abd3c185877f109817850f92eab7ff4b3"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3">foedus::cache::CacheHashtable::get_physical_buckets</a></div><div class="ttdeci">BucketId get_physical_buckets() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00314">cache_hashtable.hpp:314</a></div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1CacheHashtable_html_a9a27ca6cf18b0313816d7982d2c0667e"><div class="ttname"><a href="classfoedus_1_1cache_1_1CacheHashtable.html#a9a27ca6cf18b0313816d7982d2c0667e">foedus::cache::CacheHashtable::buckets_</a></div><div class="ttdeci">CacheBucket * buckets_</div><div class="ttdef"><b>Definition:</b> <a href="cache__hashtable_8hpp_source.html#l00346">cache_hashtable.hpp:346</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1cache_1_1CacheHashtable_a222973805e7f70a5c6d1c28867454229_cgraph.png" border="0" usemap="#classfoedus_1_1cache_1_1CacheHashtable_a222973805e7f70a5c6d1c28867454229_cgraph" alt=""/></div>
<map name="classfoedus_1_1cache_1_1CacheHashtable_a222973805e7f70a5c6d1c28867454229_cgraph" id="classfoedus_1_1cache_1_1CacheHashtable_a222973805e7f70a5c6d1c28867454229_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1cache_1_1CacheHashtable.html#abd3c185877f109817850f92eab7ff4b3" title="foedus::cache::CacheHashtable\l::get_physical_buckets" alt="" coords="260,5,467,47"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a class="anchor" id="aac3194f117eb41ce165f1fe06a17f1e4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html">CacheHashtable</a> &amp;&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a9a27ca6cf18b0313816d7982d2c0667e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfoedus_1_1cache_1_1CacheBucket.html">CacheBucket</a>* foedus::cache::CacheHashtable::buckets_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00346">346</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00212">evict_main_loop()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00415">find()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00376">find_batch()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00326">get_bucket()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00351">get_stat_single_thread()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00340">verify_single_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="aa1b4ed7d210e4a1f7be234fc52a22ab6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html">memory::AlignedMemory</a> foedus::cache::CacheHashtable::buckets_memory_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00341">341</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>.</p>

</div>
</div>
<a class="anchor" id="a727376cbbde951edc3535a7ff6e46b68"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#abfca49eb29e5129b80bf087c7b9cfaa7">BucketId</a> foedus::cache::CacheHashtable::clockhand_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>We previously stopped eviction here for usual buckets. </p>
<p>We will resume from this number +1 next time. We will then sequetnially check. The overflow list is fully checked after each wrap-around of this clockhand, so we don't have a dedicated clock hand for overflow list. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00378">378</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00171">evict()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00212">evict_main_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="a445d065db71ba9b4bb0ef35c1bdcd097"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structfoedus_1_1cache_1_1HashFunc.html">HashFunc</a> foedus::cache::CacheHashtable::hash_func_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00340">340</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8hpp_source.html#l00319">get_bucket_number()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00313">get_logical_buckets()</a>, and <a class="el" href="cache__hashtable_8hpp_source.html#l00314">get_physical_buckets()</a>.</p>

</div>
</div>
<a class="anchor" id="ae86a50505266a7691692e0b6297eeebf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const uint16_t foedus::cache::CacheHashtable::numa_node_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00338">338</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00171">evict()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00212">evict_main_loop()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00277">evict_overflow_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="afc6c1d5e06ba80515bee790d0f240baf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#structfoedus_1_1cache_1_1CacheOverflowEntry">CacheOverflowEntry</a>* foedus::cache::CacheHashtable::overflow_buckets_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00350">350</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00277">evict_overflow_loop()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00415">find()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00376">find_batch()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00351">get_stat_single_thread()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>.</p>

</div>
</div>
<a class="anchor" id="a43cecea26ba2304eb80c60307decfa54"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const uint32_t foedus::cache::CacheHashtable::overflow_buckets_count_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00339">339</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>.</p>

</div>
</div>
<a class="anchor" id="a483f0657f4ce6795f74d1c5984b28108"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> foedus::cache::CacheHashtable::overflow_buckets_head_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This forms a singly-linked list of active overflow entries. </p>
<p>This is initially 0 (null), and usually remains 0. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00355">355</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00171">evict()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00277">evict_overflow_loop()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00415">find()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00376">find_batch()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00351">get_stat_single_thread()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>.</p>

</div>
</div>
<a class="anchor" id="a0bac6a88e7e0f33f88170e7014e597e0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html">memory::AlignedMemory</a> foedus::cache::CacheHashtable::overflow_buckets_memory_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00343">343</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>.</p>

</div>
</div>
<a class="anchor" id="a84f35d72cd5d519f59142b41189f79c3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefoedus_1_1cache.html#a2d1f26fae41d62d8c2db91322b4f5466">OverflowPointer</a> foedus::cache::CacheHashtable::overflow_free_buckets_head_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This forms another singly-linked list of free overflow entries. </p>
<p>A new entry is consumed from the head (by transactions). A returned entry is added back to the head (by cleaner). This overflow free-list is the only data structure we access with atomic operation/mutex. As a new entry is added to overflow list very occasionally, this should be fine. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00364">364</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>.</p>

</div>
</div>
<a class="anchor" id="ac05195f8bd620a7ebe6d3321f97bb34e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1soc_1_1SharedMutex.html">soc::SharedMutex</a> foedus::cache::CacheHashtable::overflow_free_buckets_mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The mutex to protect free overflow entries. </p>
<p>Actually this is not a shared mutex, but we reuse the class to reduce code. </p>

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00370">370</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00277">evict_overflow_loop()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>.</p>

</div>
</div>
<a class="anchor" id="ae71e9e3e6d08ece9f4a640d2d9dcea8b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfoedus_1_1cache_1_1CacheRefCount.html">CacheRefCount</a>* foedus::cache::CacheHashtable::refcounts_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00347">347</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00212">evict_main_loop()</a>, <a class="el" href="cache__hashtable_8hpp_source.html#l00415">find()</a>, <a class="el" href="cache__hashtable_8cpp_source.html#l00376">find_batch()</a>, and <a class="el" href="cache__hashtable_8cpp_source.html#l00114">install()</a>.</p>

</div>
</div>
<a class="anchor" id="add385b7b32261364ee132909c69bf924"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1memory_1_1AlignedMemory.html">memory::AlignedMemory</a> foedus::cache::CacheHashtable::refcounts_memory_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cache__hashtable_8hpp_source.html#l00342">342</a> of file <a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a>.</p>

<p>Referenced by <a class="el" href="cache__hashtable_8cpp_source.html#l00066">CacheHashtable()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/cache/<a class="el" href="cache__hashtable_8hpp_source.html">cache_hashtable.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/cache/<a class="el" href="cache__hashtable_8cpp_source.html">cache_hashtable.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1cache.html">cache</a></li><li class="navelem"><a class="el" href="classfoedus_1_1cache_1_1CacheHashtable.html">CacheHashtable</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
