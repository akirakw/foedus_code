<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: foedus::storage::array::ArrayComposer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfoedus_1_1storage_1_1array_1_1ArrayComposer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfoedus_1_1storage_1_1array_1_1ArrayComposer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">foedus::storage::array::ArrayComposer Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a> &raquo; <a class="el" href="group__STORAGE.html">Storage Manager</a> &raquo; <a class="el" href="group__ARRAY.html">Array Storage</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classfoedus_1_1storage_1_1Composer.html" title="Represents a logic to compose a new version of data pages for one storage. ">Composer</a> for an array storage.  
 <a href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classfoedus_1_1storage_1_1Composer.html" title="Represents a logic to compose a new version of data pages for one storage. ">Composer</a> for an array storage. </p>
<dl class="section note"><dt>Note</dt><dd>This is a private implementation-details of <a class="el" href="group__ARRAY.html">Array Storage</a>, thus file name ends with _impl. Do not include this header from a client program. There is no case client program needs to access this internal class. </dd></dl>

<p>Definition at line <a class="el" href="array__composer__impl_8hpp_source.html#l00051">51</a> of file <a class="el" href="array__composer__impl_8hpp_source.html">array_composer_impl.hpp</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="array__composer__impl_8hpp_source.html">array_composer_impl.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab3ab6f2223dfb1165a58722c0a4df705"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ab3ab6f2223dfb1165a58722c0a4df705">ArrayComposer</a> (<a class="el" href="classfoedus_1_1storage_1_1Composer.html">Composer</a> *parent)</td></tr>
<tr class="memdesc:ab3ab6f2223dfb1165a58722c0a4df705"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html" title="Composer for an array storage. ">ArrayComposer</a> methods.  <a href="#ab3ab6f2223dfb1165a58722c0a4df705">More...</a><br /></td></tr>
<tr class="separator:ab3ab6f2223dfb1165a58722c0a4df705"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9bd9d37f8a9c300dd188c5a23b938cd"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ae9bd9d37f8a9c300dd188c5a23b938cd">to_string</a> () const </td></tr>
<tr class="separator:ae9bd9d37f8a9c300dd188c5a23b938cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab768c873a7e2b4a9ce2b4b1df39676ff"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ab768c873a7e2b4a9ce2b4b1df39676ff">compose</a> (const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">Composer::ComposeArguments</a> &amp;args)</td></tr>
<tr class="separator:ab768c873a7e2b4a9ce2b4b1df39676ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c812e46a7502abe6f506ecda0edf9ab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#a2c812e46a7502abe6f506ecda0edf9ab">construct_root</a> (const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments">Composer::ConstructRootArguments</a> &amp;args)</td></tr>
<tr class="separator:a2c812e46a7502abe6f506ecda0edf9ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abea76692cff38e66aa4328401422488a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html">Composer::DropResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#abea76692cff38e66aa4328401422488a">drop_volatiles</a> (const <a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html">Composer::DropVolatilesArguments</a> &amp;args)</td></tr>
<tr class="memdesc:abea76692cff38e66aa4328401422488a"><td class="mdescLeft">&#160;</td><td class="mdescRight">drop_volatiles and related methods  <a href="#abea76692cff38e66aa4328401422488a">More...</a><br /></td></tr>
<tr class="separator:abea76692cff38e66aa4328401422488a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ee9788f623a51584b4fd7f8ded6103a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#a9ee9788f623a51584b4fd7f8ded6103a">drop_root_volatile</a> (const <a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html">Composer::DropVolatilesArguments</a> &amp;args)</td></tr>
<tr class="separator:a9ee9788f623a51584b4fd7f8ded6103a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ab3ab6f2223dfb1165a58722c0a4df705"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">foedus::storage::array::ArrayComposer::ArrayComposer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfoedus_1_1storage_1_1Composer.html">Composer</a> *&#160;</td>
          <td class="paramname"><em>parent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html" title="Composer for an array storage. ">ArrayComposer</a> methods. </p>

<p>Definition at line <a class="el" href="array__composer__impl_8cpp_source.html#l00059">59</a> of file <a class="el" href="array__composer__impl_8cpp_source.html">array_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, and <a class="el" href="storage_8hpp_source.html#l00169">foedus::storage::Storage&lt; CONTROL_BLOCK &gt;::exists()</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  : engine_(parent-&gt;get_engine()),</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    storage_id_(parent-&gt;get_storage_id()),</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    storage_(engine_, storage_id_) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(storage_.<a class="code" href="classfoedus_1_1storage_1_1Storage.html#ade24602975f3928e77762f8cb4da51ca">exists</a>());</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1storage_1_1Storage_html_ade24602975f3928e77762f8cb4da51ca"><div class="ttname"><a href="classfoedus_1_1storage_1_1Storage.html#ade24602975f3928e77762f8cb4da51ca">foedus::storage::Storage::exists</a></div><div class="ttdeci">bool exists() const </div><div class="ttdoc">Returns whether this storage is already created. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00169">storage.hpp:169</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab3ab6f2223dfb1165a58722c0a4df705_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab3ab6f2223dfb1165a58722c0a4df705_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab3ab6f2223dfb1165a58722c0a4df705_cgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab3ab6f2223dfb1165a58722c0a4df705_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Storage.html#ade24602975f3928e77762f8cb4da51ca" title="Returns whether this storage is already created. " alt="" coords="272,5,436,47"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ab768c873a7e2b4a9ce2b4b1df39676ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::storage::array::ArrayComposer::compose </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">Composer::ComposeArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="array__composer__impl_8cpp_source.html#l00066">66</a> of file <a class="el" href="array__composer__impl_8cpp_source.html">array_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="composer_8hpp_source.html#l00110">foedus::storage::Composer::ComposeArguments::base_epoch_</a>, <a class="el" href="error__stack_8hpp_source.html#l00517">CHECK_ERROR</a>, <a class="el" href="stop__watch_8hpp_source.html#l00048">foedus::debugging::StopWatch::elapsed_ms()</a>, <a class="el" href="initializable_8hpp_source.html#l00169">foedus::DefaultInitializable::initialize()</a>, <a class="el" href="storage__id_8hpp_source.html#l00126">foedus::storage::kArrayStorage</a>, <a class="el" href="array__id_8hpp_source.html#l00118">foedus::storage::array::kMaxLevels</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="composer_8hpp_source.html#l00101">foedus::storage::Composer::ComposeArguments::log_streams_</a>, <a class="el" href="composer_8hpp_source.html#l00103">foedus::storage::Composer::ComposeArguments::log_streams_count_</a>, <a class="el" href="composer_8hpp_source.html#l00099">foedus::storage::Composer::ComposeArguments::previous_snapshot_files_</a>, <a class="el" href="composer_8hpp_source.html#l00116">foedus::storage::Composer::ComposeArguments::root_info_page_</a>, <a class="el" href="composer_8hpp_source.html#l00097">foedus::storage::Composer::ComposeArguments::snapshot_writer_</a>, <a class="el" href="stop__watch_8cpp_source.html#l00035">foedus::debugging::StopWatch::stop()</a>, <a class="el" href="array__composer__impl_8cpp_source.html#l00182">to_string()</a>, <a class="el" href="initializable_8hpp_source.html#l00187">foedus::DefaultInitializable::uninitialize()</a>, and <a class="el" href="composer_8hpp_source.html#l00105">foedus::storage::Composer::ComposeArguments::work_memory_</a>.</p>

<p>Referenced by <a class="el" href="composer_8cpp_source.html#l00061">foedus::storage::Composer::compose()</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                                                      {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  VLOG(0) &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ae9bd9d37f8a9c300dd188c5a23b938cd">to_string</a>() &lt;&lt; <span class="stringliteral">&quot; composing with &quot;</span> &lt;&lt; args.log_streams_count_ &lt;&lt; <span class="stringliteral">&quot; streams.&quot;</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  debugging::StopWatch stop_watch;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  snapshot::MergeSort merge_sort(</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    storage_id_,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="group__STORAGE.html#gga016025043f5ef9c02be03f2f2a17a0deaeee5e98ab1c99fca614ecba38b2871ff">kArrayStorage</a>,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    args.base_epoch_,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    args.log_streams_,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    args.log_streams_count_,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="group__ARRAY.html#ga982ebbd7c4c135d66a950653a1c7eeb1">kMaxLevels</a>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    args.work_memory_);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(merge_sort.initialize());</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  ArrayComposeContext context(</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    engine_,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    &amp;merge_sort,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    args.snapshot_writer_,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    args.previous_snapshot_files_,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    args.root_info_page_);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(context.execute());</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(merge_sort.uninitialize());  <span class="comment">// no need for scoped release. its destructor is safe.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  stop_watch.stop();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  LOG(INFO) &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ae9bd9d37f8a9c300dd188c5a23b938cd">to_string</a>() &lt;&lt; <span class="stringliteral">&quot; done in &quot;</span> &lt;&lt; stop_watch.elapsed_ms() &lt;&lt; <span class="stringliteral">&quot;ms.&quot;</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div>
<div class="ttc" id="group__ARRAY_html_ga982ebbd7c4c135d66a950653a1c7eeb1"><div class="ttname"><a href="group__ARRAY.html#ga982ebbd7c4c135d66a950653a1c7eeb1">foedus::storage::array::kMaxLevels</a></div><div class="ttdeci">const uint8_t kMaxLevels</div><div class="ttdoc">Code in array storage assumes this number as the maximum number of levels. </div><div class="ttdef"><b>Definition:</b> <a href="array__id_8hpp_source.html#l00118">array_id.hpp:118</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_html_ae9bd9d37f8a9c300dd188c5a23b938cd"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ae9bd9d37f8a9c300dd188c5a23b938cd">foedus::storage::array::ArrayComposer::to_string</a></div><div class="ttdeci">std::string to_string() const </div><div class="ttdef"><b>Definition:</b> <a href="array__composer__impl_8cpp_source.html#l00182">array_composer_impl.cpp:182</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__STORAGE_html_gga016025043f5ef9c02be03f2f2a17a0deaeee5e98ab1c99fca614ecba38b2871ff"><div class="ttname"><a href="group__STORAGE.html#gga016025043f5ef9c02be03f2f2a17a0deaeee5e98ab1c99fca614ecba38b2871ff">foedus::storage::kArrayStorage</a></div><div class="ttdoc">Array Storage </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00126">storage_id.hpp:126</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_cgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1debugging_1_1StopWatch.html#ac8a42ba406ab38b098e27a19e6803638" title="foedus::debugging::\lStopWatch::elapsed_ms" alt="" coords="241,71,407,112"/>
<area shape="rect" id="node3" href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff" title="Typical implementation of Initializable::initialize() that provides initialize&#45;once semantics..." alt="" coords="238,136,410,177"/>
<area shape="rect" id="node8" href="classfoedus_1_1debugging_1_1StopWatch.html#a2ee5315a0f6bf736a2a73b29b1709bd2" title="Take another current time tick. " alt="" coords="257,267,391,308"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ae9bd9d37f8a9c300dd188c5a23b938cd" title="foedus::storage::array\l::ArrayComposer::to_string" alt="" coords="235,332,413,373"/>
<area shape="rect" id="node12" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb" title="Typical implementation of Initializable::uninitialize() that provides uninitialize&#45;once semantics..." alt="" coords="238,201,410,243"/>
<area shape="rect" id="node4" href="classfoedus_1_1DefaultInitializable.html#ab8ae37e5f20f312f8b945fc40d3e0250" title="foedus::DefaultInitializable\l::initialize_once" alt="" coords="461,5,633,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1ErrorStack.html#a9c7b3a8b3806ff623c7fb4a9db5cbeec" title="Returns if this return code is not kErrorCodeOk. " alt="" coords="482,71,613,112"/>
<area shape="rect" id="node6" href="classfoedus_1_1DefaultInitializable.html#a1abda1e84b8af8bd6916e52fd0a09f3e" title="Returns whether the object has been already initialized or not. " alt="" coords="461,136,633,177"/>
<area shape="rect" id="node7" href="classfoedus_1_1DefaultInitializable.html#a764be22ce1454279e7a7e78f4c8e380b" title="foedus::DefaultInitializable\l::uninitialize_once" alt="" coords="461,201,633,243"/>
<area shape="rect" id="node9" href="classfoedus_1_1debugging_1_1StopWatch.html#adacc2b7108e7b4df019cc79733050b8c" title="foedus::debugging::\lStopWatch::elapsed_ns" alt="" coords="467,267,628,308"/>
<area shape="rect" id="node10" href="namespacefoedus_1_1debugging.html#a35a786b0492e9799cb74359408079091" title="foedus::debugging::\lget_now_nanosec" alt="" coords="480,332,615,373"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_icgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ab768c873a7e2b4a9ce2b4b1df39676ff_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Composer.html#a28c752ec784b85418c0bfafab7ee60c0" title="Construct snapshot pages from sorted run files of one storage. " alt="" coords="235,5,413,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2c812e46a7502abe6f506ecda0edf9ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> foedus::storage::array::ArrayComposer::construct_root </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments">Composer::ConstructRootArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="array__composer__impl_8cpp_source.html#l00095">95</a> of file <a class="el" href="array__composer__impl_8cpp_source.html">array_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00135">foedus::snapshot::SnapshotWriter::dump_pages()</a>, <a class="el" href="storage__id_8hpp_source.html#l00098">foedus::storage::extract_snapshot_id_from_snapshot_pointer()</a>, <a class="el" href="array__page__impl_8hpp_source.html#l00072">foedus::storage::array::ArrayPage::get_array_range()</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00057">foedus::storage::array::ArrayStorage::get_array_size()</a>, <a class="el" href="attachable_8hpp_source.html#l00097">foedus::Attachable&lt; CONTROL_BLOCK &gt;::get_control_block()</a>, <a class="el" href="savepoint__manager_8cpp_source.html#l00039">foedus::savepoint::SavepointManager::get_initial_durable_epoch()</a>, <a class="el" href="array__page__impl_8hpp_source.html#l00105">foedus::storage::array::ArrayPage::get_interior_record()</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00058">foedus::storage::array::ArrayStorage::get_levels()</a>, <a class="el" href="storage_8hpp_source.html#l00162">foedus::storage::Storage&lt; CONTROL_BLOCK &gt;::get_metadata()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00115">foedus::snapshot::SnapshotWriter::get_next_page_id()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00102">foedus::snapshot::SnapshotWriter::get_page_base()</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00056">foedus::storage::array::ArrayStorage::get_payload_size()</a>, <a class="el" href="array__route_8hpp_source.html#l00122">foedus::storage::array::LookupRouteFinder::get_records_in_leaf()</a>, <a class="el" href="engine_8cpp_source.html#l00053">foedus::Engine::get_savepoint_manager()</a>, <a class="el" href="snapshot__writer__impl_8hpp_source.html#l00116">foedus::snapshot::SnapshotWriter::get_snapshot_id()</a>, <a class="el" href="array__page__impl_8hpp_source.html#l00063">foedus::storage::array::ArrayPage::header()</a>, <a class="el" href="array__page__impl_8cpp_source.html#l00032">foedus::storage::array::ArrayPage::initialize_snapshot_page()</a>, <a class="el" href="assorted__func_8cpp_source.html#l00040">foedus::assorted::int_div_ceil()</a>, <a class="el" href="array__id_8hpp_source.html#l00110">foedus::storage::array::kInteriorFanout</a>, <a class="el" href="error__stack_8hpp_source.html#l00251">foedus::kRetOk</a>, <a class="el" href="composer_8hpp_source.html#l00136">foedus::storage::Composer::ConstructRootArguments::new_root_page_pointer_</a>, <a class="el" href="page_8hpp_source.html#l00191">foedus::storage::PageHeader::page_id_</a>, <a class="el" href="array__composer__impl_8hpp_source.html#l00096">foedus::storage::array::ArrayRootInfoPage::pointers_</a>, <a class="el" href="composer_8hpp_source.html#l00128">foedus::storage::Composer::ConstructRootArguments::previous_snapshot_files_</a>, <a class="el" href="snapshot__file__set_8cpp_source.html#l00095">foedus::cache::SnapshotFileSet::read_page()</a>, <a class="el" href="composer_8hpp_source.html#l00130">foedus::storage::Composer::ConstructRootArguments::root_info_pages_</a>, <a class="el" href="composer_8hpp_source.html#l00132">foedus::storage::Composer::ConstructRootArguments::root_info_pages_count_</a>, <a class="el" href="metadata_8hpp_source.html#l00112">foedus::storage::Metadata::root_snapshot_page_id_</a>, <a class="el" href="storage__id_8hpp_source.html#l00307">foedus::storage::DualPagePointer::snapshot_pointer_</a>, <a class="el" href="composer_8hpp_source.html#l00126">foedus::storage::Composer::ConstructRootArguments::snapshot_writer_</a>, <a class="el" href="page_8hpp_source.html#l00196">foedus::storage::PageHeader::storage_id_</a>, and <a class="el" href="error__stack_8hpp_source.html#l00533">WRAP_ERROR_CODE</a>.</p>

<p>Referenced by <a class="el" href="composer_8cpp_source.html#l00072">foedus::storage::Composer::construct_root()</a>.</p>
<div class="fragment"><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                                                                   {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// compose() created root_info_pages that contain pointers to fill in the root page,</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// so we just find non-zero entry and copy it to root page.</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  uint8_t levels = storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a3a535c4b81884868a2a5ead00428dd77">get_levels</a>();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  uint16_t payload_size = storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#acc05e0b608094e78fa9a7025c08524b5">get_payload_size</a>();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">snapshot::SnapshotId</a> new_snapshot_id = args.snapshot_writer_-&gt;get_snapshot_id();</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  Epoch system_initial_epoch = engine_-&gt;<a class="code" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">get_savepoint_manager</a>()-&gt;<a class="code" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a7fc7a7f62d25e8114ab15a340256f71a">get_initial_durable_epoch</a>();</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">if</span> (levels == 1U) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// if it&#39;s single-page array, we have already created the root page in compose().</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(args.root_info_pages_count_ == 1U);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keyword">const</span> ArrayRootInfoPage* casted</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>ArrayRootInfoPage*<span class="keyword">&gt;</span>(args.root_info_pages_[0]);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(casted-&gt;pointers_[0] != 0);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    *args.new_root_page_pointer_ = casted-&gt;pointers_[0];</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// and we have already installed it, right?</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(storage_.<a class="code" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">get_control_block</a>()-&gt;meta_.root_snapshot_page_id_</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      == casted-&gt;pointers_[0]);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(storage_.<a class="code" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">get_control_block</a>()-&gt;root_page_pointer_.snapshot_pointer_</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      == casted-&gt;pointers_[0]);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    ArrayPage* root_page = <span class="keyword">reinterpret_cast&lt;</span>ArrayPage*<span class="keyword">&gt;</span>(args.snapshot_writer_-&gt;get_page_base());</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> page_id = storage_.<a class="code" href="classfoedus_1_1storage_1_1Storage.html#ae3cca5dd58aa9bbf419cc07986bbc668">get_metadata</a>()-&gt;<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">root_snapshot_page_id_</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> new_page_id = args.snapshot_writer_-&gt;get_next_page_id();</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    *args.new_root_page_pointer_ = new_page_id;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    uint64_t root_interval = LookupRouteFinder(levels, payload_size).get_records_in_leaf();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">for</span> (uint8_t level = 1; level &lt; levels; ++level) {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      root_interval *= <a class="code" href="group__ARRAY.html#gaaa3b4fa18b93d578250c8c8a5b613423">kInteriorFanout</a>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    ArrayRange range(0, root_interval, storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca">get_array_size</a>());</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (page_id != 0) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(args.previous_snapshot_files_-&gt;read_page(page_id, root_page));</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root_page-&gt;header().storage_id_ == storage_id_);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root_page-&gt;header().page_id_ == page_id);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root_page-&gt;get_array_range() == range);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      root_page-&gt;header().page_id_ = new_page_id;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      root_page-&gt;initialize_snapshot_page(</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        system_initial_epoch,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        storage_id_,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        new_page_id,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        payload_size,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        levels - 1,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        range);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    uint64_t child_interval = root_interval / <a class="code" href="group__ARRAY.html#gaaa3b4fa18b93d578250c8c8a5b613423">kInteriorFanout</a>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    uint16_t root_children = <a class="code" href="group__ASSORTED.html#gae2beea4717aef7ca9d43b91e48cf5824">assorted::int_div_ceil</a>(storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca">get_array_size</a>(), child_interval);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// overwrite pointers with root_info_pages.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; args.root_info_pages_count_; ++i) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="keyword">const</span> ArrayRootInfoPage* casted</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>ArrayRootInfoPage*<span class="keyword">&gt;</span>(args.root_info_pages_[i]);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="keywordflow">for</span> (uint16_t j = 0; j &lt; root_children; ++j) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> pointer = casted-&gt;pointers_[j];</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> (pointer != 0) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c">extract_snapshot_id_from_snapshot_pointer</a>(pointer) == new_snapshot_id);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          DualPagePointer&amp; record = root_page-&gt;get_interior_record(j);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          <span class="comment">// partitioning has no overlap, so this must be the only overwriting pointer</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(record.snapshot_pointer_ == 0 ||</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <a class="code" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c">extract_snapshot_id_from_snapshot_pointer</a>(record.snapshot_pointer_)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;              != new_snapshot_id);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;          record.snapshot_pointer_ = pointer;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">for</span> (uint16_t j = root_children; j &lt; <a class="code" href="group__ARRAY.html#gaaa3b4fa18b93d578250c8c8a5b613423">kInteriorFanout</a>; ++j) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(casted-&gt;pointers_[j] == 0);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// even in initial snapshot, all pointers must be set because we create empty pages</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// even if some sub-tree receives no logs.</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">for</span> (uint16_t j = 0; j &lt; root_children; ++j) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root_page-&gt;get_interior_record(j).snapshot_pointer_ != 0);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(args.snapshot_writer_-&gt;dump_pages(0, 1));</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(args.snapshot_writer_-&gt;get_next_page_id() == new_page_id + 1ULL);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// AFTER writing out the root page, install the pointer to new root page</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    storage_.<a class="code" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">get_control_block</a>()-&gt;root_page_pointer_.snapshot_pointer_ = new_page_id;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    storage_.<a class="code" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">get_control_block</a>()-&gt;meta_.root_snapshot_page_id_ = new_page_id;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_acc05e0b608094e78fa9a7025c08524b5"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#acc05e0b608094e78fa9a7025c08524b5">foedus::storage::array::ArrayStorage::get_payload_size</a></div><div class="ttdeci">uint16_t get_payload_size() const </div><div class="ttdoc">Returns byte size of one record in this array storage without internal overheads. ...</div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00056">array_storage_pimpl.cpp:56</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1Storage_html_ae3cca5dd58aa9bbf419cc07986bbc668"><div class="ttname"><a href="classfoedus_1_1storage_1_1Storage.html#ae3cca5dd58aa9bbf419cc07986bbc668">foedus::storage::Storage::get_metadata</a></div><div class="ttdeci">const Metadata * get_metadata() const </div><div class="ttdoc">Returns the metadata of this storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00162">storage.hpp:162</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_a2e5043394d70ac6f151fb06508a038ca"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca">foedus::storage::array::ArrayStorage::get_array_size</a></div><div class="ttdeci">ArrayOffset get_array_size() const </div><div class="ttdoc">Returns the size of this array. </div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00057">array_storage_pimpl.cpp:57</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a4f168d41ea00249fefe905def87e80c8"><div class="ttname"><a href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8">foedus::Engine::get_savepoint_manager</a></div><div class="ttdeci">savepoint::SavepointManager * get_savepoint_manager() const </div><div class="ttdoc">See Savepoint Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00053">engine.cpp:53</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga629d4b8103bfb83ef9c11b842a4fd398"><div class="ttname"><a href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">foedus::storage::SnapshotPagePointer</a></div><div class="ttdeci">uint64_t SnapshotPagePointer</div><div class="ttdoc">Page ID of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00079">storage_id.hpp:79</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a82df0b3921d7c863275baf4f9c59959c"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c">foedus::storage::extract_snapshot_id_from_snapshot_pointer</a></div><div class="ttdeci">uint16_t extract_snapshot_id_from_snapshot_pointer(SnapshotPagePointer pointer)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00098">storage_id.hpp:98</a></div></div>
<div class="ttc" id="group__SNAPSHOT_html_gaec32eb05303ebec1048d120f73295031"><div class="ttname"><a href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">foedus::snapshot::SnapshotId</a></div><div class="ttdeci">uint16_t SnapshotId</div><div class="ttdoc">Unique ID of Snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00043">snapshot_id.hpp:43</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_a3a535c4b81884868a2a5ead00428dd77"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a3a535c4b81884868a2a5ead00428dd77">foedus::storage::array::ArrayStorage::get_levels</a></div><div class="ttdeci">uint8_t get_levels() const </div><div class="ttdoc">Returns the number of levels. </div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00058">array_storage_pimpl.cpp:58</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gae2beea4717aef7ca9d43b91e48cf5824"><div class="ttname"><a href="group__ASSORTED.html#gae2beea4717aef7ca9d43b91e48cf5824">foedus::assorted::int_div_ceil</a></div><div class="ttdeci">int64_t int_div_ceil(int64_t dividee, int64_t dividor)</div><div class="ttdoc">Efficient ceil(dividee/dividor) for integer. </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8cpp_source.html#l00040">assorted_func.cpp:40</a></div></div>
<div class="ttc" id="classfoedus_1_1savepoint_1_1SavepointManager_html_a7fc7a7f62d25e8114ab15a340256f71a"><div class="ttname"><a href="classfoedus_1_1savepoint_1_1SavepointManager.html#a7fc7a7f62d25e8114ab15a340256f71a">foedus::savepoint::SavepointManager::get_initial_durable_epoch</a></div><div class="ttdeci">Epoch get_initial_durable_epoch() const </div><div class="ttdef"><b>Definition:</b> <a href="savepoint__manager_8cpp_source.html#l00039">savepoint_manager.cpp:39</a></div></div>
<div class="ttc" id="group__ARRAY_html_gaaa3b4fa18b93d578250c8c8a5b613423"><div class="ttname"><a href="group__ARRAY.html#gaaa3b4fa18b93d578250c8c8a5b613423">foedus::storage::array::kInteriorFanout</a></div><div class="ttdeci">const uint16_t kInteriorFanout</div><div class="ttdoc">Max number of entries in an interior page of array storage. </div><div class="ttdef"><b>Definition:</b> <a href="array__id_8hpp_source.html#l00110">array_id.hpp:110</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga952ce4f5f860d7b28a70095b450d3f4d"><div class="ttname"><a href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a></div><div class="ttdeci">#define WRAP_ERROR_CODE(x)</div><div class="ttdoc">Same as CHECK_ERROR(x) except it receives only an error code, thus more efficient. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00533">error_stack.hpp:533</a></div></div>
<div class="ttc" id="classfoedus_1_1Attachable_html_a5b324e3abf302a59801aa73419bb4fad"><div class="ttname"><a href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">foedus::Attachable::get_control_block</a></div><div class="ttdeci">CONTROL_BLOCK * get_control_block() const </div><div class="ttdef"><b>Definition:</b> <a href="attachable_8hpp_source.html#l00097">attachable.hpp:97</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Metadata_html_ab9d6a766410a36959158818af739df34"><div class="ttname"><a href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">foedus::storage::Metadata::root_snapshot_page_id_</a></div><div class="ttdeci">SnapshotPagePointer root_snapshot_page_id_</div><div class="ttdoc">Pointer to a snapshotted page this storage is rooted at. </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8hpp_source.html#l00112">metadata.hpp:112</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_cgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a55ba9fc4a87f71b3991bba1c39948cc9" title="Write out pages that are contiguous in the main page pool. " alt="" coords="279,143,463,185"/>
<area shape="rect" id="node3" href="namespacefoedus_1_1storage.html#a82df0b3921d7c863275baf4f9c59959c" title="foedus::storage::extract\l_snapshot_id_from_snapshot\l_pointer" alt="" coords="792,381,983,437"/>
<area shape="rect" id="node4" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#af7bf48c6785865302f1d67bc59ab1392" title="foedus::storage::array\l::ArrayPage::get_array_range" alt="" coords="275,466,467,507"/>
<area shape="rect" id="node5" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca" title="Returns the size of this array. " alt="" coords="272,531,471,573"/>
<area shape="rect" id="node6" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="305,597,437,638"/>
<area shape="rect" id="node7" href="classfoedus_1_1savepoint_1_1SavepointManager.html#a7fc7a7f62d25e8114ab15a340256f71a" title="foedus::savepoint::\lSavepointManager::get\l_initial_durable_epoch" alt="" coords="294,663,449,719"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a53643894d607ee034359b2a4f77f0d89" title="foedus::storage::array\l::ArrayPage::get_interior\l_record" alt="" coords="290,743,453,799"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a3a535c4b81884868a2a5ead00428dd77" title="Returns the number of levels. " alt="" coords="286,823,457,865"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1Storage.html#ae3cca5dd58aa9bbf419cc07986bbc668" title="Returns the metadata of this storage. " alt="" coords="289,889,453,930"/>
<area shape="rect" id="node12" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#af9bcb8a605aecbbc3eabdc6664f6b163" title="foedus::snapshot::Snapshot\lWriter::get_next_page_id" alt="" coords="279,954,463,995"/>
<area shape="rect" id="node13" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#a4f72263ae71f34fad0130151328d6720" title="foedus::snapshot::Snapshot\lWriter::get_page_base" alt="" coords="279,1019,463,1061"/>
<area shape="rect" id="node15" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#acc05e0b608094e78fa9a7025c08524b5" title="Returns byte size of one record in this array storage without internal overheads. ..." alt="" coords="264,1085,479,1126"/>
<area shape="rect" id="node16" href="classfoedus_1_1storage_1_1array_1_1LookupRouteFinder.html#a2d19d9785d226e4c7f9b2f0f549fdd19" title="foedus::storage::array\l::LookupRouteFinder::get\l_records_in_leaf" alt="" coords="287,1151,455,1207"/>
<area shape="rect" id="node17" href="classfoedus_1_1Engine.html#a4f168d41ea00249fefe905def87e80c8" title="See Savepoint Manager. " alt="" coords="301,1231,441,1273"/>
<area shape="rect" id="node18" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#ad4209f06409d52c010aac8bf98660dbe" title="foedus::snapshot::Snapshot\lWriter::get_snapshot_id" alt="" coords="279,1297,463,1338"/>
<area shape="rect" id="node19" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#ad27a14c20dc341c655820def2e0dd1ee" title="foedus::storage::array\l::ArrayPage::header" alt="" coords="297,1362,445,1403"/>
<area shape="rect" id="node20" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a4f3a748fa4e795bd86e0b2a2ed7e6630" title="Called only when this page is initialized. " alt="" coords="297,209,445,265"/>
<area shape="rect" id="node33" href="group__ASSORTED.html#gae2beea4717aef7ca9d43b91e48cf5824" title="Efficient ceil(dividee/dividor) for integer. " alt="" coords="301,1427,441,1469"/>
<area shape="rect" id="node34" href="classfoedus_1_1cache_1_1SnapshotFileSet.html#ad7ea1e9815cd47c3175371d37974526a" title="foedus::cache::SnapshotFile\lSet::read_page" alt="" coords="278,401,465,442"/>
<area shape="rect" id="node8" href="classfoedus_1_1savepoint_1_1SavepointManagerPimpl.html#af3569e99d9295cf12b5ba4692bb5bb49" title="foedus::savepoint::\lSavepointManagerPimpl\l::get_initial_durable_epoch" alt="" coords="545,671,721,727"/>
<area shape="rect" id="node14" href="classfoedus_1_1memory_1_1AlignedMemory.html#af306ba60622e2a87f75ae93dc6c597b1" title="Returns the memory block. " alt="" coords="527,1019,740,1061"/>
<area shape="rect" id="node21" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="556,224,711,251"/>
<area shape="rect" id="node22" href="structfoedus_1_1storage_1_1PageHeader.html#a65c4acd213d2f482eb29c6dee0818915" title="foedus::storage::PageHeader\l::init_snapshot" alt="" coords="538,275,729,317"/>
<area shape="rect" id="node29" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a9c7bc21358a340d36f3c43a49f774b93" title="foedus::storage::array\l::ArrayPage::is_leaf" alt="" coords="813,19,961,61"/>
<area shape="rect" id="node30" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a038d272bb21378544e6d6cd1c8b468b3" title="foedus::storage::array\l::ArrayPage::get_leaf\l_record_count" alt="" coords="559,144,707,200"/>
<area shape="rect" id="node32" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#ae6032f608834a39808e26c59aa0e42e2" title="foedus::storage::array\l::ArrayPage::get_leaf\l_record" alt="" coords="559,64,707,120"/>
<area shape="rect" id="node23" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="793,301,981,357"/>
<area shape="rect" id="node24" href="structfoedus_1_1assorted_1_1ProbCounter.html#a8e7b31f9a6b4997f6c0916f7e20d755a" title="foedus::assorted::ProbCounter\l::reset" alt="" coords="788,235,987,277"/>
<area shape="rect" id="node25" href="structfoedus_1_1storage_1_1PageVersion.html#ae40168c82f16645e85bb66f9019e53cf" title="used only while page initialization " alt="" coords="791,170,983,211"/>
<area shape="rect" id="node26" href="structfoedus_1_1storage_1_1PageVersionStatus.html#af49ef4f3320148130f46f494f1c845aa" title="foedus::storage::PageVersion\lStatus::reset" alt="" coords="1035,203,1227,245"/>
<area shape="rect" id="node27" href="structfoedus_1_1xct_1_1McsWwLock.html#a4114c2dec151ad650a294dedac4f239d" title="used only while page initialization " alt="" coords="1046,138,1215,179"/>
<area shape="rect" id="node28" href="structfoedus_1_1xct_1_1McsWwBlockData.html#a3161e47c41388e9c1b50929f585e366b" title="foedus::xct::McsWwBlockData\l::clear" alt="" coords="1275,138,1476,179"/>
<area shape="rect" id="node31" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="807,99,967,125"/>
<area shape="rect" id="node35" href="namespacefoedus_1_1storage.html#a3c3e7a984303d1ef88e001db1591b1be" title="foedus::storage::extract\l_local_page_id_from_snapshot\l_pointer" alt="" coords="533,524,733,580"/>
<area shape="rect" id="node36" href="classfoedus_1_1cache_1_1SnapshotFileSet.html#ae5b153acb9f3115c44a48e10ff2262fb" title="foedus::cache::SnapshotFile\lSet::get_or_open_file" alt="" coords="540,393,727,434"/>
<area shape="rect" id="node37" href="classfoedus_1_1fs_1_1DirectIoFile.html#a5353bbb3b2a815d6c858c8190edeccf4" title="A version that receives a raw pointer that has to be aligned (be careful to use this ver)..." alt="" coords="558,605,709,646"/>
<area shape="rect" id="node44" href="classfoedus_1_1fs_1_1DirectIoFile.html#a35814dfec4dab81d5bb46e453f1993e6" title="Sets the position of the next byte to be written/extracted from/to the stream. " alt="" coords="558,458,709,499"/>
<area shape="rect" id="node38" href="namespacefoedus_1_1fs.html#a1a3ea81bf627928d9a5f154986af9c48" title="foedus::fs::is_odirect\l_aligned" alt="" coords="816,462,959,503"/>
<area shape="rect" id="node39" href="classfoedus_1_1fs_1_1DirectIoFile.html#a1d89a9c761a388f13f9b59490b6caa00" title="Whether the file is already and successfully opened. " alt="" coords="812,723,963,765"/>
<area shape="rect" id="node40" href="group__ASSORTED.html#gaaa260096daf8620266c2799d1f5a0270" title="Thread&#45;safe strerror(errno). " alt="" coords="817,527,957,569"/>
<area shape="rect" id="node41" href="classfoedus_1_1fs_1_1DirectIoFile.html#a1c6bff6aafc955fd4c2a8e11e7f41f40" title="Sequentially read the given amount of contents from the current position. " alt="" coords="812,658,963,699"/>
<area shape="rect" id="node42" href="group__DEBUGGING.html#gac7eac15b41b0fab4e689f62d147ce620" title="Wait until the given CPU cycles elapse. " alt="" coords="820,593,955,634"/>
<area shape="rect" id="node43" href="group__DEBUGGING.html#ga48dd46b3a1382506a34fcb4e6e0941f6" title="Returns the current CPU cycle via x86 RDTSC. " alt="" coords="1063,593,1198,634"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_icgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a2c812e46a7502abe6f506ecda0edf9ab_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Composer.html#adf148cbea7c8146dec88d23d2218452c" title="Construct root page(s) for one storage based on the ouputs of compose(). " alt="" coords="264,5,443,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9ee9788f623a51584b4fd7f8ded6103a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void foedus::storage::array::ArrayComposer::drop_root_volatile </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html">Composer::DropVolatilesArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="array__composer__impl_8cpp_source.html#l00971">971</a> of file <a class="el" href="array__composer__impl_8cpp_source.html">array_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00059">foedus::storage::array::ArrayStorage::get_array_metadata()</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00057">foedus::storage::array::ArrayStorage::get_array_size()</a>, <a class="el" href="attachable_8hpp_source.html#l00097">foedus::Attachable&lt; CONTROL_BLOCK &gt;::get_control_block()</a>, <a class="el" href="xct__id_8hpp_source.html#l00964">foedus::xct::XctId::get_epoch()</a>, <a class="el" href="array__page__impl_8hpp_source.html#l00091">foedus::storage::array::ArrayPage::get_leaf_record()</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00058">foedus::storage::array::ArrayStorage::get_levels()</a>, <a class="el" href="storage_8hpp_source.html#l00155">foedus::storage::Storage&lt; CONTROL_BLOCK &gt;::get_name()</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00056">foedus::storage::array::ArrayStorage::get_payload_size()</a>, <a class="el" href="array__page__impl_8hpp_source.html#l00070">foedus::storage::array::ArrayPage::is_leaf()</a>, <a class="el" href="epoch_8hpp_source.html#l00096">foedus::Epoch::is_valid()</a>, <a class="el" href="metadata_8hpp_source.html#l00098">foedus::storage::Metadata::keeps_all_volatile_pages()</a>, <a class="el" href="record_8hpp_source.html#l00039">foedus::storage::Record::owner_id_</a>, <a class="el" href="composer_8hpp_source.html#l00150">foedus::storage::Composer::DropVolatilesArguments::snapshot_</a>, <a class="el" href="snapshot_8hpp_source.html#l00055">foedus::snapshot::Snapshot::valid_until_epoch_</a>, <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>, and <a class="el" href="xct__id_8hpp_source.html#l01137">foedus::xct::RwLockableXctId::xct_id_</a>.</p>

<p>Referenced by <a class="el" href="composer_8cpp_source.html#l00094">foedus::storage::Composer::drop_root_volatile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                                                                                 {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordflow">if</span> (storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58">get_array_metadata</a>()-&gt;<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b">keeps_all_volatile_pages</a>()) {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Oh, but keep-all-volatile is on. Storage-&quot;</span> &lt;&lt; storage_.<a class="code" href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01">get_name</a>()</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; is configured to keep all volatile pages.&quot;</span>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  }</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keywordflow">if</span> (is_to_keep_volatile(storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a3a535c4b81884868a2a5ead00428dd77">get_levels</a>() - 1U)) {</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Oh, but Storage-&quot;</span> &lt;&lt; storage_.<a class="code" href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01">get_name</a>() &lt;&lt; <span class="stringliteral">&quot; is configured to keep&quot;</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; the root page.&quot;</span>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  }</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  DualPagePointer* root_pointer = &amp;storage_.<a class="code" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">get_control_block</a>()-&gt;root_page_pointer_;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  ArrayPage* volatile_page = resolve_volatile(root_pointer-&gt;volatile_pointer_);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordflow">if</span> (volatile_page == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Oh, but root volatile page already null&quot;</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordflow">if</span> (volatile_page-&gt;is_leaf()) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="comment">// if this is a single-level array. we now have to check epochs of records in the root page.</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    uint16_t records = storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca">get_array_size</a>();</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; records; ++i) {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      Record* record = volatile_page-&gt;get_leaf_record(i, storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#acc05e0b608094e78fa9a7025c08524b5">get_payload_size</a>());</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      Epoch epoch = record-&gt;owner_id_.xct_id_.get_epoch();</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(epoch.is_valid());</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span> (epoch &gt; args.snapshot_.valid_until_epoch_) {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Oh, but the root volatile page in single-level array contains a new rec&quot;</span>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="comment">// otherwise, all verifications already done. go drop everything!</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Okay, drop em all!!&quot;</span>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  drop_all_recurse(args, root_pointer);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_a145759e5113dca6d01be034ea5725f58"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58">foedus::storage::array::ArrayStorage::get_array_metadata</a></div><div class="ttdeci">const ArrayMetadata * get_array_metadata() const </div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00059">array_storage_pimpl.cpp:59</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Metadata_html_a675df0db1a3c909581db949c10fd192b"><div class="ttname"><a href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b">foedus::storage::Metadata::keeps_all_volatile_pages</a></div><div class="ttdeci">bool keeps_all_volatile_pages() const </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8hpp_source.html#l00098">metadata.hpp:98</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_acc05e0b608094e78fa9a7025c08524b5"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#acc05e0b608094e78fa9a7025c08524b5">foedus::storage::array::ArrayStorage::get_payload_size</a></div><div class="ttdeci">uint16_t get_payload_size() const </div><div class="ttdoc">Returns byte size of one record in this array storage without internal overheads. ...</div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00056">array_storage_pimpl.cpp:56</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_a2e5043394d70ac6f151fb06508a038ca"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca">foedus::storage::array::ArrayStorage::get_array_size</a></div><div class="ttdeci">ArrayOffset get_array_size() const </div><div class="ttdoc">Returns the size of this array. </div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00057">array_storage_pimpl.cpp:57</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1Storage_html_ac1b54d4e7f3ad9f7f7c17598911abb01"><div class="ttname"><a href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01">foedus::storage::Storage::get_name</a></div><div class="ttdeci">const StorageName &amp; get_name() const </div><div class="ttdoc">Returns the unique name of this storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00155">storage.hpp:155</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_a3a535c4b81884868a2a5ead00428dd77"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a3a535c4b81884868a2a5ead00428dd77">foedus::storage::array::ArrayStorage::get_levels</a></div><div class="ttdeci">uint8_t get_levels() const </div><div class="ttdoc">Returns the number of levels. </div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00058">array_storage_pimpl.cpp:58</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1Attachable_html_a5b324e3abf302a59801aa73419bb4fad"><div class="ttname"><a href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">foedus::Attachable::get_control_block</a></div><div class="ttdeci">CONTROL_BLOCK * get_control_block() const </div><div class="ttdef"><b>Definition:</b> <a href="attachable_8hpp_source.html#l00097">attachable.hpp:97</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_cgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_cgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58" title="foedus::storage::array\l::ArrayStorage::get_array\l_metadata" alt="" coords="230,5,398,61"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a2e5043394d70ac6f151fb06508a038ca" title="Returns the size of this array. " alt="" coords="215,86,413,127"/>
<area shape="rect" id="node4" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="248,151,380,193"/>
<area shape="rect" id="node5" href="structfoedus_1_1xct_1_1XctId.html#af48118bbaf92a957116ae2873fe55b83" title="foedus::xct::XctId\l::get_epoch" alt="" coords="253,217,375,258"/>
<area shape="rect" id="node7" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#ae6032f608834a39808e26c59aa0e42e2" title="foedus::storage::array\l::ArrayPage::get_leaf\l_record" alt="" coords="240,333,388,389"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a9c7bc21358a340d36f3c43a49f774b93" title="foedus::storage::array\l::ArrayPage::is_leaf" alt="" coords="475,282,623,323"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a3a535c4b81884868a2a5ead00428dd77" title="Returns the number of levels. " alt="" coords="229,414,399,455"/>
<area shape="rect" id="node11" href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01" title="Returns the unique name of this storage. " alt="" coords="232,479,396,521"/>
<area shape="rect" id="node12" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#acc05e0b608094e78fa9a7025c08524b5" title="Returns byte size of one record in this array storage without internal overheads. ..." alt="" coords="207,545,421,586"/>
<area shape="rect" id="node13" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="237,611,391,637"/>
<area shape="rect" id="node14" href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b" title="foedus::storage::Metadata\l::keeps_all_volatile_pages" alt="" coords="227,662,401,703"/>
<area shape="rect" id="node6" href="structfoedus_1_1xct_1_1XctId.html#aa9ea819b1fb68a729e1c92825190a39c" title="foedus::xct::XctId\l::get_epoch_int" alt="" coords="488,217,611,258"/>
<area shape="rect" id="node9" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52" title="8&#45;alignment. " alt="" coords="469,348,629,375"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_icgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_a9ee9788f623a51584b4fd7f8ded6103a_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Composer.html#af6d90399f471e1461fd4e59b0f3b923f" title="This is additionally called when no partitions observed any new modifications. " alt="" coords="207,39,385,80"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="433,39,660,80"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="708,31,919,87"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="967,5,1177,47"/>
<area shape="rect" id="node7" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="995,71,1149,112"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1225,5,1420,47"/>
<area shape="rect" id="node8" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1225,71,1420,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abea76692cff38e66aa4328401422488a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html">Composer::DropResult</a> foedus::storage::array::ArrayComposer::drop_volatiles </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html">Composer::DropVolatilesArguments</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>drop_volatiles and related methods </p>

<p>Definition at line <a class="el" href="array__composer__impl_8cpp_source.html#l00929">929</a> of file <a class="el" href="array__composer__impl_8cpp_source.html">array_composer_impl.cpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>, <a class="el" href="composer_8hpp_source.html#l00176">foedus::storage::Composer::DropResult::combine()</a>, <a class="el" href="composer_8hpp_source.html#l00202">foedus::storage::Composer::DropResult::dropped_all_</a>, <a class="el" href="storage__id_8hpp_source.html#l00095">foedus::storage::extract_numa_node_from_snapshot_pointer()</a>, <a class="el" href="array__storage__pimpl_8cpp_source.html#l00059">foedus::storage::array::ArrayStorage::get_array_metadata()</a>, <a class="el" href="attachable_8hpp_source.html#l00097">foedus::Attachable&lt; CONTROL_BLOCK &gt;::get_control_block()</a>, <a class="el" href="array__page__impl_8hpp_source.html#l00105">foedus::storage::array::ArrayPage::get_interior_record()</a>, <a class="el" href="storage_8hpp_source.html#l00155">foedus::storage::Storage&lt; CONTROL_BLOCK &gt;::get_name()</a>, <a class="el" href="array__page__impl_8hpp_source.html#l00070">foedus::storage::array::ArrayPage::is_leaf()</a>, <a class="el" href="storage__id_8hpp_source.html#l00210">foedus::storage::VolatilePagePointer::is_null()</a>, <a class="el" href="metadata_8hpp_source.html#l00098">foedus::storage::Metadata::keeps_all_volatile_pages()</a>, <a class="el" href="array__id_8hpp_source.html#l00110">foedus::storage::array::kInteriorFanout</a>, <a class="el" href="composer_8hpp_source.html#l00152">foedus::storage::Composer::DropVolatilesArguments::my_partition_</a>, <a class="el" href="composer_8hpp_source.html#l00154">foedus::storage::Composer::DropVolatilesArguments::partitioned_drop_</a>, <a class="el" href="storage__id_8hpp_source.html#l00307">foedus::storage::DualPagePointer::snapshot_pointer_</a>, and <a class="el" href="storage__id_8hpp_source.html#l00308">foedus::storage::DualPagePointer::volatile_pointer_</a>.</p>

<p>Referenced by <a class="el" href="composer_8cpp_source.html#l00083">foedus::storage::Composer::drop_volatiles()</a>.</p>
<div class="fragment"><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                                                                           {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  Composer::DropResult result(args);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="keywordflow">if</span> (storage_.<a class="code" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58">get_array_metadata</a>()-&gt;<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b">keeps_all_volatile_pages</a>()) {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Keep-all-volatile: Storage-&quot;</span> &lt;&lt; storage_.<a class="code" href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01">get_name</a>()</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; is configured to keep all volatile pages.&quot;</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    result.dropped_all_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  DualPagePointer* root_pointer = &amp;storage_.<a class="code" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">get_control_block</a>()-&gt;root_page_pointer_;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  ArrayPage* volatile_page = resolve_volatile(root_pointer-&gt;volatile_pointer_);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordflow">if</span> (volatile_page == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;No volatile root page. Probably while restart&quot;</span>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="comment">// single-page array has only the root page. nothing to do here.</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="comment">// we might drop the root page later, just like non-single-page cases.</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordflow">if</span> (volatile_page-&gt;is_leaf()) {</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Single-page array skipped by .&quot;</span>;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="comment">// We iterate through all existing volatile pages to drop volatile pages of</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="comment">// level-3 or deeper (if the storage has only 2 levels, keeps all).</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="comment">// this &quot;level-3 or deeper&quot; is a configuration per storage.</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="comment">// Even if the volatile page is deeper than that, we keep them if it contains newer modification,</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="comment">// including descendants (so, probably we will keep higher levels anyways).</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; <a class="code" href="group__ARRAY.html#gaaa3b4fa18b93d578250c8c8a5b613423">kInteriorFanout</a>; ++i) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    DualPagePointer&amp; child_pointer = volatile_page-&gt;get_interior_record(i);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">if</span> (!child_pointer.volatile_pointer_.is_null()) {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(child_pointer.snapshot_pointer_ != 0);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      uint16_t partition = <a class="code" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">extract_numa_node_from_snapshot_pointer</a>(child_pointer.snapshot_pointer_);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="keywordflow">if</span> (!args.partitioned_drop_ || partition == args.my_partition_) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        result.combine(drop_volatiles_recurse(args, &amp;child_pointer));</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      }</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// root page is kept at this point in this case. we need to check with other threads</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;}</div>
<div class="ttc" id="classfoedus_1_1storage_1_1array_1_1ArrayStorage_html_a145759e5113dca6d01be034ea5725f58"><div class="ttname"><a href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58">foedus::storage::array::ArrayStorage::get_array_metadata</a></div><div class="ttdeci">const ArrayMetadata * get_array_metadata() const </div><div class="ttdef"><b>Definition:</b> <a href="array__storage__pimpl_8cpp_source.html#l00059">array_storage_pimpl.cpp:59</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Metadata_html_a675df0db1a3c909581db949c10fd192b"><div class="ttname"><a href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b">foedus::storage::Metadata::keeps_all_volatile_pages</a></div><div class="ttdeci">bool keeps_all_volatile_pages() const </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8hpp_source.html#l00098">metadata.hpp:98</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1Storage_html_ac1b54d4e7f3ad9f7f7c17598911abb01"><div class="ttname"><a href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01">foedus::storage::Storage::get_name</a></div><div class="ttdeci">const StorageName &amp; get_name() const </div><div class="ttdoc">Returns the unique name of this storage. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00155">storage.hpp:155</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a8f6e96ac10eb804602349a54292d26a1"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1">foedus::storage::extract_numa_node_from_snapshot_pointer</a></div><div class="ttdeci">uint8_t extract_numa_node_from_snapshot_pointer(SnapshotPagePointer pointer)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00095">storage_id.hpp:95</a></div></div>
<div class="ttc" id="group__ARRAY_html_gaaa3b4fa18b93d578250c8c8a5b613423"><div class="ttname"><a href="group__ARRAY.html#gaaa3b4fa18b93d578250c8c8a5b613423">foedus::storage::array::kInteriorFanout</a></div><div class="ttdeci">const uint16_t kInteriorFanout</div><div class="ttdoc">Max number of entries in an interior page of array storage. </div><div class="ttdef"><b>Definition:</b> <a href="array__id_8hpp_source.html#l00110">array_id.hpp:110</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="classfoedus_1_1Attachable_html_a5b324e3abf302a59801aa73419bb4fad"><div class="ttname"><a href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad">foedus::Attachable::get_control_block</a></div><div class="ttdeci">CONTROL_BLOCK * get_control_block() const </div><div class="ttdef"><b>Definition:</b> <a href="attachable_8hpp_source.html#l00097">attachable.hpp:97</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_cgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_cgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_cgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_cgraph">
<area shape="rect" id="node2" href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html#a0cac5a92e42765bafd1fd54ca3200080" title="foedus::storage::Composer\l::DropResult::combine" alt="" coords="211,5,390,47"/>
<area shape="rect" id="node5" href="namespacefoedus_1_1storage.html#a8f6e96ac10eb804602349a54292d26a1" title="foedus::storage::extract\l_numa_node_from_snapshot\l_pointer" alt="" coords="207,71,395,127"/>
<area shape="rect" id="node6" href="classfoedus_1_1storage_1_1array_1_1ArrayStorage.html#a145759e5113dca6d01be034ea5725f58" title="foedus::storage::array\l::ArrayStorage::get_array\l_metadata" alt="" coords="217,151,385,207"/>
<area shape="rect" id="node7" href="classfoedus_1_1Attachable.html#a5b324e3abf302a59801aa73419bb4fad" title="foedus::Attachable\l::get_control_block" alt="" coords="235,232,367,273"/>
<area shape="rect" id="node8" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a53643894d607ee034359b2a4f77f0d89" title="foedus::storage::array\l::ArrayPage::get_interior\l_record" alt="" coords="219,298,382,354"/>
<area shape="rect" id="node9" href="classfoedus_1_1storage_1_1Storage.html#ac1b54d4e7f3ad9f7f7c17598911abb01" title="Returns the unique name of this storage. " alt="" coords="219,379,383,420"/>
<area shape="rect" id="node10" href="classfoedus_1_1storage_1_1array_1_1ArrayPage.html#a9c7bc21358a340d36f3c43a49f774b93" title="foedus::storage::array\l::ArrayPage::is_leaf" alt="" coords="227,444,375,485"/>
<area shape="rect" id="node11" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7" title="foedus::storage::Volatile\lPagePointer::is_null" alt="" coords="220,509,381,551"/>
<area shape="rect" id="node13" href="structfoedus_1_1storage_1_1Metadata.html#a675df0db1a3c909581db949c10fd192b" title="foedus::storage::Metadata\l::keeps_all_volatile_pages" alt="" coords="214,575,387,616"/>
<area shape="rect" id="node3" href="classfoedus_1_1Epoch.html#adf886b8b219538b7dac2da820fbec68c" title="Kind of std::max(this, other). " alt="" coords="443,13,617,39"/>
<area shape="rect" id="node4" href="classfoedus_1_1Epoch.html#a8228a1a49b7db9b93498a778cb40f8e9" title="foedus::Epoch::is_valid" alt="" coords="665,13,820,39"/>
<area shape="rect" id="node12" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6" title="foedus::storage::Volatile\lPagePointer::get_offset" alt="" coords="449,509,611,551"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_icgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_abea76692cff38e66aa4328401422488a_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1Composer.html#a0995635b97031b208127004382947acd" title="Drops volatile pages that have not been modified since the snapshotted epoch. " alt="" coords="207,39,385,80"/>
<area shape="rect" id="node3" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a26c51902174b692c91aedd15218f01b7" title="subroutine invoked by one thread for one node. " alt="" coords="433,31,617,87"/>
<area shape="rect" id="node4" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a5d474e7a6b4de127153103f2295cb0fa" title="Sub&#45;routine of handle_snapshot_triggered(). " alt="" coords="665,39,892,80"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="940,31,1151,87"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="1199,5,1409,47"/>
<area shape="rect" id="node8" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="1227,71,1381,112"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="1457,5,1652,47"/>
<area shape="rect" id="node9" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="1457,71,1652,112"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae9bd9d37f8a9c300dd188c5a23b938cd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string foedus::storage::array::ArrayComposer::to_string </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="array__composer__impl_8cpp_source.html#l00182">182</a> of file <a class="el" href="array__composer__impl_8cpp_source.html">array_composer_impl.cpp</a>.</p>

<p>Referenced by <a class="el" href="array__composer__impl_8cpp_source.html#l00066">compose()</a>.</p>
<div class="fragment"><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                         {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">return</span> std::string(<span class="stringliteral">&quot;ArrayComposer-&quot;</span>) + std::to_string(storage_id_);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ae9bd9d37f8a9c300dd188c5a23b938cd_icgraph.png" border="0" usemap="#classfoedus_1_1storage_1_1array_1_1ArrayComposer_ae9bd9d37f8a9c300dd188c5a23b938cd_icgraph" alt=""/></div>
<map name="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ae9bd9d37f8a9c300dd188c5a23b938cd_icgraph" id="classfoedus_1_1storage_1_1array_1_1ArrayComposer_ae9bd9d37f8a9c300dd188c5a23b938cd_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html#ab768c873a7e2b4a9ce2b4b1df39676ff" title="foedus::storage::array\l::ArrayComposer::compose" alt="" coords="232,5,413,47"/>
<area shape="rect" id="node3" href="classfoedus_1_1storage_1_1Composer.html#a28c752ec784b85418c0bfafab7ee60c0" title="Construct snapshot pages from sorted run files of one storage. " alt="" coords="461,5,640,47"/>
</map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/shino/foedus_code/foedus-core/include/foedus/storage/array/<a class="el" href="array__composer__impl_8hpp_source.html">array_composer_impl.hpp</a></li>
<li>/home/shino/foedus_code/foedus-core/src/foedus/storage/array/<a class="el" href="array__composer__impl_8cpp_source.html">array_composer_impl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefoedus.html">foedus</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage.html">storage</a></li><li class="navelem"><a class="el" href="namespacefoedus_1_1storage_1_1array.html">array</a></li><li class="navelem"><a class="el" href="classfoedus_1_1storage_1_1array_1_1ArrayComposer.html">ArrayComposer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
