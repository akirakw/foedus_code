<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: /home/shino/foedus_code/foedus-core/src/foedus/storage/hash/hash_storage_pimpl.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('hash__storage__pimpl_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">hash_storage_pimpl.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="hash__storage__pimpl_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (c) 2014-2015, Hewlett-Packard Development Company, LP.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify it</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * under the terms of the GNU General Public License as published by the Free</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Software Foundation; either version 2 of the License, or (at your option)</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * any later version.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful, but WITHOUT</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * more details. You should have received a copy of the GNU General Public</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * License along with this program; if not, write to the Free Software</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * HP designates this particular file as subject to the &quot;Classpath&quot; exception</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * as provided by HP in the LICENSE.txt file that accompanied this code.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__storage__pimpl_8hpp.html">foedus/storage/hash/hash_storage_pimpl.hpp</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;glog/logging.h&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="engine_8hpp.html">foedus/engine.hpp</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="assorted__func_8hpp.html">foedus/assorted/assorted_func.hpp</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cacheline_8hpp.html">foedus/assorted/cacheline.hpp</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__atomics_8hpp.html">foedus/assorted/raw_atomics.hpp</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="snapshot__file__set_8hpp.html">foedus/cache/snapshot_file_set.hpp</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="stop__watch_8hpp.html">foedus/debugging/stop_watch.hpp</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="log__type_8hpp.html">foedus/log/log_type.hpp</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="thread__log__buffer_8hpp.html">foedus/log/thread_log_buffer.hpp</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="engine__memory_8hpp.html">foedus/memory/engine_memory.hpp</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memory__id_8hpp.html">foedus/memory/memory_id.hpp</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="numa__core__memory_8hpp.html">foedus/memory/numa_core_memory.hpp</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="numa__node__memory_8hpp.html">foedus/memory/numa_node_memory.hpp</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="page__pool_8hpp.html">foedus/memory/page_pool.hpp</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="record_8hpp.html">foedus/storage/record.hpp</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="storage__manager_8hpp.html">foedus/storage/storage_manager.hpp</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="storage__manager__pimpl_8hpp.html">foedus/storage/storage_manager_pimpl.hpp</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__combo_8hpp.html">foedus/storage/hash/hash_combo.hpp</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__hashinate_8hpp.html">foedus/storage/hash/hash_hashinate.hpp</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__id_8hpp.html">foedus/storage/hash/hash_id.hpp</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__log__types_8hpp.html">foedus/storage/hash/hash_log_types.hpp</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__metadata_8hpp.html">foedus/storage/hash/hash_metadata.hpp</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__page__impl_8hpp.html">foedus/storage/hash/hash_page_impl.hpp</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__record__location_8hpp.html">foedus/storage/hash/hash_record_location.hpp</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__reserve__impl_8hpp.html">foedus/storage/hash/hash_reserve_impl.hpp</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash__storage_8hpp.html">foedus/storage/hash/hash_storage.hpp</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="thread_8hpp.html">foedus/thread/thread.hpp</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="xct_8hpp.html">foedus/xct/xct.hpp</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="xct__manager_8hpp.html">foedus/xct/xct_manager.hpp</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacefoedus.html">foedus</a> {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">namespace </span>storage {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keyword">namespace </span>hash {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a79c499b589d9e31709b066f1457bc1e3">   59</a></span>&#160;<a class="code" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a79c499b589d9e31709b066f1457bc1e3">HashStoragePimpl::drop</a>() {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Uninitializing an hash-storage &quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afdf4bd9f7349768099f6aaf621ff3a70">get_name</a>();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.volatile_pointer_.is_null()) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// release volatile pages</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">const</span> <a class="code" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html">memory::GlobalVolatilePageResolver</a>&amp; page_resolver</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      = <a class="code" href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">get_memory_manager</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0">get_global_volatile_page_resolver</a>();</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>* root = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      page_resolver.<a class="code" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f">resolve_offset</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.volatile_pointer_));</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    root-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a72474ba11f14c8e37ab6b9b3bd92d64b">release_pages_recursive_parallel</a>(<a class="code" href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">engine_</a>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.volatile_pointer_.word = 0;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a2823bcc0a488ad58faee46d876db8abe">   76</a></span>&#160;<a class="code" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a2823bcc0a488ad58faee46d876db8abe">HashStoragePimpl::create</a>(<span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashMetadata.html">HashMetadata</a>&amp; metadata) {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4f9309d223f938ee13a247f1a7b1da46">exists</a>()) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;This hash-storage already exists: &quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afdf4bd9f7349768099f6aaf621ff3a70">get_name</a>();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a0a03edf7d6ab7385275f50b23173dce8">kErrorCodeStrAlreadyExists</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// hash-specific check.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// Due to the current design of hash_partitioner, we spend hashbins bytes</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// out of the partitioner memory.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  uint64_t required_partitioner_bytes = metadata.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashMetadata.html#ac79017c3fbfd8dde111006ba43e97a5e">get_bin_count</a>() + 4096ULL;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  uint64_t partitioner_bytes</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    = <a class="code" href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">get_options</a>().<a class="code" href="structfoedus_1_1EngineOptions.html#a3e40cfe4530b10e87344b42be16927e1">storage_</a>.<a class="code" href="structfoedus_1_1storage_1_1StorageOptions.html#a127e9bf3b4309f1dafca757fc11ae6e5">partitioner_data_memory_mb_</a> * (1ULL &lt;&lt; 20);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// we don&#39;t bother checking other storages&#39; consumption. the config might later change anyways.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// Instead, leave a bit of margin (25%) for others.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">if</span> (partitioner_bytes &lt; required_partitioner_bytes * 1.25) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    std::stringstream str;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    str &lt;&lt; metadata &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;To accomodate this number of hash bins, partitioner_data_memory_mb_ must be&quot;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; at least &quot;</span> &lt;&lt; (required_partitioner_bytes * 1.25 / (1ULL &lt;&lt; 20));</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a>(<a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a3fbd07f82917c7d7458e01f87851a6f5">kErrorCodeStrHashBinsTooMany</a>, str.str().c_str());</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;meta_ = metadata;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Newly creating an hash-storage &quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afdf4bd9f7349768099f6aaf621ff3a70">get_name</a>();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;bin_count_ = 1ULL &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>();</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;levels_ = <a class="code" href="group__HASH.html#gacfc9ccab28ee4ffc1a7317ec51b332f4">bins_to_level</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;bin_count_);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;levels_ &gt;= 1U);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;bin_count_ &lt;= <a class="code" href="group__HASH.html#gad584a49d2de255afd325aa2ddbb7e726">fanout_power</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;levels_));</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;bin_count_ &gt; <a class="code" href="group__HASH.html#gad584a49d2de255afd325aa2ddbb7e726">fanout_power</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;levels_ - 1U));</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;bin_count=&quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a38d765f971d163f274b24fa920565074">get_bin_count</a>() &lt;&lt; <span class="stringliteral">&quot;, levels=&quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4120c099e570a27e391917bc7f76ca07">get_levels</a>());</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// small number of root pages. we should at least have that many free pages.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// so far grab all of them from node 0. no round robbin</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keyword">const</span> uint16_t kTheNode = 0;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="classfoedus_1_1memory_1_1PagePool.html">memory::PagePool</a>* pool</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    = <a class="code" href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">get_memory_manager</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8">get_node_memory</a>(kTheNode)-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774">get_volatile_pool</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1memory_1_1LocalPageResolver.html">memory::LocalPageResolver</a> &amp;local_resolver = pool-&gt;<a class="code" href="classfoedus_1_1memory_1_1PagePool.html#a18916c76eea7aa49572e69e48e75717e">get_resolver</a>();</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="comment">// allocate only the root page</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a> root_offset;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a>(pool-&gt;<a class="code" href="classfoedus_1_1memory_1_1PagePool.html#a3e9390381783077a504116988cae05c4">grab_one</a>(&amp;root_offset));</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root_offset);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>* root_page = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    local_resolver.<a class="code" href="structfoedus_1_1memory_1_1LocalPageResolver.html#aa9d2266686c3a66678b37241a3ac434f">resolve_offset_newpage</a>(root_offset));</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.snapshot_pointer_ = 0;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.volatile_pointer_.set(kTheNode, root_offset);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  root_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#aeb01df00186ad7f69875d7bd1ff0108e">initialize_volatile_page</a>(</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(),</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.volatile_pointer_,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;levels_ - 1U,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    0);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  root_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a949b3f4b505de0f1595eabf801d37741">assert_range</a>();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Newly created an hash-storage &quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afdf4bd9f7349768099f6aaf621ff3a70">get_name</a>();</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;status_ = <a class="code" href="group__STORAGE.html#ggaa532fc59a87dc23b6d432d444e98d63fadb3a41d3a531bce354f2df2aebef8dd1">kExists</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a44bc6cd5427daadbee9fd6fcc366af09">  135</a></span>&#160;<a class="code" href="classfoedus_1_1ErrorStack.html">ErrorStack</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a44bc6cd5427daadbee9fd6fcc366af09">HashStoragePimpl::load</a>(<span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1StorageControlBlock.html">StorageControlBlock</a>&amp; snapshot_block) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;meta_ = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashMetadata.html">HashMetadata</a>&amp;<span class="keyword">&gt;</span>(snapshot_block.<a class="code" href="structfoedus_1_1storage_1_1StorageControlBlock.html#ae20f48002ac04f92b32085ee52a56ed0">meta_</a>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashMetadata.html">HashMetadata</a>&amp; meta = <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;meta_;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;bin_count_ = 1ULL &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;levels_ = <a class="code" href="group__HASH.html#gacfc9ccab28ee4ffc1a7317ec51b332f4">bins_to_level</a>(<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;bin_count_);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.snapshot_pointer_ = meta.<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">root_snapshot_page_id_</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.volatile_pointer_.word = 0;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// Root page always has volatile version.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// Construct it from snapshot version.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="classfoedus_1_1cache_1_1SnapshotFileSet.html">cache::SnapshotFileSet</a> fileset(<a class="code" href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">engine_</a>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(fileset.<a class="code" href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff">initialize</a>());</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <a class="code" href="classfoedus_1_1UninitializeGuard.html">UninitializeGuard</a> fileset_guard(&amp;fileset, <a class="code" href="classfoedus_1_1UninitializeGuard.html#ae6caa12ca9b75a22b53c2eed31402721af0067551d00455a2a16416216de53568">UninitializeGuard::kWarnIfUninitializeError</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">// load root page</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html">VolatilePagePointer</a> volatile_pointer;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>* volatile_root;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(<a class="code" href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">get_memory_manager</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1EngineMemory.html#a3c3c8902b7000d09878a5a2085f6058c">load_one_volatile_page</a>(</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    &amp;fileset,</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    meta.<a class="code" href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">root_snapshot_page_id_</a>,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    &amp;volatile_pointer,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    reinterpret_cast&lt;Page**&gt;(&amp;volatile_root)));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_.volatile_pointer_ = volatile_pointer;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a>(fileset.<a class="code" href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb">uninitialize</a>());</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Loaded a hash-storage &quot;</span> &lt;&lt; <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afdf4bd9f7349768099f6aaf621ff3a70">get_name</a>();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;status_ = <a class="code" href="group__STORAGE.html#ggaa532fc59a87dc23b6d432d444e98d63fadb3a41d3a531bce354f2df2aebef8dd1">kExists</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">kRetOk</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a222e0d485305f3253b0e1c97720dc0c8">  166</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a222e0d485305f3253b0e1c97720dc0c8">HashStoragePimpl::get_record</a>(</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">void</span>* payload,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  uint16_t* payload_capacity,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">bool</span> read_only) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">locate_bin</a>(context, !read_only, combo, &amp;bin_head));</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">if</span> (!bin_head) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by pointer set, so we are done</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> location;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">locate_record_logical</a>(</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    context,</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    !read_only,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    0,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    key,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    key_length,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    combo,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    bin_head,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    &amp;location));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">if</span> (!location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>()) {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by page version set, so we are done</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// here, we do NOT have to do another optimistic-read protocol because we already took</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="comment">// the owner_id into read-set. If this read is corrupted, we will be aware of it at commit time.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  uint16_t payload_length = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a7ffd03d39f3e621a793778168ace8046">cur_payload_length_</a>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">if</span> (payload_length &gt; *payload_capacity) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// buffer too small</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    DVLOG(0) &lt;&lt; <span class="stringliteral">&quot;buffer too small??&quot;</span> &lt;&lt; payload_length &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; *payload_capacity;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    *payload_capacity = payload_length;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56ae0409810fc5028d8885fe6025cb6fdbe">kErrorCodeStrTooSmallPayloadBuffer</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  *payload_capacity = payload_length;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  uint16_t key_offset = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#abed92a9a4809cce3c1cc33bc4fb07a81">get_aligned_key_length</a>();</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  std::memcpy(payload, location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab32e08d4ebb188cd7293a568e4185950">record_</a> + key_offset, payload_length);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4eff8bc4e42a5973c8553830890d8a24">  210</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4eff8bc4e42a5973c8553830890d8a24">HashStoragePimpl::get_record_part</a>(</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordtype">void</span>* payload,</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  uint16_t payload_offset,</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  uint16_t payload_count,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordtype">bool</span> read_only) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">locate_bin</a>(context, !read_only, combo, &amp;bin_head));</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">if</span> (!bin_head) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by pointer set, so we are done</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> location;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">locate_record_logical</a>(</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    context,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    !read_only,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    0,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    key,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    key_length,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    combo,</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    bin_head,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    &amp;location));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">if</span> (!location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>()) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by page version set, so we are done</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  uint16_t payload_length = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a7ffd03d39f3e621a793778168ace8046">cur_payload_length_</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (payload_length &lt; payload_offset + payload_count) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;short record &quot;</span> &lt;&lt; combo;  <span class="comment">// probably this is a rare error. so warn.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a947e657c9c51f0108e55d6792089345a">kErrorCodeStrTooShortPayload</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  uint16_t key_offset = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#abed92a9a4809cce3c1cc33bc4fb07a81">get_aligned_key_length</a>();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  std::memcpy(payload, location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab32e08d4ebb188cd7293a568e4185950">record_</a> + key_offset + payload_offset, payload_count);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="namespacefoedus_1_1storage_1_1hash.html#a621860b1314f5eecc0e41d3972340bf9">  250</a></span>&#160;uint16_t <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a621860b1314f5eecc0e41d3972340bf9">adjust_payload_hint</a>(uint16_t payload_count, uint16_t physical_payload_hint) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(physical_payload_hint &gt;= payload_count);  <span class="comment">// if not, most likely misuse.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span> (physical_payload_hint &lt; payload_count) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    physical_payload_hint = payload_count;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  physical_payload_hint = <a class="code" href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52">assorted::align8</a>(physical_payload_hint);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">return</span> physical_payload_hint;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">  260</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">HashStoragePimpl::register_record_write_log</a>(</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a>&amp; location,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="structfoedus_1_1log_1_1RecordLogType.html">log::RecordLogType</a>* log_entry) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// If we have taken readset in locate_record, add as a related write set</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>());</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keyword">auto</span>* slot = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a093b20c41f026d8cec9c39eab2149531">page_</a>-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ab696a16e6a995a515736ff0a28b47885">get_slot_address</a>(location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a9bb073e86887f562d049b2d0a2e726cd">index_</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">char</span>* record = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab32e08d4ebb188cd7293a568e4185950">record_</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1Xct.html">xct::Xct</a>* cur_xct = &amp;context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3">get_current_xct</a>();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a10e3254ae3fdff2451ba6358ea477bad">readset_</a>) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span> cur_xct-&gt;<a class="code" href="classfoedus_1_1xct_1_1Xct.html#aa23025809d9c2fdff744f98f78c3882a">add_related_write_set</a>(location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a10e3254ae3fdff2451ba6358ea477bad">readset_</a>, &amp;slot-&gt;tid_, record, log_entry);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">return</span> cur_xct-&gt;<a class="code" href="classfoedus_1_1xct_1_1Xct.html#a7dad4e0e5a6770ee941bd365410f9b6a">add_to_write_set</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(), &amp;slot-&gt;tid_, record, log_entry);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#ac9c35890555ddb10d908b77602a1f28c">  277</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#ac9c35890555ddb10d908b77602a1f28c">HashStoragePimpl::insert_record</a>(</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* payload,</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  uint16_t payload_count,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  uint16_t physical_payload_hint) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  physical_payload_hint = <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a621860b1314f5eecc0e41d3972340bf9">adjust_payload_hint</a>(payload_count, physical_payload_hint);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">locate_bin</a>(context, <span class="keyword">true</span>, combo, &amp;bin_head));</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {  <span class="comment">// we might retry due to migrate_record. not that often, tho.</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> location;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">locate_record_logical</a>(</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      context,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keyword">true</span>,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keyword">true</span>,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      physical_payload_hint,</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      key,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      key_length,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      combo,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      bin_head,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      &amp;location));</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// we create if not exists, these are surely non-null</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>());</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab32e08d4ebb188cd7293a568e4185950">record_</a>);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">// but, that record might be not logically deleted</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (!location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148">is_deleted</a>()) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56adfc9588c95653090f65a029c574bfc9c">kErrorCodeStrKeyAlreadyExists</a>;  <span class="comment">// protected by the read set</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span> (payload_count &gt; location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#af4125da7e85cd2da82d64b8aa3eb9e81">get_max_payload</a>()) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="comment">// The physical record is too short. It will trigger a record expansion, which is a</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="comment">// system transaction (logically does nothing!) to migrate this deleted record.</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* cur_page = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a093b20c41f026d8cec9c39eab2149531">page_</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!cur_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2169cfc93933b2b35fea60fe8be9cf8">bloom_filter</a>().<a class="code" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a4e5601b652daaffbcb9fa81aee6746c6">contains</a>(combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">fingerprint_</a>));</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> cur_index = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a9bb073e86887f562d049b2d0a2e726cd">index_</a>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      DVLOG(2) &lt;&lt; <span class="stringliteral">&quot;Record expansion triggered. payload_count=&quot;</span> &lt;&lt; payload_count</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, current max=&quot;</span> &lt;&lt; location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#af4125da7e85cd2da82d64b8aa3eb9e81">get_max_payload</a>()</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, size hint=&quot;</span> &lt;&lt; physical_payload_hint;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html">ReserveRecords</a> functor(</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        context,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        cur_page,</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        key,</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        key_length,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        combo,</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        payload_count,</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        physical_payload_hint,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        cur_index);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a2a5e6b008138d755e7e401f25927400c">run_nested_sysxct</a>(&amp;functor, 5U));</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      DVLOG(2) &lt;&lt; <span class="stringliteral">&quot;Expanded record!&quot;</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="comment">// need to re-locate. also, beacuse the above method is physical-only,</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// the moved location might be again moved or now deleted. easise to just retry.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    uint16_t log_length = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">HashInsertLogType::calculate_log_length</a>(key_length, payload_count);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html">HashInsertLogType</a>* log_entry = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html">HashInsertLogType</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">get_thread_log_buffer</a>().<a class="code" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">reserve_new_log</a>(log_length));</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    log_entry-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html#abd3dbdbe4f6d69957367a01e7576882a">populate</a>(</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(),</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      key,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      key_length,</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>(),</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      payload,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      payload_count);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">register_record_write_log</a>(context, location, log_entry);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a357386c8e5be667334520a33aff51725">  356</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a357386c8e5be667334520a33aff51725">HashStoragePimpl::delete_record</a>(</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">locate_bin</a>(context, <span class="keyword">true</span>, combo, &amp;bin_head));</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> location;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">locate_record_logical</a>(</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    context,</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">true</span>,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    0,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    key,</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    key_length,</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    combo,</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    bin_head,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    &amp;location));</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">if</span> (!location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>()) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by page version set, so we are done</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148">is_deleted</a>()) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by the read set</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  uint16_t log_length = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">HashDeleteLogType::calculate_log_length</a>(key_length, 0);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDeleteLogType.html">HashDeleteLogType</a>* log_entry = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDeleteLogType.html">HashDeleteLogType</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">get_thread_log_buffer</a>().<a class="code" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">reserve_new_log</a>(log_length));</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  log_entry-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDeleteLogType.html#a3c2ca8fb362ef7876a14e22608b9aa35">populate</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(), key, key_length, <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>(), combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">register_record_write_log</a>(context, location, log_entry);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a49df48b50c0c645d3a047e8b153c4015">  390</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a49df48b50c0c645d3a047e8b153c4015">HashStoragePimpl::upsert_record</a>(</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* payload,</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  uint16_t payload_count,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  uint16_t physical_payload_hint) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  physical_payload_hint = <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a621860b1314f5eecc0e41d3972340bf9">adjust_payload_hint</a>(payload_count, physical_payload_hint);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// Upsert is a combination of what insert does and what delete does.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="comment">// If there isn&#39;t an existing physical record, it&#39;s exactly same as insert.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">// If there is, it&#39;s _basically_ a delete followed by an insert.</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="comment">// There are a few complications, depending on the status of the record.</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">locate_bin</a>(context, <span class="keyword">true</span>, combo, &amp;bin_head));</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {  <span class="comment">// we might retry due to migrate_record. not that often, tho.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> location;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">locate_record_logical</a>(</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      context,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keyword">true</span>,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keyword">true</span>,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      physical_payload_hint,</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      key,</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      key_length,</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      combo,</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      bin_head,</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      &amp;location));</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// we create if not exists, these are surely non-null</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>());</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab32e08d4ebb188cd7293a568e4185950">record_</a>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// Whether currently deleted or not, migrate it to make sure the record is long enough.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">if</span> (payload_count &gt; location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#af4125da7e85cd2da82d64b8aa3eb9e81">get_max_payload</a>()) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* cur_page = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a093b20c41f026d8cec9c39eab2149531">page_</a>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!cur_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2169cfc93933b2b35fea60fe8be9cf8">bloom_filter</a>().<a class="code" href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a4e5601b652daaffbcb9fa81aee6746c6">contains</a>(combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">fingerprint_</a>));</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> cur_index = location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a9bb073e86887f562d049b2d0a2e726cd">index_</a>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      DVLOG(2) &lt;&lt; <span class="stringliteral">&quot;Record expansion triggered. payload_count=&quot;</span> &lt;&lt; payload_count</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, current max=&quot;</span> &lt;&lt; location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#af4125da7e85cd2da82d64b8aa3eb9e81">get_max_payload</a>()</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, size hint=&quot;</span> &lt;&lt; physical_payload_hint;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html">ReserveRecords</a> functor(</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        context,</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        cur_page,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        key,</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        key_length,</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        combo,</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        payload_count,</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        physical_payload_hint,</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        cur_index);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a2a5e6b008138d755e7e401f25927400c">run_nested_sysxct</a>(&amp;functor, 5U));</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      DVLOG(2) &lt;&lt; <span class="stringliteral">&quot;Expanded record!&quot;</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// need to re-locate the record. retry.</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(payload_count &lt;= location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#af4125da7e85cd2da82d64b8aa3eb9e81">get_max_payload</a>());</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html">HashCommonLogType</a>* log_common;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148">is_deleted</a>()) {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">// If it&#39;s a deleted record, this turns to be a plain insert.</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      uint16_t log_length = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">HashInsertLogType::calculate_log_length</a>(key_length, payload_count);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html">HashInsertLogType</a>* log_entry = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html">HashInsertLogType</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">get_thread_log_buffer</a>().<a class="code" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">reserve_new_log</a>(log_length));</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      log_entry-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html#abd3dbdbe4f6d69957367a01e7576882a">populate</a>(</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(),</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        key,</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        key_length,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>(),</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        payload,</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        payload_count);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      log_common = log_entry;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a7ffd03d39f3e621a793778168ace8046">cur_payload_length_</a> == payload_count) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="comment">// If it&#39;s not changing payload size of existing record, we can conver it to an overwrite,</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="comment">// which is more efficient</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      uint16_t log_length = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">HashUpdateLogType::calculate_log_length</a>(key_length, payload_count);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html">HashOverwriteLogType</a>* log_entry = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html">HashOverwriteLogType</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">get_thread_log_buffer</a>().<a class="code" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">reserve_new_log</a>(log_length));</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      log_entry-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html#a29bf2faaed91770de679b2e836ffa3b8">populate</a>(</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(),</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        key,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        key_length,</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>(),</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        payload,</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        0,</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        payload_count);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      log_common = log_entry;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="comment">// If not, this is an update operation.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      uint16_t log_length = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">HashUpdateLogType::calculate_log_length</a>(key_length, payload_count);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashUpdateLogType.html">HashUpdateLogType</a>* log_entry = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashUpdateLogType.html">HashUpdateLogType</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">get_thread_log_buffer</a>().<a class="code" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">reserve_new_log</a>(log_length));</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      log_entry-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashUpdateLogType.html#af538b6dfae547586f1bd65cf8a879c15">populate</a>(</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(),</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        key,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        key_length,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>(),</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        payload,</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        payload_count);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      log_common = log_entry;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">register_record_write_log</a>(context, location, log_common);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;}</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#add8aafbb32713dc6be20804da789f43d">  502</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#add8aafbb32713dc6be20804da789f43d">HashStoragePimpl::overwrite_record</a>(</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context ,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* payload,</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  uint16_t payload_offset,</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  uint16_t payload_count) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">locate_bin</a>(context, <span class="keyword">true</span>, combo, &amp;bin_head));</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> location;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">locate_record_logical</a>(</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    context,</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keyword">true</span>,</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    0,</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    key,</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    key_length,</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    combo,</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    bin_head,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    &amp;location));</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">if</span> (!location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>()) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by page version set, so we are done</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148">is_deleted</a>()) {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by the read set</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a7ffd03d39f3e621a793778168ace8046">cur_payload_length_</a> &lt; payload_offset + payload_count) {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;short record &quot;</span> &lt;&lt; combo;  <span class="comment">// probably this is a rare error. so warn.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a947e657c9c51f0108e55d6792089345a">kErrorCodeStrTooShortPayload</a>;  <span class="comment">// protected by the read set</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  uint16_t log_length = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">HashOverwriteLogType::calculate_log_length</a>(key_length, payload_count);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html">HashOverwriteLogType</a>* log_entry = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html">HashOverwriteLogType</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">get_thread_log_buffer</a>().<a class="code" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">reserve_new_log</a>(log_length));</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  log_entry-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html#a29bf2faaed91770de679b2e836ffa3b8">populate</a>(</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(),</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    key,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    key_length,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>(),</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    payload,</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    payload_offset,</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    payload_count);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="comment">// overwrite_record is apparently a blind-write, but actually it&#39;s not.</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">// we depend on the fact that the record was not deleted/moved! so,</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// this still has a related/dependent read-set</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">register_record_write_log</a>(context, location, log_entry);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;}</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> PAYLOAD&gt;</div>
<div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a233fcd7ffd24bd59d2d0943af3d0de03">  554</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a233fcd7ffd24bd59d2d0943af3d0de03">HashStoragePimpl::increment_record</a>(</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  PAYLOAD* value,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  uint16_t payload_offset) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">locate_bin</a>(context, <span class="keyword">true</span>, combo, &amp;bin_head));</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> location;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">locate_record_logical</a>(</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    context,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keyword">true</span>,</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    0,</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    key,</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    key_length,</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    combo,</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    bin_head,</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    &amp;location));</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">if</span> (!location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">is_found</a>()) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by page version set, so we are done</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148">is_deleted</a>()) {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">kErrorCodeStrKeyNotFound</a>;  <span class="comment">// protected by the read set</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a7ffd03d39f3e621a793778168ace8046">cur_payload_length_</a> &lt; payload_offset + <span class="keyword">sizeof</span>(PAYLOAD)) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;short record &quot;</span> &lt;&lt; combo;  <span class="comment">// probably this is a rare error. so warn.</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a947e657c9c51f0108e55d6792089345a">kErrorCodeStrTooShortPayload</a>;  <span class="comment">// protected by the read set</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">// value: (in) addendum, (out) value after addition.</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  PAYLOAD* current = <span class="keyword">reinterpret_cast&lt;</span>PAYLOAD*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab32e08d4ebb188cd7293a568e4185950">record_</a> + location.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#abed92a9a4809cce3c1cc33bc4fb07a81">get_aligned_key_length</a>() + payload_offset);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  *value += *current;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  uint16_t log_length</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    = <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">HashOverwriteLogType::calculate_log_length</a>(key_length, <span class="keyword">sizeof</span>(PAYLOAD));</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html">HashOverwriteLogType</a>* log_entry = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html">HashOverwriteLogType</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">get_thread_log_buffer</a>().<a class="code" href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">reserve_new_log</a>(log_length));</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  log_entry-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html#a29bf2faaed91770de679b2e836ffa3b8">populate</a>(</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">get_id</a>(),</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    key,</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    key_length,</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">get_bin_bits</a>(),</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    value,</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    payload_offset,</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keyword">sizeof</span>(PAYLOAD));</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">register_record_write_log</a>(context, location, log_entry);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;}</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538">  607</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538">HashStoragePimpl::get_root_page</a>(</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordtype">bool</span> for_write,</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>** root) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6">follow_page_pointer</a>(</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keyword">nullptr</span>,  <span class="comment">// guaranteed to be non-null</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keyword">false</span>,    <span class="comment">// guaranteed to be non-null</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    for_write,</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keyword">false</span>,    <span class="comment">// guaranteed to be non-null</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    &amp;<a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;root_page_pointer_,</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    reinterpret_cast&lt;Page**&gt;(root),</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keyword">nullptr</span>,  <span class="comment">// no parent. it&#39;s root.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    0));</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>((*root)-&gt;header().get_page_type() == <a class="code" href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5baa295f358dce197aac9c593ba56d89714">kHashIntermediatePageType</a>);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>((*root)-&gt;get_level() + 1U == <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;levels_);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;}</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f">  625</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f">HashStoragePimpl::follow_page</a>(</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordtype">bool</span> for_write,</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>* parent,</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  uint16_t index_in_parent,</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1Page.html">Page</a>** page) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(index_in_parent &lt; <a class="code" href="group__HASH.html#ga4398665205e13bd71e8b2c1691ba1ba3">kHashIntermediatePageFanout</a>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(parent);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956">get_page_type</a>() == <a class="code" href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5baa295f358dce197aac9c593ba56d89714">kHashIntermediatePageType</a>);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keywordtype">bool</span> is_parent_snapshot = parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  uint8_t parent_level = parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f">get_level</a>();</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!is_parent_snapshot || !for_write);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html">DualPagePointer</a>&amp; pointer = parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a9027ebbc2ee535519916906978347be9">get_pointer</a>(index_in_parent);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordtype">bool</span> child_intermediate = (parent_level &gt; 0);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">if</span> (is_parent_snapshot) {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// if we are in snapshot world, there is no choice.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// separating this out also handles SI level well.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!for_write);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (pointer.<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a> == 0) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      *page = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487">find_or_read_a_snapshot_page</a>(pointer.<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a>, page));</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>((*page)-&gt;get_header().snapshot_);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (child_intermediate) {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6">follow_page_pointer</a>(</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <a class="code" href="group__ARRAY.html#ga2823bcd484e4e7cb47ceca880584000a">hash_intermediate_volatile_page_init</a>,</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      !for_write,  <span class="comment">// null page is a valid result only for reads (&quot;not found&quot;)</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      for_write,</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keyword">true</span>,   <span class="comment">// if we jump to snapshot page, we need to add it to pointer set for serializability.</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      &amp;pointer,</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      page,</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      reinterpret_cast&lt;Page*&gt;(parent),</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      index_in_parent));</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="comment">// we are in a level-0 volatile page. so the pointee is a bin-head.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">// we need a bit special handling in this case</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02">follow_page_bin_head</a>(context, for_write, parent, index_in_parent, page));</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordflow">if</span> (*page) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span> (child_intermediate) {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>((*page)-&gt;get_page_type() == <a class="code" href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5baa295f358dce197aac9c593ba56d89714">kHashIntermediatePageType</a>);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>((*page)-&gt;get_header().get_in_layer_level() + 1U == parent_level);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>((*page)-&gt;get_page_type() == <a class="code" href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5ba6c1740f811f2524fac6cd76aa2a31c6c">kHashDataPageType</a>);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(reinterpret_cast&lt;HashDataPage*&gt;(*page)-&gt;get_bin()</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        == parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#ac5e2de81d5e512b5a0f735a9fc413629">get_bin_range</a>().<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashBinRange.html#a6404bfe127e6686aaac2b490450c2cb7">begin_</a> + index_in_parent);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02">  679</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02">HashStoragePimpl::follow_page_bin_head</a>(</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordtype">bool</span> for_write,</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>* parent,</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  uint16_t index_in_parent,</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1Page.html">Page</a>** page) {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">// do we have to newly create a volatile version of the pointed bin?</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956">get_page_type</a>() == <a class="code" href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5baa295f358dce197aac9c593ba56d89714">kHashIntermediatePageType</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f">get_level</a>() == 0);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1Xct.html">xct::Xct</a>&amp; cur_xct = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3">get_current_xct</a>();</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <a class="code" href="group__XCT.html#ga9ac5dae4b91a288e9d887f28a7124c13">xct::IsolationLevel</a> isolation = cur_xct.<a class="code" href="classfoedus_1_1xct_1_1Xct.html#abae2ae5210db8eda39a1507940bf7352">get_isolation_level</a>();</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html">DualPagePointer</a>* pointer = parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#aa72388dc98c566a63c723184449a830f">get_pointer_address</a>(index_in_parent);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="comment">// otherwise why in volatile page.</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(for_write || isolation != <a class="code" href="group__XCT.html#gga9ac5dae4b91a288e9d887f28a7124c13a993994249cc0179cf24c63cc329e7934">xct::kSnapshot</a> || pointer-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a> == 0);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="comment">// in other words, we can safely &quot;prefer&quot; volatile page here.</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">if</span> (!pointer-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>()) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    *page = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ade1f89cfaad84ff5dda0b6f7999a519e">resolve</a>(pointer-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> snapshot_pointer = pointer-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">if</span> (!for_write) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="comment">// reads don&#39;t have to create a new page. easy</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">if</span> (snapshot_pointer == 0) {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        *page = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487">find_or_read_a_snapshot_page</a>(snapshot_pointer, page));</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordflow">if</span> (isolation == <a class="code" href="group__XCT.html#gga9ac5dae4b91a288e9d887f28a7124c13a5e9c22688eea55cea2bf4380b03a8630">xct::kSerializable</a>) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html">VolatilePagePointer</a> null_pointer;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        null_pointer.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#aa8c59b8e2944d4a6a68d5fed840a7a29">clear</a>();</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        cur_xct.add_to_pointer_set(&amp;(pointer-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>), null_pointer);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="comment">// writes need the volatile version.</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="keywordflow">if</span> (snapshot_pointer == 0) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="comment">// The bin is completely empty. we just make a new empty page.</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6">follow_page_pointer</a>(</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          <a class="code" href="group__ARRAY.html#ga8423aae479f4b36ddc54127b07268c8c">hash_data_volatile_page_init</a>,</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;          <span class="keyword">false</span>,</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;          <span class="keyword">true</span>,</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;          <span class="keyword">true</span>,</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;          pointer,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          page,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;          reinterpret_cast&lt;Page*&gt;(parent),</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;          index_in_parent));</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="comment">// Otherwise, we must create a volatile version of the existing page.</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="comment">// a special rule for hash storage in this case: we create/drop volatile versions</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="comment">// in the granularity of hash bin. all or nothing.</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="comment">// thus, not just the head page of the bin, we have to volatilize the entire bin.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <a class="code" href="classfoedus_1_1memory_1_1NumaCoreMemory.html">memory::NumaCoreMemory</a>* core_memory = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e">get_thread_memory</a>();</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keyword">const</span> <a class="code" href="structfoedus_1_1memory_1_1LocalPageResolver.html">memory::LocalPageResolver</a>&amp; local_resolver</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ac8953b86c90ec5ee1730b05397a259da">get_local_volatile_page_resolver</a>();</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html">VolatilePagePointer</a> head_page_id = core_memory-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98">grab_free_volatile_page_pointer</a>();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> offset = head_page_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6">get_offset</a>();</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(head_page_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>())) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a2ddd0cd462e4ae138f0e572106ad098c">kErrorCodeMemoryNoFreePages</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* head_page</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>*<span class="keyword">&gt;</span>(local_resolver.<a class="code" href="structfoedus_1_1memory_1_1LocalPageResolver.html#aa9d2266686c3a66678b37241a3ac434f">resolve_offset_newpage</a>(offset));</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <a class="code" href="structfoedus_1_1storage_1_1Page.html">storage::Page</a>* snapshot_head;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> code = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487">find_or_read_a_snapshot_page</a>(snapshot_pointer, &amp;snapshot_head);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">if</span> (code != <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>) {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;          core_memory-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#a6c9bf7d6b21ac33a61d6f7176023ea3a">release_free_volatile_page</a>(offset);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          <span class="keywordflow">return</span> code;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        }</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        std::memcpy(head_page, snapshot_head, <a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(head_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        head_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        head_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a59128590fdc568e894a8973a319a0154">page_id_</a> = head_page_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a8bb6c37c44056c5f986f6dd164b5b23a">word</a>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="comment">// load following pages. hopefully this is a rare case.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> last_error = <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(head_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32">next_page</a>().<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a>)) {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* cur_page = head_page;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(last_error == <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> next = cur_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32">next_page</a>().<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="keywordflow">if</span> (next == 0) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            DVLOG(1) &lt;&lt; <span class="stringliteral">&quot;Following next-link in hash data pages. Hopefully it&#39;s not that long..&quot;</span>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html">VolatilePagePointer</a> next_page_id = core_memory-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98">grab_free_volatile_page_pointer</a>();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <a class="code" href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">memory::PagePoolOffset</a> next_offset = next_page_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6">get_offset</a>();</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(next_page_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>())) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;              <span class="comment">// we have to release preceding pages too</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;              last_error = <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a2ddd0cd462e4ae138f0e572106ad098c">kErrorCodeMemoryNoFreePages</a>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            }</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* next_page</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;              = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>*<span class="keyword">&gt;</span>(local_resolver.<a class="code" href="structfoedus_1_1memory_1_1LocalPageResolver.html#aa9d2266686c3a66678b37241a3ac434f">resolve_offset_newpage</a>(next_offset));</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <span class="comment">// immediately install because:</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <span class="comment">// 1) we don&#39;t have any race here, 2) we need to follow them to release on error.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            <a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html">DualPagePointer</a>* target = cur_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a6286d91dcdb8b6455e20bc770155a0be">next_page_address</a>();</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(target-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>());</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            target-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a> = next_page_id;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            target-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a> = 0;  <span class="comment">// will be no longer used, let&#39;s clear them</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <a class="code" href="structfoedus_1_1storage_1_1Page.html">storage::Page</a>* snapshot_page;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            last_error = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487">find_or_read_a_snapshot_page</a>(next, &amp;snapshot_page);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="keywordflow">if</span> (last_error != <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>) {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            std::memcpy(next_page, snapshot_page, <a class="code" href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">kPageSize</a>);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(next_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(next_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd">get_bin</a>() == cur_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd">get_bin</a>());</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            next_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            next_page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a59128590fdc568e894a8973a319a0154">page_id_</a> = next_page_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a8bb6c37c44056c5f986f6dd164b5b23a">word</a>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            cur_page = next_page;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;          }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="comment">// all rihgt, now atomically install the pointer to the volatile head page.</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordtype">bool</span> must_release_pages = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span> (last_error == <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;          uint64_t expected = 0;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;          <span class="keywordflow">if</span> (assorted::raw_atomic_compare_exchange_strong&lt;uint64_t&gt;(</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            &amp;(pointer-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a8bb6c37c44056c5f986f6dd164b5b23a">word</a>),</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            &amp;expected,</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            head_page_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a8bb6c37c44056c5f986f6dd164b5b23a">word</a>)) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="comment">// successfully installed the head pointer. fine.</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            *page = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1Page.html">Page</a>*<span class="keyword">&gt;</span>(head_page);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(expected);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="comment">// someone else has installed it, which is also fine.</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="comment">// but, we must release pages we created (which turned out to be a waste effort)</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Interesting. Someone else has installed a volatile version.&quot;</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            *page = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ade1f89cfaad84ff5dda0b6f7999a519e">resolve</a>(pointer-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            must_release_pages = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          must_release_pages = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">if</span> (must_release_pages) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;          <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* cur = head_page;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html">VolatilePagePointer</a> cur_id = <a class="code" href="namespacefoedus_1_1storage.html#a67e1af2de6e13b000e66609cf60849b6">construct_volatile_page_pointer</a>(cur-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a59128590fdc568e894a8973a319a0154">page_id_</a>);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(cur_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077">get_numa_node</a>() == context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#aa07f33f2b78aa6e6c66a2149b1db52e8">get_numa_node</a>());</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!cur_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>());</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <span class="comment">// retrieve next_id BEFORE releasing (revoking) cur page.</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html">VolatilePagePointer</a> next_id = cur-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32">next_page</a>().<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            core_memory-&gt;<a class="code" href="classfoedus_1_1memory_1_1NumaCoreMemory.html#a6c9bf7d6b21ac33a61d6f7176023ea3a">release_free_volatile_page</a>(cur_id.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6">get_offset</a>());</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="keywordflow">if</span> (next_id.is_null()) {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            cur = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118">resolve_cast</a>&lt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>&gt;(next_id);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(last_error);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;}</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">  842</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">HashStoragePimpl::locate_bin</a>(</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordtype">bool</span> for_write,</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>** bin_head) {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>* root;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538">get_root_page</a>(context, for_write, &amp;root));</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(root);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  *bin_head = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1Xct.html">xct::Xct</a>&amp; current_xct = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3">get_current_xct</a>();</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>* parent = root;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(parent);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    uint8_t parent_level = parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f">get_level</a>();</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    uint16_t index = combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#ab53673792653ccec06c650a3e851b7b5">route_</a>.<a class="code" href="unionfoedus_1_1storage_1_1hash_1_1IntermediateRoute.html#ad124dde464379fbf3e536efdb00c3695">route</a>[parent_level];</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1Page.html">Page</a>* next;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f">follow_page</a>(context, for_write, parent, index, &amp;next));</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">if</span> (!next) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="comment">// if this is a read-access, it is possible that the page even doesn&#39;t exist.</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="comment">// it is a valid result (not found). we just have to add a pointer set to protect the result.</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!for_write);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordflow">if</span> (!parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>  <span class="comment">// then we already added a pointer set in higher level</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        &amp;&amp; current_xct.<a class="code" href="classfoedus_1_1xct_1_1Xct.html#abae2ae5210db8eda39a1507940bf7352">get_isolation_level</a>() == <a class="code" href="group__XCT.html#gga9ac5dae4b91a288e9d887f28a7124c13a5e9c22688eea55cea2bf4380b03a8630">xct::kSerializable</a>) {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html">VolatilePagePointer</a> volatile_null;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        volatile_null.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#aa8c59b8e2944d4a6a68d5fed840a7a29">clear</a>();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          current_xct.<a class="code" href="classfoedus_1_1xct_1_1Xct.html#adfd2125c9cc252494693f65719ed53b3">add_to_pointer_set</a>(</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            &amp;parent-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a9027ebbc2ee535519916906978347be9">get_pointer</a>(index).<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>,</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            volatile_null));</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <span class="keywordflow">if</span> (parent_level == 0) {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        *bin_head = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>*<span class="keyword">&gt;</span>(next);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        parent = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">HashIntermediatePage</a>*<span class="keyword">&gt;</span>(next);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(*bin_head != <span class="keyword">nullptr</span> || !for_write);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(*bin_head == <span class="keyword">nullptr</span> || (*bin_head)-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd">get_bin</a>() == combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#ae8e54d1781b0ae35653dab3db947b55f">bin_</a>);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;}</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105">  889</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105">HashStoragePimpl::locate_record_in_snapshot</a>(</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head,</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a>* result) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd">get_bin</a>() == combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#ae8e54d1781b0ae35653dab3db947b55f">bin_</a>);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a490056e5b2e5617cf640ea99d278ac21">clear</a>();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="comment">// Snapshot version doesn&#39;t need any of the concerns above. Easy!</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// Just physically search and follow to next page.</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* page = bin_head;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keyword">const</span> uint16_t record_count = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">get_record_count</a>();</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> index = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e">search_key_physical</a>(</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">fingerprint_</a>,</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      key,</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      key_length,</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      record_count);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span> (index != <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>) {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="comment">// found! this is final in snapshot page, so physical-only suffices (no protection needed).</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a33c82d9bc3661456265ee9991cba1f98">compare_slot_key</a>(index, combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>, key, key_length));</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab1d971d633ca8153c6a7363694e254a0">populate_physical</a>(page, index);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a41264f4ced33dae443651f57bc09e964">is_moved</a>());</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="comment">// Definitely not in this page, now on to next page.</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html">DualPagePointer</a>* next_page = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a6286d91dcdb8b6455e20bc770155a0be">next_page_address</a>();</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="comment">// then we are in snapshot world. no race.</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>());</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> pointer = next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">if</span> (pointer) {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1Page.html">Page</a>* next;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487">find_or_read_a_snapshot_page</a>(pointer, &amp;next));</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(next-&gt;<a class="code" href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e">get_header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      page = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>*<span class="keyword">&gt;</span>(next);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <span class="comment">// it&#39;s snapshot world. the result is final, we are done.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;}</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div>
<div class="line"><a name="l00936"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a86af9aa3326dd20ffdac2a1beffea0b4">  936</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a86af9aa3326dd20ffdac2a1beffea0b4">HashStoragePimpl::locate_record</a>(</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordtype">bool</span> for_write,</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordtype">bool</span> physical_only,</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordtype">bool</span> create_if_notfound,</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  uint16_t create_payload_length,</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* bin_head,</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a>* result) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(bin_head-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd">get_bin</a>() == combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#ae8e54d1781b0ae35653dab3db947b55f">bin_</a>);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(for_write || !create_if_notfound);  <span class="comment">// create_if_notfound implies for_write</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="comment">// Snapshot case is way easier. Separtely handle that case.</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">if</span> (bin_head-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>) {</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!for_write);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!create_if_notfound);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105">locate_record_in_snapshot</a>(context, key, key_length, combo, bin_head, result);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <a class="code" href="classfoedus_1_1xct_1_1Xct.html">xct::Xct</a>* cur_xct = &amp;context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3">get_current_xct</a>();</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="comment">// in hash storage, we maintain only bin_head&#39;s stat. it&#39;s enough</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">if</span> (for_write) {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    bin_head-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a79fd2ce938148e214062b663ee8ce524">stat_last_updater_node_</a> = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#aa07f33f2b78aa6e6c66a2149b1db52e8">get_numa_node</a>();</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* page = bin_head;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">// Start with a physical-only search. We will re-check our observation below.</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keyword">const</span> uint16_t record_count = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">get_record_count</a>();</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> index = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e">search_key_physical</a>(</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">fingerprint_</a>,</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      key,</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      key_length,</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      record_count);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordflow">if</span> (index != <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="comment">// found! but it might be now being logically moved/deleted.</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a33c82d9bc3661456265ee9991cba1f98">compare_slot_key</a>(index, combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>, key, key_length));</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">if</span> (physical_only) {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="comment">// we don&#39;t care. the caller is responsible to do logical operation</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab1d971d633ca8153c6a7363694e254a0">populate_physical</a>(page, index);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a5c39383806af101855b26268abbb00e3">populate_logical</a>(cur_xct, page, index, for_write));</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a41264f4ced33dae443651f57bc09e964">is_moved</a>())) {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;          LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Interesting. The record has been just moved&quot;</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    }</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">// Apparently not in this page, now on to next page. We have to be a bit careful</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="comment">// in this case. Non-null next page means this page is already static, but we</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="comment">// have to make sure we confirmed it in a right order.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html">DualPagePointer</a>* next_page = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a6286d91dcdb8b6455e20bc770155a0be">next_page_address</a>();</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="comment">// we are in volatile page, there might be a race!</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1PageVersionStatus.html">PageVersionStatus</a> page_status = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a44c12d47d4b478bac2076df4760fc990">page_version_</a>.<a class="code" href="structfoedus_1_1storage_1_1PageVersion.html#ad7d5aa3f29f70df46aa87d6c0e95a2a0">status_</a>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();  <span class="comment">// from now on, page_status is the ground truth here.</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// check a few things after the fence.</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="comment">// invariant: we never move on to next page without guaranteeing that this page does not</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="comment">// contain a physical non-moved record with the key.</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="comment">// did someone insert a new record at this moment?</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    uint16_t record_count_again = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">get_record_count</a>();</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(record_count != record_count_again)) {</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Interesting. concurrent insertion just happend to the page&quot;</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// just retry to make it sure. this is rare.</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="comment">// did someone install a new page at this moment?</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(!page_status.<a class="code" href="structfoedus_1_1storage_1_1PageVersionStatus.html#a8360836cebd9fbeadfeb2a31809270c2">has_next_page</a>() &amp;&amp; !next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>())) {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Interesting. concurrent next-page installation just happend to the page&quot;</span>;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// just retry to make it sure. this is rare.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    }</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">if</span> (next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>()) {</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="comment">// no next page.</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordflow">if</span> (create_if_notfound) {</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <span class="comment">// this is the tail page, so let&#39;s insert it here.</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="comment">// we do that as a system transaction.</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(for_write);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> new_location;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afa2342b5f0a374e38f0ec00242494a34">locate_record_reserve_physical</a>(</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          context,</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;          key,</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;          key_length,</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;          combo,</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;          create_payload_length,</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;          &amp;page,</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;          record_count,</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;          &amp;new_location));</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_location != <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>);  <span class="comment">// contract of the above method</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="comment">// The returned location is not logically protected... yet.</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a33c82d9bc3661456265ee9991cba1f98">compare_slot_key</a>(new_location, combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>, key, key_length));</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keywordflow">if</span> (physical_only) {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;          <span class="comment">// we don&#39;t care. the caller is responsible to do logical operation</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;          result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab1d971d633ca8153c6a7363694e254a0">populate_physical</a>(page, new_location);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;          <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a5c39383806af101855b26268abbb00e3">populate_logical</a>(cur_xct, page, new_location, for_write));</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">observed_</a>.<a class="code" href="structfoedus_1_1xct_1_1XctId.html#a41264f4ced33dae443651f57bc09e964">is_moved</a>())) {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Interesting. The record has been just moved after creation!&quot;</span>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;          }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="comment">// &quot;NotFound&quot; result. To finalize it,</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="comment">// we have to take version set because someone might</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="comment">// insert a new record/next-page later.</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        result-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a490056e5b2e5617cf640ea99d278ac21">clear</a>();</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">if</span> (physical_only) {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          <span class="comment">// we don&#39;t care. the caller is responsible to do logical operation</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;          <span class="comment">// [Logical check]: Remember the page_status we observed as of checking record count</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;          <span class="comment">// and verify it at commit time.</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;          <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(cur_xct-&gt;<a class="code" href="classfoedus_1_1xct_1_1Xct.html#a68b92830ccd52b310445b41bfef06fd7">add_to_page_version_set</a>(</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            &amp;page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#a44c12d47d4b478bac2076df4760fc990">page_version_</a>,</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            page_status));</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        }</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      page = context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118">resolve_cast</a>&lt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>&gt;(next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    }</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;}</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
<div class="line"><a name="l01074"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afa2342b5f0a374e38f0ec00242494a34"> 1074</a></span>&#160;<a class="code" href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">ErrorCode</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afa2342b5f0a374e38f0ec00242494a34">HashStoragePimpl::locate_record_reserve_physical</a>(</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <a class="code" href="classfoedus_1_1thread_1_1Thread.html">thread::Thread</a>* context,</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo,</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  uint16_t payload_length,</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>** page_in_out,</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  uint16_t examined_records,</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a>* new_location) {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(new_location);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html">ReserveRecords</a> functor(</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    context,</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    *page_in_out,</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    key,</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    key_length,</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    combo,</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    payload_length,</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    payload_length,</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    examined_records);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <a class="code" href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a>(context-&gt;<a class="code" href="classfoedus_1_1thread_1_1Thread.html#a2a5e6b008138d755e7e401f25927400c">run_nested_sysxct</a>(&amp;functor, 5U));</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  *page_in_out = functor.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">out_page_</a>;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  *new_location = functor.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">out_slot_</a>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">kErrorCodeOk</a>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;}</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af3a7066a8881f653e759362cf39e01c4"> 1099</a></span>&#160;<a class="code" href="structfoedus_1_1xct_1_1TrackMovedRecordResult.html">xct::TrackMovedRecordResult</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af3a7066a8881f653e759362cf39e01c4">HashStoragePimpl::track_moved_record</a>(</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <a class="code" href="structfoedus_1_1xct_1_1RwLockableXctId.html">xct::RwLockableXctId</a>* old_address,</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <a class="code" href="structfoedus_1_1xct_1_1WriteXctAccess.html">xct::WriteXctAccess</a>* write_set) {</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(old_address);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(old_address-&gt;<a class="code" href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36">is_moved</a>());</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="comment">// We use moved bit only for volatile data pages</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* page = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>*<span class="keyword">&gt;</span>(<a class="code" href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25">to_page</a>(old_address));</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!page-&gt;header().snapshot_);</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;header().get_page_type() == <a class="code" href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5ba6c1740f811f2524fac6cd76aa2a31c6c">kHashDataPageType</a>);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="comment">// TID is the first member in slot, so this ugly cast works.</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html">HashDataPage::Slot</a>* old_slot = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html">HashDataPage::Slot</a>*<span class="keyword">&gt;</span>(old_address);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(&amp;old_slot-&gt;tid_ == old_address);</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="comment">// for tracking, we need the full key and hash. let&#39;s extract them.</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* key = page-&gt;record_from_offset(old_slot-&gt;offset_);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  uint16_t key_length = old_slot-&gt;key_length_;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a> combo(key, key_length, <a class="code" href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">control_block_</a>-&gt;meta_);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">// we need write_set only for sanity check. It&#39;s easier in hash storage!</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="keywordflow">if</span> (write_set) {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set-&gt;<a class="code" href="structfoedus_1_1xct_1_1RecordXctAccess.html#aecf604e6febe0a58b79df2480cb6aafc">storage_id_</a> == page-&gt;header().storage_id_);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(write_set-&gt;<a class="code" href="structfoedus_1_1xct_1_1WriteXctAccess.html#a7d5747c3377b71d9fb8d0a767122e0c6">payload_address_</a> == page-&gt;record_from_offset(old_slot-&gt;offset_));</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html">HashCommonLogType</a>* the_log = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html">HashCommonLogType</a>*<span class="keyword">&gt;</span>(write_set-&gt;<a class="code" href="structfoedus_1_1xct_1_1WriteXctAccess.html#a531e6368a36e80f967de0ace50c0fb27">log_entry_</a>);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    the_log-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#ad66913658c856c60c06500b1179db779">assert_record_and_log_keys</a>(old_address, page-&gt;record_from_offset(old_slot-&gt;offset_));</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="preprocessor">#endif  // NDEBUG</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  }</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html">HashDataPage::Slot</a>* slot_origin = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html">HashDataPage::Slot</a>*<span class="keyword">&gt;</span>(page + 1);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(slot_origin &gt; old_slot);  <span class="comment">// because origin corresponds to &quot;-1&quot;.</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> old_index = slot_origin - old_slot - 1;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;get_slot_address(old_index) == old_slot);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a144ddbe7819e7b3576611d456aa46c77">track_moved_record_search</a>(page, key, key_length, combo);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;}</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"><a class="line" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a144ddbe7819e7b3576611d456aa46c77"> 1135</a></span>&#160;<a class="code" href="structfoedus_1_1xct_1_1TrackMovedRecordResult.html">xct::TrackMovedRecordResult</a> <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a144ddbe7819e7b3576611d456aa46c77">HashStoragePimpl::track_moved_record_search</a>(</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>* page,</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* key,</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  uint16_t key_length,</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">HashCombo</a>&amp; combo) {</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="keyword">const</span> <a class="code" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html">memory::GlobalVolatilePageResolver</a>&amp; resolver</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    = <a class="code" href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">engine_</a>-&gt;<a class="code" href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">get_memory_manager</a>()-&gt;<a class="code" href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0">get_global_volatile_page_resolver</a>();</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <a class="code" href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">RecordLocation</a> result;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(!page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">header</a>().<a class="code" href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">snapshot_</a>);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a6286d91dcdb8b6455e20bc770155a0be">next_page_address</a>()-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">snapshot_pointer_</a> == 0);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="keyword">const</span> uint16_t record_count = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">get_record_count</a>();</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="comment">// Tracking happens in commit phase, so we don&#39;t need further logical readset/lock things.</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="comment">// This is just to locate the new address. So, physical_only search.</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// (which might miss a new record being inserted, but it&#39;s just a bit conservative abort)</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">DataPageSlotIndex</a> index = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e">search_key_physical</a>(</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">hash_</a>,</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      combo.<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">fingerprint_</a>,</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      key,</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      key_length,</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      record_count);</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span> (index != <a class="code" href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">kSlotNotFound</a>) {</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html">HashDataPage::Slot</a>* slot = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ab696a16e6a995a515736ff0a28b47885">get_slot_address</a>(index);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="keywordtype">char</span>* payload = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07">record_from_offset</a>(slot-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#ac34e8c686a9cc92de76ac3a219b90528">offset_</a>);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="structfoedus_1_1xct_1_1TrackMovedRecordResult.html">xct::TrackMovedRecordResult</a>(&amp;slot-&gt;<a class="code" href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#a052f0dbfb1546fd9e5dab97ff374fce9">tid_</a>, payload);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    }</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="comment">// we must meet the same invariant as usual case. a bit simpler, though</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <a class="code" href="group__ASSORTED.html#ga641117f56315b0f239d72948cf5aa56f">assorted::memory_fence_consume</a>();</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html">DualPagePointer</a>* next_page = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a6286d91dcdb8b6455e20bc770155a0be">next_page_address</a>();</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <a class="code" href="group__ASSORTED.html#ga641117f56315b0f239d72948cf5aa56f">assorted::memory_fence_consume</a>();</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    uint16_t record_count_again = page-&gt;<a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">get_record_count</a>();</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a>(record_count != record_count_again)) {</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Interesting. concurrent insertion just happend to the page&quot;</span>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <a class="code" href="group__ASSORTED.html#ga641117f56315b0f239d72948cf5aa56f">assorted::memory_fence_consume</a>();</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    }</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">if</span> (next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>()) {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="comment">// This shouldn&#39;t happen as far as we flip moved bit after installing the new record</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;no next page?? but we didn&#39;t find the moved record in this page&quot;</span>;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <a class="code" href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">assorted::memory_fence_acquire</a>();</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <span class="keywordflow">if</span> (next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>.<a class="code" href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">is_null</a>()) {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Unexpected error, failed to track moved record in hash storage.&quot;</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; This should not happen. hash combo=&quot;</span> &lt;&lt; combo;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="structfoedus_1_1xct_1_1TrackMovedRecordResult.html">xct::TrackMovedRecordResult</a>();</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    }</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    page = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">HashDataPage</a>*<span class="keyword">&gt;</span>(resolver.<a class="code" href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f">resolve_offset</a>(next_page-&gt;<a class="code" href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">volatile_pointer_</a>));</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  }</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;}</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">// Explicit instantiations for each payload type</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">// @cond DOXYGEN_IGNORE</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="preprocessor">#define EXPIN_5I(x) template ErrorCode HashStoragePimpl::increment_record&lt; x &gt; \</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="preprocessor">  (thread::Thread* context, \</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="preprocessor">  const void* key, \</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="preprocessor">  uint16_t key_length, \</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="preprocessor">  const HashCombo&amp; combo, \</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="preprocessor">  x* value, \</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="preprocessor">  uint16_t payload_offset)</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<a class="code" href="group__ASSORTED.html#ga9a445a5c4fdb310f0b26cab5964aec04">INSTANTIATE_ALL_NUMERIC_TYPES</a>(EXPIN_5I);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">// @endcond</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;}  <span class="comment">// namespace hash</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;}  <span class="comment">// namespace storage</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;}  <span class="comment">// namespace foedus</span></div>
<div class="ttc" id="assorted__func_8hpp_html"><div class="ttname"><a href="assorted__func_8hpp.html">assorted_func.hpp</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a3fbd07f82917c7d7458e01f87851a6f5"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a3fbd07f82917c7d7458e01f87851a6f5">foedus::kErrorCodeStrHashBinsTooMany</a></div><div class="ttdoc">0x080D : "STORAGE: HASH: Number of hash-bins too large compared to storage.partitioner_data_memory_mb...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00179">error_code.hpp:179</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1WriteXctAccess_html_a531e6368a36e80f967de0ace50c0fb27"><div class="ttname"><a href="structfoedus_1_1xct_1_1WriteXctAccess.html#a531e6368a36e80f967de0ace50c0fb27">foedus::xct::WriteXctAccess::log_entry_</a></div><div class="ttdeci">log::RecordLogType * log_entry_</div><div class="ttdoc">Pointer to the log entry in private log buffer for this write opereation. </div><div class="ttdef"><b>Definition:</b> <a href="xct__access_8hpp_source.html#l00175">xct_access.hpp:175</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a947e657c9c51f0108e55d6792089345a"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a947e657c9c51f0108e55d6792089345a">foedus::kErrorCodeStrTooShortPayload</a></div><div class="ttdoc">0x080A : "STORAGE: The record&#39;s payload is smaller than requested" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00176">error_code.hpp:176</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a233fcd7ffd24bd59d2d0943af3d0de03"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a233fcd7ffd24bd59d2d0943af3d0de03">foedus::storage::hash::HashStoragePimpl::increment_record</a></div><div class="ttdeci">ErrorCode increment_record(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, PAYLOAD *value, uint16_t payload_offset)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00554">hash_storage_pimpl.cpp:554</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageControlBlock_html_ae20f48002ac04f92b32085ee52a56ed0"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageControlBlock.html#ae20f48002ac04f92b32085ee52a56ed0">foedus::storage::StorageControlBlock::meta_</a></div><div class="ttdeci">Metadata meta_</div><div class="ttdoc">common part of the metadata. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00084">storage.hpp:84</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_ac48c54832becbaa9141926af14705ba3"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#ac48c54832becbaa9141926af14705ba3">foedus::thread::Thread::get_current_xct</a></div><div class="ttdeci">xct::Xct &amp; get_current_xct()</div><div class="ttdoc">Returns the transaction that is currently running on this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00075">thread.cpp:75</a></div></div>
<div class="ttc" id="structfoedus_1_1memory_1_1GlobalVolatilePageResolver_html_a56250946b7719a7bd15532d211eac88f"><div class="ttname"><a href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html#a56250946b7719a7bd15532d211eac88f">foedus::memory::GlobalVolatilePageResolver::resolve_offset</a></div><div class="ttdeci">storage::Page * resolve_offset(uint8_t numa_node, PagePoolOffset offset) const __attribute__((always_inline))</div><div class="ttdoc">Resolves offset plus NUMA node ID to storage::Page*. </div><div class="ttdef"><b>Definition:</b> <a href="page__resolver_8hpp_source.html#l00120">page_resolver.hpp:120</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1hash_html_a621860b1314f5eecc0e41d3972340bf9"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1hash.html#a621860b1314f5eecc0e41d3972340bf9">foedus::storage::hash::adjust_payload_hint</a></div><div class="ttdeci">uint16_t adjust_payload_hint(uint16_t payload_count, uint16_t physical_payload_hint)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00250">hash_storage_pimpl.cpp:250</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_ad9a1cd82a866fd82299acc66a59c2487"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#ad9a1cd82a866fd82299acc66a59c2487">foedus::thread::Thread::find_or_read_a_snapshot_page</a></div><div class="ttdeci">ErrorCode find_or_read_a_snapshot_page(storage::SnapshotPagePointer page_id, storage::Page **out)</div><div class="ttdoc">Find the given page in snapshot cache, reading it if not found. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00095">thread.cpp:95</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_ab29603dc5748833bc006e129a152a4d1"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab29603dc5748833bc006e129a152a4d1">foedus::storage::hash::RecordLocation::is_found</a></div><div class="ttdeci">bool is_found() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00108">hash_record_location.hpp:108</a></div></div>
<div class="ttc" id="storage__manager_8hpp_html"><div class="ttname"><a href="storage__manager_8hpp.html">storage_manager.hpp</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga34d731a5b871bbd8a43b748808e9ce52"><div class="ttname"><a href="group__ASSORTED.html#ga34d731a5b871bbd8a43b748808e9ce52">foedus::assorted::align8</a></div><div class="ttdeci">T align8(T value)</div><div class="ttdoc">8-alignment. </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8hpp_source.html#l00058">assorted_func.hpp:58</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1NumaCoreMemory_html_a6c9bf7d6b21ac33a61d6f7176023ea3a"><div class="ttname"><a href="classfoedus_1_1memory_1_1NumaCoreMemory.html#a6c9bf7d6b21ac33a61d6f7176023ea3a">foedus::memory::NumaCoreMemory::release_free_volatile_page</a></div><div class="ttdeci">void release_free_volatile_page(PagePoolOffset offset)</div><div class="ttdoc">Returns one free volatile page to local page pool. </div><div class="ttdef"><b>Definition:</b> <a href="numa__core__memory_8cpp_source.html#l00213">numa_core_memory.cpp:213</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1DualPagePointer_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1DualPagePointer.html">foedus::storage::DualPagePointer</a></div><div class="ttdoc">Represents a pointer to another page (usually a child page). </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00271">storage_id.hpp:271</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_ad2169cfc93933b2b35fea60fe8be9cf8"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ad2169cfc93933b2b35fea60fe8be9cf8">foedus::storage::hash::HashDataPage::bloom_filter</a></div><div class="ttdeci">const DataPageBloomFilter &amp; bloom_filter() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00243">hash_page_impl.hpp:243</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a4e553f5e14ec00d8ba23fbdfa26d687e"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a4e553f5e14ec00d8ba23fbdfa26d687e">foedus::thread::Thread::get_thread_memory</a></div><div class="ttdeci">memory::NumaCoreMemory * get_thread_memory() const </div><div class="ttdoc">Returns the private memory repository of this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00057">thread.cpp:57</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56afcf2a3fbf0d4de0b82d6754532a73381">foedus::kErrorCodeStrKeyNotFound</a></div><div class="ttdoc">0x080C : "STORAGE: This key is not found in this storage" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00178">error_code.hpp:178</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_a134e444d2b945700fe14d0d6d3dd11f0"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a134e444d2b945700fe14d0d6d3dd11f0">foedus::storage::hash::HashIntermediatePage::header</a></div><div class="ttdeci">PageHeader &amp; header()</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00070">hash_page_impl.hpp:70</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_ab53673792653ccec06c650a3e851b7b5"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#ab53673792653ccec06c650a3e851b7b5">foedus::storage::hash::HashCombo::route_</a></div><div class="ttdeci">IntermediateRoute route_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00052">hash_combo.hpp:52</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType_html_a29bf2faaed91770de679b2e836ffa3b8"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html#a29bf2faaed91770de679b2e836ffa3b8">foedus::storage::hash::HashOverwriteLogType::populate</a></div><div class="ttdeci">void populate(StorageId storage_id, const void *key, uint16_t key_length, uint8_t bin_bits, HashValue hash, const void *payload, uint16_t payload_offset, uint16_t payload_count) __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00380">hash_log_types.hpp:380</a></div></div>
<div class="ttc" id="classfoedus_1_1UninitializeGuard_html_ae6caa12ca9b75a22b53c2eed31402721af0067551d00455a2a16416216de53568"><div class="ttname"><a href="classfoedus_1_1UninitializeGuard.html#ae6caa12ca9b75a22b53c2eed31402721af0067551d00455a2a16416216de53568">foedus::UninitializeGuard::kWarnIfUninitializeError</a></div><div class="ttdoc">Automatically calls if uninitialize() wasn&#39;t called when it gets out of scope, and just complains whe...</div><div class="ttdef"><b>Definition:</b> <a href="initializable_8hpp_source.html#l00243">initializable.hpp:243</a></div></div>
<div class="ttc" id="group__STORAGE_html_gaa114fc1859c2d4cb8b9e2021cb11cb25"><div class="ttname"><a href="group__STORAGE.html#gaa114fc1859c2d4cb8b9e2021cb11cb25">foedus::storage::to_page</a></div><div class="ttdeci">Page * to_page(const void *address)</div><div class="ttdoc">super-dirty way to obtain Page the address belongs to. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00395">page.hpp:395</a></div></div>
<div class="ttc" id="group__STORAGE_html_gga14e35f7fbe4bc18276fde8e8ba460f5baa295f358dce197aac9c593ba56d89714"><div class="ttname"><a href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5baa295f358dce197aac9c593ba56d89714">foedus::storage::kHashIntermediatePageType</a></div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00053">page.hpp:53</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa598b0ca7f0de626ecfa17f2cd58d5b4"><div class="ttname"><a href="group__ERRORCODES.html#gaa598b0ca7f0de626ecfa17f2cd58d5b4">ERROR_STACK</a></div><div class="ttdeci">#define ERROR_STACK(e)        </div><div class="ttdoc">Instantiates ErrorStack with the given foedus::error_code, creating an error stack with the current f...</div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00480">error_stack.hpp:480</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1PagePool_html"><div class="ttname"><a href="classfoedus_1_1memory_1_1PagePool.html">foedus::memory::PagePool</a></div><div class="ttdoc">Page pool for volatile read/write store (VolatilePage) and the read-only bufferpool (SnapshotPage)...</div><div class="ttdef"><b>Definition:</b> <a href="page__pool_8hpp_source.html#l00173">page_pool.hpp:173</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_ac5e2de81d5e512b5a0f735a9fc413629"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#ac5e2de81d5e512b5a0f735a9fc413629">foedus::storage::hash::HashIntermediatePage::get_bin_range</a></div><div class="ttdeci">const HashBinRange &amp; get_bin_range() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00104">hash_page_impl.hpp:104</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot_html_a052f0dbfb1546fd9e5dab97ff374fce9"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#a052f0dbfb1546fd9e5dab97ff374fce9">foedus::storage::hash::HashDataPage::Slot::tid_</a></div><div class="ttdeci">xct::RwLockableXctId tid_</div><div class="ttdoc">TID of the record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00165">hash_page_impl.hpp:165</a></div></div>
<div class="ttc" id="namespacefoedus_html"><div class="ttname"><a href="namespacefoedus.html">foedus</a></div><div class="ttdoc">Root package of FOEDUS (Fast Optimistic Engine for Data Unification Services). </div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00044">assert_nd.hpp:44</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1VolatilePagePointer_html_a8bb6c37c44056c5f986f6dd164b5b23a"><div class="ttname"><a href="structfoedus_1_1storage_1_1VolatilePagePointer.html#a8bb6c37c44056c5f986f6dd164b5b23a">foedus::storage::VolatilePagePointer::word</a></div><div class="ttdeci">uint64_t word</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00195">storage_id.hpp:195</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1WriteXctAccess_html"><div class="ttname"><a href="structfoedus_1_1xct_1_1WriteXctAccess.html">foedus::xct::WriteXctAccess</a></div><div class="ttdoc">Represents a record of write-access during a transaction. </div><div class="ttdef"><b>Definition:</b> <a href="xct__access_8hpp_source.html#l00168">xct_access.hpp:168</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1PagePool_html_a3e9390381783077a504116988cae05c4"><div class="ttname"><a href="classfoedus_1_1memory_1_1PagePool.html#a3e9390381783077a504116988cae05c4">foedus::memory::PagePool::grab_one</a></div><div class="ttdeci">ErrorCode grab_one(PagePoolOffset *offset)</div><div class="ttdoc">Grab only one page. </div><div class="ttdef"><b>Definition:</b> <a href="page__pool_8cpp_source.html#l00132">page_pool.cpp:132</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_add8aafbb32713dc6be20804da789f43d"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#add8aafbb32713dc6be20804da789f43d">foedus::storage::hash::HashStoragePimpl::overwrite_record</a></div><div class="ttdeci">ErrorCode overwrite_record(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, const void *payload, uint16_t payload_offset, uint16_t payload_count)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00502">hash_storage_pimpl.cpp:502</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html">foedus::thread::Thread</a></div><div class="ttdoc">Represents one thread running on one NUMA core. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8hpp_source.html#l00048">thread.hpp:48</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a4f9309d223f938ee13a247f1a7b1da46"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4f9309d223f938ee13a247f1a7b1da46">foedus::storage::hash::HashStoragePimpl::exists</a></div><div class="ttdeci">bool exists() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8hpp_source.html#l00160">hash_storage_pimpl.hpp:160</a></div></div>
<div class="ttc" id="group__MEMORY_html_gaf7ed7c23d184b14ce978b1775a86dfae"><div class="ttname"><a href="group__MEMORY.html#gaf7ed7c23d184b14ce978b1775a86dfae">foedus::memory::PagePoolOffset</a></div><div class="ttdeci">uint32_t PagePoolOffset</div><div class="ttdoc">Offset in PagePool that compactly represents the page address (unlike 8 bytes pointer). </div><div class="ttdef"><b>Definition:</b> <a href="memory__id_8hpp_source.html#l00044">memory_id.hpp:44</a></div></div>
<div class="ttc" id="log__type_8hpp_html"><div class="ttname"><a href="log__type_8hpp.html">log_type.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad34d7b80062bae0e2a0cb703109d848c"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad34d7b80062bae0e2a0cb703109d848c">foedus::storage::hash::ReserveRecords::out_slot_</a></div><div class="ttdeci">DataPageSlotIndex out_slot_</div><div class="ttdoc">[Out] The slot of the record that is found or created. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00133">hash_reserve_impl.hpp:133</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_abed92a9a4809cce3c1cc33bc4fb07a81"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#abed92a9a4809cce3c1cc33bc4fb07a81">foedus::storage::hash::RecordLocation::get_aligned_key_length</a></div><div class="ttdeci">uint16_t get_aligned_key_length() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00109">hash_record_location.hpp:109</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a4eff8bc4e42a5973c8553830890d8a24"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4eff8bc4e42a5973c8553830890d8a24">foedus::storage::hash::HashStoragePimpl::get_record_part</a></div><div class="ttdeci">ErrorCode get_record_part(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, void *payload, uint16_t payload_offset, uint16_t payload_count, bool read_only)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00210">hash_storage_pimpl.cpp:210</a></div></div>
<div class="ttc" id="xct_8hpp_html"><div class="ttname"><a href="xct_8hpp.html">xct.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_af4125da7e85cd2da82d64b8aa3eb9e81"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#af4125da7e85cd2da82d64b8aa3eb9e81">foedus::storage::hash::RecordLocation::get_max_payload</a></div><div class="ttdeci">uint16_t get_max_payload() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00110">hash_record_location.hpp:110</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a07025464a0eba08710f6fa92d7c0f32d"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a07025464a0eba08710f6fa92d7c0f32d">foedus::storage::hash::HashStoragePimpl::locate_record_logical</a></div><div class="ttdeci">ErrorCode locate_record_logical(thread::Thread *context, bool for_write, bool create_if_notfound, uint16_t create_payload_length, const void *key, uint16_t key_length, const HashCombo &amp;combo, HashDataPage *bin_head, RecordLocation *result)</div><div class="ttdoc">locate_record()&#39;s logical+physical version. </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8hpp_source.html#l00400">hash_storage_pimpl.hpp:400</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1EngineMemory_html_a62b2d4de6a72644e9e31d35a7f9beae0"><div class="ttname"><a href="classfoedus_1_1memory_1_1EngineMemory.html#a62b2d4de6a72644e9e31d35a7f9beae0">foedus::memory::EngineMemory::get_global_volatile_page_resolver</a></div><div class="ttdeci">const GlobalVolatilePageResolver &amp; get_global_volatile_page_resolver() const </div><div class="ttdoc">Returns the page resolver to convert volatile page ID to page pointer. </div><div class="ttdef"><b>Definition:</b> <a href="engine__memory_8hpp_source.html#l00090">engine_memory.hpp:90</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1TrackMovedRecordResult_html"><div class="ttname"><a href="structfoedus_1_1xct_1_1TrackMovedRecordResult.html">foedus::xct::TrackMovedRecordResult</a></div><div class="ttdoc">Result of track_moved_record(). </div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l01180">xct_id.hpp:1180</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1hash_html_a33cdddb3771cf2fdc3e65465792b6c96"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1hash.html#a33cdddb3771cf2fdc3e65465792b6c96">foedus::storage::hash::kSlotNotFound</a></div><div class="ttdeci">const DataPageSlotIndex kSlotNotFound</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00197">hash_id.hpp:197</a></div></div>
<div class="ttc" id="hash__storage__pimpl_8hpp_html"><div class="ttname"><a href="hash__storage__pimpl_8hpp.html">hash_storage_pimpl.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1VolatilePagePointer_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1VolatilePagePointer.html">foedus::storage::VolatilePagePointer</a></div><div class="ttdoc">Represents a pointer to a volatile page with modification count for preventing ABA. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00194">storage_id.hpp:194</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1Xct_html"><div class="ttname"><a href="classfoedus_1_1xct_1_1Xct.html">foedus::xct::Xct</a></div><div class="ttdoc">Represents a user transaction. </div><div class="ttdef"><b>Definition:</b> <a href="xct_8hpp_source.html#l00058">xct.hpp:58</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a21ed664fcd1889aa4dab0f150fd06c02"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a21ed664fcd1889aa4dab0f150fd06c02">foedus::storage::hash::HashStoragePimpl::follow_page_bin_head</a></div><div class="ttdeci">ErrorCode follow_page_bin_head(thread::Thread *context, bool for_write, HashIntermediatePage *parent, uint16_t index_in_parent, Page **page)</div><div class="ttdoc">subroutine to follow a pointer to head of bin from a volatile parent </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00679">hash_storage_pimpl.cpp:679</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a579927a24cc690c8d4d6362bcb9e8538"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a579927a24cc690c8d4d6362bcb9e8538">foedus::storage::hash::HashStoragePimpl::get_root_page</a></div><div class="ttdeci">ErrorCode get_root_page(thread::Thread *context, bool for_write, HashIntermediatePage **root)</div><div class="ttdoc">Retrieves the root page of this storage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00607">hash_storage_pimpl.cpp:607</a></div></div>
<div class="ttc" id="structfoedus_1_1memory_1_1LocalPageResolver_html_aa9d2266686c3a66678b37241a3ac434f"><div class="ttname"><a href="structfoedus_1_1memory_1_1LocalPageResolver.html#aa9d2266686c3a66678b37241a3ac434f">foedus::memory::LocalPageResolver::resolve_offset_newpage</a></div><div class="ttdeci">storage::Page * resolve_offset_newpage(PagePoolOffset offset) const __attribute__((always_inline))</div><div class="ttdoc">As the name suggests, this version is for new pages, which don&#39;t have sanity checks. </div><div class="ttdef"><b>Definition:</b> <a href="page__resolver_8hpp_source.html#l00064">page_resolver.hpp:64</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter_html_a4e5601b652daaffbcb9fa81aee6746c6"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1DataPageBloomFilter.html#a4e5601b652daaffbcb9fa81aee6746c6">foedus::storage::hash::DataPageBloomFilter::contains</a></div><div class="ttdeci">bool contains(const BloomFilterFingerprint &amp;fingerprint) const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__hashinate_8hpp_source.html#l00152">hash_hashinate.hpp:152</a></div></div>
<div class="ttc" id="engine_8hpp_html"><div class="ttname"><a href="engine_8hpp.html">engine.hpp</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a3d443bf6ef79608f06b5ca1aa4ea7e6f"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a3d443bf6ef79608f06b5ca1aa4ea7e6f">foedus::storage::hash::HashStoragePimpl::follow_page</a></div><div class="ttdeci">ErrorCode follow_page(thread::Thread *context, bool for_write, HashIntermediatePage *parent, uint16_t index_in_parent, Page **page)</div><div class="ttdoc">for non-root </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00625">hash_storage_pimpl.cpp:625</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1EngineMemory_html_a3c3c8902b7000d09878a5a2085f6058c"><div class="ttname"><a href="classfoedus_1_1memory_1_1EngineMemory.html#a3c3c8902b7000d09878a5a2085f6058c">foedus::memory::EngineMemory::load_one_volatile_page</a></div><div class="ttdeci">ErrorStack load_one_volatile_page(cache::SnapshotFileSet *fileset, storage::SnapshotPagePointer snapshot_pointer, storage::VolatilePagePointer *pointer, storage::Page **page)</div><div class="ttdoc">Another convenience method that also reads an existing snapshot page to the volatile page...</div><div class="ttdef"><b>Definition:</b> <a href="engine__memory_8cpp_source.html#l00148">engine_memory.cpp:148</a></div></div>
<div class="ttc" id="classfoedus_1_1DefaultInitializable_html_ab14b136a7d26f9f499ab9dc15a45a8cb"><div class="ttname"><a href="classfoedus_1_1DefaultInitializable.html#ab14b136a7d26f9f499ab9dc15a45a8cb">foedus::DefaultInitializable::uninitialize</a></div><div class="ttdeci">ErrorStack uninitialize() override final</div><div class="ttdoc">Typical implementation of Initializable::uninitialize() that provides uninitialize-once semantics...</div><div class="ttdef"><b>Definition:</b> <a href="initializable_8hpp_source.html#l00187">initializable.hpp:187</a></div></div>
<div class="ttc" id="classfoedus_1_1ErrorStack_html"><div class="ttname"><a href="classfoedus_1_1ErrorStack.html">foedus::ErrorStack</a></div><div class="ttdoc">Brings error stacktrace information as return value of functions. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00081">error_stack.hpp:81</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_a33c82d9bc3661456265ee9991cba1f98"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a33c82d9bc3661456265ee9991cba1f98">foedus::storage::hash::HashDataPage::compare_slot_key</a></div><div class="ttdeci">bool compare_slot_key(DataPageSlotIndex index, HashValue hash, const void *key, uint16_t key_length) const </div><div class="ttdoc">returns whether the slot contains the exact key specified </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00396">hash_page_impl.hpp:396</a></div></div>
<div class="ttc" id="hash__page__impl_8hpp_html"><div class="ttname"><a href="hash__page__impl_8hpp.html">hash_page_impl.hpp</a></div></div>
<div class="ttc" id="group__XCT_html_gga9ac5dae4b91a288e9d887f28a7124c13a993994249cc0179cf24c63cc329e7934"><div class="ttname"><a href="group__XCT.html#gga9ac5dae4b91a288e9d887f28a7124c13a993994249cc0179cf24c63cc329e7934">foedus::xct::kSnapshot</a></div><div class="ttdoc">Snapshot isolation (SI), meaning the transaction reads a consistent and complete image of the databas...</div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l00078">xct_id.hpp:78</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_a5c39383806af101855b26268abbb00e3"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a5c39383806af101855b26268abbb00e3">foedus::storage::hash::RecordLocation::populate_logical</a></div><div class="ttdeci">ErrorCode populate_logical(xct::Xct *cur_xct, HashDataPage *page, DataPageSlotIndex index, bool intended_for_write)</div><div class="ttdoc">Populates the result with XID and possibly readset. </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8cpp_source.html#l00027">hash_record_location.cpp:27</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_ac9c35890555ddb10d908b77602a1f28c"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#ac9c35890555ddb10d908b77602a1f28c">foedus::storage::hash::HashStoragePimpl::insert_record</a></div><div class="ttdeci">ErrorCode insert_record(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, const void *payload, uint16_t payload_count, uint16_t physical_payload_hint)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00277">hash_storage_pimpl.cpp:277</a></div></div>
<div class="ttc" id="stop__watch_8hpp_html"><div class="ttname"><a href="stop__watch_8hpp.html">stop_watch.hpp</a></div></div>
<div class="ttc" id="classfoedus_1_1Attachable_html_a5f84f871a1d36f9ee990f3175661cd99"><div class="ttname"><a href="classfoedus_1_1Attachable.html#a5f84f871a1d36f9ee990f3175661cd99">foedus::Attachable&lt; HashStorageControlBlock &gt;::engine_</a></div><div class="ttdeci">Engine * engine_</div><div class="ttdoc">Most attachable object stores an engine pointer (local engine), so we define it here. </div><div class="ttdef"><b>Definition:</b> <a href="attachable_8hpp_source.html#l00107">attachable.hpp:107</a></div></div>
<div class="ttc" id="storage__manager__pimpl_8hpp_html"><div class="ttname"><a href="storage__manager__pimpl_8hpp.html">storage_manager_pimpl.hpp</a></div></div>
<div class="ttc" id="group__STORAGE_html_ggaa532fc59a87dc23b6d432d444e98d63fadb3a41d3a531bce354f2df2aebef8dd1"><div class="ttname"><a href="group__STORAGE.html#ggaa532fc59a87dc23b6d432d444e98d63fadb3a41d3a531bce354f2df2aebef8dd1">foedus::storage::kExists</a></div><div class="ttdoc">The storage has been created and ready for use. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00158">storage_id.hpp:158</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1Xct_html_a7dad4e0e5a6770ee941bd365410f9b6a"><div class="ttname"><a href="classfoedus_1_1xct_1_1Xct.html#a7dad4e0e5a6770ee941bd365410f9b6a">foedus::xct::Xct::add_to_write_set</a></div><div class="ttdeci">ErrorCode add_to_write_set(storage::StorageId storage_id, RwLockableXctId *owner_id_address, char *payload_address, log::RecordLogType *log_entry)</div><div class="ttdoc">Add the given record to the write set of this transaction. </div><div class="ttdef"><b>Definition:</b> <a href="xct_8cpp_source.html#l00444">xct.cpp:444</a></div></div>
<div class="ttc" id="memory__id_8hpp_html"><div class="ttname"><a href="memory__id_8hpp.html">memory_id.hpp</a></div><div class="ttdoc">Definitions of IDs in this package and a few related constant values. </div></div>
<div class="ttc" id="classfoedus_1_1cache_1_1SnapshotFileSet_html"><div class="ttname"><a href="classfoedus_1_1cache_1_1SnapshotFileSet.html">foedus::cache::SnapshotFileSet</a></div><div class="ttdoc">Holds a set of read-only file objects for snapshot files. </div><div class="ttdef"><b>Definition:</b> <a href="snapshot__file__set_8hpp_source.html#l00052">snapshot_file_set.hpp:52</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_afa2342b5f0a374e38f0ec00242494a34"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afa2342b5f0a374e38f0ec00242494a34">foedus::storage::hash::HashStoragePimpl::locate_record_reserve_physical</a></div><div class="ttdeci">ErrorCode locate_record_reserve_physical(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, uint16_t payload_length, HashDataPage **page_in_out, uint16_t examined_records, DataPageSlotIndex *new_location)</div><div class="ttdoc">Subroutine of locate_record() to create/migrate a physical record of the given key in the page or its...</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l01074">hash_storage_pimpl.cpp:1074</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_afdf4bd9f7349768099f6aaf621ff3a70"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#afdf4bd9f7349768099f6aaf621ff3a70">foedus::storage::hash::HashStoragePimpl::get_name</a></div><div class="ttdeci">const StorageName &amp; get_name() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8hpp_source.html#l00162">hash_storage_pimpl.hpp:162</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a81e03c29d8931350b4df1fd1f8b9e4b6"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a81e03c29d8931350b4df1fd1f8b9e4b6">foedus::thread::Thread::follow_page_pointer</a></div><div class="ttdeci">ErrorCode follow_page_pointer(storage::VolatilePageInit page_initializer, bool tolerate_null_pointer, bool will_modify, bool take_ptr_set_snapshot, storage::DualPagePointer *pointer, storage::Page **page, const storage::Page *parent, uint16_t index_in_parent)</div><div class="ttdoc">A general method to follow (read) a page pointer. </div><div class="ttdef"><b>Definition:</b> <a href="thread__pimpl_8cpp_source.html#l00353">thread_pimpl.cpp:353</a></div></div>
<div class="ttc" id="group__HASH_html_gacfc9ccab28ee4ffc1a7317ec51b332f4"><div class="ttname"><a href="group__HASH.html#gacfc9ccab28ee4ffc1a7317ec51b332f4">foedus::storage::hash::bins_to_level</a></div><div class="ttdeci">uint8_t bins_to_level(uint64_t bins)</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00090">hash_id.hpp:90</a></div></div>
<div class="ttc" id="hash__record__location_8hpp_html"><div class="ttname"><a href="hash__record__location_8hpp.html">hash_record_location.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html_ad95de6d2f7cbec7e2d08f758d5165166"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html#ad95de6d2f7cbec7e2d08f758d5165166">foedus::storage::hash::ReserveRecords::out_page_</a></div><div class="ttdeci">HashDataPage * out_page_</div><div class="ttdoc">[Out] The page that contains the found/created record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00140">hash_reserve_impl.hpp:140</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1NumaCoreMemory_html_afb436d68c982228d9e4bc66104b2aa98"><div class="ttname"><a href="classfoedus_1_1memory_1_1NumaCoreMemory.html#afb436d68c982228d9e4bc66104b2aa98">foedus::memory::NumaCoreMemory::grab_free_volatile_page_pointer</a></div><div class="ttdeci">storage::VolatilePagePointer grab_free_volatile_page_pointer()</div><div class="ttdoc">Wrapper for grab_free_volatile_page(). </div><div class="ttdef"><b>Definition:</b> <a href="numa__core__memory_8cpp_source.html#l00208">numa_core_memory.cpp:208</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_abdd0cbf1f438986888173779270bab4a"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#abdd0cbf1f438986888173779270bab4a">foedus::storage::hash::HashStoragePimpl::get_id</a></div><div class="ttdeci">StorageId get_id() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8hpp_source.html#l00161">hash_storage_pimpl.hpp:161</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_a093b20c41f026d8cec9c39eab2149531"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a093b20c41f026d8cec9c39eab2149531">foedus::storage::hash::RecordLocation::page_</a></div><div class="ttdeci">HashDataPage * page_</div><div class="ttdoc">The data page (might not be bin-head) containing the record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00078">hash_record_location.hpp:78</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType_html_abd3dbdbe4f6d69957367a01e7576882a"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html#abd3dbdbe4f6d69957367a01e7576882a">foedus::storage::hash::HashInsertLogType::populate</a></div><div class="ttdeci">void populate(StorageId storage_id, const void *key, uint16_t key_length, uint8_t bin_bits, HashValue hash, const void *payload, uint16_t payload_count) __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00212">hash_log_types.hpp:212</a></div></div>
<div class="ttc" id="hash__storage_8hpp_html"><div class="ttname"><a href="hash__storage_8hpp.html">hash_storage.hpp</a></div></div>
<div class="ttc" id="hash__reserve__impl_8hpp_html"><div class="ttname"><a href="hash__reserve__impl_8hpp.html">hash_reserve_impl.hpp</a></div></div>
<div class="ttc" id="numa__node__memory_8hpp_html"><div class="ttname"><a href="numa__node__memory_8hpp.html">numa_node_memory.hpp</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a38d765f971d163f274b24fa920565074"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a38d765f971d163f274b24fa920565074">foedus::storage::hash::HashStoragePimpl::get_bin_count</a></div><div class="ttdeci">HashBin get_bin_count() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8hpp_source.html#l00165">hash_storage_pimpl.hpp:165</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a6546930099132529543c320327367ef1"><div class="ttname"><a href="classfoedus_1_1Engine.html#a6546930099132529543c320327367ef1">foedus::Engine::get_options</a></div><div class="ttdeci">const EngineOptions &amp; get_options() const </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00039">engine.cpp:39</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1NumaCoreMemory_html"><div class="ttname"><a href="classfoedus_1_1memory_1_1NumaCoreMemory.html">foedus::memory::NumaCoreMemory</a></div><div class="ttdoc">Repository of memories dynamically acquired within one CPU core (thread). </div><div class="ttdef"><b>Definition:</b> <a href="numa__core__memory_8hpp_source.html#l00046">numa_core_memory.hpp:46</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_a6286d91dcdb8b6455e20bc770155a0be"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a6286d91dcdb8b6455e20bc770155a0be">foedus::storage::hash::HashDataPage::next_page_address</a></div><div class="ttdeci">const DualPagePointer * next_page_address() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00240">hash_page_impl.hpp:240</a></div></div>
<div class="ttc" id="snapshot__file__set_8hpp_html"><div class="ttname"><a href="snapshot__file__set_8hpp.html">snapshot_file_set.hpp</a></div></div>
<div class="ttc" id="hash__combo_8hpp_html"><div class="ttname"><a href="hash__combo_8hpp.html">hash_combo.hpp</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a2823bcc0a488ad58faee46d876db8abe"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a2823bcc0a488ad58faee46d876db8abe">foedus::storage::hash::HashStoragePimpl::create</a></div><div class="ttdeci">ErrorStack create(const HashMetadata &amp;metadata)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00076">hash_storage_pimpl.cpp:76</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1RwLockableXctId_html"><div class="ttname"><a href="structfoedus_1_1xct_1_1RwLockableXctId.html">foedus::xct::RwLockableXctId</a></div><div class="ttdoc">The MCS reader-writer lock variant of LockableXctId. </div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l01132">xct_id.hpp:1132</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_ab696a16e6a995a515736ff0a28b47885"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ab696a16e6a995a515736ff0a28b47885">foedus::storage::hash::HashDataPage::get_slot_address</a></div><div class="ttdeci">const Slot * get_slot_address(DataPageSlotIndex record) const __attribute__((always_inline))</div><div class="ttdoc">same as &get_slot(), but this is more explicit and easier to understand/maintain </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00259">hash_page_impl.hpp:259</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_ade1f89cfaad84ff5dda0b6f7999a519e"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#ade1f89cfaad84ff5dda0b6f7999a519e">foedus::thread::Thread::resolve</a></div><div class="ttdeci">storage::Page * resolve(storage::VolatilePagePointer ptr) const </div><div class="ttdoc">Shorthand for get_global_volatile_page_resolver.resolve_offset() </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00129">thread.cpp:129</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a4120c099e570a27e391917bc7f76ca07"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a4120c099e570a27e391917bc7f76ca07">foedus::storage::hash::HashStoragePimpl::get_levels</a></div><div class="ttdeci">uint8_t get_levels() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8hpp_source.html#l00164">hash_storage_pimpl.hpp:164</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a9a5d37d6dac9966989e23381f600fcee"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a9a5d37d6dac9966989e23381f600fcee">foedus::thread::Thread::get_thread_log_buffer</a></div><div class="ttdeci">log::ThreadLogBuffer &amp; get_thread_log_buffer()</div><div class="ttdoc">Returns the private log buffer for this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00078">thread.cpp:78</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageOptions_html_a127e9bf3b4309f1dafca757fc11ae6e5"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageOptions.html#a127e9bf3b4309f1dafca757fc11ae6e5">foedus::storage::StorageOptions::partitioner_data_memory_mb_</a></div><div class="ttdeci">uint32_t partitioner_data_memory_mb_</div><div class="ttdoc">Size in MB of a shared memory buffer allocated for all partitioners during log gleaning. </div><div class="ttdef"><b>Definition:</b> <a href="storage__options_8hpp_source.html#l00051">storage_options.hpp:51</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1DualPagePointer_html_a99e67179a5576a52a4710c700ac309f4"><div class="ttname"><a href="structfoedus_1_1storage_1_1DualPagePointer.html#a99e67179a5576a52a4710c700ac309f4">foedus::storage::DualPagePointer::volatile_pointer_</a></div><div class="ttdeci">VolatilePagePointer volatile_pointer_</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00308">storage_id.hpp:308</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_ab32e08d4ebb188cd7293a568e4185950"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab32e08d4ebb188cd7293a568e4185950">foedus::storage::hash::RecordLocation::record_</a></div><div class="ttdeci">char * record_</div><div class="ttdoc">Address of the record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00093">hash_record_location.hpp:93</a></div></div>
<div class="ttc" id="hash__hashinate_8hpp_html"><div class="ttname"><a href="hash__hashinate_8hpp.html">hash_hashinate.hpp</a></div><div class="ttdoc">Independent utility methods/classes for hashination, or hash functions. </div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a6fe6714ceb6dbd09ad6f627d11b775c9">foedus::kErrorCodeOk</a></div><div class="ttdoc">0 means no-error. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00087">error_code.hpp:87</a></div></div>
<div class="ttc" id="group__HASH_html_gad584a49d2de255afd325aa2ddbb7e726"><div class="ttname"><a href="group__HASH.html#gad584a49d2de255afd325aa2ddbb7e726">foedus::storage::hash::fanout_power</a></div><div class="ttdeci">uint64_t fanout_power(uint8_t exponent)</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00056">hash_id.hpp:56</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1RwLockableXctId_html_a03782134d5ef0ebb8e187ddbd89f3c36"><div class="ttname"><a href="structfoedus_1_1xct_1_1RwLockableXctId.html#a03782134d5ef0ebb8e187ddbd89f3c36">foedus::xct::RwLockableXctId::is_moved</a></div><div class="ttdeci">bool is_moved() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l01142">xct_id.hpp:1142</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1VolatilePagePointer_html_ac3d7cb1649528efa8b9aa22b63bf52e6"><div class="ttname"><a href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ac3d7cb1649528efa8b9aa22b63bf52e6">foedus::storage::VolatilePagePointer::get_offset</a></div><div class="ttdeci">memory::PagePoolOffset get_offset() const </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00202">storage_id.hpp:202</a></div></div>
<div class="ttc" id="classfoedus_1_1Attachable_html_af9f87c691e2df0b04322e6df8d7c0d81"><div class="ttname"><a href="classfoedus_1_1Attachable.html#af9f87c691e2df0b04322e6df8d7c0d81">foedus::Attachable&lt; HashStorageControlBlock &gt;::control_block_</a></div><div class="ttdeci">HashStorageControlBlock * control_block_</div><div class="ttdoc">The shared data on shared memory that has been initialized in some SOC or master engine. </div><div class="ttdef"><b>Definition:</b> <a href="attachable_8hpp_source.html#l00111">attachable.hpp:111</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1Xct_html_aa23025809d9c2fdff744f98f78c3882a"><div class="ttname"><a href="classfoedus_1_1xct_1_1Xct.html#aa23025809d9c2fdff744f98f78c3882a">foedus::xct::Xct::add_related_write_set</a></div><div class="ttdeci">ErrorCode add_related_write_set(ReadXctAccess *related_read_set, RwLockableXctId *tid_address, char *payload_address, log::RecordLogType *log_entry)</div><div class="ttdoc">Registers a write-set related to an existing read-set. </div><div class="ttdef"><b>Definition:</b> <a href="xct_8cpp_source.html#l00506">xct.cpp:506</a></div></div>
<div class="ttc" id="record_8hpp_html"><div class="ttname"><a href="record_8hpp.html">record.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1EngineOptions_html_a3e40cfe4530b10e87344b42be16927e1"><div class="ttname"><a href="structfoedus_1_1EngineOptions.html#a3e40cfe4530b10e87344b42be16927e1">foedus::EngineOptions::storage_</a></div><div class="ttdeci">storage::StorageOptions storage_</div><div class="ttdef"><b>Definition:</b> <a href="engine__options_8hpp_source.html#l00145">engine_options.hpp:145</a></div></div>
<div class="ttc" id="hash__log__types_8hpp_html"><div class="ttname"><a href="hash__log__types_8hpp.html">hash_log_types.hpp</a></div><div class="ttdoc">Declares all log types used in this storage type. </div></div>
<div class="ttc" id="numa__core__memory_8hpp_html"><div class="ttname"><a href="numa__core__memory_8hpp.html">numa_core_memory.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_a7ffd03d39f3e621a793778168ace8046"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a7ffd03d39f3e621a793778168ace8046">foedus::storage::hash::RecordLocation::cur_payload_length_</a></div><div class="ttdeci">uint16_t cur_payload_length_</div><div class="ttdoc">Logical payload length as-of the observed XID. </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00086">hash_record_location.hpp:86</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga629d4b8103bfb83ef9c11b842a4fd398"><div class="ttname"><a href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">foedus::storage::SnapshotPagePointer</a></div><div class="ttdeci">uint64_t SnapshotPagePointer</div><div class="ttdoc">Page ID of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00079">storage_id.hpp:79</a></div></div>
<div class="ttc" id="classfoedus_1_1UninitializeGuard_html"><div class="ttname"><a href="classfoedus_1_1UninitializeGuard.html">foedus::UninitializeGuard</a></div><div class="ttdoc">Calls Initializable::uninitialize() automatically when it gets out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="initializable_8hpp_source.html#l00220">initializable.hpp:220</a></div></div>
<div class="ttc" id="cacheline_8hpp_html"><div class="ttname"><a href="cacheline_8hpp.html">cacheline.hpp</a></div><div class="ttdoc">Constants and methods related to CPU cacheline and its prefetching. </div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashUpdateLogType_html_af538b6dfae547586f1bd65cf8a879c15"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashUpdateLogType.html#af538b6dfae547586f1bd65cf8a879c15">foedus::storage::hash::HashUpdateLogType::populate</a></div><div class="ttdeci">void populate(StorageId storage_id, const void *key, uint16_t key_length, uint8_t bin_bits, HashValue hash, const void *payload, uint16_t payload_count) __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00318">hash_log_types.hpp:318</a></div></div>
<div class="ttc" id="classfoedus_1_1DefaultInitializable_html_a22a0dc3bbbca682c3bc41eace9b6d1ff"><div class="ttname"><a href="classfoedus_1_1DefaultInitializable.html#a22a0dc3bbbca682c3bc41eace9b6d1ff">foedus::DefaultInitializable::initialize</a></div><div class="ttdeci">ErrorStack initialize() override final</div><div class="ttdoc">Typical implementation of Initializable::initialize() that provides initialize-once semantics...</div><div class="ttdef"><b>Definition:</b> <a href="initializable_8hpp_source.html#l00169">initializable.hpp:169</a></div></div>
<div class="ttc" id="page__pool_8hpp_html"><div class="ttname"><a href="page__pool_8hpp.html">page_pool.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashUpdateLogType_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashUpdateLogType.html">foedus::storage::hash::HashUpdateLogType</a></div><div class="ttdoc">Log type of hash-storage&#39;s update operation. </div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00315">hash_log_types.hpp:315</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_a1bdd725342fd4aa90f983fec651f6956"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#a1bdd725342fd4aa90f983fec651f6956">foedus::storage::PageHeader::get_page_type</a></div><div class="ttdeci">PageType get_page_type() const </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00280">page.hpp:280</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a0a03edf7d6ab7385275f50b23173dce8"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a0a03edf7d6ab7385275f50b23173dce8">foedus::kErrorCodeStrAlreadyExists</a></div><div class="ttdoc">0x0802 : "STORAGE: This storage already exists" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00168">error_code.hpp:168</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html">foedus::storage::hash::HashCommonLogType</a></div><div class="ttdoc">A base class for HashInsertLogType/HashDeleteLogType/HashOverwriteLogType. </div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00075">hash_log_types.hpp:75</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1WriteXctAccess_html_a7d5747c3377b71d9fb8d0a767122e0c6"><div class="ttname"><a href="structfoedus_1_1xct_1_1WriteXctAccess.html#a7d5747c3377b71d9fb8d0a767122e0c6">foedus::xct::WriteXctAccess::payload_address_</a></div><div class="ttdeci">char * payload_address_</div><div class="ttdoc">Pointer to the payload of the record. </div><div class="ttdef"><b>Definition:</b> <a href="xct__access_8hpp_source.html#l00172">xct_access.hpp:172</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1EngineMemory_html_a8bf8832e627cd97fe92c60d38ed96ac8"><div class="ttname"><a href="classfoedus_1_1memory_1_1EngineMemory.html#a8bf8832e627cd97fe92c60d38ed96ac8">foedus::memory::EngineMemory::get_node_memory</a></div><div class="ttdeci">NumaNodeMemoryRef * get_node_memory(foedus::thread::ThreadGroupId group) const </div><div class="ttdef"><b>Definition:</b> <a href="engine__memory_8hpp_source.html#l00076">engine_memory.hpp:76</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1DualPagePointer_html_af1b2fd480af916504df50c01faa3e597"><div class="ttname"><a href="structfoedus_1_1storage_1_1DualPagePointer.html#af1b2fd480af916504df50c01faa3e597">foedus::storage::DualPagePointer::snapshot_pointer_</a></div><div class="ttdeci">SnapshotPagePointer snapshot_pointer_</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00307">storage_id.hpp:307</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a44bc6cd5427daadbee9fd6fcc366af09"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a44bc6cd5427daadbee9fd6fcc366af09">foedus::storage::hash::HashStoragePimpl::load</a></div><div class="ttdeci">ErrorStack load(const StorageControlBlock &amp;snapshot_block)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00135">hash_storage_pimpl.cpp:135</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1ReserveRecords_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1ReserveRecords.html">foedus::storage::hash::ReserveRecords</a></div><div class="ttdoc">A system transaction to reserve a physical record(s) in a hash data page. </div><div class="ttdef"><b>Definition:</b> <a href="hash__reserve__impl_8hpp_source.html#l00073">hash_reserve_impl.hpp:73</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html">foedus::storage::hash::HashDataPage::Slot</a></div><div class="ttdoc">Fix-sized slot for each record, which is placed at the end of data region. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00161">hash_page_impl.hpp:161</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Page_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1Page.html">foedus::storage::Page</a></div><div class="ttdoc">Just a marker to denote that the memory region represents a data page. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00334">page.hpp:334</a></div></div>
<div class="ttc" id="unionfoedus_1_1storage_1_1hash_1_1IntermediateRoute_html_ad124dde464379fbf3e536efdb00c3695"><div class="ttname"><a href="unionfoedus_1_1storage_1_1hash_1_1IntermediateRoute.html#ad124dde464379fbf3e536efdb00c3695">foedus::storage::hash::IntermediateRoute::route</a></div><div class="ttdeci">uint8_t route[8]</div><div class="ttdoc">[0] means ordinal in level-0 intermediate page, [1] in its parent page, [2]... </div><div class="ttdef"><b>Definition:</b> <a href="hash__hashinate_8hpp_source.html#l00203">hash_hashinate.hpp:203</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_a44c12d47d4b478bac2076df4760fc990"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#a44c12d47d4b478bac2076df4760fc990">foedus::storage::PageHeader::page_version_</a></div><div class="ttdeci">PageVersion page_version_</div><div class="ttdoc">Used in several storage types as concurrency control mechanism for the page. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00272">page.hpp:272</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashBinRange_html_a6404bfe127e6686aaac2b490450c2cb7"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashBinRange.html#a6404bfe127e6686aaac2b490450c2cb7">foedus::storage::hash::HashBinRange::begin_</a></div><div class="ttdeci">HashBin begin_</div><div class="ttdoc">Inclusive beginning of the range. </div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00191">hash_id.hpp:191</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a0f073a76a5abeac0829ba1e47a40c02c"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a0f073a76a5abeac0829ba1e47a40c02c">foedus::storage::hash::HashStoragePimpl::locate_bin</a></div><div class="ttdeci">ErrorCode locate_bin(thread::Thread *context, bool for_write, const HashCombo &amp;combo, HashDataPage **bin_head)</div><div class="ttdoc">Find a pointer to the bin that contains records for the hash. </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00842">hash_storage_pimpl.cpp:842</a></div></div>
<div class="ttc" id="thread_8hpp_html"><div class="ttname"><a href="thread_8hpp.html">thread.hpp</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_1_1hash_html_a476dd04e514ebe83142d21135e8b91c7"><div class="ttname"><a href="namespacefoedus_1_1storage_1_1hash.html#a476dd04e514ebe83142d21135e8b91c7">foedus::storage::hash::DataPageSlotIndex</a></div><div class="ttdeci">uint16_t DataPageSlotIndex</div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00196">hash_id.hpp:196</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctId_html_a6008b5f8531e6ee524d60cf86bc20148"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctId.html#a6008b5f8531e6ee524d60cf86bc20148">foedus::xct::XctId::is_deleted</a></div><div class="ttdeci">bool is_deleted() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l01040">xct_id.hpp:1040</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_af3a7066a8881f653e759362cf39e01c4"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af3a7066a8881f653e759362cf39e01c4">foedus::storage::hash::HashStoragePimpl::track_moved_record</a></div><div class="ttdeci">xct::TrackMovedRecordResult track_moved_record(xct::RwLockableXctId *old_address, xct::WriteXctAccess *write_set)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l01099">hash_storage_pimpl.cpp:1099</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1RecordXctAccess_html_aecf604e6febe0a58b79df2480cb6aafc"><div class="ttname"><a href="structfoedus_1_1xct_1_1RecordXctAccess.html#aecf604e6febe0a58b79df2480cb6aafc">foedus::xct::RecordXctAccess::storage_id_</a></div><div class="ttdeci">storage::StorageId storage_id_</div><div class="ttdoc">The storage we accessed. </div><div class="ttdef"><b>Definition:</b> <a href="xct__access_8hpp_source.html#l00085">xct_access.hpp:85</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_a72474ba11f14c8e37ab6b9b3bd92d64b"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a72474ba11f14c8e37ab6b9b3bd92d64b">foedus::storage::hash::HashIntermediatePage::release_pages_recursive_parallel</a></div><div class="ttdeci">void release_pages_recursive_parallel(Engine *engine)</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8cpp_source.html#l00271">hash_page_impl.cpp:271</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_aff4c87787f9e6ce9c4306b8bcaf36a47"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aff4c87787f9e6ce9c4306b8bcaf36a47">foedus::storage::hash::HashStoragePimpl::get_bin_bits</a></div><div class="ttdeci">uint8_t get_bin_bits() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8hpp_source.html#l00166">hash_storage_pimpl.hpp:166</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a17f375db3d50174cf49746e04ce00118"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a17f375db3d50174cf49746e04ce00118">foedus::thread::Thread::resolve_cast</a></div><div class="ttdeci">P * resolve_cast(storage::VolatilePagePointer ptr) const </div><div class="ttdoc">resolve() plus reinterpret_cast </div><div class="ttdef"><b>Definition:</b> <a href="thread_8hpp_source.html#l00110">thread.hpp:110</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html">foedus::storage::hash::HashCombo</a></div><div class="ttdoc">A set of information that are used in many places, extracted from the given key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00048">hash_combo.hpp:48</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_aa72388dc98c566a63c723184449a830f"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#aa72388dc98c566a63c723184449a830f">foedus::storage::hash::HashIntermediatePage::get_pointer_address</a></div><div class="ttdeci">DualPagePointer * get_pointer_address(uint16_t index)</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00082">hash_page_impl.hpp:82</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_a19d9cee1d8cd64d33d7645b59b6536fd"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a19d9cee1d8cd64d33d7645b59b6536fd">foedus::storage::hash::HashCombo::hash_</a></div><div class="ttdeci">HashValue hash_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00049">hash_combo.hpp:49</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_aeb01df00186ad7f69875d7bd1ff0108e"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#aeb01df00186ad7f69875d7bd1ff0108e">foedus::storage::hash::HashIntermediatePage::initialize_volatile_page</a></div><div class="ttdeci">void initialize_volatile_page(StorageId storage_id, VolatilePagePointer page_id, const HashIntermediatePage *parent, uint8_t level, HashBin start_bin)</div><div class="ttdoc">Called only when this page is initialized. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8cpp_source.html#l00040">hash_page_impl.cpp:40</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_ac8953b86c90ec5ee1730b05397a259da"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#ac8953b86c90ec5ee1730b05397a259da">foedus::thread::Thread::get_local_volatile_page_resolver</a></div><div class="ttdeci">const memory::LocalPageResolver &amp; get_local_volatile_page_resolver() const </div><div class="ttdoc">Returns page resolver to convert only local page ID to page pointer. </div><div class="ttdef"><b>Definition:</b> <a href="thread_8cpp_source.html#l00080">thread.cpp:80</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_a949b3f4b505de0f1595eabf801d37741"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a949b3f4b505de0f1595eabf801d37741">foedus::storage::hash::HashIntermediatePage::assert_range</a></div><div class="ttdeci">void assert_range() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00110">hash_page_impl.hpp:110</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56a2ddd0cd462e4ae138f0e572106ad098c"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56a2ddd0cd462e4ae138f0e572106ad098c">foedus::kErrorCodeMemoryNoFreePages</a></div><div class="ttdoc">0x0301 : "MEMORY : Not enough free volatile pages. Check the config of MemoryOptions" ...</div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00142">error_code.hpp:142</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_ab1d971d633ca8153c6a7363694e254a0"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#ab1d971d633ca8153c6a7363694e254a0">foedus::storage::hash::RecordLocation::populate_physical</a></div><div class="ttdeci">void populate_physical(HashDataPage *page, DataPageSlotIndex index)</div><div class="ttdoc">Populates fields other than readset_. </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8cpp_source.html#l00079">hash_record_location.cpp:79</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashDeleteLogType_html_a3c2ca8fb362ef7876a14e22608b9aa35"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashDeleteLogType.html#a3c2ca8fb362ef7876a14e22608b9aa35">foedus::storage::hash::HashDeleteLogType::populate</a></div><div class="ttdeci">void populate(StorageId storage_id, const void *key, uint16_t key_length, uint8_t bin_bits, HashValue hash) __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00274">hash_log_types.hpp:274</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a86af9aa3326dd20ffdac2a1beffea0b4"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a86af9aa3326dd20ffdac2a1beffea0b4">foedus::storage::hash::HashStoragePimpl::locate_record</a></div><div class="ttdeci">ErrorCode locate_record(thread::Thread *context, bool for_write, bool physical_only, bool create_if_notfound, uint16_t create_payload_length, const void *key, uint16_t key_length, const HashCombo &amp;combo, HashDataPage *bin_head, RecordLocation *result)</div><div class="ttdoc">Usually follows locate_bin to locate the exact physical record for the key, or create a new one if no...</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00936">hash_storage_pimpl.cpp:936</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_a7dd89264e53c0c98b32e883ab6800ba1"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#a7dd89264e53c0c98b32e883ab6800ba1">foedus::storage::hash::HashCombo::fingerprint_</a></div><div class="ttdeci">BloomFilterFingerprint fingerprint_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00051">hash_combo.hpp:51</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html">foedus::storage::hash::HashIntermediatePage</a></div><div class="ttdoc">Represents an intermediate page in Hashtable Storage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00064">hash_page_impl.hpp:64</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_aeea83aff996263bc8e9b3623fbe305a1"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#aeea83aff996263bc8e9b3623fbe305a1">foedus::storage::hash::HashStoragePimpl::register_record_write_log</a></div><div class="ttdeci">ErrorCode register_record_write_log(thread::Thread *context, const RecordLocation &amp;location, log::RecordLogType *log_entry)</div><div class="ttdoc">Used in the following methods. </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00260">hash_storage_pimpl.cpp:260</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType_html_ad66913658c856c60c06500b1179db779"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#ad66913658c856c60c06500b1179db779">foedus::storage::hash::HashCommonLogType::assert_record_and_log_keys</a></div><div class="ttdeci">void assert_record_and_log_keys(xct::RwLockableXctId *owner_id, const char *data) const </div><div class="ttdoc">used only for sanity check. </div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00142">hash_log_types.hpp:142</a></div></div>
<div class="ttc" id="xct__manager_8hpp_html"><div class="ttname"><a href="xct__manager_8hpp.html">xct_manager.hpp</a></div></div>
<div class="ttc" id="group__XCT_html_ga9ac5dae4b91a288e9d887f28a7124c13"><div class="ttname"><a href="group__XCT.html#ga9ac5dae4b91a288e9d887f28a7124c13">foedus::xct::IsolationLevel</a></div><div class="ttdeci">IsolationLevel</div><div class="ttdoc">Specifies the level of isolation during transaction processing. </div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l00055">xct_id.hpp:55</a></div></div>
<div class="ttc" id="group__ARRAY_html_ga2823bcd484e4e7cb47ceca880584000a"><div class="ttname"><a href="group__ARRAY.html#ga2823bcd484e4e7cb47ceca880584000a">foedus::storage::hash::hash_intermediate_volatile_page_init</a></div><div class="ttdeci">void hash_intermediate_volatile_page_init(const VolatilePageInitArguments &amp;args)</div><div class="ttdoc">volatile page initialize callback for HashIntermediatePage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8cpp_source.html#l00213">hash_page_impl.cpp:213</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_a49863802f2bfb024c928a37ea7abce07"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#a49863802f2bfb024c928a37ea7abce07">foedus::storage::hash::HashDataPage::record_from_offset</a></div><div class="ttdeci">char * record_from_offset(uint16_t offset)</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00275">hash_page_impl.hpp:275</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaa3832e1d1faf1540161d389edf2a9c17"><div class="ttname"><a href="group__ERRORCODES.html#gaa3832e1d1faf1540161d389edf2a9c17">CHECK_ERROR_CODE</a></div><div class="ttdeci">#define CHECK_ERROR_CODE(x)</div><div class="ttdoc">This macro calls x and checks its returned error code. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00155">error_code.hpp:155</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html">foedus::storage::hash::HashDataPage</a></div><div class="ttdoc">Represents an individual data page in Hashtable Storage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00155">hash_page_impl.hpp:155</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1Xct_html_abae2ae5210db8eda39a1507940bf7352"><div class="ttname"><a href="classfoedus_1_1xct_1_1Xct.html#abae2ae5210db8eda39a1507940bf7352">foedus::xct::Xct::get_isolation_level</a></div><div class="ttdeci">IsolationLevel get_isolation_level() const </div><div class="ttdoc">Returns the level of isolation for this transaction. </div><div class="ttdef"><b>Definition:</b> <a href="xct_8hpp_source.html#l00149">xct.hpp:149</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_ac977ed25935d3fa3a8d9651f96349c32"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac977ed25935d3fa3a8d9651f96349c32">foedus::storage::hash::HashDataPage::next_page</a></div><div class="ttdeci">const DualPagePointer &amp; next_page() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00238">hash_page_impl.hpp:238</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashInsertLogType.html">foedus::storage::hash::HashInsertLogType</a></div><div class="ttdoc">Log type of hash-storage&#39;s insert operation. </div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00209">hash_log_types.hpp:209</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_ac653a03fd75011048550f8e9f5dd198d"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac653a03fd75011048550f8e9f5dd198d">foedus::storage::hash::HashDataPage::header</a></div><div class="ttdeci">PageHeader &amp; header()</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00225">hash_page_impl.hpp:225</a></div></div>
<div class="ttc" id="group__ARRAY_html_ga8423aae479f4b36ddc54127b07268c8c"><div class="ttname"><a href="group__ARRAY.html#ga8423aae479f4b36ddc54127b07268c8c">foedus::storage::hash::hash_data_volatile_page_init</a></div><div class="ttdeci">void hash_data_volatile_page_init(const VolatilePageInitArguments &amp;args)</div><div class="ttdoc">volatile page initialize callback for HashDataPage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8cpp_source.html#l00232">hash_page_impl.cpp:232</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1VolatilePagePointer_html_ad9d25c0d8211f93db82d8cefe9d6ead7"><div class="ttname"><a href="structfoedus_1_1storage_1_1VolatilePagePointer.html#ad9d25c0d8211f93db82d8cefe9d6ead7">foedus::storage::VolatilePagePointer::is_null</a></div><div class="ttdeci">bool is_null() const </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00210">storage_id.hpp:210</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga72a80915c3588aea09c053ab567e19c4"><div class="ttname"><a href="group__ERRORCODES.html#ga72a80915c3588aea09c053ab567e19c4">CHECK_ERROR</a></div><div class="ttdeci">#define CHECK_ERROR(x)</div><div class="ttdoc">This macro calls x and checks its returned value. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00517">error_stack.hpp:517</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashOverwriteLogType.html">foedus::storage::hash::HashOverwriteLogType</a></div><div class="ttdoc">Log type of hash-storage&#39;s overwrite operation. </div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00377">hash_log_types.hpp:377</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_a1d282ef110938539f04d42aeeb228fcf"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a1d282ef110938539f04d42aeeb228fcf">foedus::storage::hash::RecordLocation::observed_</a></div><div class="ttdeci">xct::XctId observed_</div><div class="ttdoc">TID as of locate_record() identifying the record. </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00100">hash_record_location.hpp:100</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageVersion_html_ad7d5aa3f29f70df46aa87d6c0e95a2a0"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageVersion.html#ad7d5aa3f29f70df46aa87d6c0e95a2a0">foedus::storage::PageVersion::status_</a></div><div class="ttdeci">PageVersionStatus status_</div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00172">page.hpp:172</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56ae0409810fc5028d8885fe6025cb6fdbe"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56ae0409810fc5028d8885fe6025cb6fdbe">foedus::kErrorCodeStrTooSmallPayloadBuffer</a></div><div class="ttdoc">0x0809 : "STORAGE: The record&#39;s payload is larger than the buffer" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00175">error_code.hpp:175</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageVersionStatus_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageVersionStatus.html">foedus::storage::PageVersionStatus</a></div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00059">page.hpp:59</a></div></div>
<div class="ttc" id="namespacefoedus_1_1storage_html_a67e1af2de6e13b000e66609cf60849b6"><div class="ttname"><a href="namespacefoedus_1_1storage.html#a67e1af2de6e13b000e66609cf60849b6">foedus::storage::construct_volatile_page_pointer</a></div><div class="ttdeci">VolatilePagePointer construct_volatile_page_pointer(uint64_t word)</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00230">storage_id.hpp:230</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga61f52cd33eb500d6997a91e704ace244"><div class="ttname"><a href="group__ERRORCODES.html#ga61f52cd33eb500d6997a91e704ace244">foedus::kRetOk</a></div><div class="ttdeci">const ErrorStack kRetOk</div><div class="ttdoc">Normal return value for no-error case. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00251">error_stack.hpp:251</a></div></div>
<div class="ttc" id="hash__metadata_8hpp_html"><div class="ttname"><a href="hash__metadata_8hpp.html">hash_metadata.hpp</a></div></div>
<div class="ttc" id="structfoedus_1_1memory_1_1LocalPageResolver_html"><div class="ttname"><a href="structfoedus_1_1memory_1_1LocalPageResolver.html">foedus::memory::LocalPageResolver</a></div><div class="ttdoc">Resolves an offset in local (same NUMA node) page pool to a pointer and vice versa. </div><div class="ttdef"><b>Definition:</b> <a href="page__resolver_8hpp_source.html#l00042">page_resolver.hpp:42</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html">foedus::storage::hash::RecordLocation</a></div><div class="ttdoc">return value of locate_record(). </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00076">hash_record_location.hpp:76</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashMetadata_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashMetadata.html">foedus::storage::hash::HashMetadata</a></div><div class="ttdoc">Metadata of an hash storage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__metadata_8hpp_source.html#l00040">hash_metadata.hpp:40</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashMetadata_html_ac79017c3fbfd8dde111006ba43e97a5e"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashMetadata.html#ac79017c3fbfd8dde111006ba43e97a5e">foedus::storage::hash::HashMetadata::get_bin_count</a></div><div class="ttdeci">uint64_t get_bin_count() const </div><div class="ttdoc">Number of bins in this hash storage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__metadata_8hpp_source.html#l00062">hash_metadata.hpp:62</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a79c499b589d9e31709b066f1457bc1e3"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a79c499b589d9e31709b066f1457bc1e3">foedus::storage::hash::HashStoragePimpl::drop</a></div><div class="ttdeci">ErrorStack drop()</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00059">hash_storage_pimpl.cpp:59</a></div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_aa07f33f2b78aa6e6c66a2149b1db52e8"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#aa07f33f2b78aa6e6c66a2149b1db52e8">foedus::thread::Thread::get_numa_node</a></div><div class="ttdeci">ThreadGroupId get_numa_node() const </div><div class="ttdef"><b>Definition:</b> <a href="thread_8hpp_source.html#l00066">thread.hpp:66</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1NumaNodeMemoryRef_html_a70b68580143ce771f5b5b1f9a209f774"><div class="ttname"><a href="classfoedus_1_1memory_1_1NumaNodeMemoryRef.html#a70b68580143ce771f5b5b1f9a209f774">foedus::memory::NumaNodeMemoryRef::get_volatile_pool</a></div><div class="ttdeci">PagePool * get_volatile_pool()</div><div class="ttdef"><b>Definition:</b> <a href="numa__node__memory_8hpp_source.html#l00175">numa_node_memory.hpp:175</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1Xct_html_a68b92830ccd52b310445b41bfef06fd7"><div class="ttname"><a href="classfoedus_1_1xct_1_1Xct.html#a68b92830ccd52b310445b41bfef06fd7">foedus::xct::Xct::add_to_page_version_set</a></div><div class="ttdeci">ErrorCode add_to_page_version_set(const storage::PageVersion *version_address, storage::PageVersionStatus observed)</div><div class="ttdoc">Add the given page version to the page version set of this transaction. </div><div class="ttdef"><b>Definition:</b> <a href="xct_8cpp_source.html#l00242">xct.cpp:242</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_a6ddc93fb5df01249140895435819da2f"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a6ddc93fb5df01249140895435819da2f">foedus::storage::hash::HashIntermediatePage::get_level</a></div><div class="ttdeci">uint8_t get_level() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00105">hash_page_impl.hpp:105</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga641117f56315b0f239d72948cf5aa56f"><div class="ttname"><a href="group__ASSORTED.html#ga641117f56315b0f239d72948cf5aa56f">foedus::assorted::memory_fence_consume</a></div><div class="ttdeci">void memory_fence_consume()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_consume). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00081">atomic_fences.hpp:81</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_a10e3254ae3fdff2451ba6358ea477bad"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a10e3254ae3fdff2451ba6358ea477bad">foedus::storage::hash::RecordLocation::readset_</a></div><div class="ttdeci">xct::ReadXctAccess * readset_</div><div class="ttdoc">If this method took a read-set on the returned record, points to the corresponding read-set...</div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00106">hash_record_location.hpp:106</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gac6707c46c408c0bd492f44d648bf9e10"><div class="ttname"><a href="group__ERRORCODES.html#gac6707c46c408c0bd492f44d648bf9e10">ERROR_STACK_MSG</a></div><div class="ttdeci">#define ERROR_STACK_MSG(e, m)  </div><div class="ttdoc">Overload of ERROR_STACK(e) to receive a custom error message. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00498">error_stack.hpp:498</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_a79fd2ce938148e214062b663ee8ce524"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#a79fd2ce938148e214062b663ee8ce524">foedus::storage::PageHeader::stat_last_updater_node_</a></div><div class="ttdeci">uint8_t stat_last_updater_node_</div><div class="ttdoc">A loosely maintained statistics for volatile pages. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00251">page.hpp:251</a></div></div>
<div class="ttc" id="group__ASSORTED_html_gaf84f9944a16c5848f69beacdfeedf939"><div class="ttname"><a href="group__ASSORTED.html#gaf84f9944a16c5848f69beacdfeedf939">foedus::assorted::memory_fence_acquire</a></div><div class="ttdeci">void memory_fence_acquire()</div><div class="ttdoc">Equivalent to std::atomic_thread_fence(std::memory_order_acquire). </div><div class="ttdef"><b>Definition:</b> <a href="atomic__fences_8hpp_source.html#l00046">atomic_fences.hpp:46</a></div></div>
<div class="ttc" id="structfoedus_1_1memory_1_1GlobalVolatilePageResolver_html"><div class="ttname"><a href="structfoedus_1_1memory_1_1GlobalVolatilePageResolver.html">foedus::memory::GlobalVolatilePageResolver</a></div><div class="ttdoc">Resolves an offset in a volatile page pool to an actual pointer and vice versa. </div><div class="ttdef"><b>Definition:</b> <a href="page__resolver_8hpp_source.html#l00092">page_resolver.hpp:92</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Page_html_abee44ea141b30e613f3de40831d6ff8e"><div class="ttname"><a href="structfoedus_1_1storage_1_1Page.html#abee44ea141b30e613f3de40831d6ff8e">foedus::storage::Page::get_header</a></div><div class="ttdeci">PageHeader &amp; get_header()</div><div class="ttdoc">At least the basic header exists in all pages. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00336">page.hpp:336</a></div></div>
<div class="ttc" id="group__HASH_html_ga4398665205e13bd71e8b2c1691ba1ba3"><div class="ttname"><a href="group__HASH.html#ga4398665205e13bd71e8b2c1691ba1ba3">foedus::storage::hash::kHashIntermediatePageFanout</a></div><div class="ttdeci">const uint8_t kHashIntermediatePageFanout</div><div class="ttdoc">Number of pointers in an intermediate page of hash storage. </div><div class="ttdef"><b>Definition:</b> <a href="hash__id_8hpp_source.html#l00049">hash_id.hpp:49</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageVersionStatus_html_a8360836cebd9fbeadfeb2a31809270c2"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageVersionStatus.html#a8360836cebd9fbeadfeb2a31809270c2">foedus::storage::PageVersionStatus::has_next_page</a></div><div class="ttdeci">bool has_next_page() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00073">page.hpp:73</a></div></div>
<div class="ttc" id="group__ASSORTED_html_ga9a445a5c4fdb310f0b26cab5964aec04"><div class="ttname"><a href="group__ASSORTED.html#ga9a445a5c4fdb310f0b26cab5964aec04">INSTANTIATE_ALL_NUMERIC_TYPES</a></div><div class="ttdeci">#define INSTANTIATE_ALL_NUMERIC_TYPES(M)</div><div class="ttdoc">INSTANTIATE_ALL_TYPES minus std::string. </div><div class="ttdef"><b>Definition:</b> <a href="assorted__func_8hpp_source.html#l00320">assorted_func.hpp:320</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1VolatilePagePointer_html_aa8c59b8e2944d4a6a68d5fed840a7a29"><div class="ttname"><a href="structfoedus_1_1storage_1_1VolatilePagePointer.html#aa8c59b8e2944d4a6a68d5fed840a7a29">foedus::storage::VolatilePagePointer::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00211">storage_id.hpp:211</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType_html_a04238b5b4aec46d0a24b5489553b793a"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCommonLogType.html#a04238b5b4aec46d0a24b5489553b793a">foedus::storage::hash::HashCommonLogType::calculate_log_length</a></div><div class="ttdeci">static uint16_t calculate_log_length(uint16_t key_length, uint16_t payload_count) __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00095">hash_log_types.hpp:95</a></div></div>
<div class="ttc" id="classfoedus_1_1memory_1_1PagePool_html_a18916c76eea7aa49572e69e48e75717e"><div class="ttname"><a href="classfoedus_1_1memory_1_1PagePool.html#a18916c76eea7aa49572e69e48e75717e">foedus::memory::PagePool::get_resolver</a></div><div class="ttdeci">const LocalPageResolver &amp; get_resolver() const </div><div class="ttdoc">Gives an object to resolve an offset in this page pool (thus local) to an actual pointer and vice ver...</div><div class="ttdef"><b>Definition:</b> <a href="page__pool_8cpp_source.html#l00146">page_pool.cpp:146</a></div></div>
<div class="ttc" id="structfoedus_1_1log_1_1RecordLogType_html"><div class="ttname"><a href="structfoedus_1_1log_1_1RecordLogType.html">foedus::log::RecordLogType</a></div><div class="ttdoc">Base class for log type of record-wise operation. </div><div class="ttdef"><b>Definition:</b> <a href="common__log__types_8hpp_source.html#l00181">common_log_types.hpp:181</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_ac6b4a13e6f057be1874f637fb9f87c51"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#ac6b4a13e6f057be1874f637fb9f87c51">foedus::storage::hash::HashDataPage::get_record_count</a></div><div class="ttdeci">uint16_t get_record_count() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00246">hash_page_impl.hpp:246</a></div></div>
<div class="ttc" id="thread__log__buffer_8hpp_html"><div class="ttname"><a href="thread__log__buffer_8hpp.html">thread_log_buffer.hpp</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_acfa062e1acf64b882f466cca8e190fdd"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#acfa062e1acf64b882f466cca8e190fdd">foedus::storage::hash::HashDataPage::get_bin</a></div><div class="ttdeci">HashBin get_bin() const </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00412">hash_page_impl.hpp:412</a></div></div>
<div class="ttc" id="group__COMPILER_html_ga967462e28f63546ee191a661cd4b9dd2"><div class="ttname"><a href="group__COMPILER.html#ga967462e28f63546ee191a661cd4b9dd2">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)    </div><div class="ttdoc">Hints that x is highly likely false. </div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00104">compiler.hpp:104</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_ac0baf9ee636d13c02d334ce779cc6a8f"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#ac0baf9ee636d13c02d334ce779cc6a8f">foedus::storage::PageHeader::snapshot_</a></div><div class="ttdeci">bool snapshot_</div><div class="ttdoc">Whether this page image is of a snapshot page. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00211">page.hpp:211</a></div></div>
<div class="ttc" id="structfoedus_1_1xct_1_1XctId_html_a41264f4ced33dae443651f57bc09e964"><div class="ttname"><a href="structfoedus_1_1xct_1_1XctId.html#a41264f4ced33dae443651f57bc09e964">foedus::xct::XctId::is_moved</a></div><div class="ttdeci">bool is_moved() const __attribute__((always_inline))</div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l01041">xct_id.hpp:1041</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1VolatilePagePointer_html_adb76c33cd20ea764c7a8e554e8201077"><div class="ttname"><a href="structfoedus_1_1storage_1_1VolatilePagePointer.html#adb76c33cd20ea764c7a8e554e8201077">foedus::storage::VolatilePagePointer::get_numa_node</a></div><div class="ttdeci">uint8_t get_numa_node() const </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00201">storage_id.hpp:201</a></div></div>
<div class="ttc" id="hash__id_8hpp_html"><div class="ttname"><a href="hash__id_8hpp.html">hash_id.hpp</a></div><div class="ttdoc">Definitions of IDs in this package and a few related constant values. </div></div>
<div class="ttc" id="classfoedus_1_1thread_1_1Thread_html_a2a5e6b008138d755e7e401f25927400c"><div class="ttname"><a href="classfoedus_1_1thread_1_1Thread.html#a2a5e6b008138d755e7e401f25927400c">foedus::thread::Thread::run_nested_sysxct</a></div><div class="ttdeci">ErrorCode run_nested_sysxct(xct::SysxctFunctor *functor, uint32_t max_retries=0)</div><div class="ttdoc">Methods related to System transactions (sysxct) nested under this thread. </div><div class="ttdef"><b>Definition:</b> <a href="thread__pimpl_8cpp_source.html#l00952">thread_pimpl.cpp:952</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_ga952ce4f5f860d7b28a70095b450d3f4d"><div class="ttname"><a href="group__ERRORCODES.html#ga952ce4f5f860d7b28a70095b450d3f4d">WRAP_ERROR_CODE</a></div><div class="ttdeci">#define WRAP_ERROR_CODE(x)</div><div class="ttdoc">Same as CHECK_ERROR(x) except it receives only an error code, thus more efficient. </div><div class="ttdef"><b>Definition:</b> <a href="error__stack_8hpp_source.html#l00533">error_stack.hpp:533</a></div></div>
<div class="ttc" id="raw__atomics_8hpp_html"><div class="ttname"><a href="raw__atomics_8hpp.html">raw_atomics.hpp</a></div><div class="ttdoc">Raw atomic operations that work for both C++11 and non-C++11 code. </div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1StorageControlBlock_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1StorageControlBlock.html">foedus::storage::StorageControlBlock</a></div><div class="ttdoc">A base layout of shared data for all storage types. </div><div class="ttdef"><b>Definition:</b> <a href="storage_8hpp_source.html#l00053">storage.hpp:53</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage_html_a9027ebbc2ee535519916906978347be9"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashIntermediatePage.html#a9027ebbc2ee535519916906978347be9">foedus::storage::hash::HashIntermediatePage::get_pointer</a></div><div class="ttdeci">DualPagePointer &amp; get_pointer(uint16_t index)</div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00080">hash_page_impl.hpp:80</a></div></div>
<div class="ttc" id="engine__memory_8hpp_html"><div class="ttname"><a href="engine__memory_8hpp.html">engine_memory.hpp</a></div></div>
<div class="ttc" id="classfoedus_1_1log_1_1ThreadLogBuffer_html_a9a8c4e8f3a994272f52ddddb312f15b9"><div class="ttname"><a href="classfoedus_1_1log_1_1ThreadLogBuffer.html#a9a8c4e8f3a994272f52ddddb312f15b9">foedus::log::ThreadLogBuffer::reserve_new_log</a></div><div class="ttdeci">char * reserve_new_log(uint16_t log_length) __attribute__((always_inline))</div><div class="ttdoc">Reserves a space for a new (uncommitted) log entry at the tail. </div><div class="ttdef"><b>Definition:</b> <a href="thread__log__buffer_8hpp_source.html#l00320">thread_log_buffer.hpp:320</a></div></div>
<div class="ttc" id="classfoedus_1_1xct_1_1Xct_html_adfd2125c9cc252494693f65719ed53b3"><div class="ttname"><a href="classfoedus_1_1xct_1_1Xct.html#adfd2125c9cc252494693f65719ed53b3">foedus::xct::Xct::add_to_pointer_set</a></div><div class="ttdeci">ErrorCode add_to_pointer_set(const storage::VolatilePagePointer *pointer_address, storage::VolatilePagePointer observed)</div><div class="ttdoc">Add the given page pointer to the pointer set of this transaction. </div><div class="ttdef"><b>Definition:</b> <a href="xct_8cpp_source.html#l00198">xct.cpp:198</a></div></div>
<div class="ttc" id="classfoedus_1_1Engine_html_a02ed05009c7baa8d75e04f202a86b2c6"><div class="ttname"><a href="classfoedus_1_1Engine.html#a02ed05009c7baa8d75e04f202a86b2c6">foedus::Engine::get_memory_manager</a></div><div class="ttdeci">memory::EngineMemory * get_memory_manager() const </div><div class="ttdoc">See Memory Manager. </div><div class="ttdef"><b>Definition:</b> <a href="engine_8cpp_source.html#l00050">engine.cpp:50</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashCombo_html_ae8e54d1781b0ae35653dab3db947b55f"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashCombo.html#ae8e54d1781b0ae35653dab3db947b55f">foedus::storage::hash::HashCombo::bin_</a></div><div class="ttdeci">HashBin bin_</div><div class="ttdef"><b>Definition:</b> <a href="hash__combo_8hpp_source.html#l00050">hash_combo.hpp:50</a></div></div>
<div class="ttc" id="group__STORAGE_html_ga1a3c05fe1d44455fc3e761947c6e21e6"><div class="ttname"><a href="group__STORAGE.html#ga1a3c05fe1d44455fc3e761947c6e21e6">foedus::storage::kPageSize</a></div><div class="ttdeci">const uint16_t kPageSize</div><div class="ttdoc">A constant defining the page size (in bytes) of both snapshot pages and volatile pages. </div><div class="ttdef"><b>Definition:</b> <a href="storage__id_8hpp_source.html#l00045">storage_id.hpp:45</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a357386c8e5be667334520a33aff51725"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a357386c8e5be667334520a33aff51725">foedus::storage::hash::HashStoragePimpl::delete_record</a></div><div class="ttdeci">ErrorCode delete_record(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00356">hash_storage_pimpl.cpp:356</a></div></div>
<div class="ttc" id="group__ERRORCODES_html_gaae5f98d1b4caace7febc49e59ae5ac56"><div class="ttname"><a href="group__ERRORCODES.html#gaae5f98d1b4caace7febc49e59ae5ac56">foedus::ErrorCode</a></div><div class="ttdeci">ErrorCode</div><div class="ttdoc">Enum of error codes defined in error_code.xmacro. </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00085">error_code.hpp:85</a></div></div>
<div class="ttc" id="group__STORAGE_html_gga14e35f7fbe4bc18276fde8e8ba460f5ba6c1740f811f2524fac6cd76aa2a31c6c"><div class="ttname"><a href="group__STORAGE.html#gga14e35f7fbe4bc18276fde8e8ba460f5ba6c1740f811f2524fac6cd76aa2a31c6c">foedus::storage::kHashDataPageType</a></div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00054">page.hpp:54</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashDataPage_html_aa03f1438dc159688f49de6e73c851d6e"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashDataPage.html#aa03f1438dc159688f49de6e73c851d6e">foedus::storage::hash::HashDataPage::search_key_physical</a></div><div class="ttdeci">DataPageSlotIndex search_key_physical(HashValue hash, const BloomFilterFingerprint &amp;fingerprint, const void *key, KeyLength key_length, DataPageSlotIndex record_count, DataPageSlotIndex check_from=0) const </div><div class="ttdoc">Search for a physical slot that exactly contains the given key. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8cpp_source.html#l00106">hash_page_impl.cpp:106</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_a9bb073e86887f562d049b2d0a2e726cd"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a9bb073e86887f562d049b2d0a2e726cd">foedus::storage::hash::RecordLocation::index_</a></div><div class="ttdeci">DataPageSlotIndex index_</div><div class="ttdoc">Index of the record in the page. </div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00080">hash_record_location.hpp:80</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a49df48b50c0c645d3a047e8b153c4015"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a49df48b50c0c645d3a047e8b153c4015">foedus::storage::hash::HashStoragePimpl::upsert_record</a></div><div class="ttdeci">ErrorCode upsert_record(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, const void *payload, uint16_t payload_count, uint16_t physical_payload_hint)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00390">hash_storage_pimpl.cpp:390</a></div></div>
<div class="ttc" id="namespacefoedus_html_gaae5f98d1b4caace7febc49e59ae5ac56adfc9588c95653090f65a029c574bfc9c"><div class="ttname"><a href="namespacefoedus.html#gaae5f98d1b4caace7febc49e59ae5ac56adfc9588c95653090f65a029c574bfc9c">foedus::kErrorCodeStrKeyAlreadyExists</a></div><div class="ttdoc">0x080B : "STORAGE: This key already exists in this storage" . </div><div class="ttdef"><b>Definition:</b> <a href="error__code_8hpp_source.html#l00177">error_code.hpp:177</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a222e0d485305f3253b0e1c97720dc0c8"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a222e0d485305f3253b0e1c97720dc0c8">foedus::storage::hash::HashStoragePimpl::get_record</a></div><div class="ttdeci">ErrorCode get_record(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, void *payload, uint16_t *payload_capacity, bool read_only)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00166">hash_storage_pimpl.cpp:166</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1RecordLocation_html_a490056e5b2e5617cf640ea99d278ac21"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1RecordLocation.html#a490056e5b2e5617cf640ea99d278ac21">foedus::storage::hash::RecordLocation::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="hash__record__location_8hpp_source.html#l00114">hash_record_location.hpp:114</a></div></div>
<div class="ttc" id="group__XCT_html_gga9ac5dae4b91a288e9d887f28a7124c13a5e9c22688eea55cea2bf4380b03a8630"><div class="ttname"><a href="group__XCT.html#gga9ac5dae4b91a288e9d887f28a7124c13a5e9c22688eea55cea2bf4380b03a8630">foedus::xct::kSerializable</a></div><div class="ttdoc">Protects against all anomalies in all situations. </div><div class="ttdef"><b>Definition:</b> <a href="xct__id_8hpp_source.html#l00086">xct_id.hpp:86</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashDeleteLogType_html"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashDeleteLogType.html">foedus::storage::hash::HashDeleteLogType</a></div><div class="ttdoc">Log type of hash-storage&#39;s delete operation. </div><div class="ttdef"><b>Definition:</b> <a href="hash__log__types_8hpp_source.html#l00271">hash_log_types.hpp:271</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot_html_ac34e8c686a9cc92de76ac3a219b90528"><div class="ttname"><a href="structfoedus_1_1storage_1_1hash_1_1HashDataPage_1_1Slot.html#ac34e8c686a9cc92de76ac3a219b90528">foedus::storage::hash::HashDataPage::Slot::offset_</a></div><div class="ttdeci">uint16_t offset_</div><div class="ttdoc">Byte offset in data_ where this record starts. </div><div class="ttdef"><b>Definition:</b> <a href="hash__page__impl_8hpp_source.html#l00171">hash_page_impl.hpp:171</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_af64ca224598812767abe9631f280b105"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#af64ca224598812767abe9631f280b105">foedus::storage::hash::HashStoragePimpl::locate_record_in_snapshot</a></div><div class="ttdeci">ErrorCode locate_record_in_snapshot(thread::Thread *context, const void *key, uint16_t key_length, const HashCombo &amp;combo, HashDataPage *bin_head, RecordLocation *result)</div><div class="ttdoc">Simpler version of locate_record for when we are in snapshot world. </div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l00889">hash_storage_pimpl.cpp:889</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1PageHeader_html_a59128590fdc568e894a8973a319a0154"><div class="ttname"><a href="structfoedus_1_1storage_1_1PageHeader.html#a59128590fdc568e894a8973a319a0154">foedus::storage::PageHeader::page_id_</a></div><div class="ttdeci">uint64_t page_id_</div><div class="ttdoc">Page ID of this page. </div><div class="ttdef"><b>Definition:</b> <a href="page_8hpp_source.html#l00191">page.hpp:191</a></div></div>
<div class="ttc" id="structfoedus_1_1storage_1_1Metadata_html_ab9d6a766410a36959158818af739df34"><div class="ttname"><a href="structfoedus_1_1storage_1_1Metadata.html#ab9d6a766410a36959158818af739df34">foedus::storage::Metadata::root_snapshot_page_id_</a></div><div class="ttdeci">SnapshotPagePointer root_snapshot_page_id_</div><div class="ttdoc">Pointer to a snapshotted page this storage is rooted at. </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8hpp_source.html#l00112">metadata.hpp:112</a></div></div>
<div class="ttc" id="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl_html_a144ddbe7819e7b3576611d456aa46c77"><div class="ttname"><a href="classfoedus_1_1storage_1_1hash_1_1HashStoragePimpl.html#a144ddbe7819e7b3576611d456aa46c77">foedus::storage::hash::HashStoragePimpl::track_moved_record_search</a></div><div class="ttdeci">xct::TrackMovedRecordResult track_moved_record_search(HashDataPage *page, const void *key, uint16_t key_length, const HashCombo &amp;combo)</div><div class="ttdef"><b>Definition:</b> <a href="hash__storage__pimpl_8cpp_source.html#l01135">hash_storage_pimpl.cpp:1135</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8937f9425540f92243ad585d5de884fc.html">foedus-core</a></li><li class="navelem"><a class="el" href="dir_d7a805ee636aca3e828841913b8fee6f.html">src</a></li><li class="navelem"><a class="el" href="dir_69f399cb2d64e6ca2c29e4a5a8e5672b.html">foedus</a></li><li class="navelem"><a class="el" href="dir_7ce05622802b44ef7dab2138a2d07843.html">storage</a></li><li class="navelem"><a class="el" href="dir_dba5aa2bd69f9e2b3bc6deb0d969fb00.html">hash</a></li><li class="navelem"><a class="el" href="hash__storage__pimpl_8cpp.html">hash_storage_pimpl.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
