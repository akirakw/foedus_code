<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>libfoedus-core: Snapshot Manager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfoedus-core
   </div>
   <div id="projectbrief">FOEDUS Core Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/centos7/"><span>Jenkins&#160;(x86_64&#160;Fedora)</span></a></li>
      <li><a href="http://cihead.labs.hpe.com/ub1404/"><span>Jenkins&#160;(x86_64&#160;Ubuntu)</span></a></li>
      <li><a href="http://ms01915-003.hpl.hp.com:8080/"><span>Jenkins&#160;(aarch64&#160;Ubuntu)</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/tree/master"><span>Github</span></a></li>
      <li><a href="http://github.com/hkimura/foedus_code/wiki"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__SNAPSHOT.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Snapshot Manager<div class="ingroups"><a class="el" href="group__COMPONENTS.html">FOEDUS Components</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><b>Snapshot</b> <b>Manager</b>, which manages snapshot files of the database.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p><b>Snapshot</b> <b>Manager</b>, which manages snapshot files of the database. </p>
<p>This package contains classes to handle <em>snapshot</em> files.</p>
<h1><a class="anchor" id="SP"></a>
Snapshot</h1>
<p>One snapshot consists of a set of snapshot files and a snapshot metadata file (snapshot.xml). Every snapshot is tagged with <em>base</em> epoch and <em>valid-until</em> epoch. The snapshot <em>logically</em> contains all information of the database upto valid-until epoch, meaning the previous snapshot (whose valid-until should be equal to base epoch of the snapshot) as well as all log entries in the transactional log from a base epoch until valid-until epoch.</p>
<h1><a class="anchor" id="SPFiles"></a>
Snapshot Files</h1>
<p>However, the snapshot does not necessarily <em>physically</em> contains all information from the previous snapshot because it makes each snapshot-ing too expensive. One common approach is LSM-Tree (Log Structured Merge Tree), but it is not a good fit for serializable transactional processing. Even a trivial primary key constraint would be too expensive on top of LSM-Tree.</p>
<p>Instead, snapshot files in FOEDUS are <b>overlays</b> of the database image. Each snapshot file contains new version of data pages that <b>overwrite</b> a required portion of storages. They are not incremental new-tuples/tombstones data as in LSM. They are a complete representation of the storages, but it might contain pointers to old snapshot files if pages under it had no change.</p>
<p>In the worst case, transactions in one epoch updates just one tuple in every page, resulting in a snapshot that physically contains all data. However, it is rare and such a workload is fundamentally expensive if data size does not fit DRAM (if it does, this approach is also fine).</p>
<h1><a class="anchor" id="SNAPSHOTTING"></a>
Making a new Snapshot</h1>
<p>Snapshot Manager creates a new set of snapshot files as well as its metadata file occasionally. The frequency is a tuning knob. The mechanism to create snapshot files is called <b>Log-Gleaner</b> (<a class="el" href="classfoedus_1_1snapshot_1_1LogGleaner.html" title="A log-gleaner, which constructs a new set of snapshot files during snapshotting. ">foedus::snapshot::LogGleaner</a>). See its documentation below.</p>
<h1><a class="anchor" id="GLEANER_OVERVIEW"></a>
Log Gleaner Overview</h1>
<p>LogGleaner is the main class that manages most mechanisms to construct a new set of snapshot files. Snapshot procedure constructs and calls this object during snapshot. It receives partitioning policy (which snapshot partitions to send ranges of keys) per storage and beginning/ending epoch of logs to <em>glean</em> while log-gleaning.</p>
<p>Log-gleaning consists of two components; <b>mapper</b> (<a class="el" href="classfoedus_1_1snapshot_1_1LogMapper.html" title="A log mapper, which reads log files from one logger and sends them to corresponding log reducers...">foedus::snapshot::LogMapper</a>) and <b>reducer</b> (<a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html" title="A log reducer, which receives log entries sent from mappers and applies them to construct new snapsho...">foedus::snapshot::LogReducer</a>), obviously named after the well-known map-reduce concepts.</p>
<h1><a class="anchor" id="GLEANER_MAPPER"></a>
Mapper</h1>
<p>LogGleaner launches a set of mapper threads (<a class="el" href="classfoedus_1_1snapshot_1_1LogMapper.html" title="A log mapper, which reads log files from one logger and sends them to corresponding log reducers...">foedus::snapshot::LogMapper</a>) to read log files. Each LogMapper corresponds to <a class="el" href="classfoedus_1_1log_1_1Logger.html" title="A log writer that writes out buffered logs to stable storages. ">foedus::log::Logger</a>, the NUMA-local log writer which simply writes out log entries produced by local worker threads. Thus, the log files contain log entries that might be sent to any partitions. LogMapper <em>maps</em> each log entry to some partition and send it to a reducer corresponding to the partition. For more details, see <a class="el" href="classfoedus_1_1snapshot_1_1LogMapper.html" title="A log mapper, which reads log files from one logger and sends them to corresponding log reducers...">foedus::snapshot::LogMapper</a>.</p>
<h1><a class="anchor" id="GLEANER_REDUCER"></a>
Reducer</h1>
<p>LogGleaner also launches a set of reducer threads (<a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html" title="A log reducer, which receives log entries sent from mappers and applies them to construct new snapsho...">foedus::snapshot::LogReducer</a>), one for each NUMA node. LogReducer sorts log entries sent from LogMapper. The log entries are sorted by key and ordinal (*), then processed just like usual APPLY at the end of transaction, but on top of snapshot files.</p>
<p>(*) otherwise correct result is not guaranteed. For example, imagine the following case: </p><ul>
<li>UPDATE rec-1 to A. Log-ordinal 1. </li>
<li>UPDATE rec-1 to B. Log-ordinal 2.</li>
</ul>
<p>Ordinal-1 must be processed before ordinal 2.</p>
<h1><a class="anchor" id="GLEANER_SYNC"></a>
Synchronization</h1>
<p>LogGleaner coordinates the synchronization between mappers and reducers during snapshotting. At the beginning of snapshotting, gleaner wakes up reducers and mappers. Mappers go in to sleep when they process all logs. When all mappers went to sleep, reducers start to also go into sleep when they process all logs they receive. When all of them are done, gleaner initiates the last wrap-up phase. Additionally, LogGleaner is in charge of receiving termination request from the engine if the user invokes Engine::uninitialize() and requesting reducers/mappers to stop.</p>
<p>Reducers/mappers occasionally check if they are requested to stop when they get idle or complete all work. They do the check at least once for a while so that the latency to stop can not be catastrophic.</p>
<h1><a class="anchor" id="GLEANER_ROOT"></a>
Constructing Root Pages</h1>
<p>After all mappers and reducers complete, the last phase of log gleaning is to construct root pages for the storages modified in this snapshotting. Gleaner collects <em>root-page-info</em> from each reducer and combines them to create the root page(s). When all set, gleaner produces maps from storage ID to a new root page ID. This will be written out in a snapshot metadata file by snapshot manager.</p>
<dl class="section note"><dt>Note</dt><dd>This is a private implementation-details of <a class="el" href="group__SNAPSHOT.html">Snapshot Manager</a>, thus file name ends with _impl. Do not include this header from a client program. There is no case client program needs to access this internal class. </dd></dl>
<div class="dynheader">
Collaboration diagram for Snapshot Manager:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__SNAPSHOT.png" border="0" alt="" usemap="#group____SNAPSHOT"/>
<map name="group____SNAPSHOT" id="group____SNAPSHOT">
<area shape="rect" id="node1" href="group__STORAGE.html" title="Storage Manager, which implements a couple of key/value stores. " alt="" coords="544,124,665,151"/>
<area shape="rect" id="node3" href="group__COMPONENTS.html" title="Main modules of libfoedus. " alt="" coords="5,124,159,151"/>
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:snapshot_2fwd_8hpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snapshot_2fwd_8hpp.html">fwd.hpp</a></td></tr>
<tr class="memdesc:snapshot_2fwd_8hpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forward declarations of classes in snapshot manager package. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:snapshot__id_8hpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snapshot__id_8hpp.html">snapshot_id.hpp</a></td></tr>
<tr class="memdesc:snapshot__id_8hpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">Typedefs of ID types used in snapshot package. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1LogBuffer.html">foedus::snapshot::LogBuffer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Packages handling of 4-bytes representation of position in log buffers.  <a href="structfoedus_1_1snapshot_1_1LogBuffer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SortedBuffer.html">foedus::snapshot::SortedBuffer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents one input stream of sorted log entries.  <a href="classfoedus_1_1snapshot_1_1SortedBuffer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1InMemorySortedBuffer.html">foedus::snapshot::InMemorySortedBuffer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of <a class="el" href="classfoedus_1_1snapshot_1_1SortedBuffer.html" title="Represents one input stream of sorted log entries. ">SortedBuffer</a> that is backed by fully in-memory buffer.  <a href="classfoedus_1_1snapshot_1_1InMemorySortedBuffer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1DumpFileSortedBuffer.html">foedus::snapshot::DumpFileSortedBuffer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of <a class="el" href="classfoedus_1_1snapshot_1_1SortedBuffer.html" title="Represents one input stream of sorted log entries. ">SortedBuffer</a> that is backed by a dumped file.  <a href="classfoedus_1_1snapshot_1_1DumpFileSortedBuffer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1LogGleaner.html">foedus::snapshot::LogGleaner</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A log-gleaner, which constructs a new set of snapshot files during snapshotting.  <a href="classfoedus_1_1snapshot_1_1LogGleaner.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1LogGleanerRef.html">foedus::snapshot::LogGleanerRef</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A remote view of <a class="el" href="classfoedus_1_1snapshot_1_1LogGleaner.html" title="A log-gleaner, which constructs a new set of snapshot files during snapshotting. ">LogGleaner</a> from all engines.  <a href="classfoedus_1_1snapshot_1_1LogGleanerRef.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1LogGleanerResource_1_1PerNodeResource.html">foedus::snapshot::LogGleanerResource::PerNodeResource</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">These buffers are used to read intermediate results from each reducer to compose the root page or other kinds of pages that weren't composed in each reducer (eg.  <a href="structfoedus_1_1snapshot_1_1LogGleanerResource_1_1PerNodeResource.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html">foedus::snapshot::LogGleanerResource</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Local resource for the log gleaner, which runs only in the master node.  <a href="structfoedus_1_1snapshot_1_1LogGleanerResource.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1LogMapper.html">foedus::snapshot::LogMapper</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A log mapper, which reads log files from one logger and sends them to corresponding log reducers.  <a href="classfoedus_1_1snapshot_1_1LogMapper.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfoedus_1_1snapshot_1_1ReducerBufferStatus_1_1Components"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SNAPSHOT.html#structfoedus_1_1snapshot_1_1ReducerBufferStatus_1_1Components">foedus::snapshot::ReducerBufferStatus::Components</a></td></tr>
<tr class="separator:structfoedus_1_1snapshot_1_1ReducerBufferStatus_1_1Components"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">union &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unionfoedus_1_1snapshot_1_1ReducerBufferStatus.html">foedus::snapshot::ReducerBufferStatus</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compactly represents important status informations of a reducer buffer.  <a href="unionfoedus_1_1snapshot_1_1ReducerBufferStatus.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1BlockHeaderBase.html">foedus::snapshot::BlockHeaderBase</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">All log blocks in mapper/reducers start with this header.  <a href="structfoedus_1_1snapshot_1_1BlockHeaderBase.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1FullBlockHeader.html">foedus::snapshot::FullBlockHeader</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">All blocks that have content start with this header.  <a href="structfoedus_1_1snapshot_1_1FullBlockHeader.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1LogReducerControlBlock.html">foedus::snapshot::LogReducerControlBlock</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shared data for <a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html" title="A log reducer, which receives log entries sent from mappers and applies them to construct new snapsho...">LogReducer</a>.  <a href="structfoedus_1_1snapshot_1_1LogReducerControlBlock.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html">foedus::snapshot::LogReducer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A log reducer, which receives log entries sent from mappers and applies them to construct new snapshot files.  <a href="classfoedus_1_1snapshot_1_1LogReducer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1LogReducerRef.html">foedus::snapshot::LogReducerRef</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A remote view of <a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html" title="A log reducer, which receives log entries sent from mappers and applies them to construct new snapsho...">LogReducer</a> from all engines.  <a href="classfoedus_1_1snapshot_1_1LogReducerRef.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1MapReduceBase.html">foedus::snapshot::MapReduceBase</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class for <a class="el" href="classfoedus_1_1snapshot_1_1LogMapper.html" title="A log mapper, which reads log files from one logger and sends them to corresponding log reducers...">LogMapper</a> and <a class="el" href="classfoedus_1_1snapshot_1_1LogReducer.html" title="A log reducer, which receives log entries sent from mappers and applies them to construct new snapsho...">LogReducer</a> to share common code.  <a href="classfoedus_1_1snapshot_1_1MapReduceBase.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1MergeSort_1_1SortEntry.html">foedus::snapshot::MergeSort::SortEntry</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Entries we actually sort.  <a href="structfoedus_1_1snapshot_1_1MergeSort_1_1SortEntry.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1MergeSort_1_1PositionEntry.html">foedus::snapshot::MergeSort::PositionEntry</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides additional information for each entry we are sorting.  <a href="structfoedus_1_1snapshot_1_1MergeSort_1_1PositionEntry.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1MergeSort_1_1InputStatus.html">foedus::snapshot::MergeSort::InputStatus</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current status of each input.  <a href="structfoedus_1_1snapshot_1_1MergeSort_1_1InputStatus.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1MergeSort_1_1AdjustComparatorMasstree.html">foedus::snapshot::MergeSort::AdjustComparatorMasstree</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used in batch_sort_adjust_sort if the storage is a masstree storage.  <a href="structfoedus_1_1snapshot_1_1MergeSort_1_1AdjustComparatorMasstree.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1MergeSort_1_1GroupifyResult.html">foedus::snapshot::MergeSort::GroupifyResult</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents a group of consecutive logs in the current batch.  <a href="structfoedus_1_1snapshot_1_1MergeSort_1_1GroupifyResult.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1MergeSort.html">foedus::snapshot::MergeSort</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receives an arbitrary number of sorted buffers and emits one fully sorted stream of logs.  <a href="classfoedus_1_1snapshot_1_1MergeSort.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html">foedus::snapshot::Snapshot</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents one snapshot that converts all logs from base epoch to valid_until epoch into snapshot file(s).  <a href="structfoedus_1_1snapshot_1_1Snapshot.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManager.html">foedus::snapshot::SnapshotManager</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html" title="Represents one snapshot that converts all logs from base epoch to valid_until epoch into snapshot fil...">Snapshot</a> manager that atomically and durably writes out a snapshot file.  <a href="classfoedus_1_1snapshot_1_1SnapshotManager.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html">foedus::snapshot::SnapshotManagerPimpl</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pimpl object of <a class="el" href="classfoedus_1_1snapshot_1_1SnapshotManager.html" title="Snapshot manager that atomically and durably writes out a snapshot file. ">SnapshotManager</a>.  <a href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1SnapshotMetadata.html">foedus::snapshot::SnapshotMetadata</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents the data in one snapshot metadata file.  <a href="structfoedus_1_1snapshot_1_1SnapshotMetadata.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1snapshot_1_1SnapshotOptions.html">foedus::snapshot::SnapshotOptions</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set of options for snapshot manager.  <a href="structfoedus_1_1snapshot_1_1SnapshotOptions.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html">foedus::snapshot::SnapshotWriter</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes out one snapshot file for all data pages in one reducer.  <a href="classfoedus_1_1snapshot_1_1SnapshotWriter.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfoedus_1_1storage_1_1Composer_1_1ComposeArguments"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">foedus::storage::Composer::ComposeArguments</a></td></tr>
<tr class="memdesc:structfoedus_1_1storage_1_1Composer_1_1ComposeArguments"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arguments for <a class="el" href="classfoedus_1_1storage_1_1Composer.html#a28c752ec784b85418c0bfafab7ee60c0" title="Construct snapshot pages from sorted run files of one storage. ">compose()</a>  <a href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ComposeArguments">More...</a><br /></td></tr>
<tr class="separator:structfoedus_1_1storage_1_1Composer_1_1ComposeArguments"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments">foedus::storage::Composer::ConstructRootArguments</a></td></tr>
<tr class="memdesc:structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arguments for <a class="el" href="classfoedus_1_1storage_1_1Composer.html#adf148cbea7c8146dec88d23d2218452c" title="Construct root page(s) for one storage based on the ouputs of compose(). ">construct_root()</a>  <a href="group__STORAGE.html#structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments">More...</a><br /></td></tr>
<tr class="separator:structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html">foedus::storage::Composer::DropVolatilesArguments</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arguments for <a class="el" href="classfoedus_1_1storage_1_1Composer.html#a0995635b97031b208127004382947acd" title="Drops volatile pages that have not been modified since the snapshotted epoch. ">drop_volatiles()</a>  <a href="structfoedus_1_1storage_1_1Composer_1_1DropVolatilesArguments.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html">foedus::storage::Composer::DropResult</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrun value of <a class="el" href="classfoedus_1_1storage_1_1Composer.html#a0995635b97031b208127004382947acd" title="Drops volatile pages that have not been modified since the snapshotted epoch. ">drop_volatiles()</a>  <a href="structfoedus_1_1storage_1_1Composer_1_1DropResult.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfoedus_1_1storage_1_1Composer.html">foedus::storage::Composer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents a logic to compose a new version of data pages for one storage.  <a href="classfoedus_1_1storage_1_1Composer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gaec32eb05303ebec1048d120f73295031"><td class="memItemLeft" align="right" valign="top">typedef uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">foedus::snapshot::SnapshotId</a></td></tr>
<tr class="memdesc:gaec32eb05303ebec1048d120f73295031"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unique ID of <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html" title="Represents one snapshot that converts all logs from base epoch to valid_until epoch into snapshot fil...">Snapshot</a>.  <a href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">More...</a><br /></td></tr>
<tr class="separator:gaec32eb05303ebec1048d120f73295031"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad2482840d665e70d93678f530b452b79"><td class="memItemLeft" align="right" valign="top">typedef uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SNAPSHOT.html#gad2482840d665e70d93678f530b452b79">foedus::snapshot::BufferPosition</a></td></tr>
<tr class="memdesc:gad2482840d665e70d93678f530b452b79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents a position in some buffer.  <a href="group__SNAPSHOT.html#gad2482840d665e70d93678f530b452b79">More...</a><br /></td></tr>
<tr class="separator:gad2482840d665e70d93678f530b452b79"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gad1370b531dc11ee1b942d3d8ad829730"><td class="memItemLeft" align="right" valign="top">SnapshotId&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730">foedus::snapshot::increment</a> (SnapshotId id)</td></tr>
<tr class="memdesc:gad1370b531dc11ee1b942d3d8ad829730"><td class="mdescLeft">&#160;</td><td class="mdescRight">Increment SnapshotId.  <a href="group__SNAPSHOT.html#gad1370b531dc11ee1b942d3d8ad829730">More...</a><br /></td></tr>
<tr class="separator:gad1370b531dc11ee1b942d3d8ad829730"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<hr/><h2 class="groupheader">Class Documentation</h2>
<a name="structfoedus_1_1snapshot_1_1ReducerBufferStatus_1_1Components" id="structfoedus_1_1snapshot_1_1ReducerBufferStatus_1_1Components"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct foedus::snapshot::ReducerBufferStatus::Components</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock">
<p>Definition at line <a class="el" href="log__reducer__impl_8hpp_source.html#l00071">71</a> of file <a class="el" href="log__reducer__impl_8hpp_source.html">log_reducer_impl.hpp</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Class Members</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a1bb6dc9193b46847d47c1c68c1f1fea7"></a>uint16_t</td>
<td class="fieldname">
active_writers_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a90ca730fb707345d1d69bc0e4bfe7ff9"></a>uint16_t</td>
<td class="fieldname">
flags_</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="af04897d1e53bd495598781eacddd253b"></a><a class="el" href="group__SNAPSHOT.html#gad2482840d665e70d93678f530b452b79">BufferPosition</a></td>
<td class="fieldname">
tail_position_</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
<a name="structfoedus_1_1storage_1_1Composer_1_1ComposeArguments" id="structfoedus_1_1storage_1_1Composer_1_1ComposeArguments"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct foedus::storage::Composer::ComposeArguments</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Arguments for <a class="el" href="classfoedus_1_1storage_1_1Composer.html#a28c752ec784b85418c0bfafab7ee60c0" title="Construct snapshot pages from sorted run files of one storage. ">compose()</a> </p>

<p>Definition at line <a class="el" href="composer_8hpp_source.html#l00095">95</a> of file <a class="el" href="composer_8hpp_source.html">composer.hpp</a>.</p>
</div><div class="dynheader">
Collaboration diagram for foedus::storage::Composer::ComposeArguments:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1Composer_1_1ComposeArguments__coll__graph.png" border="0" usemap="#foedus_1_1storage_1_1Composer_1_1ComposeArguments_coll__map" alt="Collaboration graph"/></div>
<map name="foedus_1_1storage_1_1Composer_1_1ComposeArguments_coll__map" id="foedus_1_1storage_1_1Composer_1_1ComposeArguments_coll__map">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html" title="Writes out one snapshot file for all data pages in one reducer. " alt="" coords="423,5,607,47"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1Page.html" title="Just a marker to denote that the memory region represents a data page. " alt="" coords="440,71,589,98"/>
<area shape="rect" id="node4" href="classfoedus_1_1cache_1_1SnapshotFileSet.html" title="Holds a set of read&#45;only file objects for snapshot files. " alt="" coords="411,122,618,149"/>
<area shape="rect" id="node5" href="classfoedus_1_1DefaultInitializable.html" title="Typical implementation of Initializable as a skeleton base class. " alt="" coords="187,122,359,149"/>
<area shape="rect" id="node6" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="5,122,137,149"/>
<area shape="rect" id="node7" href="classfoedus_1_1Epoch.html" title="Represents a time epoch. " alt="" coords="462,173,567,199"/>
<area shape="rect" id="node8" href="classfoedus_1_1memory_1_1AlignedMemory.html" title="Represents one memory block aligned to actual OS/hardware pages. " alt="" coords="408,223,621,250"/>
<area shape="rect" id="node9" href="classfoedus_1_1snapshot_1_1SortedBuffer.html" title="Represents one input stream of sorted log entries. " alt="" coords="431,275,598,316"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="fieldtable">
<tr><th colspan="3">Class Members</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a2357fc574d9b4b24ff7962d99fa903a6"></a><a class="el" href="classfoedus_1_1Epoch.html">Epoch</a></td>
<td class="fieldname">
base_epoch_</td>
<td class="fielddoc">
All log entries in this inputs are assured to be after this epoch. <p>Also, it is assured to be within 2^16 from this epoch. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a708121027bd0babb9a89fe0f45f5056d"></a>SortedBuffer *const *</td>
<td class="fieldname">
log_streams_</td>
<td class="fielddoc">
Sorted runs. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a4a7218b354966f4d3de56dd11c8c1725"></a>uint32_t</td>
<td class="fieldname">
log_streams_count_</td>
<td class="fielddoc">
Number of sorted runs. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a5a1088a90d1f70d8dccbec8724a8ce18"></a>SnapshotFileSet *</td>
<td class="fieldname">
previous_snapshot_files_</td>
<td class="fielddoc">
To read existing snapshots. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a2eee0b46b2de53032aceae070f993329"></a><a class="el" href="structfoedus_1_1storage_1_1Page.html">Page</a> *</td>
<td class="fieldname">
root_info_page_</td>
<td class="fielddoc">
[OUT] Returns pointers and related information that is required to construct the root page. <p>The data format depends on the composer. In all implementations, the information must fit in one page (should be, otherwise we can't have a root page) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="aad05b2c2a53ad3641caabd2fa6258782"></a>SnapshotWriter *</td>
<td class="fieldname">
snapshot_writer_</td>
<td class="fielddoc">
Writes out composed pages. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ac0cd0fa1ce2de4626b82ca9b5be9049e"></a>AlignedMemory *</td>
<td class="fieldname">
work_memory_</td>
<td class="fielddoc">
Working memory to be used in this method. <p>Automatically expand if needed. </p>
</td></tr>
</table>

</div>
</div>
<a name="structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments" id="structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct foedus::storage::Composer::ConstructRootArguments</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Arguments for <a class="el" href="classfoedus_1_1storage_1_1Composer.html#adf148cbea7c8146dec88d23d2218452c" title="Construct root page(s) for one storage based on the ouputs of compose(). ">construct_root()</a> </p>

<p>Definition at line <a class="el" href="composer_8hpp_source.html#l00124">124</a> of file <a class="el" href="composer_8hpp_source.html">composer.hpp</a>.</p>
</div><div class="dynheader">
Collaboration diagram for foedus::storage::Composer::ConstructRootArguments:</div>
<div class="dyncontent">
<div class="center"><img src="structfoedus_1_1storage_1_1Composer_1_1ConstructRootArguments__coll__graph.png" border="0" usemap="#foedus_1_1storage_1_1Composer_1_1ConstructRootArguments_coll__map" alt="Collaboration graph"/></div>
<map name="foedus_1_1storage_1_1Composer_1_1ConstructRootArguments_coll__map" id="foedus_1_1storage_1_1Composer_1_1ConstructRootArguments_coll__map">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotWriter.html" title="Writes out one snapshot file for all data pages in one reducer. " alt="" coords="1137,5,1321,47"/>
<area shape="rect" id="node3" href="structfoedus_1_1storage_1_1Page.html" title="Just a marker to denote that the memory region represents a data page. " alt="" coords="1154,71,1303,98"/>
<area shape="rect" id="node4" href="classfoedus_1_1cache_1_1SnapshotFileSet.html" title="Holds a set of read&#45;only file objects for snapshot files. " alt="" coords="1125,122,1332,149"/>
<area shape="rect" id="node5" href="classfoedus_1_1DefaultInitializable.html" title="Typical implementation of Initializable as a skeleton base class. " alt="" coords="756,98,928,125"/>
<area shape="rect" id="node6" href="classfoedus_1_1Initializable.html" title="The pure&#45;virtual interface to initialize/uninitialize non&#45;trivial resources. " alt="" coords="407,90,539,117"/>
<area shape="rect" id="node7" href="structfoedus_1_1snapshot_1_1LogGleanerResource.html" title="Local resource for the log gleaner, which runs only in the master node. " alt="" coords="1131,205,1326,247"/>
<area shape="rect" id="node9" href="structfoedus_1_1snapshot_1_1LogGleanerResource_1_1PerNodeResource.html" title="These buffers are used to read intermediate results from each reducer to compose the root page or oth..." alt="" coords="376,283,571,324"/>
<area shape="rect" id="node10" href="classfoedus_1_1memory_1_1AlignedMemory.html" title="Represents one memory block aligned to actual OS/hardware pages. " alt="" coords="5,253,219,279"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="fieldtable">
<tr><th colspan="3">Class Members</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a54873841faf29cc3f2f8b7e51d0c5eb3"></a>LogGleanerResource *</td>
<td class="fieldname">
gleaner_resource_</td>
<td class="fielddoc">
All pre-allocated resouces to help run <a class="el" href="classfoedus_1_1storage_1_1Composer.html#adf148cbea7c8146dec88d23d2218452c" title="Construct root page(s) for one storage based on the ouputs of compose(). ">construct_root()</a>, such as memory buffers. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a5fe97ae932df0a5ff337429b38d27ddf"></a><a class="el" href="group__STORAGE.html#ga629d4b8103bfb83ef9c11b842a4fd398">SnapshotPagePointer</a> *</td>
<td class="fieldname">
new_root_page_pointer_</td>
<td class="fielddoc">
[OUT] Returns pointer to new root snapshot page/ </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ad93f59f4f2671486832c3baa3e73562c"></a>SnapshotFileSet *</td>
<td class="fieldname">
previous_snapshot_files_</td>
<td class="fielddoc">
To read existing snapshots. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a50a94b00807fe3666996480562b31072"></a>const <a class="el" href="structfoedus_1_1storage_1_1Page.html">Page</a> *const *</td>
<td class="fieldname">
root_info_pages_</td>
<td class="fielddoc">
Root info pages output by <a class="el" href="classfoedus_1_1storage_1_1Composer.html#a28c752ec784b85418c0bfafab7ee60c0" title="Construct snapshot pages from sorted run files of one storage. ">compose()</a> </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a5bc4649af515f379e0b35ce47eee9085"></a>uint32_t</td>
<td class="fieldname">
root_info_pages_count_</td>
<td class="fielddoc">
Number of root info pages. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a2e4631f50021ca8d5a351403eaf92768"></a>SnapshotWriter *</td>
<td class="fieldname">
snapshot_writer_</td>
<td class="fielddoc">
Writes out composed pages. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="gad2482840d665e70d93678f530b452b79"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="group__SNAPSHOT.html#gad2482840d665e70d93678f530b452b79">foedus::snapshot::BufferPosition</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Represents a position in some buffer. </p>
<p>As log is always 8-byte aligned, we divide the original byte position by 8. Thus, this can represent up to 8 * 2^32=32GB, which is the maximum value of log_mapper_io_buffer_mb_. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="namespacefoedus_1_1snapshot.html#a6ecb433ddae550c78d00cbbbdc510301">to_buffer_position</a> </dd>
<dd>
<a class="el" href="namespacefoedus_1_1snapshot.html#a499edf9829f41f833e2057346e8bbf3a">from_buffer_position</a> </dd></dl>

<p>Definition at line <a class="el" href="snapshot__id_8hpp_source.html#l00072">72</a> of file <a class="el" href="snapshot__id_8hpp_source.html">snapshot_id.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="gaec32eb05303ebec1048d120f73295031"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint16_t <a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">foedus::snapshot::SnapshotId</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unique ID of <a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html" title="Represents one snapshot that converts all logs from base epoch to valid_until epoch into snapshot fil...">Snapshot</a>. </p>
<p><a class="el" href="structfoedus_1_1snapshot_1_1Snapshot.html" title="Represents one snapshot that converts all logs from base epoch to valid_until epoch into snapshot fil...">Snapshot</a> ID is a 16-bit integer. As we periodically merge all snapshots, we won't have 2^16 snapshots at one time. This ID wraps around, but it causes no issue as we never compare greater-than/less-than between snapshot ID. All snapshots contain base and valid_until epochs, so we just compare them.</p>
<p>ID-0 is a special value that means NULL. Use the following method to increment a snapshot ID to preserve this invariant. </p>

<p>Definition at line <a class="el" href="snapshot__id_8hpp_source.html#l00043">43</a> of file <a class="el" href="snapshot__id_8hpp_source.html">snapshot_id.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gad1370b531dc11ee1b942d3d8ad829730"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SnapshotId foedus::snapshot::increment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__SNAPSHOT.html#gaec32eb05303ebec1048d120f73295031">SnapshotId</a>&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Increment SnapshotId. </p>
<dl class="section invariant"><dt>Invariant</dt><dd>id != kNullSnapshotId </dd></dl>

<p>Definition at line <a class="el" href="snapshot__id_8hpp_source.html#l00052">52</a> of file <a class="el" href="snapshot__id_8hpp_source.html">snapshot_id.hpp</a>.</p>

<p>References <a class="el" href="assert__nd_8hpp_source.html#l00072">ASSERT_ND</a>.</p>

<p>Referenced by <a class="el" href="snapshot__manager__pimpl_8cpp_source.html#l00316">foedus::snapshot::SnapshotManagerPimpl::handle_snapshot_triggered()</a>, and <a class="el" href="snapshot__manager__pimpl_8hpp_source.html#l00239">foedus::snapshot::SnapshotManagerPimpl::issue_next_snapshot_id()</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                           {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a>(<span class="keywordtype">id</span> != <a class="code" href="namespacefoedus_1_1snapshot.html#a26a2120f7b28c565f2d22ff799ee2280">kNullSnapshotId</a>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  ++id;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code" href="namespacefoedus_1_1snapshot.html#a26a2120f7b28c565f2d22ff799ee2280">kNullSnapshotId</a>) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">return</span> 1;  <span class="comment">// wrap around, and skip 0.</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">return</span> id;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div>
<div class="ttc" id="namespacefoedus_1_1snapshot_html_a26a2120f7b28c565f2d22ff799ee2280"><div class="ttname"><a href="namespacefoedus_1_1snapshot.html#a26a2120f7b28c565f2d22ff799ee2280">foedus::snapshot::kNullSnapshotId</a></div><div class="ttdeci">const SnapshotId kNullSnapshotId</div><div class="ttdef"><b>Definition:</b> <a href="snapshot__id_8hpp_source.html#l00045">snapshot_id.hpp:45</a></div></div>
<div class="ttc" id="group__IDIOMS_html_gaa5c1d074da423c0f330d1bc8a098ecb8"><div class="ttname"><a href="group__IDIOMS.html#gaa5c1d074da423c0f330d1bc8a098ecb8">ASSERT_ND</a></div><div class="ttdeci">#define ASSERT_ND(x)</div><div class="ttdoc">A warning-free wrapper macro of assert() that has no performance effect in release mode even when &#39;x&#39;...</div><div class="ttdef"><b>Definition:</b> <a href="assert__nd_8hpp_source.html#l00072">assert_nd.hpp:72</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__SNAPSHOT_gad1370b531dc11ee1b942d3d8ad829730_icgraph.png" border="0" usemap="#group__SNAPSHOT_gad1370b531dc11ee1b942d3d8ad829730_icgraph" alt=""/></div>
<map name="group__SNAPSHOT_gad1370b531dc11ee1b942d3d8ad829730_icgraph" id="group__SNAPSHOT_gad1370b531dc11ee1b942d3d8ad829730_icgraph">
<area shape="rect" id="node2" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a905ccf76fe0e076980dc1965f038fe10" title="handle_snapshot() calls this when it should start snapshotting. " alt="" coords="240,30,451,86"/>
<area shape="rect" id="node7" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#aa267f8a5bae1442133dc336aa5e9e8c9" title="foedus::snapshot::Snapshot\lManagerPimpl::issue_next\l_snapshot_id" alt="" coords="253,110,437,166"/>
<area shape="rect" id="node3" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a8c5418a3e6d3558aa3920a605834df08" title="Recover the state of database from recent snapshot files and transaction logs. " alt="" coords="527,5,681,47"/>
<area shape="rect" id="node5" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a64e3c7594b7d7d0d5f8a144bd802d910" title="Main routine for snapshot_thread_ in master engine. " alt="" coords="499,71,709,112"/>
<area shape="rect" id="node4" href="classfoedus_1_1restart_1_1RestartManagerPimpl.html#a868dca9015af77e04202ead68fd7a136" title="foedus::restart::Restart\lManagerPimpl::initialize_once" alt="" coords="757,5,952,47"/>
<area shape="rect" id="node6" href="classfoedus_1_1snapshot_1_1SnapshotManagerPimpl.html#a632a4da7b3c67dd687f7eba4f6ec1d76" title="foedus::snapshot::Snapshot\lManagerPimpl::initialize_once" alt="" coords="757,71,952,112"/>
</map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
